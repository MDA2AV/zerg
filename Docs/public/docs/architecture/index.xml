<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>zerg – Architecture</title>
    <link>http://localhost:1313/zerg/docs/architecture/</link>
    <description>Recent content in Architecture on zerg</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    
	  <atom:link href="http://localhost:1313/zerg/docs/architecture/index.xml" rel="self" type="application/rss+xml" />
    
    
      
        
      
    
    
    <item>
      <title>Reactor Pattern</title>
      <link>http://localhost:1313/zerg/docs/architecture/reactor-pattern/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>http://localhost:1313/zerg/docs/architecture/reactor-pattern/</guid>
      <description>
        
        
        &lt;p&gt;zerg implements a classic &lt;strong&gt;reactor pattern&lt;/strong&gt; with a split-architecture design: one dedicated acceptor thread and N independent reactor threads.&lt;/p&gt;
&lt;h2&gt;Overview&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;overview&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#overview&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;div id=&#34;reactor-diagram&#34; style=&#34;position:relative;width:100%;max-width:800px;margin:2rem auto;font-family:system-ui,sans-serif;user-select:none&#34;&gt;
&lt;style&gt;
  #reactor-diagram *{box-sizing:border-box}
  #reactor-diagram .zone{border-radius:12px;padding:20px;margin-bottom:16px;position:relative}
  #reactor-diagram .zone-kernel{background:linear-gradient(135deg,#1a1a2e,#16213e);border:1px solid #2a3a5c}
  #reactor-diagram .zone-user{background:linear-gradient(135deg,#0f1729,#131b2e);border:1px solid #1e2d4a}
  #reactor-diagram .zone-label{position:absolute;top:10px;right:14px;font-size:10px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:#4a5e7a}
  #reactor-diagram .node{border-radius:10px;padding:14px 18px;text-align:center;position:relative;transition:transform .2s,box-shadow .2s}
  #reactor-diagram .node:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(59,130,246,.2)}
  #reactor-diagram .node-client{background:linear-gradient(135deg,#1e3a5f,#1a2d4a);border:1px solid #2e5a8a;color:#7eb8f0}
  #reactor-diagram .node-acceptor{background:linear-gradient(135deg,#2d1b4e,#1f1338);border:1px solid #5b3a8a;color:#c4a5f0}
  #reactor-diagram .node-reactor{background:linear-gradient(135deg,#1b3a2e,#132a1f);border:1px solid #2e7a5a;color:#7ef0b8;flex:1;min-width:0}
  #reactor-diagram .node-app{background:linear-gradient(135deg,#3a2a1b,#2a1f13);border:1px solid #8a6a2e;color:#f0d07e}
  #reactor-diagram .node-title{font-weight:700;font-size:14px;margin-bottom:6px}
  #reactor-diagram .node-sub{font-size:11px;opacity:.7;line-height:1.5}
  #reactor-diagram .connector{display:flex;align-items:center;justify-content:center;padding:8px 0;position:relative}
  #reactor-diagram .connector-line{width:2px;height:32px;background:linear-gradient(to bottom,transparent,#3b82f6,transparent)}
  #reactor-diagram .connector-fan{display:flex;gap:12px;justify-content:center;align-items:flex-start;position:relative;padding-top:8px}
  #reactor-diagram .connector-arrow{color:#3b82f6;font-size:13px;font-weight:700;animation:pulse-arrow 2s infinite}
  #reactor-diagram .connector-arrow-rr{color:#8b5cf6;font-size:11px;font-weight:600}
  #reactor-diagram .badge{display:inline-block;font-size:10px;font-weight:600;padding:2px 8px;border-radius:20px;margin:2px}
  #reactor-diagram .badge-uring{background:rgba(139,92,246,.2);color:#a78bfa;border:1px solid rgba(139,92,246,.3)}
  #reactor-diagram .badge-buf{background:rgba(59,130,246,.15);color:#60a5fa;border:1px solid rgba(59,130,246,.3)}
  #reactor-diagram .badge-queue{background:rgba(16,185,129,.15);color:#34d399;border:1px solid rgba(16,185,129,.3)}
  #reactor-diagram .badge-lock{background:rgba(245,158,11,.15);color:#fbbf24;border:1px solid rgba(245,158,11,.3)}
  #reactor-diagram .flow-dot{width:6px;height:6px;border-radius:50%;background:#3b82f6;position:absolute;animation:flow-down 2s infinite}
  #reactor-diagram .reactor-internals{display:flex;flex-wrap:wrap;gap:4px;margin-top:8px;justify-content:center}
  #reactor-diagram .clients-grid{display:flex;gap:6px;justify-content:center;flex-wrap:wrap;margin-bottom:8px}
  #reactor-diagram .client-dot{width:36px;height:36px;border-radius:50%;background:linear-gradient(135deg,#2563eb,#1d4ed8);border:2px solid #3b82f6;display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:700;color:#bfdbfe;transition:transform .2s}
  #reactor-diagram .client-dot:hover{transform:scale(1.15)}
  @keyframes pulse-arrow{0%,100%{opacity:.4}50%{opacity:1}}
  @keyframes flow-down{0%{top:0;opacity:0}50%{opacity:1}100%{top:100%;opacity:0}}
  @media(max-width:640px){
    #reactor-diagram .connector-fan{flex-direction:column;align-items:center}
    #reactor-diagram .node-reactor{width:100%}
  }
&lt;/style&gt;
&lt;!-- Kernel Space --&gt;
&lt;div class=&#34;zone zone-kernel&#34;&gt;
  &lt;div class=&#34;zone-label&#34;&gt;Kernel Space&lt;/div&gt;
  &lt;div class=&#34;clients-grid&#34;&gt;
    &lt;div class=&#34;client-dot&#34;&gt;C1&lt;/div&gt;
    &lt;div class=&#34;client-dot&#34;&gt;C2&lt;/div&gt;
    &lt;div class=&#34;client-dot&#34;&gt;C3&lt;/div&gt;
    &lt;div class=&#34;client-dot&#34;&gt;C4&lt;/div&gt;
    &lt;div class=&#34;client-dot&#34;&gt;C5&lt;/div&gt;
    &lt;div class=&#34;client-dot&#34; style=&#34;opacity:.5&#34;&gt;...&lt;/div&gt;
  &lt;/div&gt;
  &lt;div style=&#34;text-align:center;margin-top:4px&#34;&gt;
    &lt;span class=&#34;connector-arrow&#34;&gt;TCP&lt;/span&gt;
    &lt;span style=&#34;color:#4a5e7a;font-size:12px&#34;&gt; &amp;darr; &lt;/span&gt;
  &lt;/div&gt;
  &lt;div class=&#34;node node-client&#34; style=&#34;max-width:320px;margin:8px auto 0&#34;&gt;
    &lt;div class=&#34;node-title&#34;&gt;Listening Socket&lt;/div&gt;
    &lt;div class=&#34;node-sub&#34;&gt;bind + listen &amp;bull; backlog queue&lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;
&lt;!-- Connector --&gt;
&lt;div class=&#34;connector&#34;&gt;&lt;div class=&#34;connector-line&#34; style=&#34;position:relative&#34;&gt;&lt;div class=&#34;flow-dot&#34;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;!-- User Space --&gt;
&lt;div class=&#34;zone zone-user&#34;&gt;
  &lt;div class=&#34;zone-label&#34;&gt;User Space&lt;/div&gt;
  &lt;!-- Acceptor --&gt;
  &lt;div class=&#34;node node-acceptor&#34; style=&#34;max-width:480px;margin:0 auto 16px&#34;&gt;
    &lt;div class=&#34;node-title&#34;&gt;Acceptor Thread&lt;/div&gt;
    &lt;div class=&#34;node-sub&#34;&gt;Single SQE &amp;rarr; multishot accept &amp;rarr; one CQE per connection&lt;/div&gt;
    &lt;div style=&#34;margin-top:8px&#34;&gt;
      &lt;span class=&#34;badge badge-uring&#34;&gt;io_uring&lt;/span&gt;
      &lt;span class=&#34;badge badge-lock&#34;&gt;TCP_NODELAY&lt;/span&gt;
    &lt;/div&gt;
  &lt;/div&gt;
  &lt;!-- Round Robin label --&gt;
  &lt;div style=&#34;text-align:center;padding:4px 0&#34;&gt;
    &lt;span class=&#34;connector-arrow-rr&#34;&gt;round-robin fd distribution&lt;/span&gt;
    &lt;div style=&#34;display:flex;justify-content:center;gap:60px;margin-top:6px&#34;&gt;
      &lt;span class=&#34;connector-arrow&#34;&gt;&amp;darr;&lt;/span&gt;
      &lt;span class=&#34;connector-arrow&#34; style=&#34;animation-delay:.3s&#34;&gt;&amp;darr;&lt;/span&gt;
      &lt;span class=&#34;connector-arrow&#34; style=&#34;animation-delay:.6s&#34;&gt;&amp;darr;&lt;/span&gt;
    &lt;/div&gt;
    &lt;div style=&#34;display:flex;justify-content:center;gap:30px;margin-top:2px&#34;&gt;
      &lt;span class=&#34;badge badge-queue&#34;&gt;ConcurrentQueue&lt;/span&gt;
      &lt;span class=&#34;badge badge-queue&#34;&gt;ConcurrentQueue&lt;/span&gt;
      &lt;span class=&#34;badge badge-queue&#34;&gt;ConcurrentQueue&lt;/span&gt;
    &lt;/div&gt;
  &lt;/div&gt;
  &lt;!-- Reactors --&gt;
  &lt;div class=&#34;connector-fan&#34; style=&#34;margin-top:12px&#34;&gt;
    &lt;div class=&#34;node node-reactor&#34;&gt;
      &lt;div class=&#34;node-title&#34;&gt;Reactor 0&lt;/div&gt;
      &lt;div class=&#34;reactor-internals&#34;&gt;
        &lt;span class=&#34;badge badge-uring&#34;&gt;io_uring&lt;/span&gt;
        &lt;span class=&#34;badge badge-buf&#34;&gt;buf_ring&lt;/span&gt;
        &lt;span class=&#34;badge badge-queue&#34;&gt;SPSC ring&lt;/span&gt;
      &lt;/div&gt;
      &lt;div class=&#34;reactor-internals&#34;&gt;
        &lt;span class=&#34;badge badge-lock&#34;&gt;conn_map&lt;/span&gt;
        &lt;span class=&#34;badge badge-queue&#34;&gt;flush_Q&lt;/span&gt;
      &lt;/div&gt;
      &lt;div class=&#34;node-sub&#34; style=&#34;margin-top:6px&#34;&gt;multishot recv + send&lt;/div&gt;
    &lt;/div&gt;
    &lt;div class=&#34;node node-reactor&#34;&gt;
      &lt;div class=&#34;node-title&#34;&gt;Reactor 1&lt;/div&gt;
      &lt;div class=&#34;reactor-internals&#34;&gt;
        &lt;span class=&#34;badge badge-uring&#34;&gt;io_uring&lt;/span&gt;
        &lt;span class=&#34;badge badge-buf&#34;&gt;buf_ring&lt;/span&gt;
        &lt;span class=&#34;badge badge-queue&#34;&gt;SPSC ring&lt;/span&gt;
      &lt;/div&gt;
      &lt;div class=&#34;reactor-internals&#34;&gt;
        &lt;span class=&#34;badge badge-lock&#34;&gt;conn_map&lt;/span&gt;
        &lt;span class=&#34;badge badge-queue&#34;&gt;flush_Q&lt;/span&gt;
      &lt;/div&gt;
      &lt;div class=&#34;node-sub&#34; style=&#34;margin-top:6px&#34;&gt;multishot recv + send&lt;/div&gt;
    &lt;/div&gt;
    &lt;div class=&#34;node node-reactor&#34;&gt;
      &lt;div class=&#34;node-title&#34;&gt;Reactor N&lt;/div&gt;
      &lt;div class=&#34;reactor-internals&#34;&gt;
        &lt;span class=&#34;badge badge-uring&#34;&gt;io_uring&lt;/span&gt;
        &lt;span class=&#34;badge badge-buf&#34;&gt;buf_ring&lt;/span&gt;
        &lt;span class=&#34;badge badge-queue&#34;&gt;SPSC ring&lt;/span&gt;
      &lt;/div&gt;
      &lt;div class=&#34;reactor-internals&#34;&gt;
        &lt;span class=&#34;badge badge-lock&#34;&gt;conn_map&lt;/span&gt;
        &lt;span class=&#34;badge badge-queue&#34;&gt;flush_Q&lt;/span&gt;
      &lt;/div&gt;
      &lt;div class=&#34;node-sub&#34; style=&#34;margin-top:6px&#34;&gt;multishot recv + send&lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
  &lt;!-- Channel --&gt;
  &lt;div class=&#34;connector&#34;&gt;&lt;div class=&#34;connector-line&#34; style=&#34;position:relative&#34;&gt;&lt;div class=&#34;flow-dot&#34; style=&#34;animation-delay:.5s&#34;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;
  &lt;div style=&#34;text-align:center&#34;&gt;
    &lt;span class=&#34;badge badge-queue&#34; style=&#34;font-size:12px;padding:4px 14px&#34;&gt;Channel&amp;lt;ConnectionItem&amp;gt;&lt;/span&gt;
  &lt;/div&gt;
  &lt;div class=&#34;connector&#34;&gt;&lt;div class=&#34;connector-line&#34; style=&#34;position:relative&#34;&gt;&lt;div class=&#34;flow-dot&#34; style=&#34;animation-delay:1s&#34;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;
  &lt;!-- Application --&gt;
  &lt;div class=&#34;node node-app&#34; style=&#34;max-width:480px;margin:0 auto&#34;&gt;
    &lt;div class=&#34;node-title&#34;&gt;Application Handlers&lt;/div&gt;
    &lt;div class=&#34;node-sub&#34;&gt;Engine.AcceptAsync() &amp;rarr; ReadAsync &amp;harr; Write + FlushAsync&lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Every thread in the system owns its own &lt;code&gt;io_uring&lt;/code&gt; instance. There is no shared ring, and no lock contention on the I/O path.&lt;/p&gt;
&lt;h2&gt;Acceptor Thread&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;acceptor-thread&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#acceptor-thread&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;The acceptor is responsible for one job: accepting new TCP connections.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Creates a listening socket (IPv4 or IPv6 dual-stack, configurable via &lt;code&gt;IPVersion&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;Binds and listens with the configured &lt;code&gt;Backlog&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Sets up its own &lt;code&gt;io_uring&lt;/code&gt; and arms a &lt;strong&gt;multishot accept&lt;/strong&gt; SQE&lt;/li&gt;
&lt;li&gt;Enters an event loop that:
&lt;ul&gt;
&lt;li&gt;Peeks a batch of CQEs (accepted file descriptors)&lt;/li&gt;
&lt;li&gt;Sets &lt;code&gt;TCP_NODELAY&lt;/code&gt; on each accepted socket&lt;/li&gt;
&lt;li&gt;Distributes fds to reactors in round-robin order via lock-free &lt;code&gt;ConcurrentQueue&amp;lt;int&amp;gt;&lt;/code&gt; (one per reactor)&lt;/li&gt;
&lt;li&gt;Sleeps in &lt;code&gt;io_uring_wait_cqes()&lt;/code&gt; when idle&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Multishot accept means a single submission produces a CQE for every incoming connection without re-arming. The acceptor never allocates per-connection &amp;ndash; it just hands off integer file descriptors.&lt;/p&gt;
&lt;h3&gt;Acceptor Event Loop&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;acceptor-event-loop&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#acceptor-event-loop&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;loop:
    cqeCount = peek_batch_cqe(ring, cqes, batchSize)
    if cqeCount == 0:
        submit_and_wait_timeout(ring, timeout)
        continue

    for each cqe in cqes:
        if cqe.res &amp;lt; 0:
            log error, continue
        clientFd = cqe.res
        setsockopt(clientFd, TCP_NODELAY)
        reactorQueues[nextReactor&amp;#43;&amp;#43; % reactorCount].Enqueue(clientFd)

    cq_advance(ring, cqeCount)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2&gt;Reactor Threads&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;reactor-threads&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#reactor-threads&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;Each reactor thread owns:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Its own &lt;code&gt;io_uring&lt;/code&gt; instance (created with &lt;code&gt;SINGLE_ISSUER | DEFER_TASKRUN&lt;/code&gt; by default)&lt;/li&gt;
&lt;li&gt;A &lt;strong&gt;buffer ring&lt;/strong&gt; for zero-copy receive operations&lt;/li&gt;
&lt;li&gt;A &lt;code&gt;Dictionary&amp;lt;int, Connection&amp;gt;&lt;/code&gt; mapping file descriptors to connection objects&lt;/li&gt;
&lt;li&gt;Lock-free queues for receiving new fds from the acceptor and flush requests from handlers&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Reactor Event Loop&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;reactor-event-loop&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#reactor-event-loop&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;Each reactor runs a tight loop:&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;loop:
    // 1. Drain newly accepted connections
    while reactorQueue.TryDequeue(out clientFd):
        connection = pool.Get() or new Connection()
        connection.SetFd(clientFd).SetReactor(this)
        connections[clientFd] = connection
        arm multishot_recv_select(clientFd, bufferGroupId)
        notify application via Channel

    // 2. Drain buffer returns
    while returnQ.TryDequeue(out bufferId):
        buf_ring_add(bufferRing, slab &amp;#43; bufferId * bufSize, bufSize, bufferId, mask, idx&amp;#43;&amp;#43;)
    buf_ring_advance(bufferRing, returnCount)

    // 3. Drain flush requests
    while flushQ.TryDequeue(out flushFd):
        connection = connections[flushFd]
        prep_send(sqe, flushFd, connection.WriteBuffer, connection.WriteInFlight, 0)
        submit pending sends

    // 4. Process completions
    cqeCount = peek_batch_cqe(ring, cqes, batchSize)
    for each cqe:
        kind = UdKindOf(cqe.user_data)
        fd   = UdFdOf(cqe.user_data)

        if kind == Recv:
            if cqe.res &amp;lt;= 0: close connection, return buffer
            else: enqueue RingItem to connection, wake handler

        if kind == Send:
            advance WriteHead, resubmit if partial, signal flush complete

        if kind == Cancel:
            handle cancellation completion

    cq_advance(ring, cqeCount)
    submit_and_wait_timeout(ring, timeout)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2&gt;Connection Distribution&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;connection-distribution&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#connection-distribution&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;The acceptor distributes connections using a simple round-robin counter:&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;reactorIndex = acceptCount&amp;#43;&amp;#43; % reactorCount&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Each reactor gets approximately equal load. The distribution is via &lt;code&gt;ConcurrentQueue&amp;lt;int&amp;gt;&lt;/code&gt; &amp;ndash; one queue per reactor &amp;ndash; so the acceptor never blocks waiting for a reactor.&lt;/p&gt;
&lt;h2&gt;Application Integration&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;application-integration&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#application-integration&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;After a reactor registers a new connection, it pushes a &lt;code&gt;ConnectionItem&lt;/code&gt; (reactor ID + client fd) into an unbounded &lt;code&gt;Channel&amp;lt;ConnectionItem&amp;gt;&lt;/code&gt;. The &lt;code&gt;Engine.AcceptAsync()&lt;/code&gt; method reads from this channel, returning fully-registered &lt;code&gt;Connection&lt;/code&gt; objects to the application.&lt;/p&gt;
&lt;p&gt;This means by the time your handler receives a connection:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The connection is already assigned to a reactor&lt;/li&gt;
&lt;li&gt;Multishot recv is already armed&lt;/li&gt;
&lt;li&gt;The buffer ring is ready to receive data&lt;/li&gt;
&lt;li&gt;You can immediately call &lt;code&gt;ReadAsync()&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
    <item>
      <title>io_uring</title>
      <link>http://localhost:1313/zerg/docs/architecture/io-uring/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>http://localhost:1313/zerg/docs/architecture/io-uring/</guid>
      <description>
        
        
        &lt;p&gt;&lt;code&gt;io_uring&lt;/code&gt; is a Linux kernel interface for asynchronous I/O. zerg uses it as its sole I/O mechanism &amp;ndash; there are no &lt;code&gt;epoll&lt;/code&gt;, &lt;code&gt;kqueue&lt;/code&gt;, or &lt;code&gt;libuv&lt;/code&gt; fallbacks.&lt;/p&gt;
&lt;style&gt;
  #iouring-guide { --bg: #0b0d11; --bg2: #12151c; --bg3: #181c25; --bg4: #1e2330; --border: #2a3040; --text: #e0e4ef; --text2: #8a90a8; --muted: #555c73; --blue: #4a90ff; --cyan: #3ee8d0; --green: #3ee88a; --orange: #ff8a3e; --red: #ff4a5e; --purple: #a06aff; --yellow: #ffd04a; }
  #iouring-guide * { box-sizing: border-box; }
  #iouring-guide .iu-section { margin: 3rem 0; }
  #iouring-guide .iu-stag { display:inline-block; padding:.2rem .65rem; border-radius:5px; font-size:.7rem; font-weight:700; text-transform:uppercase; letter-spacing:1.2px; margin-bottom:.75rem; }
  #iouring-guide .iu-stag-blue { background:rgba(74,144,255,.12); color:var(--blue); border:1px solid rgba(74,144,255,.2); }
  #iouring-guide .iu-stag-cyan { background:rgba(62,232,208,.1); color:var(--cyan); border:1px solid rgba(62,232,208,.2); }
  #iouring-guide .iu-stag-green { background:rgba(62,232,138,.1); color:var(--green); border:1px solid rgba(62,232,138,.2); }
  #iouring-guide .iu-stag-orange { background:rgba(255,138,62,.1); color:var(--orange); border:1px solid rgba(255,138,62,.2); }
  #iouring-guide .iu-stag-purple { background:rgba(160,106,255,.1); color:var(--purple); border:1px solid rgba(160,106,255,.2); }
  #iouring-guide .iu-lead { color:var(--text2); font-size:1.05rem; margin-bottom:2rem; max-width:650px; }
  #iouring-guide .ring-svg { width:100%; height:auto; display:block; }
  #iouring-guide .svg-text { font-family:&#39;Inter&#39;,system-ui,sans-serif; fill:var(--text); }
  #iouring-guide .svg-mono { font-family:&#39;JetBrains Mono&#39;,ui-monospace,monospace; fill:var(--text2); }
  #iouring-guide .iu-cards { display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:1rem; margin-top:1.5rem; }
  #iouring-guide .iu-card { background:var(--bg3); border:1px solid var(--border); border-radius:12px; padding:1.25rem; transition:border-color .3s; }
  #iouring-guide .iu-card:hover { border-color:rgba(62,232,208,.3); }
  #iouring-guide .iu-card h4 { font-size:.9rem; font-weight:700; margin-bottom:.35rem; }
  #iouring-guide .iu-card p { font-size:.82rem; color:var(--text2); line-height:1.55; }
  #iouring-guide .iu-card code { font-family:&#39;JetBrains Mono&#39;,ui-monospace,monospace; font-size:.78rem; background:var(--bg); padding:.1rem .35rem; border-radius:4px; color:var(--cyan); }
  #iouring-guide .iu-two-col { display:grid; grid-template-columns:1fr 1fr; gap:2rem; align-items:start; }
  @media (max-width:800px) { #iouring-guide .iu-two-col { grid-template-columns:1fr; } }
  #iouring-guide .iu-divider { width:100%; height:1px; background:linear-gradient(90deg,transparent,var(--border),transparent); margin:2.5rem 0; }
  /* Stepper */
  #iouring-guide .stepper { display:flex; align-items:center; gap:1rem; justify-content:center; margin:1.5rem 0 1rem; }
  #iouring-guide .step-btn { width:40px; height:40px; border-radius:50%; border:2px solid var(--border); background:var(--bg3); color:var(--text); font-size:1rem; cursor:pointer; display:flex; align-items:center; justify-content:center; transition:all .2s; }
  #iouring-guide .step-btn:hover { border-color:var(--cyan); color:var(--cyan); }
  #iouring-guide .step-btn:disabled { opacity:.3; cursor:default; }
  #iouring-guide .step-dots { display:flex; gap:.4rem; }
  #iouring-guide .step-dot { width:10px; height:10px; border-radius:50%; background:var(--bg4); border:2px solid var(--border); transition:all .3s; cursor:pointer; }
  #iouring-guide .step-dot.active { background:var(--cyan); border-color:var(--cyan); box-shadow:0 0 8px rgba(62,232,208,.4); }
  #iouring-guide .step-dot.done { background:var(--muted); border-color:var(--muted); }
  #iouring-guide .step-desc { background:var(--bg3); border:1px solid var(--border); border-radius:12px; padding:1.25rem 1.5rem; margin-bottom:1rem; min-height:70px; }
  #iouring-guide .step-desc h4 { font-size:.95rem; font-weight:700; margin-bottom:.35rem; }
  #iouring-guide .step-desc p { font-size:.88rem; color:var(--text2); line-height:1.6; }
  #iouring-guide .step-desc code { font-family:&#39;JetBrains Mono&#39;,ui-monospace,monospace; font-size:.78rem; background:var(--bg); padding:.1rem .35rem; border-radius:4px; color:var(--cyan); }
  /* Step elements */
  #iouring-guide .step-el { opacity:0; transition:opacity .5s,transform .5s; transform:translateY(8px); pointer-events:none; }
  #iouring-guide .step-el.show { opacity:1; transform:translateY(0); pointer-events:auto; }
  /* Full flow panels */
  #iouring-guide .ff-panel { animation:iuFadeIn .45s ease both; }
  @keyframes iuFadeIn { from{opacity:0;transform:translateY(16px)} to{opacity:1;transform:translateY(0)} }
  /* Phase bar */
  #iouring-guide .phase-bar { display:flex; gap:2px; margin-bottom:1.5rem; border-radius:8px; overflow:hidden; }
  #iouring-guide .phase-seg { flex:1; height:6px; background:var(--bg4); transition:background .4s; }
  /* Codeblock */
  #iouring-guide .iu-codeblock { background:var(--bg); border:1px solid var(--border); border-radius:10px; overflow:hidden; }
  #iouring-guide .iu-codeblock-head { padding:.5rem 1rem; background:rgba(255,255,255,.02); border-bottom:1px solid var(--border); font-size:.75rem; color:var(--muted); font-family:&#39;JetBrains Mono&#39;,ui-monospace,monospace; }
  #iouring-guide .iu-codeblock pre { padding:1rem 1.25rem; font-family:&#39;JetBrains Mono&#39;,ui-monospace,monospace; font-size:.8rem; line-height:1.7; overflow-x:auto; color:var(--text); margin:0; }
  #iouring-guide .kw { color:#c792ea; } #iouring-guide .ty { color:#82aaff; } #iouring-guide .fn { color:#ffd700; } #iouring-guide .cm { color:#546e7a; font-style:italic; } #iouring-guide .num { color:#f78c6c; } #iouring-guide .op { color:#89ddff; }
&lt;/style&gt;
&lt;div id=&#34;iouring-guide&#34;&gt;
&lt;!-- ═══════════════ SECTION 1: THE RING MODEL ═══════════════ --&gt;
&lt;div class=&#34;iu-section&#34;&gt;
&lt;div class=&#34;iu-stag iu-stag-blue&#34;&gt;The Ring Model&lt;/div&gt;
&lt;h3&gt;How io_uring Works&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;how-io_uring-works&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#how-io_uring-works&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p class=&#34;iu-lead&#34;&gt;io_uring uses two lock-free ring buffers shared between userspace and the kernel. Your app writes SQEs (requests), the kernel writes CQEs (results). No syscall needed for submission.&lt;/p&gt;
&lt;svg viewBox=&#34;0 0 900 520&#34; class=&#34;ring-svg&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;
  &lt;defs&gt;
    &lt;linearGradient id=&#34;gSQ&#34; x1=&#34;0&#34; y1=&#34;0&#34; x2=&#34;1&#34; y2=&#34;1&#34;&gt;&lt;stop offset=&#34;0%&#34; stop-color=&#34;#4a90ff&#34;/&gt;&lt;stop offset=&#34;100%&#34; stop-color=&#34;#3e6aff&#34;/&gt;&lt;/linearGradient&gt;
    &lt;linearGradient id=&#34;gCQ&#34; x1=&#34;0&#34; y1=&#34;0&#34; x2=&#34;1&#34; y2=&#34;1&#34;&gt;&lt;stop offset=&#34;0%&#34; stop-color=&#34;#3ee88a&#34;/&gt;&lt;stop offset=&#34;100%&#34; stop-color=&#34;#2ab870&#34;/&gt;&lt;/linearGradient&gt;
    &lt;linearGradient id=&#34;gK&#34; x1=&#34;0&#34; y1=&#34;0&#34; x2=&#34;1&#34; y2=&#34;1&#34;&gt;&lt;stop offset=&#34;0%&#34; stop-color=&#34;#ff8a3e&#34;/&gt;&lt;stop offset=&#34;100%&#34; stop-color=&#34;#e06020&#34;/&gt;&lt;/linearGradient&gt;
    &lt;marker id=&#34;arrowB&#34; markerWidth=&#34;8&#34; markerHeight=&#34;6&#34; refX=&#34;8&#34; refY=&#34;3&#34; orient=&#34;auto&#34;&gt;&lt;polygon points=&#34;0 0, 8 3, 0 6&#34; fill=&#34;#4a90ff&#34;/&gt;&lt;/marker&gt;
    &lt;marker id=&#34;arrowG&#34; markerWidth=&#34;8&#34; markerHeight=&#34;6&#34; refX=&#34;8&#34; refY=&#34;3&#34; orient=&#34;auto&#34;&gt;&lt;polygon points=&#34;0 0, 8 3, 0 6&#34; fill=&#34;#3ee88a&#34;/&gt;&lt;/marker&gt;
    &lt;marker id=&#34;arrowO&#34; markerWidth=&#34;8&#34; markerHeight=&#34;6&#34; refX=&#34;8&#34; refY=&#34;3&#34; orient=&#34;auto&#34;&gt;&lt;polygon points=&#34;0 0, 8 3, 0 6&#34; fill=&#34;#ff8a3e&#34;/&gt;&lt;/marker&gt;
    &lt;filter id=&#34;glowB&#34;&gt;&lt;feDropShadow dx=&#34;0&#34; dy=&#34;0&#34; stdDeviation=&#34;4&#34; flood-color=&#34;#4a90ff&#34; flood-opacity=&#34;.5&#34;/&gt;&lt;/filter&gt;
    &lt;filter id=&#34;glowG&#34;&gt;&lt;feDropShadow dx=&#34;0&#34; dy=&#34;0&#34; stdDeviation=&#34;4&#34; flood-color=&#34;#3ee88a&#34; flood-opacity=&#34;.5&#34;/&gt;&lt;/filter&gt;
  &lt;/defs&gt;
  &lt;!-- USERSPACE BOX --&gt;
  &lt;rect x=&#34;30&#34; y=&#34;20&#34; width=&#34;840&#34; height=&#34;180&#34; rx=&#34;14&#34; fill=&#34;none&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;1.5&#34; stroke-dasharray=&#34;6 4&#34; opacity=&#34;.3&#34;/&gt;
  &lt;text x=&#34;55&#34; y=&#34;48&#34; class=&#34;svg-text&#34; font-size=&#34;13&#34; font-weight=&#34;700&#34; fill=&#34;#4a90ff&#34; opacity=&#34;.6&#34;&gt;USERSPACE (your C# app)&lt;/text&gt;
  &lt;!-- KERNEL BOX --&gt;
  &lt;rect x=&#34;30&#34; y=&#34;310&#34; width=&#34;840&#34; height=&#34;190&#34; rx=&#34;14&#34; fill=&#34;none&#34; stroke=&#34;#ff8a3e&#34; stroke-width=&#34;1.5&#34; stroke-dasharray=&#34;6 4&#34; opacity=&#34;.3&#34;/&gt;
  &lt;text x=&#34;55&#34; y=&#34;340&#34; class=&#34;svg-text&#34; font-size=&#34;13&#34; font-weight=&#34;700&#34; fill=&#34;#ff8a3e&#34; opacity=&#34;.6&#34;&gt;KERNEL&lt;/text&gt;
  &lt;!-- SHARED MEMORY BAND --&gt;
  &lt;rect x=&#34;30&#34; y=&#34;210&#34; width=&#34;840&#34; height=&#34;90&#34; rx=&#34;10&#34; fill=&#34;rgba(255,255,255,.02)&#34; stroke=&#34;#2a3040&#34; stroke-width=&#34;1&#34;/&gt;
  &lt;text x=&#34;450&#34; y=&#34;262&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#555c73&#34; text-anchor=&#34;middle&#34;&gt;SHARED MEMORY (mmap&#39;d)&lt;/text&gt;
  &lt;!-- SQ RING --&gt;
  &lt;g transform=&#34;translate(150, 220)&#34;&gt;
    &lt;rect x=&#34;0&#34; y=&#34;0&#34; width=&#34;220&#34; height=&#34;70&#34; rx=&#34;10&#34; fill=&#34;rgba(74,144,255,.08)&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;2&#34; filter=&#34;url(#glowB)&#34;/&gt;
    &lt;text x=&#34;110&#34; y=&#34;25&#34; class=&#34;svg-text&#34; font-size=&#34;14&#34; font-weight=&#34;800&#34; fill=&#34;#4a90ff&#34; text-anchor=&#34;middle&#34;&gt;Submission Queue&lt;/text&gt;
    &lt;rect x=&#34;12&#34; y=&#34;36&#34; width=&#34;28&#34; height=&#34;24&#34; rx=&#34;4&#34; fill=&#34;#4a90ff&#34; opacity=&#34;.8&#34;/&gt;&lt;text x=&#34;26&#34; y=&#34;52&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#fff&#34; text-anchor=&#34;middle&#34;&gt;SQE&lt;/text&gt;
    &lt;rect x=&#34;44&#34; y=&#34;36&#34; width=&#34;28&#34; height=&#34;24&#34; rx=&#34;4&#34; fill=&#34;#4a90ff&#34; opacity=&#34;.6&#34;/&gt;&lt;text x=&#34;58&#34; y=&#34;52&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#fff&#34; text-anchor=&#34;middle&#34;&gt;SQE&lt;/text&gt;
    &lt;rect x=&#34;76&#34; y=&#34;36&#34; width=&#34;28&#34; height=&#34;24&#34; rx=&#34;4&#34; fill=&#34;#4a90ff&#34; opacity=&#34;.4&#34;/&gt;&lt;text x=&#34;90&#34; y=&#34;52&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#fff&#34; text-anchor=&#34;middle&#34;&gt;SQE&lt;/text&gt;
    &lt;rect x=&#34;108&#34; y=&#34;36&#34; width=&#34;28&#34; height=&#34;24&#34; rx=&#34;4&#34; fill=&#34;rgba(74,144,255,.15)&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;1&#34; stroke-dasharray=&#34;3 2&#34;/&gt;
    &lt;rect x=&#34;140&#34; y=&#34;36&#34; width=&#34;28&#34; height=&#34;24&#34; rx=&#34;4&#34; fill=&#34;rgba(74,144,255,.15)&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;1&#34; stroke-dasharray=&#34;3 2&#34;/&gt;
    &lt;rect x=&#34;172&#34; y=&#34;36&#34; width=&#34;28&#34; height=&#34;24&#34; rx=&#34;4&#34; fill=&#34;rgba(74,144,255,.15)&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;1&#34; stroke-dasharray=&#34;3 2&#34;/&gt;
  &lt;/g&gt;
  &lt;!-- CQ RING --&gt;
  &lt;g transform=&#34;translate(530, 220)&#34;&gt;
    &lt;rect x=&#34;0&#34; y=&#34;0&#34; width=&#34;220&#34; height=&#34;70&#34; rx=&#34;10&#34; fill=&#34;rgba(62,232,138,.08)&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;2&#34; filter=&#34;url(#glowG)&#34;/&gt;
    &lt;text x=&#34;110&#34; y=&#34;25&#34; class=&#34;svg-text&#34; font-size=&#34;14&#34; font-weight=&#34;800&#34; fill=&#34;#3ee88a&#34; text-anchor=&#34;middle&#34;&gt;Completion Queue&lt;/text&gt;
    &lt;rect x=&#34;12&#34; y=&#34;36&#34; width=&#34;28&#34; height=&#34;24&#34; rx=&#34;4&#34; fill=&#34;#3ee88a&#34; opacity=&#34;.8&#34;/&gt;&lt;text x=&#34;26&#34; y=&#34;52&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#0a0a0f&#34; text-anchor=&#34;middle&#34;&gt;CQE&lt;/text&gt;
    &lt;rect x=&#34;44&#34; y=&#34;36&#34; width=&#34;28&#34; height=&#34;24&#34; rx=&#34;4&#34; fill=&#34;#3ee88a&#34; opacity=&#34;.6&#34;/&gt;&lt;text x=&#34;58&#34; y=&#34;52&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#0a0a0f&#34; text-anchor=&#34;middle&#34;&gt;CQE&lt;/text&gt;
    &lt;rect x=&#34;76&#34; y=&#34;36&#34; width=&#34;28&#34; height=&#34;24&#34; rx=&#34;4&#34; fill=&#34;rgba(62,232,138,.15)&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;1&#34; stroke-dasharray=&#34;3 2&#34;/&gt;
    &lt;rect x=&#34;108&#34; y=&#34;36&#34; width=&#34;28&#34; height=&#34;24&#34; rx=&#34;4&#34; fill=&#34;rgba(62,232,138,.15)&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;1&#34; stroke-dasharray=&#34;3 2&#34;/&gt;
    &lt;rect x=&#34;140&#34; y=&#34;36&#34; width=&#34;28&#34; height=&#34;24&#34; rx=&#34;4&#34; fill=&#34;rgba(62,232,138,.15)&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;1&#34; stroke-dasharray=&#34;3 2&#34;/&gt;
    &lt;rect x=&#34;172&#34; y=&#34;36&#34; width=&#34;28&#34; height=&#34;24&#34; rx=&#34;4&#34; fill=&#34;rgba(62,232,138,.15)&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;1&#34; stroke-dasharray=&#34;3 2&#34;/&gt;
  &lt;/g&gt;
  &lt;!-- ARROWS --&gt;
  &lt;line x1=&#34;260&#34; y1=&#34;150&#34; x2=&#34;260&#34; y2=&#34;215&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;2&#34; marker-end=&#34;url(#arrowB)&#34; opacity=&#34;.7&#34;/&gt;
  &lt;text x=&#34;278&#34; y=&#34;185&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#4a90ff&#34;&gt;write SQEs&lt;/text&gt;
  &lt;line x1=&#34;260&#34; y1=&#34;295&#34; x2=&#34;260&#34; y2=&#34;360&#34; stroke=&#34;#ff8a3e&#34; stroke-width=&#34;2&#34; marker-end=&#34;url(#arrowO)&#34; opacity=&#34;.7&#34;/&gt;
  &lt;text x=&#34;178&#34; y=&#34;335&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#ff8a3e&#34;&gt;kernel reads SQ&lt;/text&gt;
  &lt;line x1=&#34;640&#34; y1=&#34;360&#34; x2=&#34;640&#34; y2=&#34;295&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;2&#34; marker-end=&#34;url(#arrowG)&#34; opacity=&#34;.7&#34;/&gt;
  &lt;text x=&#34;655&#34; y=&#34;335&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#3ee88a&#34;&gt;kernel writes CQ&lt;/text&gt;
  &lt;line x1=&#34;640&#34; y1=&#34;215&#34; x2=&#34;640&#34; y2=&#34;150&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;2&#34; marker-end=&#34;url(#arrowG)&#34; opacity=&#34;.7&#34;/&gt;
  &lt;text x=&#34;655&#34; y=&#34;185&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#3ee88a&#34;&gt;read CQEs&lt;/text&gt;
  &lt;!-- Kernel processing --&gt;
  &lt;rect x=&#34;350&#34; y=&#34;370&#34; width=&#34;200&#34; height=&#34;60&#34; rx=&#34;10&#34; fill=&#34;rgba(255,138,62,.08)&#34; stroke=&#34;#ff8a3e&#34; stroke-width=&#34;1.5&#34;/&gt;
  &lt;text x=&#34;450&#34; y=&#34;395&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#ff8a3e&#34; text-anchor=&#34;middle&#34;&gt;I/O Processing&lt;/text&gt;
  &lt;text x=&#34;450&#34; y=&#34;415&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;accept / recv / send&lt;/text&gt;
  &lt;!-- App boxes --&gt;
  &lt;rect x=&#34;120&#34; y=&#34;70&#34; width=&#34;180&#34; height=&#34;65&#34; rx=&#34;10&#34; fill=&#34;#181c25&#34; stroke=&#34;#2a3040&#34; stroke-width=&#34;1&#34;/&gt;
  &lt;text x=&#34;210&#34; y=&#34;95&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; text-anchor=&#34;middle&#34;&gt;Your Code&lt;/text&gt;
  &lt;text x=&#34;210&#34; y=&#34;115&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;prep_recv, prep_send...&lt;/text&gt;
  &lt;rect x=&#34;570&#34; y=&#34;70&#34; width=&#34;200&#34; height=&#34;65&#34; rx=&#34;10&#34; fill=&#34;#181c25&#34; stroke=&#34;#2a3040&#34; stroke-width=&#34;1&#34;/&gt;
  &lt;text x=&#34;670&#34; y=&#34;95&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; text-anchor=&#34;middle&#34;&gt;Your Handler&lt;/text&gt;
  &lt;text x=&#34;670&#34; y=&#34;115&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;process results, route...&lt;/text&gt;
  &lt;!-- SQE STRUCTURE --&gt;
  &lt;g transform=&#34;translate(60,445)&#34;&gt;
    &lt;text x=&#34;0&#34; y=&#34;0&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; font-weight=&#34;700&#34; fill=&#34;#4a90ff&#34;&gt;SQE Structure (Submission)&lt;/text&gt;
    &lt;g transform=&#34;translate(0,12)&#34;&gt;
      &lt;rect x=&#34;0&#34; y=&#34;0&#34; width=&#34;80&#34; height=&#34;22&#34; rx=&#34;3&#34; fill=&#34;rgba(74,144,255,.12)&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;1&#34;/&gt;
      &lt;text x=&#34;40&#34; y=&#34;15&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#4a90ff&#34; text-anchor=&#34;middle&#34;&gt;opcode&lt;/text&gt;
      &lt;rect x=&#34;84&#34; y=&#34;0&#34; width=&#34;60&#34; height=&#34;22&#34; rx=&#34;3&#34; fill=&#34;rgba(74,144,255,.12)&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;1&#34;/&gt;
      &lt;text x=&#34;114&#34; y=&#34;15&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#4a90ff&#34; text-anchor=&#34;middle&#34;&gt;fd&lt;/text&gt;
      &lt;rect x=&#34;148&#34; y=&#34;0&#34; width=&#34;70&#34; height=&#34;22&#34; rx=&#34;3&#34; fill=&#34;rgba(74,144,255,.12)&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;1&#34;/&gt;
      &lt;text x=&#34;183&#34; y=&#34;15&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#4a90ff&#34; text-anchor=&#34;middle&#34;&gt;buf/len&lt;/text&gt;
      &lt;rect x=&#34;222&#34; y=&#34;0&#34; width=&#34;100&#34; height=&#34;22&#34; rx=&#34;3&#34; fill=&#34;rgba(74,144,255,.12)&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;1&#34;/&gt;
      &lt;text x=&#34;272&#34; y=&#34;15&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#4a90ff&#34; text-anchor=&#34;middle&#34;&gt;user_data&lt;/text&gt;
      &lt;rect x=&#34;326&#34; y=&#34;0&#34; width=&#34;60&#34; height=&#34;22&#34; rx=&#34;3&#34; fill=&#34;rgba(74,144,255,.12)&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;1&#34;/&gt;
      &lt;text x=&#34;356&#34; y=&#34;15&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#4a90ff&#34; text-anchor=&#34;middle&#34;&gt;flags&lt;/text&gt;
    &lt;/g&gt;
  &lt;/g&gt;
  &lt;!-- CQE STRUCTURE --&gt;
  &lt;g transform=&#34;translate(510,445)&#34;&gt;
    &lt;text x=&#34;0&#34; y=&#34;0&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; font-weight=&#34;700&#34; fill=&#34;#3ee88a&#34;&gt;CQE Structure (Completion)&lt;/text&gt;
    &lt;g transform=&#34;translate(0,12)&#34;&gt;
      &lt;rect x=&#34;0&#34; y=&#34;0&#34; width=&#34;100&#34; height=&#34;22&#34; rx=&#34;3&#34; fill=&#34;rgba(62,232,138,.12)&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;1&#34;/&gt;
      &lt;text x=&#34;50&#34; y=&#34;15&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#3ee88a&#34; text-anchor=&#34;middle&#34;&gt;user_data&lt;/text&gt;
      &lt;rect x=&#34;104&#34; y=&#34;0&#34; width=&#34;70&#34; height=&#34;22&#34; rx=&#34;3&#34; fill=&#34;rgba(62,232,138,.12)&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;1&#34;/&gt;
      &lt;text x=&#34;139&#34; y=&#34;15&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#3ee88a&#34; text-anchor=&#34;middle&#34;&gt;res&lt;/text&gt;
      &lt;rect x=&#34;178&#34; y=&#34;0&#34; width=&#34;100&#34; height=&#34;22&#34; rx=&#34;3&#34; fill=&#34;rgba(62,232,138,.12)&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;1&#34;/&gt;
      &lt;text x=&#34;228&#34; y=&#34;15&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#3ee88a&#34; text-anchor=&#34;middle&#34;&gt;flags&lt;/text&gt;
    &lt;/g&gt;
  &lt;/g&gt;
&lt;/svg&gt;
&lt;div class=&#34;iu-cards&#34;&gt;
  &lt;div class=&#34;iu-card&#34;&gt;
    &lt;h4 style=&#34;color:#4a90ff;&#34;&gt;SQE — Submission Queue Entry&lt;/h4&gt;
    &lt;p&gt;&lt;code&gt;opcode&lt;/code&gt; = what to do (recv, send, accept)&lt;br&gt;
       &lt;code&gt;fd&lt;/code&gt; = which socket&lt;br&gt;
       &lt;code&gt;user_data&lt;/code&gt; = your 64-bit tag (returned in CQE)&lt;br&gt;
       &lt;code&gt;flags&lt;/code&gt; = BUFFER_SELECT, etc.&lt;/p&gt;
  &lt;/div&gt;
  &lt;div class=&#34;iu-card&#34;&gt;
    &lt;h4 style=&#34;color:#3ee88a;&#34;&gt;CQE — Completion Queue Entry&lt;/h4&gt;
    &lt;p&gt;&lt;code&gt;user_data&lt;/code&gt; = your original tag (identifies the op)&lt;br&gt;
       &lt;code&gt;res&lt;/code&gt; = result (bytes transferred, new fd, or -errno)&lt;br&gt;
       &lt;code&gt;flags&lt;/code&gt; = MORE, BUFFER (contains buffer_id)&lt;/p&gt;
  &lt;/div&gt;
  &lt;div class=&#34;iu-card&#34;&gt;
    &lt;h4 style=&#34;color:#ff8a3e;&#34;&gt;Shared Memory&lt;/h4&gt;
    &lt;p&gt;Both rings are mmap&#39;d. The kernel and your app write to them directly. No copy,
       no syscall for enqueue. Only &lt;code&gt;io_uring_enter()&lt;/code&gt; needed to wake the kernel.&lt;/p&gt;
  &lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;!-- ═══════════════ SECTION 2: I/O LIFECYCLE ═══════════════ --&gt;
&lt;div class=&#34;iu-section&#34;&gt;
&lt;div class=&#34;iu-stag iu-stag-cyan&#34;&gt;Interactive&lt;/div&gt;
&lt;h3&gt;The I/O Lifecycle&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;the-io-lifecycle&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#the-io-lifecycle&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p class=&#34;iu-lead&#34;&gt;Step through the exact sequence: your app queues an SQE, the kernel processes it, and you read the CQE result. All in shared memory.&lt;/p&gt;
&lt;div id=&#34;lifecycleScene&#34;&gt;
  &lt;svg viewBox=&#34;0 0 900 400&#34; class=&#34;ring-svg&#34;&gt;
    &lt;rect x=&#34;20&#34; y=&#34;10&#34; width=&#34;860&#34; height=&#34;140&#34; rx=&#34;12&#34; fill=&#34;none&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;1&#34; stroke-dasharray=&#34;4 3&#34; opacity=&#34;.2&#34;/&gt;
    &lt;text x=&#34;40&#34; y=&#34;34&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; font-weight=&#34;700&#34; fill=&#34;#4a90ff&#34; opacity=&#34;.5&#34;&gt;USERSPACE&lt;/text&gt;
    &lt;line x1=&#34;20&#34; y1=&#34;195&#34; x2=&#34;880&#34; y2=&#34;195&#34; stroke=&#34;#2a3040&#34; stroke-width=&#34;1&#34; stroke-dasharray=&#34;6 4&#34;/&gt;
    &lt;text x=&#34;435&#34; y=&#34;190&#34; class=&#34;svg-text&#34; font-size=&#34;10&#34; font-weight=&#34;700&#34; fill=&#34;#555c73&#34; text-anchor=&#34;middle&#34;&gt;━━ kernel boundary ━━&lt;/text&gt;
    &lt;rect x=&#34;20&#34; y=&#34;210&#34; width=&#34;860&#34; height=&#34;180&#34; rx=&#34;12&#34; fill=&#34;none&#34; stroke=&#34;#ff8a3e&#34; stroke-width=&#34;1&#34; stroke-dasharray=&#34;4 3&#34; opacity=&#34;.2&#34;/&gt;
    &lt;text x=&#34;40&#34; y=&#34;234&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; font-weight=&#34;700&#34; fill=&#34;#ff8a3e&#34; opacity=&#34;.5&#34;&gt;KERNEL&lt;/text&gt;
    &lt;!-- STEP 1 --&gt;
    &lt;g id=&#34;lc-s1&#34; class=&#34;step-el&#34;&gt;
      &lt;rect x=&#34;80&#34; y=&#34;55&#34; width=&#34;160&#34; height=&#34;55&#34; rx=&#34;10&#34; fill=&#34;#181c25&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;160&#34; y=&#34;80&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#4a90ff&#34; text-anchor=&#34;middle&#34;&gt;get_sqe()&lt;/text&gt;
      &lt;text x=&#34;160&#34; y=&#34;96&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; text-anchor=&#34;middle&#34;&gt;grab empty SQE slot&lt;/text&gt;
    &lt;/g&gt;
    &lt;!-- STEP 2 --&gt;
    &lt;g id=&#34;lc-s2&#34; class=&#34;step-el&#34;&gt;
      &lt;rect x=&#34;280&#34; y=&#34;55&#34; width=&#34;180&#34; height=&#34;55&#34; rx=&#34;10&#34; fill=&#34;#181c25&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;370&#34; y=&#34;80&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#4a90ff&#34; text-anchor=&#34;middle&#34;&gt;prep_recv(sqe, fd)&lt;/text&gt;
      &lt;text x=&#34;370&#34; y=&#34;96&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; text-anchor=&#34;middle&#34;&gt;fill opcode + fd + flags&lt;/text&gt;
      &lt;line x1=&#34;242&#34; y1=&#34;82&#34; x2=&#34;276&#34; y2=&#34;82&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;1.5&#34; marker-end=&#34;url(#arrowB)&#34; opacity=&#34;.6&#34;/&gt;
    &lt;/g&gt;
    &lt;!-- STEP 3 --&gt;
    &lt;g id=&#34;lc-s3&#34; class=&#34;step-el&#34;&gt;
      &lt;rect x=&#34;500&#34; y=&#34;55&#34; width=&#34;190&#34; height=&#34;55&#34; rx=&#34;10&#34; fill=&#34;#181c25&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;595&#34; y=&#34;80&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#4a90ff&#34; text-anchor=&#34;middle&#34;&gt;set_data64(sqe, tag)&lt;/text&gt;
      &lt;text x=&#34;595&#34; y=&#34;96&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; text-anchor=&#34;middle&#34;&gt;attach your 64-bit token&lt;/text&gt;
      &lt;line x1=&#34;462&#34; y1=&#34;82&#34; x2=&#34;496&#34; y2=&#34;82&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;1.5&#34; marker-end=&#34;url(#arrowB)&#34; opacity=&#34;.6&#34;/&gt;
    &lt;/g&gt;
    &lt;!-- STEP 4 --&gt;
    &lt;g id=&#34;lc-s4&#34; class=&#34;step-el&#34;&gt;
      &lt;rect x=&#34;730&#34; y=&#34;55&#34; width=&#34;120&#34; height=&#34;55&#34; rx=&#34;10&#34; fill=&#34;#181c25&#34; stroke=&#34;#3ee8d0&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;790&#34; y=&#34;80&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#3ee8d0&#34; text-anchor=&#34;middle&#34;&gt;submit()&lt;/text&gt;
      &lt;text x=&#34;790&#34; y=&#34;96&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; text-anchor=&#34;middle&#34;&gt;io_uring_enter&lt;/text&gt;
      &lt;line x1=&#34;692&#34; y1=&#34;82&#34; x2=&#34;726&#34; y2=&#34;82&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;1.5&#34; marker-end=&#34;url(#arrowB)&#34; opacity=&#34;.6&#34;/&gt;
      &lt;line x1=&#34;790&#34; y1=&#34;115&#34; x2=&#34;790&#34; y2=&#34;230&#34; stroke=&#34;#ff8a3e&#34; stroke-width=&#34;2&#34; marker-end=&#34;url(#arrowO)&#34; opacity=&#34;.6&#34; stroke-dasharray=&#34;6 4&#34;/&gt;
    &lt;/g&gt;
    &lt;!-- STEP 5 --&gt;
    &lt;g id=&#34;lc-s5&#34; class=&#34;step-el&#34;&gt;
      &lt;rect x=&#34;620&#34; y=&#34;250&#34; width=&#34;220&#34; height=&#34;55&#34; rx=&#34;10&#34; fill=&#34;rgba(255,138,62,.08)&#34; stroke=&#34;#ff8a3e&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;730&#34; y=&#34;275&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#ff8a3e&#34; text-anchor=&#34;middle&#34;&gt;Kernel processes I/O&lt;/text&gt;
      &lt;text x=&#34;730&#34; y=&#34;291&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; text-anchor=&#34;middle&#34;&gt;recv(fd) → data into buffer&lt;/text&gt;
    &lt;/g&gt;
    &lt;!-- STEP 6 --&gt;
    &lt;g id=&#34;lc-s6&#34; class=&#34;step-el&#34;&gt;
      &lt;rect x=&#34;320&#34; y=&#34;250&#34; width=&#34;220&#34; height=&#34;55&#34; rx=&#34;10&#34; fill=&#34;rgba(62,232,138,.08)&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;430&#34; y=&#34;275&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#3ee88a&#34; text-anchor=&#34;middle&#34;&gt;CQE written to CQ&lt;/text&gt;
      &lt;text x=&#34;430&#34; y=&#34;291&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; text-anchor=&#34;middle&#34;&gt;user_data + res + flags&lt;/text&gt;
      &lt;line x1=&#34;616&#34; y1=&#34;277&#34; x2=&#34;544&#34; y2=&#34;277&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;1.5&#34; marker-end=&#34;url(#arrowG)&#34; opacity=&#34;.6&#34;/&gt;
      &lt;line x1=&#34;430&#34; y1=&#34;245&#34; x2=&#34;430&#34; y2=&#34;140&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;2&#34; marker-end=&#34;url(#arrowG)&#34; opacity=&#34;.6&#34; stroke-dasharray=&#34;6 4&#34;/&gt;
    &lt;/g&gt;
    &lt;!-- STEP 7 --&gt;
    &lt;g id=&#34;lc-s7&#34; class=&#34;step-el&#34;&gt;
      &lt;rect x=&#34;80&#34; y=&#34;250&#34; width=&#34;180&#34; height=&#34;55&#34; rx=&#34;10&#34; fill=&#34;rgba(62,232,138,.08)&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;170&#34; y=&#34;275&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#3ee88a&#34; text-anchor=&#34;middle&#34;&gt;App reads CQE&lt;/text&gt;
      &lt;text x=&#34;170&#34; y=&#34;291&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; text-anchor=&#34;middle&#34;&gt;dispatch by user_data&lt;/text&gt;
      &lt;line x1=&#34;316&#34; y1=&#34;277&#34; x2=&#34;264&#34; y2=&#34;277&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;1.5&#34; marker-end=&#34;url(#arrowG)&#34; opacity=&#34;.6&#34;/&gt;
    &lt;/g&gt;
    &lt;!-- STEP 8 --&gt;
    &lt;g id=&#34;lc-s8&#34; class=&#34;step-el&#34;&gt;
      &lt;rect x=&#34;80&#34; y=&#34;330&#34; width=&#34;180&#34; height=&#34;50&#34; rx=&#34;10&#34; fill=&#34;#181c25&#34; stroke=&#34;#555c73&#34; stroke-width=&#34;1.5&#34;/&gt;
      &lt;text x=&#34;170&#34; y=&#34;354&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;cq_advance(count)&lt;/text&gt;
      &lt;text x=&#34;170&#34; y=&#34;370&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#555c73&#34; text-anchor=&#34;middle&#34;&gt;mark CQEs consumed&lt;/text&gt;
    &lt;/g&gt;
  &lt;/svg&gt;
&lt;/div&gt;
&lt;div class=&#34;stepper&#34;&gt;
  &lt;button class=&#34;step-btn&#34; id=&#34;lcPrev&#34; onclick=&#34;lcStep(-1)&#34;&gt;&amp;#9664;&lt;/button&gt;
  &lt;div class=&#34;step-dots&#34; id=&#34;lcDots&#34;&gt;&lt;/div&gt;
  &lt;button class=&#34;step-btn&#34; id=&#34;lcNext&#34; onclick=&#34;lcStep(1)&#34;&gt;&amp;#9654;&lt;/button&gt;
&lt;/div&gt;
&lt;div class=&#34;step-desc&#34; id=&#34;lcDesc&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;iu-codeblock&#34; style=&#34;max-width:700px;margin:0 auto;&#34;&gt;
  &lt;div class=&#34;iu-codeblock-head&#34;&gt;zerg — single syscall pattern&lt;/div&gt;
  &lt;pre&gt;&lt;span class=&#34;cm&#34;&gt;// 1. Queue work (no syscall)&lt;/span&gt;
&lt;span class=&#34;ty&#34;&gt;io_uring_sqe&lt;/span&gt;* sqe = &lt;span class=&#34;fn&#34;&gt;shim_get_sqe&lt;/span&gt;(ring);
&lt;span class=&#34;fn&#34;&gt;shim_prep_recv_multishot_select&lt;/span&gt;(sqe, fd, bgid, &lt;span class=&#34;num&#34;&gt;0&lt;/span&gt;);
&lt;span class=&#34;fn&#34;&gt;shim_sqe_set_data64&lt;/span&gt;(sqe, &lt;span class=&#34;fn&#34;&gt;PackUd&lt;/span&gt;(&lt;span class=&#34;ty&#34;&gt;UdKind&lt;/span&gt;.Recv, fd));
&lt;p&gt;&lt;span class=&#34;cm&#34;&gt;// 2. Submit + wait in ONE syscall&lt;/span&gt;
&lt;span class=&#34;fn&#34;&gt;shim_submit_and_wait_timeout&lt;/span&gt;(ring, &amp;amp;cqes, &lt;span class=&#34;num&#34;&gt;1&lt;/span&gt;, &amp;amp;ts);&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;cm&#34;&gt;// 3. Batch-read completions (no syscall)&lt;/span&gt;
&lt;span class=&#34;kw&#34;&gt;int&lt;/span&gt; got = &lt;span class=&#34;fn&#34;&gt;shim_peek_batch_cqe&lt;/span&gt;(ring, cqes, batchSize);&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;cm&#34;&gt;// 4. Process results&lt;/span&gt;
&lt;span class=&#34;kw&#34;&gt;for&lt;/span&gt; (&lt;span class=&#34;kw&#34;&gt;int&lt;/span&gt; i = &lt;span class=&#34;num&#34;&gt;0&lt;/span&gt;; i &amp;lt; got; i++) {
&lt;span class=&#34;ty&#34;&gt;UdKind&lt;/span&gt; kind = &lt;span class=&#34;fn&#34;&gt;UdKindOf&lt;/span&gt;(&lt;span class=&#34;fn&#34;&gt;shim_cqe_get_data64&lt;/span&gt;(cqes[i]));
&lt;span class=&#34;kw&#34;&gt;int&lt;/span&gt; res = cqes[i]-&amp;gt;res;
&lt;span class=&#34;cm&#34;&gt;// dispatch&amp;hellip;&lt;/span&gt;
}
&lt;span class=&#34;fn&#34;&gt;shim_cq_advance&lt;/span&gt;(ring, (&lt;span class=&#34;ty&#34;&gt;uint&lt;/span&gt;)got); &lt;span class=&#34;cm&#34;&gt;// 5. Mark consumed&lt;/span&gt;&lt;/pre&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;!-- ═══════════════ SECTION 3: MULTISHOT ═══════════════ --&gt;
&lt;div class=&#34;iu-section&#34;&gt;
&lt;div class=&#34;iu-stag iu-stag-green&#34;&gt;Key Feature&lt;/div&gt;
&lt;h3&gt;Multishot Operations&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;multishot-operations&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#multishot-operations&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p class=&#34;iu-lead&#34;&gt;Traditional I/O: 1 SQE → 1 CQE. Multishot: 1 SQE → many CQEs. The kernel keeps producing completions until an error or you cancel.&lt;/p&gt;
&lt;div class=&#34;iu-two-col&#34;&gt;
  &lt;div&gt;
    &lt;h4 style=&#34;font-weight:700;margin-bottom:1rem;&#34;&gt;Traditional (one-shot)&lt;/h4&gt;
    &lt;svg viewBox=&#34;0 0 420 280&#34; class=&#34;ring-svg&#34;&gt;
      &lt;text x=&#34;10&#34; y=&#34;20&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; font-weight=&#34;600&#34; fill=&#34;#555c73&#34;&gt;Submit recv for each read&lt;/text&gt;
      &lt;g transform=&#34;translate(20,35)&#34;&gt;
        &lt;rect x=&#34;0&#34; y=&#34;0&#34; width=&#34;80&#34; height=&#34;28&#34; rx=&#34;6&#34; fill=&#34;rgba(74,144,255,.15)&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;1.5&#34;/&gt;
        &lt;text x=&#34;40&#34; y=&#34;18&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#4a90ff&#34; text-anchor=&#34;middle&#34;&gt;SQE recv&lt;/text&gt;
        &lt;line x1=&#34;84&#34; y1=&#34;14&#34; x2=&#34;140&#34; y2=&#34;14&#34; stroke=&#34;#555c73&#34; stroke-width=&#34;1&#34; marker-end=&#34;url(#arrowB)&#34;/&gt;
        &lt;rect x=&#34;144&#34; y=&#34;0&#34; width=&#34;80&#34; height=&#34;28&#34; rx=&#34;6&#34; fill=&#34;rgba(62,232,138,.15)&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;1.5&#34;/&gt;
        &lt;text x=&#34;184&#34; y=&#34;18&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#3ee88a&#34; text-anchor=&#34;middle&#34;&gt;CQE data&lt;/text&gt;
      &lt;/g&gt;
      &lt;g transform=&#34;translate(20,75)&#34;&gt;
        &lt;rect x=&#34;0&#34; y=&#34;0&#34; width=&#34;80&#34; height=&#34;28&#34; rx=&#34;6&#34; fill=&#34;rgba(74,144,255,.15)&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;1.5&#34;/&gt;
        &lt;text x=&#34;40&#34; y=&#34;18&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#4a90ff&#34; text-anchor=&#34;middle&#34;&gt;SQE recv&lt;/text&gt;
        &lt;line x1=&#34;84&#34; y1=&#34;14&#34; x2=&#34;140&#34; y2=&#34;14&#34; stroke=&#34;#555c73&#34; stroke-width=&#34;1&#34; marker-end=&#34;url(#arrowB)&#34;/&gt;
        &lt;rect x=&#34;144&#34; y=&#34;0&#34; width=&#34;80&#34; height=&#34;28&#34; rx=&#34;6&#34; fill=&#34;rgba(62,232,138,.15)&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;1.5&#34;/&gt;
        &lt;text x=&#34;184&#34; y=&#34;18&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#3ee88a&#34; text-anchor=&#34;middle&#34;&gt;CQE data&lt;/text&gt;
      &lt;/g&gt;
      &lt;g transform=&#34;translate(20,115)&#34;&gt;
        &lt;rect x=&#34;0&#34; y=&#34;0&#34; width=&#34;80&#34; height=&#34;28&#34; rx=&#34;6&#34; fill=&#34;rgba(74,144,255,.15)&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;1.5&#34;/&gt;
        &lt;text x=&#34;40&#34; y=&#34;18&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#4a90ff&#34; text-anchor=&#34;middle&#34;&gt;SQE recv&lt;/text&gt;
        &lt;line x1=&#34;84&#34; y1=&#34;14&#34; x2=&#34;140&#34; y2=&#34;14&#34; stroke=&#34;#555c73&#34; stroke-width=&#34;1&#34; marker-end=&#34;url(#arrowB)&#34;/&gt;
        &lt;rect x=&#34;144&#34; y=&#34;0&#34; width=&#34;80&#34; height=&#34;28&#34; rx=&#34;6&#34; fill=&#34;rgba(62,232,138,.15)&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;1.5&#34;/&gt;
        &lt;text x=&#34;184&#34; y=&#34;18&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#3ee88a&#34; text-anchor=&#34;middle&#34;&gt;CQE data&lt;/text&gt;
      &lt;/g&gt;
      &lt;g transform=&#34;translate(20,155)&#34;&gt;
        &lt;rect x=&#34;0&#34; y=&#34;0&#34; width=&#34;80&#34; height=&#34;28&#34; rx=&#34;6&#34; fill=&#34;rgba(74,144,255,.15)&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;1.5&#34;/&gt;
        &lt;text x=&#34;40&#34; y=&#34;18&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#4a90ff&#34; text-anchor=&#34;middle&#34;&gt;SQE recv&lt;/text&gt;
        &lt;line x1=&#34;84&#34; y1=&#34;14&#34; x2=&#34;140&#34; y2=&#34;14&#34; stroke=&#34;#555c73&#34; stroke-width=&#34;1&#34; marker-end=&#34;url(#arrowB)&#34;/&gt;
        &lt;rect x=&#34;144&#34; y=&#34;0&#34; width=&#34;80&#34; height=&#34;28&#34; rx=&#34;6&#34; fill=&#34;rgba(62,232,138,.15)&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;1.5&#34;/&gt;
        &lt;text x=&#34;184&#34; y=&#34;18&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#3ee88a&#34; text-anchor=&#34;middle&#34;&gt;CQE data&lt;/text&gt;
      &lt;/g&gt;
      &lt;text x=&#34;280&#34; y=&#34;115&#34; class=&#34;svg-text&#34; font-size=&#34;32&#34; font-weight=&#34;800&#34; fill=&#34;#ff4a5e&#34; opacity=&#34;.6&#34;&gt;4 SQEs&lt;/text&gt;
      &lt;text x=&#34;280&#34; y=&#34;140&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; fill=&#34;#8a90a8&#34;&gt;4 submissions&lt;/text&gt;
      &lt;text x=&#34;280&#34; y=&#34;155&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; fill=&#34;#8a90a8&#34;&gt;4 completions&lt;/text&gt;
      &lt;text x=&#34;20&#34; y=&#34;220&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; font-weight=&#34;600&#34; fill=&#34;#ff4a5e&#34;&gt;Cost: re-arm after every read&lt;/text&gt;
      &lt;text x=&#34;20&#34; y=&#34;238&#34; class=&#34;svg-text&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34;&gt;More SQE slots consumed&lt;/text&gt;
      &lt;text x=&#34;20&#34; y=&#34;254&#34; class=&#34;svg-text&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34;&gt;More CPU cycles on submission&lt;/text&gt;
    &lt;/svg&gt;
  &lt;/div&gt;
  &lt;div&gt;
    &lt;h4 style=&#34;font-weight:700;margin-bottom:1rem;&#34;&gt;Multishot (zerg)&lt;/h4&gt;
    &lt;svg viewBox=&#34;0 0 420 280&#34; class=&#34;ring-svg&#34;&gt;
      &lt;text x=&#34;10&#34; y=&#34;20&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; font-weight=&#34;600&#34; fill=&#34;#555c73&#34;&gt;Submit once, get many completions&lt;/text&gt;
      &lt;g transform=&#34;translate(20,35)&#34;&gt;
        &lt;rect x=&#34;0&#34; y=&#34;0&#34; width=&#34;120&#34; height=&#34;150&#34; rx=&#34;10&#34; fill=&#34;rgba(74,144,255,.08)&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;2&#34;/&gt;
        &lt;text x=&#34;60&#34; y=&#34;25&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#4a90ff&#34; text-anchor=&#34;middle&#34;&gt;1 SQE&lt;/text&gt;
        &lt;text x=&#34;60&#34; y=&#34;42&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;recv_multishot&lt;/text&gt;
        &lt;line x1=&#34;124&#34; y1=&#34;45&#34; x2=&#34;175&#34; y2=&#34;30&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;1.5&#34; marker-end=&#34;url(#arrowG)&#34;/&gt;
        &lt;line x1=&#34;124&#34; y1=&#34;70&#34; x2=&#34;175&#34; y2=&#34;70&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;1.5&#34; marker-end=&#34;url(#arrowG)&#34;/&gt;
        &lt;line x1=&#34;124&#34; y1=&#34;95&#34; x2=&#34;175&#34; y2=&#34;110&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;1.5&#34; marker-end=&#34;url(#arrowG)&#34;/&gt;
        &lt;line x1=&#34;124&#34; y1=&#34;120&#34; x2=&#34;175&#34; y2=&#34;150&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;1.5&#34; marker-end=&#34;url(#arrowG)&#34;/&gt;
        &lt;rect x=&#34;180&#34; y=&#34;16&#34; width=&#34;90&#34; height=&#34;28&#34; rx=&#34;6&#34; fill=&#34;rgba(62,232,138,.15)&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;1.5&#34;/&gt;
        &lt;text x=&#34;225&#34; y=&#34;34&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#3ee88a&#34; text-anchor=&#34;middle&#34;&gt;CQE + MORE&lt;/text&gt;
        &lt;rect x=&#34;180&#34; y=&#34;56&#34; width=&#34;90&#34; height=&#34;28&#34; rx=&#34;6&#34; fill=&#34;rgba(62,232,138,.15)&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;1.5&#34;/&gt;
        &lt;text x=&#34;225&#34; y=&#34;74&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#3ee88a&#34; text-anchor=&#34;middle&#34;&gt;CQE + MORE&lt;/text&gt;
        &lt;rect x=&#34;180&#34; y=&#34;96&#34; width=&#34;90&#34; height=&#34;28&#34; rx=&#34;6&#34; fill=&#34;rgba(62,232,138,.15)&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;1.5&#34;/&gt;
        &lt;text x=&#34;225&#34; y=&#34;114&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#3ee88a&#34; text-anchor=&#34;middle&#34;&gt;CQE + MORE&lt;/text&gt;
        &lt;rect x=&#34;180&#34; y=&#34;136&#34; width=&#34;90&#34; height=&#34;28&#34; rx=&#34;6&#34; fill=&#34;rgba(62,232,138,.15)&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;1.5&#34;/&gt;
        &lt;text x=&#34;225&#34; y=&#34;154&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#3ee88a&#34; text-anchor=&#34;middle&#34;&gt;CQE final&lt;/text&gt;
        &lt;rect x=&#34;285&#34; y=&#34;16&#34; width=&#34;100&#34; height=&#34;28&#34; rx=&#34;6&#34; fill=&#34;rgba(255,208,74,.08)&#34; stroke=&#34;#ffd04a&#34; stroke-width=&#34;1&#34;/&gt;
        &lt;text x=&#34;335&#34; y=&#34;34&#34; class=&#34;svg-mono&#34; font-size=&#34;8&#34; fill=&#34;#ffd04a&#34; text-anchor=&#34;middle&#34;&gt;F_MORE = 1&lt;/text&gt;
        &lt;rect x=&#34;285&#34; y=&#34;56&#34; width=&#34;100&#34; height=&#34;28&#34; rx=&#34;6&#34; fill=&#34;rgba(255,208,74,.08)&#34; stroke=&#34;#ffd04a&#34; stroke-width=&#34;1&#34;/&gt;
        &lt;text x=&#34;335&#34; y=&#34;74&#34; class=&#34;svg-mono&#34; font-size=&#34;8&#34; fill=&#34;#ffd04a&#34; text-anchor=&#34;middle&#34;&gt;F_MORE = 1&lt;/text&gt;
        &lt;rect x=&#34;285&#34; y=&#34;96&#34; width=&#34;100&#34; height=&#34;28&#34; rx=&#34;6&#34; fill=&#34;rgba(255,208,74,.08)&#34; stroke=&#34;#ffd04a&#34; stroke-width=&#34;1&#34;/&gt;
        &lt;text x=&#34;335&#34; y=&#34;114&#34; class=&#34;svg-mono&#34; font-size=&#34;8&#34; fill=&#34;#ffd04a&#34; text-anchor=&#34;middle&#34;&gt;F_MORE = 1&lt;/text&gt;
        &lt;rect x=&#34;285&#34; y=&#34;136&#34; width=&#34;100&#34; height=&#34;28&#34; rx=&#34;6&#34; fill=&#34;rgba(255,74,94,.08)&#34; stroke=&#34;#ff4a5e&#34; stroke-width=&#34;1&#34;/&gt;
        &lt;text x=&#34;335&#34; y=&#34;154&#34; class=&#34;svg-mono&#34; font-size=&#34;8&#34; fill=&#34;#ff4a5e&#34; text-anchor=&#34;middle&#34;&gt;F_MORE = 0&lt;/text&gt;
      &lt;/g&gt;
      &lt;text x=&#34;20&#34; y=&#34;220&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; font-weight=&#34;600&#34; fill=&#34;#3ee88a&#34;&gt;Win: 1 submission, N completions&lt;/text&gt;
      &lt;text x=&#34;20&#34; y=&#34;238&#34; class=&#34;svg-text&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34;&gt;Kernel sets IORING_CQE_F_MORE on each CQE&lt;/text&gt;
      &lt;text x=&#34;20&#34; y=&#34;254&#34; class=&#34;svg-text&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34;&gt;When MORE=0 → multishot ended, re-arm&lt;/text&gt;
      &lt;text x=&#34;20&#34; y=&#34;272&#34; class=&#34;svg-text&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34;&gt;Used for both accept and recv in zerg&lt;/text&gt;
    &lt;/svg&gt;
  &lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;iu-divider&#34;&gt;&lt;/div&gt;
&lt;h4&gt;user_data Packing&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;user_data-packing&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#user_data-packing&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;Each SQE carries a 64-bit token so the completion handler knows what operation completed and on which socket.&lt;/p&gt;
&lt;svg viewBox=&#34;0 0 800 110&#34; class=&#34;ring-svg&#34; style=&#34;max-width:800px;margin:1rem auto;display:block;&#34;&gt;
  &lt;text x=&#34;400&#34; y=&#34;18&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; text-anchor=&#34;middle&#34;&gt;64-bit user_data&lt;/text&gt;
  &lt;rect x=&#34;50&#34; y=&#34;30&#34; width=&#34;340&#34; height=&#34;45&#34; rx=&#34;8&#34; fill=&#34;rgba(160,106,255,.1)&#34; stroke=&#34;#a06aff&#34; stroke-width=&#34;2&#34;/&gt;
  &lt;text x=&#34;220&#34; y=&#34;50&#34; class=&#34;svg-text&#34; font-size=&#34;13&#34; font-weight=&#34;700&#34; fill=&#34;#a06aff&#34; text-anchor=&#34;middle&#34;&gt;UdKind (bits 63-32)&lt;/text&gt;
  &lt;text x=&#34;220&#34; y=&#34;66&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; text-anchor=&#34;middle&#34;&gt;1=Accept  2=Recv  3=Send  4=Cancel&lt;/text&gt;
  &lt;rect x=&#34;410&#34; y=&#34;30&#34; width=&#34;340&#34; height=&#34;45&#34; rx=&#34;8&#34; fill=&#34;rgba(74,144,255,.1)&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;2&#34;/&gt;
  &lt;text x=&#34;580&#34; y=&#34;50&#34; class=&#34;svg-text&#34; font-size=&#34;13&#34; font-weight=&#34;700&#34; fill=&#34;#4a90ff&#34; text-anchor=&#34;middle&#34;&gt;File Descriptor (bits 31-0)&lt;/text&gt;
  &lt;text x=&#34;580&#34; y=&#34;66&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; text-anchor=&#34;middle&#34;&gt;socket fd cast to uint&lt;/text&gt;
  &lt;text x=&#34;400&#34; y=&#34;100&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#3ee8d0&#34; text-anchor=&#34;middle&#34;&gt;PackUd(kind, fd) = ((ulong)kind &amp;lt;&amp;lt; 32) | (uint)fd&lt;/text&gt;
&lt;/svg&gt;
&lt;/div&gt;
&lt;!-- ═══════════════ SECTION 4: BUFFER RING ═══════════════ --&gt;
&lt;div class=&#34;iu-section&#34;&gt;
&lt;div class=&#34;iu-stag iu-stag-purple&#34;&gt;Zero Copy&lt;/div&gt;
&lt;h3&gt;Provided Buffer Ring&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;provided-buffer-ring&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#provided-buffer-ring&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p class=&#34;iu-lead&#34;&gt;Instead of passing a buffer with each recv, you pre-register a pool. The kernel picks one, fills it, and tells you which ID it used. You return it when done.&lt;/p&gt;
&lt;svg viewBox=&#34;0 0 900 500&#34; class=&#34;ring-svg&#34;&gt;
  &lt;defs&gt;
    &lt;marker id=&#34;arrowP&#34; markerWidth=&#34;8&#34; markerHeight=&#34;6&#34; refX=&#34;8&#34; refY=&#34;3&#34; orient=&#34;auto&#34;&gt;&lt;polygon points=&#34;0 0, 8 3, 0 6&#34; fill=&#34;#a06aff&#34;/&gt;&lt;/marker&gt;
  &lt;/defs&gt;
  &lt;text x=&#34;30&#34; y=&#34;25&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; font-weight=&#34;700&#34; fill=&#34;#4a90ff&#34; opacity=&#34;.5&#34;&gt;USERSPACE&lt;/text&gt;
  &lt;text x=&#34;30&#34; y=&#34;335&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; font-weight=&#34;700&#34; fill=&#34;#ff8a3e&#34; opacity=&#34;.5&#34;&gt;KERNEL&lt;/text&gt;
  &lt;line x1=&#34;20&#34; y1=&#34;305&#34; x2=&#34;880&#34; y2=&#34;305&#34; stroke=&#34;#2a3040&#34; stroke-width=&#34;1&#34; stroke-dasharray=&#34;6 4&#34;/&gt;
  &lt;!-- BUFFER SLAB --&gt;
  &lt;text x=&#34;60&#34; y=&#34;55&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#a06aff&#34;&gt;Buffer Slab (NativeMemory)&lt;/text&gt;
  &lt;g transform=&#34;translate(60, 65)&#34;&gt;
    &lt;rect x=&#34;0&#34; y=&#34;0&#34; width=&#34;60&#34; height=&#34;35&#34; rx=&#34;5&#34; fill=&#34;rgba(160,106,255,.2)&#34; stroke=&#34;#a06aff&#34; stroke-width=&#34;1.5&#34;/&gt;
    &lt;text x=&#34;30&#34; y=&#34;15&#34; class=&#34;svg-mono&#34; font-size=&#34;8&#34; fill=&#34;#a06aff&#34; text-anchor=&#34;middle&#34;&gt;buf 0&lt;/text&gt;
    &lt;text x=&#34;30&#34; y=&#34;28&#34; class=&#34;svg-mono&#34; font-size=&#34;7&#34; fill=&#34;#555c73&#34; text-anchor=&#34;middle&#34;&gt;32KB&lt;/text&gt;
    &lt;rect x=&#34;66&#34; y=&#34;0&#34; width=&#34;60&#34; height=&#34;35&#34; rx=&#34;5&#34; fill=&#34;rgba(160,106,255,.2)&#34; stroke=&#34;#a06aff&#34; stroke-width=&#34;1.5&#34;/&gt;
    &lt;text x=&#34;96&#34; y=&#34;15&#34; class=&#34;svg-mono&#34; font-size=&#34;8&#34; fill=&#34;#a06aff&#34; text-anchor=&#34;middle&#34;&gt;buf 1&lt;/text&gt;
    &lt;text x=&#34;96&#34; y=&#34;28&#34; class=&#34;svg-mono&#34; font-size=&#34;7&#34; fill=&#34;#555c73&#34; text-anchor=&#34;middle&#34;&gt;32KB&lt;/text&gt;
    &lt;rect x=&#34;132&#34; y=&#34;0&#34; width=&#34;60&#34; height=&#34;35&#34; rx=&#34;5&#34; fill=&#34;rgba(160,106,255,.5)&#34; stroke=&#34;#a06aff&#34; stroke-width=&#34;2&#34;/&gt;
    &lt;text x=&#34;162&#34; y=&#34;15&#34; class=&#34;svg-mono&#34; font-size=&#34;8&#34; fill=&#34;#fff&#34; text-anchor=&#34;middle&#34;&gt;buf 2&lt;/text&gt;
    &lt;text x=&#34;162&#34; y=&#34;28&#34; class=&#34;svg-mono&#34; font-size=&#34;7&#34; fill=&#34;rgba(255,255,255,.6)&#34; text-anchor=&#34;middle&#34;&gt;32KB&lt;/text&gt;
    &lt;rect x=&#34;198&#34; y=&#34;0&#34; width=&#34;60&#34; height=&#34;35&#34; rx=&#34;5&#34; fill=&#34;rgba(160,106,255,.2)&#34; stroke=&#34;#a06aff&#34; stroke-width=&#34;1.5&#34;/&gt;
    &lt;text x=&#34;228&#34; y=&#34;15&#34; class=&#34;svg-mono&#34; font-size=&#34;8&#34; fill=&#34;#a06aff&#34; text-anchor=&#34;middle&#34;&gt;buf 3&lt;/text&gt;
    &lt;text x=&#34;228&#34; y=&#34;28&#34; class=&#34;svg-mono&#34; font-size=&#34;7&#34; fill=&#34;#555c73&#34; text-anchor=&#34;middle&#34;&gt;32KB&lt;/text&gt;
    &lt;rect x=&#34;264&#34; y=&#34;0&#34; width=&#34;60&#34; height=&#34;35&#34; rx=&#34;5&#34; fill=&#34;rgba(160,106,255,.15)&#34; stroke=&#34;#a06aff&#34; stroke-width=&#34;1&#34; stroke-dasharray=&#34;3 2&#34;/&gt;
    &lt;text x=&#34;294&#34; y=&#34;22&#34; class=&#34;svg-mono&#34; font-size=&#34;8&#34; fill=&#34;#555c73&#34; text-anchor=&#34;middle&#34;&gt;...&lt;/text&gt;
    &lt;rect x=&#34;330&#34; y=&#34;0&#34; width=&#34;60&#34; height=&#34;35&#34; rx=&#34;5&#34; fill=&#34;rgba(160,106,255,.2)&#34; stroke=&#34;#a06aff&#34; stroke-width=&#34;1.5&#34;/&gt;
    &lt;text x=&#34;360&#34; y=&#34;15&#34; class=&#34;svg-mono&#34; font-size=&#34;8&#34; fill=&#34;#a06aff&#34; text-anchor=&#34;middle&#34;&gt;buf N&lt;/text&gt;
    &lt;text x=&#34;360&#34; y=&#34;28&#34; class=&#34;svg-mono&#34; font-size=&#34;7&#34; fill=&#34;#555c73&#34; text-anchor=&#34;middle&#34;&gt;32KB&lt;/text&gt;
  &lt;/g&gt;
  &lt;!-- BUFFER RING --&gt;
  &lt;text x=&#34;60&#34; y=&#34;135&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#a06aff&#34;&gt;Buffer Ring (shared with kernel)&lt;/text&gt;
  &lt;g transform=&#34;translate(60, 145)&#34;&gt;
    &lt;rect x=&#34;0&#34; y=&#34;0&#34; width=&#34;450&#34; height=&#34;50&#34; rx=&#34;10&#34; fill=&#34;rgba(160,106,255,.06)&#34; stroke=&#34;#a06aff&#34; stroke-width=&#34;2&#34;/&gt;
    &lt;rect x=&#34;10&#34; y=&#34;10&#34; width=&#34;50&#34; height=&#34;30&#34; rx=&#34;4&#34; fill=&#34;#a06aff&#34; opacity=&#34;.7&#34;/&gt;&lt;text x=&#34;35&#34; y=&#34;29&#34; class=&#34;svg-mono&#34; font-size=&#34;8&#34; fill=&#34;#fff&#34; text-anchor=&#34;middle&#34;&gt;id:0&lt;/text&gt;
    &lt;rect x=&#34;65&#34; y=&#34;10&#34; width=&#34;50&#34; height=&#34;30&#34; rx=&#34;4&#34; fill=&#34;#a06aff&#34; opacity=&#34;.7&#34;/&gt;&lt;text x=&#34;90&#34; y=&#34;29&#34; class=&#34;svg-mono&#34; font-size=&#34;8&#34; fill=&#34;#fff&#34; text-anchor=&#34;middle&#34;&gt;id:1&lt;/text&gt;
    &lt;rect x=&#34;120&#34; y=&#34;10&#34; width=&#34;50&#34; height=&#34;30&#34; rx=&#34;4&#34; fill=&#34;#a06aff&#34; opacity=&#34;.3&#34;/&gt;&lt;text x=&#34;145&#34; y=&#34;29&#34; class=&#34;svg-mono&#34; font-size=&#34;8&#34; fill=&#34;#a06aff&#34; text-anchor=&#34;middle&#34;&gt;id:2&lt;/text&gt;
    &lt;text x=&#34;145&#34; y=&#34;16&#34; class=&#34;svg-mono&#34; font-size=&#34;7&#34; fill=&#34;#ff8a3e&#34; text-anchor=&#34;middle&#34;&gt;used&lt;/text&gt;
    &lt;rect x=&#34;175&#34; y=&#34;10&#34; width=&#34;50&#34; height=&#34;30&#34; rx=&#34;4&#34; fill=&#34;#a06aff&#34; opacity=&#34;.7&#34;/&gt;&lt;text x=&#34;200&#34; y=&#34;29&#34; class=&#34;svg-mono&#34; font-size=&#34;8&#34; fill=&#34;#fff&#34; text-anchor=&#34;middle&#34;&gt;id:3&lt;/text&gt;
    &lt;rect x=&#34;230&#34; y=&#34;10&#34; width=&#34;50&#34; height=&#34;30&#34; rx=&#34;4&#34; fill=&#34;#a06aff&#34; opacity=&#34;.7&#34;/&gt;&lt;text x=&#34;255&#34; y=&#34;29&#34; class=&#34;svg-mono&#34; font-size=&#34;8&#34; fill=&#34;#fff&#34; text-anchor=&#34;middle&#34;&gt;id:4&lt;/text&gt;
    &lt;rect x=&#34;285&#34; y=&#34;10&#34; width=&#34;50&#34; height=&#34;30&#34; rx=&#34;4&#34; fill=&#34;#a06aff&#34; opacity=&#34;.7&#34;/&gt;&lt;text x=&#34;310&#34; y=&#34;29&#34; class=&#34;svg-mono&#34; font-size=&#34;8&#34; fill=&#34;#fff&#34; text-anchor=&#34;middle&#34;&gt;id:5&lt;/text&gt;
    &lt;rect x=&#34;340&#34; y=&#34;10&#34; width=&#34;50&#34; height=&#34;30&#34; rx=&#34;4&#34; fill=&#34;#a06aff&#34; opacity=&#34;.5&#34;/&gt;&lt;text x=&#34;365&#34; y=&#34;29&#34; class=&#34;svg-mono&#34; font-size=&#34;8&#34; fill=&#34;#a06aff&#34; text-anchor=&#34;middle&#34;&gt;...&lt;/text&gt;
    &lt;rect x=&#34;395&#34; y=&#34;10&#34; width=&#34;45&#34; height=&#34;30&#34; rx=&#34;4&#34; fill=&#34;#a06aff&#34; opacity=&#34;.7&#34;/&gt;&lt;text x=&#34;417&#34; y=&#34;29&#34; class=&#34;svg-mono&#34; font-size=&#34;8&#34; fill=&#34;#fff&#34; text-anchor=&#34;middle&#34;&gt;id:N&lt;/text&gt;
  &lt;/g&gt;
  &lt;!-- RECV FLOW --&gt;
  &lt;text x=&#34;550&#34; y=&#34;135&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; font-weight=&#34;700&#34; fill=&#34;#ff8a3e&#34;&gt;Recv Flow&lt;/text&gt;
  &lt;rect x=&#34;540&#34; y=&#34;145&#34; width=&#34;320&#34; height=&#34;145&#34; rx=&#34;12&#34; fill=&#34;#181c25&#34; stroke=&#34;#2a3040&#34; stroke-width=&#34;1&#34;/&gt;
  &lt;text x=&#34;560&#34; y=&#34;170&#34; class=&#34;svg-text&#34; font-size=&#34;10&#34; font-weight=&#34;700&#34; fill=&#34;#ffd04a&#34;&gt;1&lt;/text&gt;
  &lt;text x=&#34;578&#34; y=&#34;170&#34; class=&#34;svg-text&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34;&gt;Kernel picks buf from ring&lt;/text&gt;
  &lt;text x=&#34;560&#34; y=&#34;195&#34; class=&#34;svg-text&#34; font-size=&#34;10&#34; font-weight=&#34;700&#34; fill=&#34;#ffd04a&#34;&gt;2&lt;/text&gt;
  &lt;text x=&#34;578&#34; y=&#34;195&#34; class=&#34;svg-text&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34;&gt;recv() fills it with data&lt;/text&gt;
  &lt;text x=&#34;560&#34; y=&#34;220&#34; class=&#34;svg-text&#34; font-size=&#34;10&#34; font-weight=&#34;700&#34; fill=&#34;#ffd04a&#34;&gt;3&lt;/text&gt;
  &lt;text x=&#34;578&#34; y=&#34;220&#34; class=&#34;svg-text&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34;&gt;CQE.flags contains buf id&lt;/text&gt;
  &lt;text x=&#34;578&#34; y=&#34;235&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#3ee8d0&#34;&gt;bid = flags &gt;&gt; 16&lt;/text&gt;
  &lt;text x=&#34;560&#34; y=&#34;260&#34; class=&#34;svg-text&#34; font-size=&#34;10&#34; font-weight=&#34;700&#34; fill=&#34;#ffd04a&#34;&gt;4&lt;/text&gt;
  &lt;text x=&#34;578&#34; y=&#34;260&#34; class=&#34;svg-text&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34;&gt;CQE.res = bytes received&lt;/text&gt;
  &lt;text x=&#34;560&#34; y=&#34;280&#34; class=&#34;svg-text&#34; font-size=&#34;10&#34; font-weight=&#34;700&#34; fill=&#34;#ffd04a&#34;&gt;5&lt;/text&gt;
  &lt;text x=&#34;578&#34; y=&#34;280&#34; class=&#34;svg-text&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34;&gt;App returns buf via buf_ring_add&lt;/text&gt;
  &lt;!-- KERNEL --&gt;
  &lt;rect x=&#34;200&#34; y=&#34;340&#34; width=&#34;500&#34; height=&#34;55&#34; rx=&#34;10&#34; fill=&#34;rgba(255,138,62,.06)&#34; stroke=&#34;#ff8a3e&#34; stroke-width=&#34;1.5&#34;/&gt;
  &lt;text x=&#34;450&#34; y=&#34;365&#34; class=&#34;svg-text&#34; font-size=&#34;13&#34; font-weight=&#34;700&#34; fill=&#34;#ff8a3e&#34; text-anchor=&#34;middle&#34;&gt;Kernel: recv(fd) → picks buf 2 → fills 1,420 bytes&lt;/text&gt;
  &lt;text x=&#34;450&#34; y=&#34;382&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;CQE { user_data: [Recv|fd], res: 1420, flags: (2 &amp;lt;&amp;lt; 16) | F_BUFFER | F_MORE }&lt;/text&gt;
  &lt;!-- RETURN FLOW --&gt;
  &lt;g transform=&#34;translate(60, 415)&#34;&gt;
    &lt;text x=&#34;0&#34; y=&#34;15&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#3ee88a&#34;&gt;Buffer Return (app → ring)&lt;/text&gt;
    &lt;rect x=&#34;0&#34; y=&#34;25&#34; width=&#34;700&#34; height=&#34;50&#34; rx=&#34;10&#34; fill=&#34;#181c25&#34; stroke=&#34;#2a3040&#34; stroke-width=&#34;1&#34;/&gt;
    &lt;text x=&#34;20&#34; y=&#34;50&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34;&gt;connection.ReturnRing(bid)&lt;/text&gt;
    &lt;text x=&#34;25&#34; y=&#34;65&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#555c73&#34;&gt;→ MPSC queue → reactor drains → shim_buf_ring_add(ring, addr, len, bid, mask, idx) → shim_buf_ring_advance(1)&lt;/text&gt;
  &lt;/g&gt;
&lt;/svg&gt;
&lt;/div&gt;
&lt;!-- ═══════════════ SECTION 5: FULL FLOW ═══════════════ --&gt;
&lt;div class=&#34;iu-section&#34;&gt;
&lt;div class=&#34;iu-stag iu-stag-orange&#34;&gt;End to End&lt;/div&gt;
&lt;h3&gt;Full zerg Flow&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;full-zerg-flow&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#full-zerg-flow&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p class=&#34;iu-lead&#34;&gt;Walk through the complete lifecycle: client connects, data flows in, your app responds, buffers recycle. Step through each phase one at a time.&lt;/p&gt;
&lt;div class=&#34;phase-bar&#34; id=&#34;ffBar&#34;&gt;
  &lt;div class=&#34;phase-seg&#34; id=&#34;ffSeg0&#34;&gt;&lt;/div&gt;
  &lt;div class=&#34;phase-seg&#34; id=&#34;ffSeg1&#34;&gt;&lt;/div&gt;
  &lt;div class=&#34;phase-seg&#34; id=&#34;ffSeg2&#34;&gt;&lt;/div&gt;
  &lt;div class=&#34;phase-seg&#34; id=&#34;ffSeg3&#34;&gt;&lt;/div&gt;
  &lt;div class=&#34;phase-seg&#34; id=&#34;ffSeg4&#34;&gt;&lt;/div&gt;
  &lt;div class=&#34;phase-seg&#34; id=&#34;ffSeg5&#34;&gt;&lt;/div&gt;
  &lt;div class=&#34;phase-seg&#34; id=&#34;ffSeg6&#34;&gt;&lt;/div&gt;
  &lt;div class=&#34;phase-seg&#34; id=&#34;ffSeg7&#34;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&#34;ffSvgWrap&#34; style=&#34;min-height:300px;position:relative;&#34;&gt;
  &lt;!-- STEP 0 --&gt;
  &lt;div class=&#34;ff-panel&#34; id=&#34;ffP0&#34;&gt;
    &lt;svg viewBox=&#34;0 0 860 280&#34; class=&#34;ring-svg&#34;&gt;
      &lt;rect x=&#34;10&#34; y=&#34;10&#34; width=&#34;840&#34; height=&#34;260&#34; rx=&#34;14&#34; fill=&#34;rgba(74,144,255,.03)&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;1&#34; stroke-dasharray=&#34;5 3&#34; opacity=&#34;.35&#34;/&gt;
      &lt;text x=&#34;30&#34; y=&#34;34&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; font-weight=&#34;700&#34; fill=&#34;#4a90ff&#34; opacity=&#34;.5&#34;&gt;ACCEPTOR THREAD&lt;/text&gt;
      &lt;rect x=&#34;40&#34; y=&#34;90&#34; width=&#34;110&#34; height=&#34;70&#34; rx=&#34;10&#34; fill=&#34;#181c25&#34; stroke=&#34;#8a90a8&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;95&#34; y=&#34;120&#34; class=&#34;svg-text&#34; font-size=&#34;14&#34; font-weight=&#34;800&#34; text-anchor=&#34;middle&#34;&gt;Client&lt;/text&gt;
      &lt;text x=&#34;95&#34; y=&#34;140&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#555c73&#34; text-anchor=&#34;middle&#34;&gt;TCP SYN&lt;/text&gt;
      &lt;line x1=&#34;155&#34; y1=&#34;125&#34; x2=&#34;230&#34; y2=&#34;125&#34; stroke=&#34;#8a90a8&#34; stroke-width=&#34;2.5&#34; marker-end=&#34;url(#arrowB)&#34;/&gt;
      &lt;text x=&#34;192&#34; y=&#34;115&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#555c73&#34; text-anchor=&#34;middle&#34;&gt;connect&lt;/text&gt;
      &lt;rect x=&#34;235&#34; y=&#34;75&#34; width=&#34;190&#34; height=&#34;100&#34; rx=&#34;12&#34; fill=&#34;rgba(255,138,62,.06)&#34; stroke=&#34;#ff8a3e&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;330&#34; y=&#34;104&#34; class=&#34;svg-text&#34; font-size=&#34;13&#34; font-weight=&#34;800&#34; fill=&#34;#ff8a3e&#34; text-anchor=&#34;middle&#34;&gt;Kernel&lt;/text&gt;
      &lt;text x=&#34;330&#34; y=&#34;124&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;multishot accept&lt;/text&gt;
      &lt;text x=&#34;330&#34; y=&#34;142&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;completes → CQE&lt;/text&gt;
      &lt;text x=&#34;330&#34; y=&#34;160&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#ff8a3e&#34; text-anchor=&#34;middle&#34;&gt;res = new client fd&lt;/text&gt;
      &lt;line x1=&#34;428&#34; y1=&#34;125&#34; x2=&#34;510&#34; y2=&#34;125&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;2.5&#34; marker-end=&#34;url(#arrowG)&#34;/&gt;
      &lt;rect x=&#34;515&#34; y=&#34;85&#34; width=&#34;150&#34; height=&#34;80&#34; rx=&#34;12&#34; fill=&#34;rgba(62,232,138,.06)&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;590&#34; y=&#34;115&#34; class=&#34;svg-text&#34; font-size=&#34;13&#34; font-weight=&#34;800&#34; fill=&#34;#3ee88a&#34; text-anchor=&#34;middle&#34;&gt;Accept CQE&lt;/text&gt;
      &lt;text x=&#34;590&#34; y=&#34;135&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;fd = 42&lt;/text&gt;
      &lt;text x=&#34;590&#34; y=&#34;152&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#3ee88a&#34; text-anchor=&#34;middle&#34;&gt;F_MORE = 1 (stay armed)&lt;/text&gt;
      &lt;line x1=&#34;668&#34; y1=&#34;125&#34; x2=&#34;720&#34; y2=&#34;125&#34; stroke=&#34;#3ee8d0&#34; stroke-width=&#34;2.5&#34; marker-end=&#34;url(#arrowB)&#34;/&gt;
      &lt;rect x=&#34;725&#34; y=&#34;85&#34; width=&#34;110&#34; height=&#34;80&#34; rx=&#34;12&#34; fill=&#34;#181c25&#34; stroke=&#34;#3ee8d0&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;780&#34; y=&#34;113&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#3ee8d0&#34; text-anchor=&#34;middle&#34;&gt;Round&lt;/text&gt;
      &lt;text x=&#34;780&#34; y=&#34;130&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#3ee8d0&#34; text-anchor=&#34;middle&#34;&gt;Robin&lt;/text&gt;
      &lt;text x=&#34;780&#34; y=&#34;152&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;next % N&lt;/text&gt;
      &lt;text x=&#34;430&#34; y=&#34;230&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;Multishot accept is armed once at startup. Each new connection produces a CQE automatically.&lt;/text&gt;
      &lt;text x=&#34;430&#34; y=&#34;250&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;The acceptor never re-submits. F_MORE flag tells us the kernel will keep producing CQEs.&lt;/text&gt;
    &lt;/svg&gt;
  &lt;/div&gt;
  &lt;!-- STEP 1 --&gt;
  &lt;div class=&#34;ff-panel&#34; id=&#34;ffP1&#34; style=&#34;display:none;&#34;&gt;
    &lt;svg viewBox=&#34;0 0 860 280&#34; class=&#34;ring-svg&#34;&gt;
      &lt;rect x=&#34;10&#34; y=&#34;10&#34; width=&#34;380&#34; height=&#34;130&#34; rx=&#34;14&#34; fill=&#34;rgba(74,144,255,.03)&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;1&#34; stroke-dasharray=&#34;5 3&#34; opacity=&#34;.35&#34;/&gt;
      &lt;text x=&#34;30&#34; y=&#34;34&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; font-weight=&#34;700&#34; fill=&#34;#4a90ff&#34; opacity=&#34;.5&#34;&gt;ACCEPTOR&lt;/text&gt;
      &lt;rect x=&#34;470&#34; y=&#34;10&#34; width=&#34;380&#34; height=&#34;260&#34; rx=&#34;14&#34; fill=&#34;rgba(62,232,208,.03)&#34; stroke=&#34;#3ee8d0&#34; stroke-width=&#34;1&#34; stroke-dasharray=&#34;5 3&#34; opacity=&#34;.35&#34;/&gt;
      &lt;text x=&#34;490&#34; y=&#34;34&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; font-weight=&#34;700&#34; fill=&#34;#3ee8d0&#34; opacity=&#34;.5&#34;&gt;REACTOR 0&lt;/text&gt;
      &lt;rect x=&#34;40&#34; y=&#34;55&#34; width=&#34;140&#34; height=&#34;65&#34; rx=&#34;10&#34; fill=&#34;#181c25&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;1.5&#34;/&gt;
      &lt;text x=&#34;110&#34; y=&#34;80&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#4a90ff&#34; text-anchor=&#34;middle&#34;&gt;Acceptor&lt;/text&gt;
      &lt;text x=&#34;110&#34; y=&#34;98&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;fd = 42&lt;/text&gt;
      &lt;line x1=&#34;184&#34; y1=&#34;87&#34; x2=&#34;470&#34; y2=&#34;87&#34; stroke=&#34;#3ee8d0&#34; stroke-width=&#34;3&#34; marker-end=&#34;url(#arrowB)&#34;/&gt;
      &lt;rect x=&#34;260&#34; y=&#34;68&#34; width=&#34;140&#34; height=&#34;38&#34; rx=&#34;8&#34; fill=&#34;#0b0d11&#34; stroke=&#34;#3ee8d0&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;330&#34; y=&#34;84&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; font-weight=&#34;700&#34; fill=&#34;#3ee8d0&#34; text-anchor=&#34;middle&#34;&gt;MPSC Queue&lt;/text&gt;
      &lt;text x=&#34;330&#34; y=&#34;99&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#555c73&#34; text-anchor=&#34;middle&#34;&gt;lock-free enqueue&lt;/text&gt;
      &lt;rect x=&#34;505&#34; y=&#34;55&#34; width=&#34;200&#34; height=&#34;65&#34; rx=&#34;10&#34; fill=&#34;#181c25&#34; stroke=&#34;#3ee8d0&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;605&#34; y=&#34;78&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#3ee8d0&#34; text-anchor=&#34;middle&#34;&gt;Reactor dequeues fd&lt;/text&gt;
      &lt;text x=&#34;605&#34; y=&#34;98&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;creates Connection object&lt;/text&gt;
      &lt;line x1=&#34;605&#34; y1=&#34;124&#34; x2=&#34;605&#34; y2=&#34;162&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;2.5&#34; marker-end=&#34;url(#arrowB)&#34;/&gt;
      &lt;rect x=&#34;490&#34; y=&#34;166&#34; width=&#34;230&#34; height=&#34;65&#34; rx=&#34;10&#34; fill=&#34;rgba(74,144,255,.08)&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;605&#34; y=&#34;190&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#4a90ff&#34; text-anchor=&#34;middle&#34;&gt;Arm recv_multishot&lt;/text&gt;
      &lt;text x=&#34;605&#34; y=&#34;210&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;prep_recv(sqe, fd=42, bgid=1)&lt;/text&gt;
      &lt;text x=&#34;605&#34; y=&#34;224&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#555c73&#34; text-anchor=&#34;middle&#34;&gt;+ set_data64([Recv | 42])&lt;/text&gt;
      &lt;text x=&#34;430&#34; y=&#34;265&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;The reactor now owns this fd. No other thread touches it. Zero contention by design.&lt;/text&gt;
    &lt;/svg&gt;
  &lt;/div&gt;
  &lt;!-- STEP 2 --&gt;
  &lt;div class=&#34;ff-panel&#34; id=&#34;ffP2&#34; style=&#34;display:none;&#34;&gt;
    &lt;svg viewBox=&#34;0 0 860 300&#34; class=&#34;ring-svg&#34;&gt;
      &lt;rect x=&#34;10&#34; y=&#34;10&#34; width=&#34;840&#34; height=&#34;280&#34; rx=&#34;14&#34; fill=&#34;rgba(255,138,62,.03)&#34; stroke=&#34;#ff8a3e&#34; stroke-width=&#34;1&#34; stroke-dasharray=&#34;5 3&#34; opacity=&#34;.35&#34;/&gt;
      &lt;text x=&#34;30&#34; y=&#34;34&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; font-weight=&#34;700&#34; fill=&#34;#ff8a3e&#34; opacity=&#34;.5&#34;&gt;KERNEL I/O&lt;/text&gt;
      &lt;rect x=&#34;40&#34; y=&#34;70&#34; width=&#34;120&#34; height=&#34;60&#34; rx=&#34;10&#34; fill=&#34;#181c25&#34; stroke=&#34;#8a90a8&#34; stroke-width=&#34;1.5&#34;/&gt;
      &lt;text x=&#34;100&#34; y=&#34;96&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; text-anchor=&#34;middle&#34;&gt;Client&lt;/text&gt;
      &lt;text x=&#34;100&#34; y=&#34;114&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#555c73&#34; text-anchor=&#34;middle&#34;&gt;sends data&lt;/text&gt;
      &lt;line x1=&#34;164&#34; y1=&#34;100&#34; x2=&#34;230&#34; y2=&#34;100&#34; stroke=&#34;#8a90a8&#34; stroke-width=&#34;2&#34; marker-end=&#34;url(#arrowO)&#34;/&gt;
      &lt;rect x=&#34;235&#34; y=&#34;55&#34; width=&#34;200&#34; height=&#34;90&#34; rx=&#34;12&#34; fill=&#34;rgba(255,138,62,.08)&#34; stroke=&#34;#ff8a3e&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;335&#34; y=&#34;82&#34; class=&#34;svg-text&#34; font-size=&#34;13&#34; font-weight=&#34;800&#34; fill=&#34;#ff8a3e&#34; text-anchor=&#34;middle&#34;&gt;Kernel recv()&lt;/text&gt;
      &lt;text x=&#34;335&#34; y=&#34;102&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;multishot → picks buf&lt;/text&gt;
      &lt;text x=&#34;335&#34; y=&#34;120&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;from buf_ring (bgid=1)&lt;/text&gt;
      &lt;line x1=&#34;438&#34; y1=&#34;100&#34; x2=&#34;510&#34; y2=&#34;100&#34; stroke=&#34;#a06aff&#34; stroke-width=&#34;2.5&#34; marker-end=&#34;url(#arrowP)&#34;/&gt;
      &lt;rect x=&#34;515&#34; y=&#34;60&#34; width=&#34;160&#34; height=&#34;80&#34; rx=&#34;12&#34; fill=&#34;rgba(160,106,255,.1)&#34; stroke=&#34;#a06aff&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;595&#34; y=&#34;88&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#a06aff&#34; text-anchor=&#34;middle&#34;&gt;Buffer #7&lt;/text&gt;
      &lt;text x=&#34;595&#34; y=&#34;108&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;32KB pre-allocated&lt;/text&gt;
      &lt;text x=&#34;595&#34; y=&#34;126&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#a06aff&#34; text-anchor=&#34;middle&#34;&gt;filled: 1,420 bytes&lt;/text&gt;
      &lt;line x1=&#34;430&#34; y1=&#34;150&#34; x2=&#34;430&#34; y2=&#34;188&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;2.5&#34; marker-end=&#34;url(#arrowG)&#34;/&gt;
      &lt;rect x=&#34;240&#34; y=&#34;192&#34; width=&#34;380&#34; height=&#34;70&#34; rx=&#34;12&#34; fill=&#34;rgba(62,232,138,.06)&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;430&#34; y=&#34;215&#34; class=&#34;svg-text&#34; font-size=&#34;13&#34; font-weight=&#34;800&#34; fill=&#34;#3ee88a&#34; text-anchor=&#34;middle&#34;&gt;CQE produced&lt;/text&gt;
      &lt;text x=&#34;430&#34; y=&#34;237&#34; class=&#34;svg-mono&#34; font-size=&#34;11&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;user_data: [Recv | 42]   res: 1420   flags: (7 &amp;lt;&amp;lt; 16) | F_BUFFER | F_MORE&lt;/text&gt;
      &lt;text x=&#34;430&#34; y=&#34;255&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#555c73&#34; text-anchor=&#34;middle&#34;&gt;buffer_id=7 encoded in flags upper 16 bits • F_MORE means multishot continues&lt;/text&gt;
      &lt;rect x=&#34;690&#34; y=&#34;75&#34; width=&#34;140&#34; height=&#34;50&#34; rx=&#34;8&#34; fill=&#34;#181c25&#34; stroke=&#34;#ffd04a&#34; stroke-width=&#34;1.5&#34;/&gt;
      &lt;text x=&#34;760&#34; y=&#34;97&#34; class=&#34;svg-text&#34; font-size=&#34;10&#34; font-weight=&#34;700&#34; fill=&#34;#ffd04a&#34; text-anchor=&#34;middle&#34;&gt;Zero Copy&lt;/text&gt;
      &lt;text x=&#34;760&#34; y=&#34;112&#34; class=&#34;svg-mono&#34; font-size=&#34;8&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;NIC → your buffer&lt;/text&gt;
    &lt;/svg&gt;
  &lt;/div&gt;
  &lt;!-- STEP 3 --&gt;
  &lt;div class=&#34;ff-panel&#34; id=&#34;ffP3&#34; style=&#34;display:none;&#34;&gt;
    &lt;svg viewBox=&#34;0 0 860 300&#34; class=&#34;ring-svg&#34;&gt;
      &lt;rect x=&#34;10&#34; y=&#34;10&#34; width=&#34;840&#34; height=&#34;280&#34; rx=&#34;14&#34; fill=&#34;rgba(62,232,208,.03)&#34; stroke=&#34;#3ee8d0&#34; stroke-width=&#34;1&#34; stroke-dasharray=&#34;5 3&#34; opacity=&#34;.35&#34;/&gt;
      &lt;text x=&#34;30&#34; y=&#34;34&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; font-weight=&#34;700&#34; fill=&#34;#3ee8d0&#34; opacity=&#34;.5&#34;&gt;REACTOR EVENT LOOP&lt;/text&gt;
      &lt;rect x=&#34;40&#34; y=&#34;60&#34; width=&#34;200&#34; height=&#34;70&#34; rx=&#34;10&#34; fill=&#34;#181c25&#34; stroke=&#34;#3ee8d0&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;140&#34; y=&#34;86&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#3ee8d0&#34; text-anchor=&#34;middle&#34;&gt;peek_batch_cqe&lt;/text&gt;
      &lt;text x=&#34;140&#34; y=&#34;108&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;got 3 CQEs&lt;/text&gt;
      &lt;line x1=&#34;244&#34; y1=&#34;95&#34; x2=&#34;300&#34; y2=&#34;95&#34; stroke=&#34;#3ee8d0&#34; stroke-width=&#34;2&#34; marker-end=&#34;url(#arrowB)&#34;/&gt;
      &lt;rect x=&#34;305&#34; y=&#34;60&#34; width=&#34;200&#34; height=&#34;70&#34; rx=&#34;10&#34; fill=&#34;#181c25&#34; stroke=&#34;#8a90a8&#34; stroke-width=&#34;1.5&#34;/&gt;
      &lt;text x=&#34;405&#34; y=&#34;84&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; text-anchor=&#34;middle&#34;&gt;Unpack user_data&lt;/text&gt;
      &lt;text x=&#34;405&#34; y=&#34;106&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;kind = UdKindOf(ud)&lt;/text&gt;
      &lt;text x=&#34;405&#34; y=&#34;120&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;fd   = UdFdOf(ud)&lt;/text&gt;
      &lt;line x1=&#34;405&#34; y1=&#34;134&#34; x2=&#34;140&#34; y2=&#34;190&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;2&#34; marker-end=&#34;url(#arrowG)&#34;/&gt;
      &lt;line x1=&#34;405&#34; y1=&#34;134&#34; x2=&#34;405&#34; y2=&#34;190&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;2&#34; marker-end=&#34;url(#arrowB)&#34;/&gt;
      &lt;line x1=&#34;405&#34; y1=&#34;134&#34; x2=&#34;670&#34; y2=&#34;190&#34; stroke=&#34;#ff4a5e&#34; stroke-width=&#34;2&#34; marker-end=&#34;url(#arrowB)&#34;/&gt;
      &lt;rect x=&#34;50&#34; y=&#34;195&#34; width=&#34;180&#34; height=&#34;75&#34; rx=&#34;10&#34; fill=&#34;rgba(62,232,138,.06)&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;140&#34; y=&#34;220&#34; class=&#34;svg-text&#34; font-size=&#34;13&#34; font-weight=&#34;800&#34; fill=&#34;#3ee88a&#34; text-anchor=&#34;middle&#34;&gt;Recv&lt;/text&gt;
      &lt;text x=&#34;140&#34; y=&#34;240&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;extract buffer_id&lt;/text&gt;
      &lt;text x=&#34;140&#34; y=&#34;256&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;enqueue to connection&lt;/text&gt;
      &lt;rect x=&#34;315&#34; y=&#34;195&#34; width=&#34;180&#34; height=&#34;75&#34; rx=&#34;10&#34; fill=&#34;rgba(74,144,255,.06)&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;405&#34; y=&#34;220&#34; class=&#34;svg-text&#34; font-size=&#34;13&#34; font-weight=&#34;800&#34; fill=&#34;#4a90ff&#34; text-anchor=&#34;middle&#34;&gt;Send&lt;/text&gt;
      &lt;text x=&#34;405&#34; y=&#34;240&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;update WriteHead += res&lt;/text&gt;
      &lt;text x=&#34;405&#34; y=&#34;256&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;complete flush if done&lt;/text&gt;
      &lt;rect x=&#34;580&#34; y=&#34;195&#34; width=&#34;180&#34; height=&#34;75&#34; rx=&#34;10&#34; fill=&#34;rgba(255,74,94,.06)&#34; stroke=&#34;#ff4a5e&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;670&#34; y=&#34;220&#34; class=&#34;svg-text&#34; font-size=&#34;13&#34; font-weight=&#34;800&#34; fill=&#34;#ff4a5e&#34; text-anchor=&#34;middle&#34;&gt;Cancel&lt;/text&gt;
      &lt;text x=&#34;670&#34; y=&#34;240&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;cleanup acknowledged&lt;/text&gt;
      &lt;text x=&#34;670&#34; y=&#34;256&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;nothing to do&lt;/text&gt;
    &lt;/svg&gt;
  &lt;/div&gt;
  &lt;!-- STEP 4 --&gt;
  &lt;div class=&#34;ff-panel&#34; id=&#34;ffP4&#34; style=&#34;display:none;&#34;&gt;
    &lt;svg viewBox=&#34;0 0 860 280&#34; class=&#34;ring-svg&#34;&gt;
      &lt;rect x=&#34;10&#34; y=&#34;10&#34; width=&#34;840&#34; height=&#34;260&#34; rx=&#34;14&#34; fill=&#34;rgba(62,232,208,.03)&#34; stroke=&#34;#3ee8d0&#34; stroke-width=&#34;1&#34; stroke-dasharray=&#34;5 3&#34; opacity=&#34;.35&#34;/&gt;
      &lt;text x=&#34;30&#34; y=&#34;34&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; font-weight=&#34;700&#34; fill=&#34;#3ee8d0&#34; opacity=&#34;.5&#34;&gt;CONNECTION READ PATH&lt;/text&gt;
      &lt;rect x=&#34;40&#34; y=&#34;70&#34; width=&#34;170&#34; height=&#34;80&#34; rx=&#34;10&#34; fill=&#34;rgba(62,232,138,.06)&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;125&#34; y=&#34;96&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#3ee88a&#34; text-anchor=&#34;middle&#34;&gt;Recv CQE&lt;/text&gt;
      &lt;text x=&#34;125&#34; y=&#34;116&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;buf_id=7, 1420B&lt;/text&gt;
      &lt;text x=&#34;125&#34; y=&#34;134&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#555c73&#34; text-anchor=&#34;middle&#34;&gt;ptr = slab + 7*32KB&lt;/text&gt;
      &lt;line x1=&#34;214&#34; y1=&#34;110&#34; x2=&#34;280&#34; y2=&#34;110&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;2&#34; marker-end=&#34;url(#arrowG)&#34;/&gt;
      &lt;rect x=&#34;285&#34; y=&#34;70&#34; width=&#34;180&#34; height=&#34;80&#34; rx=&#34;10&#34; fill=&#34;#181c25&#34; stroke=&#34;#a06aff&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;375&#34; y=&#34;96&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#a06aff&#34; text-anchor=&#34;middle&#34;&gt;MPSC Recv Ring&lt;/text&gt;
      &lt;text x=&#34;375&#34; y=&#34;116&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;EnqueueRingItem&lt;/text&gt;
      &lt;text x=&#34;375&#34; y=&#34;134&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#555c73&#34; text-anchor=&#34;middle&#34;&gt;(ptr, len, buf_id)&lt;/text&gt;
      &lt;line x1=&#34;469&#34; y1=&#34;110&#34; x2=&#34;535&#34; y2=&#34;110&#34; stroke=&#34;#3ee8d0&#34; stroke-width=&#34;2&#34; marker-end=&#34;url(#arrowB)&#34;/&gt;
      &lt;rect x=&#34;540&#34; y=&#34;60&#34; width=&#34;270&#34; height=&#34;100&#34; rx=&#34;12&#34; fill=&#34;rgba(62,232,208,.06)&#34; stroke=&#34;#3ee8d0&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;675&#34; y=&#34;90&#34; class=&#34;svg-text&#34; font-size=&#34;14&#34; font-weight=&#34;800&#34; fill=&#34;#3ee8d0&#34; text-anchor=&#34;middle&#34;&gt;ReadAsync() completes&lt;/text&gt;
      &lt;text x=&#34;675&#34; y=&#34;114&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;ValueTask signals your handler&lt;/text&gt;
      &lt;text x=&#34;675&#34; y=&#34;134&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;result.IsClosed = false&lt;/text&gt;
      &lt;text x=&#34;675&#34; y=&#34;150&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#3ee8d0&#34; text-anchor=&#34;middle&#34;&gt;zero allocation (ManualResetValueTaskSourceCore)&lt;/text&gt;
      &lt;text x=&#34;430&#34; y=&#34;210&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;The reactor enqueues the raw pointer + length + buffer_id into the connection&#39;s lock-free recv ring.&lt;/text&gt;
      &lt;text x=&#34;430&#34; y=&#34;230&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;Your await ReadAsync() resumes with zero allocations via ValueTask.&lt;/text&gt;
      &lt;text x=&#34;430&#34; y=&#34;252&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;You now have direct pointer access to the kernel-filled buffer. No copy happened.&lt;/text&gt;
    &lt;/svg&gt;
  &lt;/div&gt;
  &lt;!-- STEP 5 --&gt;
  &lt;div class=&#34;ff-panel&#34; id=&#34;ffP5&#34; style=&#34;display:none;&#34;&gt;
    &lt;svg viewBox=&#34;0 0 860 300&#34; class=&#34;ring-svg&#34;&gt;
      &lt;rect x=&#34;10&#34; y=&#34;10&#34; width=&#34;840&#34; height=&#34;280&#34; rx=&#34;14&#34; fill=&#34;rgba(62,232,208,.03)&#34; stroke=&#34;#3ee8d0&#34; stroke-width=&#34;1&#34; stroke-dasharray=&#34;5 3&#34; opacity=&#34;.35&#34;/&gt;
      &lt;text x=&#34;30&#34; y=&#34;34&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; font-weight=&#34;700&#34; fill=&#34;#3ee8d0&#34; opacity=&#34;.5&#34;&gt;YOUR APPLICATION HANDLER&lt;/text&gt;
      &lt;rect x=&#34;40&#34; y=&#34;60&#34; width=&#34;200&#34; height=&#34;100&#34; rx=&#34;10&#34; fill=&#34;#181c25&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;140&#34; y=&#34;86&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#3ee88a&#34; text-anchor=&#34;middle&#34;&gt;Read Buffers&lt;/text&gt;
      &lt;text x=&#34;140&#34; y=&#34;106&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#3ee8d0&#34; text-anchor=&#34;middle&#34;&gt;GetAllSnapshot&lt;/text&gt;
      &lt;text x=&#34;140&#34; y=&#34;122&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#3ee8d0&#34; text-anchor=&#34;middle&#34;&gt;RingsAsUnmanagedMemory&lt;/text&gt;
      &lt;text x=&#34;140&#34; y=&#34;142&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#555c73&#34; text-anchor=&#34;middle&#34;&gt;or ToReadOnlySequence()&lt;/text&gt;
      &lt;line x1=&#34;244&#34; y1=&#34;110&#34; x2=&#34;295&#34; y2=&#34;110&#34; stroke=&#34;#8a90a8&#34; stroke-width=&#34;2&#34; marker-end=&#34;url(#arrowB)&#34;/&gt;
      &lt;rect x=&#34;300&#34; y=&#34;70&#34; width=&#34;170&#34; height=&#34;80&#34; rx=&#34;10&#34; fill=&#34;#181c25&#34; stroke=&#34;#8a90a8&#34; stroke-width=&#34;1.5&#34;/&gt;
      &lt;text x=&#34;385&#34; y=&#34;100&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; text-anchor=&#34;middle&#34;&gt;Parse Request&lt;/text&gt;
      &lt;text x=&#34;385&#34; y=&#34;120&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;your business logic&lt;/text&gt;
      &lt;text x=&#34;385&#34; y=&#34;137&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#555c73&#34; text-anchor=&#34;middle&#34;&gt;HTTP parse, JSON, etc.&lt;/text&gt;
      &lt;line x1=&#34;474&#34; y1=&#34;110&#34; x2=&#34;525&#34; y2=&#34;110&#34; stroke=&#34;#8a90a8&#34; stroke-width=&#34;2&#34; marker-end=&#34;url(#arrowB)&#34;/&gt;
      &lt;rect x=&#34;530&#34; y=&#34;60&#34; width=&#34;280&#34; height=&#34;100&#34; rx=&#34;10&#34; fill=&#34;rgba(74,144,255,.06)&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;670&#34; y=&#34;86&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#4a90ff&#34; text-anchor=&#34;middle&#34;&gt;Write Response&lt;/text&gt;
      &lt;text x=&#34;670&#34; y=&#34;108&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#3ee8d0&#34; text-anchor=&#34;middle&#34;&gt;connection.Write(data)&lt;/text&gt;
      &lt;text x=&#34;670&#34; y=&#34;126&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;copies into 16KB staging slab&lt;/text&gt;
      &lt;text x=&#34;670&#34; y=&#34;146&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#555c73&#34; text-anchor=&#34;middle&#34;&gt;NativeMemory, no GC pressure&lt;/text&gt;
      &lt;line x1=&#34;670&#34; y1=&#34;164&#34; x2=&#34;670&#34; y2=&#34;200&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;2&#34; marker-end=&#34;url(#arrowB)&#34;/&gt;
      &lt;rect x=&#34;530&#34; y=&#34;205&#34; width=&#34;280&#34; height=&#34;60&#34; rx=&#34;10&#34; fill=&#34;rgba(74,144,255,.1)&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;670&#34; y=&#34;230&#34; class=&#34;svg-text&#34; font-size=&#34;13&#34; font-weight=&#34;800&#34; fill=&#34;#4a90ff&#34; text-anchor=&#34;middle&#34;&gt;await FlushAsync()&lt;/text&gt;
      &lt;text x=&#34;670&#34; y=&#34;250&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;queues send SQE for reactor&lt;/text&gt;
      &lt;text x=&#34;250&#34; y=&#34;230&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;Write() copies into the unmanaged staging buffer.&lt;/text&gt;
      &lt;text x=&#34;250&#34; y=&#34;250&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;FlushAsync() signals the reactor to submit a&lt;/text&gt;
      &lt;text x=&#34;250&#34; y=&#34;270&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;send SQE on the next loop iteration.&lt;/text&gt;
    &lt;/svg&gt;
  &lt;/div&gt;
  &lt;!-- STEP 6 --&gt;
  &lt;div class=&#34;ff-panel&#34; id=&#34;ffP6&#34; style=&#34;display:none;&#34;&gt;
    &lt;svg viewBox=&#34;0 0 860 280&#34; class=&#34;ring-svg&#34;&gt;
      &lt;rect x=&#34;10&#34; y=&#34;10&#34; width=&#34;420&#34; height=&#34;260&#34; rx=&#34;14&#34; fill=&#34;rgba(62,232,208,.03)&#34; stroke=&#34;#3ee8d0&#34; stroke-width=&#34;1&#34; stroke-dasharray=&#34;5 3&#34; opacity=&#34;.35&#34;/&gt;
      &lt;text x=&#34;30&#34; y=&#34;34&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; font-weight=&#34;700&#34; fill=&#34;#3ee8d0&#34; opacity=&#34;.5&#34;&gt;REACTOR&lt;/text&gt;
      &lt;rect x=&#34;440&#34; y=&#34;10&#34; width=&#34;410&#34; height=&#34;260&#34; rx=&#34;14&#34; fill=&#34;rgba(255,138,62,.03)&#34; stroke=&#34;#ff8a3e&#34; stroke-width=&#34;1&#34; stroke-dasharray=&#34;5 3&#34; opacity=&#34;.35&#34;/&gt;
      &lt;text x=&#34;460&#34; y=&#34;34&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; font-weight=&#34;700&#34; fill=&#34;#ff8a3e&#34; opacity=&#34;.5&#34;&gt;KERNEL&lt;/text&gt;
      &lt;rect x=&#34;40&#34; y=&#34;60&#34; width=&#34;180&#34; height=&#34;65&#34; rx=&#34;10&#34; fill=&#34;#181c25&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;130&#34; y=&#34;84&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; font-weight=&#34;700&#34; fill=&#34;#4a90ff&#34; text-anchor=&#34;middle&#34;&gt;Drain Flush Q&lt;/text&gt;
      &lt;text x=&#34;130&#34; y=&#34;104&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;prep_send(fd, buf, len)&lt;/text&gt;
      &lt;line x1=&#34;224&#34; y1=&#34;92&#34; x2=&#34;265&#34; y2=&#34;92&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;2&#34; marker-end=&#34;url(#arrowB)&#34;/&gt;
      &lt;rect x=&#34;270&#34; y=&#34;60&#34; width=&#34;145&#34; height=&#34;65&#34; rx=&#34;10&#34; fill=&#34;rgba(62,232,208,.08)&#34; stroke=&#34;#3ee8d0&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;342&#34; y=&#34;82&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; font-weight=&#34;700&#34; fill=&#34;#3ee8d0&#34; text-anchor=&#34;middle&#34;&gt;submit_and&lt;/text&gt;
      &lt;text x=&#34;342&#34; y=&#34;98&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; font-weight=&#34;700&#34; fill=&#34;#3ee8d0&#34; text-anchor=&#34;middle&#34;&gt;_wait_timeout&lt;/text&gt;
      &lt;text x=&#34;342&#34; y=&#34;115&#34; class=&#34;svg-mono&#34; font-size=&#34;8&#34; fill=&#34;#555c73&#34; text-anchor=&#34;middle&#34;&gt;1 syscall&lt;/text&gt;
      &lt;line x1=&#34;418&#34; y1=&#34;92&#34; x2=&#34;475&#34; y2=&#34;92&#34; stroke=&#34;#ff8a3e&#34; stroke-width=&#34;2.5&#34; marker-end=&#34;url(#arrowO)&#34;/&gt;
      &lt;rect x=&#34;480&#34; y=&#34;55&#34; width=&#34;200&#34; height=&#34;80&#34; rx=&#34;12&#34; fill=&#34;rgba(255,138,62,.08)&#34; stroke=&#34;#ff8a3e&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;580&#34; y=&#34;82&#34; class=&#34;svg-text&#34; font-size=&#34;13&#34; font-weight=&#34;800&#34; fill=&#34;#ff8a3e&#34; text-anchor=&#34;middle&#34;&gt;Kernel send()&lt;/text&gt;
      &lt;text x=&#34;580&#34; y=&#34;102&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;staging buf → TCP socket&lt;/text&gt;
      &lt;text x=&#34;580&#34; y=&#34;120&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;→ client receives data&lt;/text&gt;
      &lt;line x1=&#34;580&#34; y1=&#34;140&#34; x2=&#34;580&#34; y2=&#34;178&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;2&#34; marker-end=&#34;url(#arrowG)&#34;/&gt;
      &lt;rect x=&#34;475&#34; y=&#34;182&#34; width=&#34;210&#34; height=&#34;65&#34; rx=&#34;10&#34; fill=&#34;rgba(62,232,138,.06)&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;580&#34; y=&#34;208&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#3ee88a&#34; text-anchor=&#34;middle&#34;&gt;Send CQE&lt;/text&gt;
      &lt;text x=&#34;580&#34; y=&#34;228&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;res = bytes_sent&lt;/text&gt;
      &lt;text x=&#34;580&#34; y=&#34;240&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#3ee88a&#34; text-anchor=&#34;middle&#34;&gt;reactor: CompleteFlush()&lt;/text&gt;
      &lt;line x1=&#34;472&#34; y1=&#34;214&#34; x2=&#34;240&#34; y2=&#34;214&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;2&#34; marker-end=&#34;url(#arrowG)&#34;/&gt;
      &lt;rect x=&#34;40&#34; y=&#34;185&#34; width=&#34;196&#34; height=&#34;60&#34; rx=&#34;10&#34; fill=&#34;#181c25&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;1.5&#34;/&gt;
      &lt;text x=&#34;138&#34; y=&#34;208&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; font-weight=&#34;700&#34; fill=&#34;#3ee88a&#34; text-anchor=&#34;middle&#34;&gt;FlushAsync returns&lt;/text&gt;
      &lt;text x=&#34;138&#34; y=&#34;228&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;your handler continues&lt;/text&gt;
    &lt;/svg&gt;
  &lt;/div&gt;
  &lt;!-- STEP 7 --&gt;
  &lt;div class=&#34;ff-panel&#34; id=&#34;ffP7&#34; style=&#34;display:none;&#34;&gt;
    &lt;svg viewBox=&#34;0 0 860 300&#34; class=&#34;ring-svg&#34;&gt;
      &lt;rect x=&#34;10&#34; y=&#34;10&#34; width=&#34;840&#34; height=&#34;280&#34; rx=&#34;14&#34; fill=&#34;rgba(160,106,255,.03)&#34; stroke=&#34;#a06aff&#34; stroke-width=&#34;1&#34; stroke-dasharray=&#34;5 3&#34; opacity=&#34;.35&#34;/&gt;
      &lt;text x=&#34;30&#34; y=&#34;34&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; font-weight=&#34;700&#34; fill=&#34;#a06aff&#34; opacity=&#34;.5&#34;&gt;BUFFER RECYCLING&lt;/text&gt;
      &lt;rect x=&#34;40&#34; y=&#34;65&#34; width=&#34;190&#34; height=&#34;80&#34; rx=&#34;10&#34; fill=&#34;#181c25&#34; stroke=&#34;#3ee8d0&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;135&#34; y=&#34;92&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#3ee8d0&#34; text-anchor=&#34;middle&#34;&gt;Your Handler&lt;/text&gt;
      &lt;text x=&#34;135&#34; y=&#34;112&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#3ee8d0&#34; text-anchor=&#34;middle&#34;&gt;ReturnRing(bid=7)&lt;/text&gt;
      &lt;text x=&#34;135&#34; y=&#34;130&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#3ee8d0&#34; text-anchor=&#34;middle&#34;&gt;ResetRead()&lt;/text&gt;
      &lt;line x1=&#34;234&#34; y1=&#34;105&#34; x2=&#34;290&#34; y2=&#34;105&#34; stroke=&#34;#a06aff&#34; stroke-width=&#34;2.5&#34; marker-end=&#34;url(#arrowP)&#34;/&gt;
      &lt;rect x=&#34;295&#34; y=&#34;70&#34; width=&#34;170&#34; height=&#34;70&#34; rx=&#34;10&#34; fill=&#34;#181c25&#34; stroke=&#34;#a06aff&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;380&#34; y=&#34;96&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#a06aff&#34; text-anchor=&#34;middle&#34;&gt;Return Queue&lt;/text&gt;
      &lt;text x=&#34;380&#34; y=&#34;118&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;MPSC enqueue(7)&lt;/text&gt;
      &lt;line x1=&#34;469&#34; y1=&#34;105&#34; x2=&#34;525&#34; y2=&#34;105&#34; stroke=&#34;#3ee8d0&#34; stroke-width=&#34;2.5&#34; marker-end=&#34;url(#arrowB)&#34;/&gt;
      &lt;rect x=&#34;530&#34; y=&#34;65&#34; width=&#34;175&#34; height=&#34;80&#34; rx=&#34;10&#34; fill=&#34;#181c25&#34; stroke=&#34;#3ee8d0&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;617&#34; y=&#34;92&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#3ee8d0&#34; text-anchor=&#34;middle&#34;&gt;Reactor drains&lt;/text&gt;
      &lt;text x=&#34;617&#34; y=&#34;112&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;DrainReturnQ()&lt;/text&gt;
      &lt;text x=&#34;617&#34; y=&#34;130&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#555c73&#34; text-anchor=&#34;middle&#34;&gt;on next loop iter&lt;/text&gt;
      &lt;line x1=&#34;617&#34; y1=&#34;149&#34; x2=&#34;617&#34; y2=&#34;185&#34; stroke=&#34;#a06aff&#34; stroke-width=&#34;2.5&#34; marker-end=&#34;url(#arrowP)&#34;/&gt;
      &lt;rect x=&#34;440&#34; y=&#34;190&#34; width=&#34;360&#34; height=&#34;80&#34; rx=&#34;12&#34; fill=&#34;rgba(160,106,255,.06)&#34; stroke=&#34;#a06aff&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;620&#34; y=&#34;218&#34; class=&#34;svg-text&#34; font-size=&#34;13&#34; font-weight=&#34;800&#34; fill=&#34;#a06aff&#34; text-anchor=&#34;middle&#34;&gt;buf_ring_add + buf_ring_advance&lt;/text&gt;
      &lt;text x=&#34;620&#34; y=&#34;240&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;buffer #7 is back in the pool&lt;/text&gt;
      &lt;text x=&#34;620&#34; y=&#34;258&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;kernel can use it for the next recv&lt;/text&gt;
      &lt;rect x=&#34;40&#34; y=&#34;200&#34; width=&#34;230&#34; height=&#34;60&#34; rx=&#34;10&#34; fill=&#34;rgba(62,232,208,.06)&#34; stroke=&#34;#3ee8d0&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;155&#34; y=&#34;224&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#3ee8d0&#34; text-anchor=&#34;middle&#34;&gt;await ReadAsync()&lt;/text&gt;
      &lt;text x=&#34;155&#34; y=&#34;244&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;ready for next request&lt;/text&gt;
      &lt;text x=&#34;430&#34; y=&#34;290&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#3ee8d0&#34; text-anchor=&#34;middle&#34;&gt;← Loop repeats. Zero allocations. 1 syscall per iteration. →&lt;/text&gt;
    &lt;/svg&gt;
  &lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;stepper&#34;&gt;
  &lt;button class=&#34;step-btn&#34; id=&#34;ffPrev&#34; onclick=&#34;ffStep(-1)&#34;&gt;&amp;#9664;&lt;/button&gt;
  &lt;div class=&#34;step-dots&#34; id=&#34;ffDots&#34;&gt;&lt;/div&gt;
  &lt;button class=&#34;step-btn&#34; id=&#34;ffNext&#34; onclick=&#34;ffStep(1)&#34;&gt;&amp;#9654;&lt;/button&gt;
&lt;/div&gt;
&lt;div class=&#34;step-desc&#34; id=&#34;ffDesc&#34;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;!-- ═══════════════ FEATURES USED BY ZERG ═══════════════ --&gt;
&lt;div class=&#34;iu-section&#34;&gt;
&lt;h3&gt;Features Used by zerg&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;features-used-by-zerg&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#features-used-by-zerg&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;iu-cards&#34; style=&#34;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));&#34;&gt;
  &lt;div class=&#34;iu-card&#34;&gt;
    &lt;h4 style=&#34;color:#4a90ff;&#34;&gt;Multishot Accept&lt;/h4&gt;
    &lt;p&gt;A single SQE arms the kernel to produce one CQE per accepted connection indefinitely. The acceptor thread never re-arms. Each CQE contains the new client fd in &lt;code&gt;cqe-&gt;res&lt;/code&gt; and &lt;code&gt;IORING_CQE_F_MORE&lt;/code&gt; to indicate more will follow.&lt;/p&gt;
  &lt;/div&gt;
  &lt;div class=&#34;iu-card&#34;&gt;
    &lt;h4 style=&#34;color:#3ee88a;&#34;&gt;Multishot Recv + Buffer Selection&lt;/h4&gt;
    &lt;p&gt;A single SQE arms recv for a connection. Each time data arrives, the kernel picks a buffer from the buf_ring, fills it, and produces a CQE with the buffer ID in the flags. Eliminates per-recv buffer allocation.&lt;/p&gt;
  &lt;/div&gt;
  &lt;div class=&#34;iu-card&#34;&gt;
    &lt;h4 style=&#34;color:#a06aff;&#34;&gt;Buffer Rings (Provided Buffers)&lt;/h4&gt;
    &lt;p&gt;Pre-allocated buffer pool registered with the kernel via &lt;code&gt;shim_setup_buf_ring()&lt;/code&gt;. Buffers are added with &lt;code&gt;buf_ring_add()&lt;/code&gt; and recycled after use. See &lt;a href=&#34;../buffer-rings/&#34; style=&#34;color:#a06aff;&#34;&gt;Buffer Rings&lt;/a&gt; for the full lifecycle.&lt;/p&gt;
  &lt;/div&gt;
  &lt;div class=&#34;iu-card&#34;&gt;
    &lt;h4 style=&#34;color:#3ee8d0;&#34;&gt;SINGLE_ISSUER&lt;/h4&gt;
    &lt;p&gt;Tells the kernel only one thread submits to this ring. Skips SQ locking for better throughput. Matches zerg&#39;s model where each reactor is the sole submitter to its ring.&lt;/p&gt;
  &lt;/div&gt;
  &lt;div class=&#34;iu-card&#34;&gt;
    &lt;h4 style=&#34;color:#ff8a3e;&#34;&gt;DEFER_TASKRUN&lt;/h4&gt;
    &lt;p&gt;Defers kernel task_work until the next ring entry. Reduces latency spikes from interrupt-context work and makes completions arrive at predictable points for better async/await integration.&lt;/p&gt;
  &lt;/div&gt;
  &lt;div class=&#34;iu-card&#34;&gt;
    &lt;h4 style=&#34;color:#ffd04a;&#34;&gt;SQPOLL (Optional)&lt;/h4&gt;
    &lt;p&gt;Creates a kernel thread polling the SQ continuously, eliminating the &lt;code&gt;io_uring_enter()&lt;/code&gt; syscall. Trades a dedicated CPU core for the lowest possible submission latency.&lt;/p&gt;
  &lt;/div&gt;
  &lt;div class=&#34;iu-card&#34;&gt;
    &lt;h4 style=&#34;color:#ff6ab0;&#34;&gt;Submit-and-Wait&lt;/h4&gt;
    &lt;p&gt;zerg&#39;s reactor uses &lt;code&gt;shim_submit_and_wait_timeout()&lt;/code&gt; — a single syscall that submits all pending SQEs AND waits for at least one CQE. One syscall instead of two.&lt;/p&gt;
  &lt;/div&gt;
  &lt;div class=&#34;iu-card&#34;&gt;
    &lt;h4 style=&#34;color:#82aaff;&#34;&gt;CQE Batching&lt;/h4&gt;
    &lt;p&gt;Instead of one CQE at a time, the reactor peeks a batch with &lt;code&gt;shim_peek_batch_cqe()&lt;/code&gt; and processes all before advancing the CQ head. Amortizes the head update across completions.&lt;/p&gt;
  &lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;!-- /iouring-guide --&gt;
&lt;script&gt;
// Lifecycle stepper
const lcSteps = [
  { el: &#39;lc-s1&#39;, title: &#39;1. Get a free SQE slot&#39;, desc: &#39;Call &lt;code&gt;shim_get_sqe(ring)&lt;/code&gt; to grab an empty Submission Queue Entry from the ring. This is a userspace-only operation — no syscall. If the SQ is full, submit first to flush pending entries.&#39; },
  { el: &#39;lc-s2&#39;, title: &#39;2. Prepare the operation&#39;, desc: &#39;Fill the SQE with what you want: &lt;code&gt;shim_prep_recv_multishot_select(sqe, fd, bgid, 0)&lt;/code&gt;. This sets the opcode (RECV), the file descriptor, and enables buffer selection from the buf_ring.&#39; },
  { el: &#39;lc-s3&#39;, title: &#39;3. Attach your user_data&#39;, desc: &#39;Call &lt;code&gt;shim_sqe_set_data64(sqe, PackUd(Recv, fd))&lt;/code&gt;. This 64-bit tag will be returned verbatim in the CQE, so you can identify which operation completed and on which socket.&#39; },
  { el: &#39;lc-s4&#39;, title: &#39;4. Submit to kernel&#39;, desc: &#39;&lt;code&gt;shim_submit_and_wait_timeout(ring, &amp;amp;cqes, 1, &amp;amp;ts)&lt;/code&gt; — this single syscall flushes all queued SQEs AND waits for at least 1 completion. One syscall instead of two.&#39; },
  { el: &#39;lc-s5&#39;, title: &#39;5. Kernel processes the I/O&#39;, desc: &#39;The kernel sees your recv SQE, picks a buffer from the buf_ring, and when data arrives on the socket, fills that buffer. Zero-copy from NIC to your pre-allocated memory.&#39; },
  { el: &#39;lc-s6&#39;, title: &#39;6. CQE written to Completion Queue&#39;, desc: &#39;The kernel writes a CQE containing your &lt;code&gt;user_data&lt;/code&gt;, &lt;code&gt;res&lt;/code&gt; (bytes received), and &lt;code&gt;flags&lt;/code&gt; (including the buffer_id in the upper 16 bits and the F_MORE flag).&#39; },
  { el: &#39;lc-s7&#39;, title: &#39;7. App reads and dispatches CQE&#39;, desc: &#39;Your app calls &lt;code&gt;shim_peek_batch_cqe()&lt;/code&gt; to grab all available CQEs. Unpack &lt;code&gt;user_data&lt;/code&gt; to determine UdKind (Recv/Send/Cancel) and the fd. Process the result.&#39; },
  { el: &#39;lc-s8&#39;, title: &#39;8. Advance the CQ head&#39;, desc: &#39;Call &lt;code&gt;shim_cq_advance(ring, count)&lt;/code&gt; to mark all processed CQEs as consumed. This is a single userspace write to the ring head pointer — no syscall needed.&#39; },
];
let lcCur = -1;
function lcBuildDots() {
  const c = document.getElementById(&#39;lcDots&#39;);
  lcSteps.forEach((_, i) =&gt; { const d = document.createElement(&#39;div&#39;); d.className = &#39;step-dot&#39;; d.onclick = () =&gt; lcGoTo(i); c.appendChild(d); });
}
lcBuildDots();
function lcGoTo(idx) {
  lcCur = idx;
  lcSteps.forEach((s, i) =&gt; { const el = document.getElementById(s.el); if (i &lt;= idx) el.classList.add(&#39;show&#39;); else el.classList.remove(&#39;show&#39;); });
  document.querySelectorAll(&#39;#lcDots .step-dot&#39;).forEach((d, i) =&gt; { d.classList.remove(&#39;active&#39;,&#39;done&#39;); if (i &lt; idx) d.classList.add(&#39;done&#39;); if (i === idx) d.classList.add(&#39;active&#39;); });
  document.getElementById(&#39;lcDesc&#39;).innerHTML = &#39;&lt;h4&gt;&lt;span style=&#34;color:#3ee8d0;&#34;&gt;&#39;+lcSteps[idx].title+&#39;&lt;/span&gt;&lt;/h4&gt;&lt;p&gt;&#39;+lcSteps[idx].desc+&#39;&lt;/p&gt;&#39;;
  document.getElementById(&#39;lcPrev&#39;).disabled = idx &lt;= 0;
  document.getElementById(&#39;lcNext&#39;).disabled = idx &gt;= lcSteps.length - 1;
}
function lcStep(dir) { const n = lcCur + dir; if (n &gt;= 0 &amp;&amp; n &lt; lcSteps.length) lcGoTo(n); }
lcGoTo(0);

// Full flow stepper
const ffSteps = [
  { panel:&#39;ffP0&#39;, title:&#39;Phase 1 — Client Connects&#39;, desc:&#39;A client sends a TCP SYN. The kernel\&#39;s multishot accept (armed once at startup) produces a CQE with the new file descriptor. The acceptor never re-submits — F_MORE keeps it armed. The fd is round-robin\&#39;d to a reactor.&#39;, color:&#39;#4a90ff&#39; },
  { panel:&#39;ffP1&#39;, title:&#39;Phase 2 — FD Handed to Reactor&#39;, desc:&#39;The acceptor pushes the fd into the reactor\&#39;s lock-free MPSC queue. The reactor dequeues it, creates a pooled Connection object, and arms &lt;code&gt;recv_multishot&lt;/code&gt; with buffer selection. From now on, only this reactor touches this fd — zero contention.&#39;, color:&#39;#3ee8d0&#39; },
  { panel:&#39;ffP2&#39;, title:&#39;Phase 3 — Data Arrives&#39;, desc:&#39;The client sends data. The kernel\&#39;s multishot recv automatically picks a buffer from the buf_ring, fills it, and writes a CQE. The buffer_id is encoded in the upper 16 bits of &lt;code&gt;cqe.flags&lt;/code&gt;. Your pre-allocated memory was filled directly — zero copy.&#39;, color:&#39;#ff8a3e&#39; },
  { panel:&#39;ffP3&#39;, title:&#39;Phase 4 — CQE Dispatch&#39;, desc:&#39;The reactor calls &lt;code&gt;peek_batch_cqe()&lt;/code&gt; to grab all available completions. For each CQE, it unpacks &lt;code&gt;user_data&lt;/code&gt; into UdKind + fd and dispatches: &lt;b style=&#34;color:#3ee88a&#34;&gt;Recv&lt;/b&gt; = enqueue to connection, &lt;b style=&#34;color:#4a90ff&#34;&gt;Send&lt;/b&gt; = complete flush, &lt;b style=&#34;color:#ff4a5e&#34;&gt;Cancel&lt;/b&gt; = cleanup.&#39;, color:&#39;#3ee88a&#39; },
  { panel:&#39;ffP4&#39;, title:&#39;Phase 5 — ReadAsync Completes&#39;, desc:&#39;The recv data (raw pointer + length + buffer_id) is enqueued into the connection\&#39;s MPSC recv ring. This signals the &lt;code&gt;ManualResetValueTaskSourceCore&lt;/code&gt;, completing your &lt;code&gt;await ReadAsync()&lt;/code&gt; with zero allocation. You now have direct pointer access to the kernel-filled buffer.&#39;, color:&#39;#3ee8d0&#39; },
  { panel:&#39;ffP5&#39;, title:&#39;Phase 6 — Process + Write Response&#39;, desc:&#39;Your handler reads the buffers via &lt;code&gt;GetAllSnapshotRingsAsUnmanagedMemory()&lt;/code&gt; or &lt;code&gt;ToReadOnlySequence()&lt;/code&gt;. After processing, call &lt;code&gt;connection.Write(data)&lt;/code&gt; to copy into the unmanaged staging slab, then &lt;code&gt;FlushAsync()&lt;/code&gt; to signal the reactor to send.&#39;, color:&#39;#4a90ff&#39; },
  { panel:&#39;ffP6&#39;, title:&#39;Phase 7 — Reactor Sends Response&#39;, desc:&#39;On the next loop iteration, the reactor drains the flush queue, builds a send SQE, and fires &lt;code&gt;submit_and_wait_timeout&lt;/code&gt; — one syscall for all pending work. The kernel delivers the response to the client. The send CQE completes your &lt;code&gt;FlushAsync()&lt;/code&gt;.&#39;, color:&#39;#ff8a3e&#39; },
  { panel:&#39;ffP7&#39;, title:&#39;Phase 8 — Buffer Recycle + Loop&#39;, desc:&#39;Your handler calls &lt;code&gt;ReturnRing(bid)&lt;/code&gt; to recycle the buffer, then &lt;code&gt;ResetRead()&lt;/code&gt;. The reactor drains the return queue and calls &lt;code&gt;buf_ring_add + buf_ring_advance&lt;/code&gt; to give the buffer back to the kernel. Then &lt;code&gt;await ReadAsync()&lt;/code&gt; again. The loop repeats with zero allocations.&#39;, color:&#39;#a06aff&#39; },
];
let ffCur = -1;
function ffBuildDots() {
  const c = document.getElementById(&#39;ffDots&#39;);
  ffSteps.forEach((_, i) =&gt; { const d = document.createElement(&#39;div&#39;); d.className = &#39;step-dot&#39;; d.onclick = () =&gt; ffGoTo(i); c.appendChild(d); });
}
ffBuildDots();
function ffGoTo(idx) {
  ffCur = idx;
  ffSteps.forEach((s, i) =&gt; { const el = document.getElementById(s.panel); if (i === idx) { el.style.display=&#39;&#39;; el.style.animation=&#39;none&#39;; el.offsetHeight; el.style.animation=&#39;&#39;; } else el.style.display=&#39;none&#39;; });
  document.querySelectorAll(&#39;#ffDots .step-dot&#39;).forEach((d, i) =&gt; { d.classList.remove(&#39;active&#39;,&#39;done&#39;); if (i &lt; idx) d.classList.add(&#39;done&#39;); if (i === idx) d.classList.add(&#39;active&#39;); });
  ffSteps.forEach((s, i) =&gt; { const seg = document.getElementById(&#39;ffSeg&#39;+i); if (i &lt; idx) seg.style.background=&#39;#555c73&#39;; else if (i === idx) seg.style.background=s.color; else seg.style.background=&#39;&#39;; });
  document.getElementById(&#39;ffDesc&#39;).innerHTML = &#39;&lt;h4&gt;&lt;span style=&#34;color:&#39;+ffSteps[idx].color+&#39;;&#34;&gt;&#39;+ffSteps[idx].title+&#39;&lt;/span&gt;&lt;/h4&gt;&lt;p&gt;&#39;+ffSteps[idx].desc+&#39;&lt;/p&gt;&#39;;
  document.getElementById(&#39;ffPrev&#39;).disabled = idx &lt;= 0;
  document.getElementById(&#39;ffNext&#39;).disabled = idx &gt;= ffSteps.length - 1;
}
function ffStep(dir) { const n = ffCur + dir; if (n &gt;= 0 &amp;&amp; n &lt; ffSteps.length) ffGoTo(n); }
ffGoTo(0);
&lt;/script&gt;

      </description>
    </item>
    
    <item>
      <title>Buffer Rings</title>
      <link>http://localhost:1313/zerg/docs/architecture/buffer-rings/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>http://localhost:1313/zerg/docs/architecture/buffer-rings/</guid>
      <description>
        
        
        &lt;p&gt;Buffer rings (also called &amp;ldquo;provided buffers&amp;rdquo;) are a core &lt;code&gt;io_uring&lt;/code&gt; feature that zerg uses for zero-copy receive operations. Instead of userspace providing a buffer with each recv call, the kernel picks from a pre-registered pool.&lt;/p&gt;
&lt;h2&gt;How Buffer Rings Work&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;how-buffer-rings-work&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#how-buffer-rings-work&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;h3&gt;Setup&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;setup&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#setup&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;When a reactor starts, it creates a buffer ring and populates it with pre-allocated buffers:&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;1. Allocate a contiguous slab of unmanaged memory (64-byte aligned)
2. Register the buffer ring with io_uring:
     br = shim_setup_buf_ring(ring, entries, bgid, 0, &amp;amp;ret)
3. Divide the slab into fixed-size chunks and add each to the ring:
     for i in 0..entries:
         shim_buf_ring_add(br, slab &amp;#43; i * bufSize, bufSize, i, mask, i)
4. Publish all buffers to the kernel:
     shim_buf_ring_advance(br, entries)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Each buffer is identified by a 16-bit &lt;code&gt;bufferId&lt;/code&gt; (0 to &lt;code&gt;BufferRingEntries - 1&lt;/code&gt;). The slab is a single contiguous allocation so the address of any buffer is &lt;code&gt;slab + bufferId * RecvBufferSize&lt;/code&gt;.&lt;/p&gt;
&lt;h3&gt;Receive&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;receive&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#receive&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;When multishot recv completes for a connection:&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;CQE arrives:
    cqe-&amp;gt;res    = bytes received (or negative errno)
    cqe-&amp;gt;flags  = IORING_CQE_F_BUFFER | (bufferId &amp;lt;&amp;lt; 16)

Reactor extracts:
    bufferId = shim_cqe_buffer_id(cqe)
    ptr      = slab &amp;#43; bufferId * bufSize
    length   = cqe-&amp;gt;res&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;The kernel has already written the received data into the selected buffer. The reactor creates a &lt;code&gt;RingItem(ptr, length, bufferId)&lt;/code&gt; and enqueues it to the connection&amp;rsquo;s receive ring.&lt;/p&gt;
&lt;h3&gt;Consumption&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;consumption&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#consumption&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;The application handler drains &lt;code&gt;RingItem&lt;/code&gt;s from the connection:&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TryGetRing&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TailSnapshot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;out&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RingItem&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ring&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;ReadOnlySpan&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;data&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ring&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;AsSpan&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// zero-copy view&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// process data...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ReturnRing&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ring&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;BufferId&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;      &lt;span class=&#34;c1&#34;&gt;// return to kernel&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h3&gt;Return&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;return&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#return&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;When the handler calls &lt;code&gt;ReturnRing(bufferId)&lt;/code&gt;, the buffer ID is enqueued to the reactor&amp;rsquo;s return queue (an MPSC queue). On the next loop iteration, the reactor returns all queued buffers to the kernel:&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;while returnQ.TryDequeue(out bufferId):
    shim_buf_ring_add(br, slab &amp;#43; bufferId * bufSize, bufSize, bufferId, mask, idx&amp;#43;&amp;#43;)
shim_buf_ring_advance(br, count)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2&gt;Buffer Lifecycle&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;buffer-lifecycle&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#buffer-lifecycle&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;                ┌──────────────────────────────────────────┐
                │              Buffer Ring                   │
                │  ┌─────┬─────┬─────┬─────┬─────┐         │
                │  │ B0  │ B1  │ B2  │ ... │ Bn  │         │
                │  └──┬──┴──┬──┴──┬──┴─────┴──┬──┘         │
                └─────┼─────┼─────┼───────────┼────────────┘
                      │     │     │           │
      ┌───────────────┘     │     │           └──────────────┐
      ▼                     ▼     ▼                          ▼
  ┌────────┐          ┌────────┐ ┌────────┐           ┌────────┐
  │ Kernel │          │ Kernel │ │  User  │           │  User  │
  │ (free) │          │ (recv) │ │ (proc) │           │ (done) │
  └────────┘          └───┬────┘ └───┬────┘           └───┬────┘
                          │          │                    │
                          │ CQE      │ TryGetRing()       │ ReturnRing()
                          ▼          ▼                    ▼
                    ┌──────────┐ ┌──────────┐      ┌──────────┐
                    │ RingItem │ │ Handler  │      │ Return Q │
                    │ enqueued │ │ draining │      │ → kernel │
                    └──────────┘ └──────────┘      └──────────┘&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;A buffer transitions through these states:&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;State&lt;/th&gt;
          &lt;th&gt;Owner&lt;/th&gt;
          &lt;th&gt;Description&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;Free&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;Kernel&lt;/td&gt;
          &lt;td&gt;Available in the buffer ring for the next recv&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;In-flight&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;Kernel&lt;/td&gt;
          &lt;td&gt;Selected by kernel for an active recv operation&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;Enqueued&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;Reactor&lt;/td&gt;
          &lt;td&gt;Data received, &lt;code&gt;RingItem&lt;/code&gt; pushed to connection&amp;rsquo;s SPSC ring&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;Processing&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;Handler&lt;/td&gt;
          &lt;td&gt;Handler has dequeued the &lt;code&gt;RingItem&lt;/code&gt; and is reading the data&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;Returning&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;Return queue&lt;/td&gt;
          &lt;td&gt;Handler called &lt;code&gt;ReturnRing()&lt;/code&gt;, buffer ID queued for return&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;Returned&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;Kernel&lt;/td&gt;
          &lt;td&gt;Reactor added buffer back to the ring via &lt;code&gt;buf_ring_add&lt;/code&gt; + &lt;code&gt;advance&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h2&gt;Configuration&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;configuration&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#configuration&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;Config Property&lt;/th&gt;
          &lt;th&gt;Default&lt;/th&gt;
          &lt;th&gt;Impact&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;BufferRingEntries&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;16384&lt;/td&gt;
          &lt;td&gt;Total buffers per reactor. Must be power of two. More buffers = more concurrent in-flight receives.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;RecvBufferSize&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;32 KB&lt;/td&gt;
          &lt;td&gt;Size of each buffer. Larger = fewer buffers needed for big payloads, but more memory per buffer.&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;Memory formula:&lt;/strong&gt; &lt;code&gt;BufferRingEntries * RecvBufferSize&lt;/code&gt; per reactor.&lt;/p&gt;
&lt;p&gt;With defaults: 16384 * 32 KB = &lt;strong&gt;512 MB per reactor&lt;/strong&gt;.&lt;/p&gt;
&lt;h2&gt;Important Rules&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;important-rules&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#important-rules&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Always return buffers.&lt;/strong&gt; Every buffer obtained via &lt;code&gt;TryGetRing()&lt;/code&gt; or &lt;code&gt;GetAllSnapshotRings()&lt;/code&gt; must eventually be returned via &lt;code&gt;ReturnRing()&lt;/code&gt; or &lt;code&gt;ReturnRingBuffers()&lt;/code&gt;. Leaked buffers deplete the pool and eventually stall receives.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Don&amp;rsquo;t access buffer data after returning.&lt;/strong&gt; Once &lt;code&gt;ReturnRing(bufferId)&lt;/code&gt; is called, the kernel may reuse that buffer immediately. Any pointer or span referencing the buffer becomes invalid.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Return from the handler thread.&lt;/strong&gt; &lt;code&gt;ReturnRing()&lt;/code&gt; enqueues to an MPSC queue that the reactor drains. It&amp;rsquo;s safe to call from any thread, but typically called from the handler after processing.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Buffer ring exhaustion.&lt;/strong&gt; If all buffers are in-flight or held by handlers, new recv operations will fail. The reactor handles this gracefully &amp;ndash; multishot recv CQEs may stop arriving until buffers are returned. If the connection&amp;rsquo;s SPSC ring is full (1024 items), the connection is closed as a safety measure.&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;

      </description>
    </item>
    
    <item>
      <title>Connection Lifecycle</title>
      <link>http://localhost:1313/zerg/docs/architecture/connection-lifecycle/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>http://localhost:1313/zerg/docs/architecture/connection-lifecycle/</guid>
      <description>
        
        
        &lt;p&gt;A connection in zerg goes through a well-defined lifecycle: accept, register, use, close, and optionally return to pool.&lt;/p&gt;
&lt;h2&gt;Lifecycle Stages&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;lifecycle-stages&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#lifecycle-stages&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;                    Accept (Acceptor)
                         │
                         ▼
                  ┌──────────────┐
                  │  Distribute  │  round-robin to reactor
                  │  via queue   │
                  └──────┬───────┘
                         │
                         ▼
                  ┌──────────────┐
                  │   Register   │  arm multishot recv
                  │  in reactor  │  add to connections dict
                  └──────┬───────┘
                         │
                         ▼
                  ┌──────────────┐
                  │   Notify     │  push to Channel
                  │  application │  AcceptAsync() returns
                  └──────┬───────┘
                         │
                         ▼
                  ┌──────────────┐
              ┌──▶│  ReadAsync   │◀─┐
              │   │  &amp;#43; process   │  │  read/write loop
              │   │  &amp;#43; Write     │  │
              │   │  &amp;#43; FlushAsync│──┘
              │   └──────┬───────┘
              │          │
              │          ▼ (IsClosed or error)
              │   ┌──────────────┐
              │   │    Close     │  connection removed
              │   │   &amp;#43; cleanup  │  from reactor dict
              │   └──────┬───────┘
              │          │
              │          ▼
              │   ┌──────────────┐
              └───│  Pool/Reuse  │  Clear(), return to pool
                  │  (optional)  │  generation incremented
                  └──────────────┘&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2&gt;Accept Phase&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;accept-phase&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#accept-phase&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;The acceptor&amp;rsquo;s &lt;code&gt;io_uring&lt;/code&gt; delivers a CQE with the new client fd&lt;/li&gt;
&lt;li&gt;&lt;code&gt;TCP_NODELAY&lt;/code&gt; is set on the socket&lt;/li&gt;
&lt;li&gt;The fd is enqueued to the target reactor&amp;rsquo;s &lt;code&gt;ConcurrentQueue&amp;lt;int&amp;gt;&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;Registration Phase&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;registration-phase&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#registration-phase&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;On its next loop iteration, the reactor:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Dequeues the fd from its queue&lt;/li&gt;
&lt;li&gt;Creates or retrieves a &lt;code&gt;Connection&lt;/code&gt; from the pool&lt;/li&gt;
&lt;li&gt;Calls &lt;code&gt;connection.SetFd(clientFd).SetReactor(this)&lt;/code&gt; which:
&lt;ul&gt;
&lt;li&gt;Assigns the file descriptor&lt;/li&gt;
&lt;li&gt;Clears the &lt;code&gt;_closed&lt;/code&gt; flag&lt;/li&gt;
&lt;li&gt;Resets &lt;code&gt;_pending&lt;/code&gt; and &lt;code&gt;_armed&lt;/code&gt; flags&lt;/li&gt;
&lt;li&gt;Resets the &lt;code&gt;_readSignal&lt;/code&gt; completion source&lt;/li&gt;
&lt;li&gt;Clears the SPSC receive ring&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Stores the connection in &lt;code&gt;connections[clientFd]&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Arms multishot recv with buffer selection for the fd&lt;/li&gt;
&lt;li&gt;Pushes a &lt;code&gt;ConnectionItem&lt;/code&gt; to the &lt;code&gt;Channel&amp;lt;ConnectionItem&amp;gt;&lt;/code&gt; for &lt;code&gt;AcceptAsync()&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;Active Phase&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;active-phase&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#active-phase&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;The connection is now active. The handler can:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ReadAsync()&lt;/strong&gt; &amp;ndash; park until data arrives, then drain ring items&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Write()&lt;/strong&gt; &amp;ndash; stage bytes into the unmanaged write slab&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;FlushAsync()&lt;/strong&gt; &amp;ndash; tell the reactor to send staged bytes&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ResetRead()&lt;/strong&gt; &amp;ndash; prepare for the next read cycle&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;See &lt;a href=&#34;../../api-reference/connection-read/&#34;&gt;Connection Read&lt;/a&gt; and &lt;a href=&#34;../../api-reference/connection-write/&#34;&gt;Connection Write&lt;/a&gt; for API details.&lt;/p&gt;
&lt;h2&gt;Close Phase&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;close-phase&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#close-phase&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;A connection closes when:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Client disconnects&lt;/strong&gt;: recv CQE arrives with &lt;code&gt;res == 0&lt;/code&gt; (EOF) or &lt;code&gt;res &amp;lt; 0&lt;/code&gt; (error)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Ring overflow&lt;/strong&gt;: the SPSC recv ring is full (1024 items) &amp;ndash; the connection is force-closed as a safety measure&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Application closes&lt;/strong&gt;: the handler exits the read loop&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;When the reactor detects a close (recv CQE with &lt;code&gt;res &amp;lt;= 0&lt;/code&gt;):&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Returns any buffer used by the final CQE to the buffer ring&lt;/li&gt;
&lt;li&gt;Removes the connection from the reactor&amp;rsquo;s &lt;code&gt;connections&lt;/code&gt; dictionary&lt;/li&gt;
&lt;li&gt;Marks the connection as closed (&lt;code&gt;_closed = 1&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;Wakes any waiting &lt;code&gt;ReadAsync()&lt;/code&gt; so the handler sees &lt;code&gt;IsClosed == true&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;Pooling and Reuse&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;pooling-and-reuse&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#pooling-and-reuse&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;Connections can be pooled to avoid repeated allocation. The &lt;code&gt;Connection&lt;/code&gt; class supports two reset methods:&lt;/p&gt;
&lt;h3&gt;&lt;code&gt;Clear()&lt;/code&gt; &amp;ndash; Safe Reset&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;clear--safe-reset&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#clear--safe-reset&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;Increments &lt;code&gt;_generation&lt;/code&gt; to invalidate in-flight &lt;code&gt;ValueTask&lt;/code&gt; tokens&lt;/li&gt;
&lt;li&gt;Publishes &lt;code&gt;_closed = 1&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Cancels any waiting read or flush waiter with &lt;code&gt;OperationCanceledException&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Resets all write buffer state (WriteHead, WriteTail = 0)&lt;/li&gt;
&lt;li&gt;Resets both &lt;code&gt;_readSignal&lt;/code&gt; and &lt;code&gt;_flushSignal&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Clears the SPSC receive ring&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;&lt;code&gt;Clear2()&lt;/code&gt; &amp;ndash; Fast Reset&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;clear2--fast-reset&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#clear2--fast-reset&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;Increments &lt;code&gt;_generation&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Publishes &lt;code&gt;_closed = 1&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Clears the receive ring and resets completion state&lt;/li&gt;
&lt;li&gt;Does &lt;strong&gt;not&lt;/strong&gt; cancel waiters (assumes they&amp;rsquo;ve already exited)&lt;/li&gt;
&lt;li&gt;Faster than &lt;code&gt;Clear()&lt;/code&gt; for hot-path pooling&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Generation Counter&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;generation-counter&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#generation-counter&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;The &lt;code&gt;_generation&lt;/code&gt; counter (incremented on every reuse) serves as the &lt;code&gt;ValueTask&lt;/code&gt; token. If a stale &lt;code&gt;ReadAsync()&lt;/code&gt; completes after the connection has been reused, &lt;code&gt;GetResult()&lt;/code&gt; detects the mismatched token and returns &lt;code&gt;ReadResult.Closed()&lt;/code&gt; instead of delivering stale data. This prevents use-after-free bugs in the async machinery.&lt;/p&gt;
&lt;h2&gt;Connection Object Layout&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;connection-object-layout&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#connection-object-layout&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;partial&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;Connection&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;IBufferWriter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;IValueTaskSource&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ReadResult&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;IValueTaskSource&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;IDisposable&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// Identity&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ClientFd&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;Engine&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Reactor&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Reactor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_generation&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// Read state&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;SpscRecvRing&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_recv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;           &lt;span class=&#34;c1&#34;&gt;// capacity: 1024&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;ManualResetValueTaskSourceCore&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ReadResult&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_readSignal&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_armed&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_pending&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_closed&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// Write state&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;WriteBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;            &lt;span class=&#34;c1&#34;&gt;// 64-byte aligned unmanaged slab&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;WriteHead&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;WriteTail&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;WriteInFlight&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;SendInflight&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;             &lt;span class=&#34;c1&#34;&gt;// reactor-owned flag&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;ManualResetValueTaskSourceCore&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_flushSignal&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_flushArmed&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_flushInProgress&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;

      </description>
    </item>
    
    <item>
      <title>Threading Model</title>
      <link>http://localhost:1313/zerg/docs/architecture/threading-model/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>http://localhost:1313/zerg/docs/architecture/threading-model/</guid>
      <description>
        
        
        &lt;p&gt;zerg uses a fixed set of dedicated threads with strict ownership rules. Every piece of mutable state is owned by exactly one thread, and all cross-thread communication happens through lock-free queues with well-defined memory ordering.&lt;/p&gt;
&lt;h2&gt;Thread Layout&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;thread-layout&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#thread-layout&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;┌─────────────────┐
│  Acceptor Thread │  1 thread
│  (io_uring)      │  Accepts connections, distributes fds
└────────┬────────┘
         │ ConcurrentQueue&amp;lt;int&amp;gt; per reactor
         ▼
┌───────────────┐  ┌───────────────┐  ┌───────────────┐
│  Reactor 0    │  │  Reactor 1    │  │  Reactor N    │  N threads
│  (io_uring)   │  │  (io_uring)   │  │  (io_uring)   │  Event loops
│  (buf_ring)   │  │  (buf_ring)   │  │  (buf_ring)   │
│  (conn dict)  │  │  (conn dict)  │  │  (conn dict)  │
└───────┬───────┘  └───────┬───────┘  └───────┬───────┘
        │                  │                  │
        ▼                  ▼                  ▼
┌───────────────┐  ┌───────────────┐  ┌───────────────┐
│  Handler Tasks│  │  Handler Tasks│  │  Handler Tasks│  Task pool
│  (async/await)│  │  (async/await)│  │  (async/await)│  User code
└───────────────┘  └───────────────┘  └───────────────┘&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h3&gt;Thread Count&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;thread-count&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#thread-count&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;Total threads = 1 (acceptor) + N (reactors), where N = &lt;code&gt;EngineOptions.ReactorCount&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Handler tasks run on the .NET thread pool and are not dedicated threads. Multiple handler tasks may be active per reactor, but each connection&amp;rsquo;s &lt;code&gt;ReadAsync&lt;/code&gt;/&lt;code&gt;FlushAsync&lt;/code&gt; enforces single-waiter semantics.&lt;/p&gt;
&lt;h2&gt;Ownership Rules&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;ownership-rules&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#ownership-rules&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;State&lt;/th&gt;
          &lt;th&gt;Owner&lt;/th&gt;
          &lt;th&gt;Accessed By&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;Acceptor &lt;code&gt;io_uring&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Acceptor thread&lt;/td&gt;
          &lt;td&gt;Acceptor only&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Reactor &lt;code&gt;io_uring&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Reactor thread&lt;/td&gt;
          &lt;td&gt;Reactor only&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Buffer ring&lt;/td&gt;
          &lt;td&gt;Reactor thread&lt;/td&gt;
          &lt;td&gt;Reactor (add/advance), handler (ReturnRing via MPSC queue)&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;connections&lt;/code&gt; dict&lt;/td&gt;
          &lt;td&gt;Reactor thread&lt;/td&gt;
          &lt;td&gt;Reactor only&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Connection read state (&lt;code&gt;_recv&lt;/code&gt;, &lt;code&gt;_armed&lt;/code&gt;, etc.)&lt;/td&gt;
          &lt;td&gt;Split&lt;/td&gt;
          &lt;td&gt;Reactor produces, handler consumes&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Connection write slab&lt;/td&gt;
          &lt;td&gt;Handler&lt;/td&gt;
          &lt;td&gt;Handler writes, reactor reads during flush&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;SendInflight&lt;/code&gt; flag&lt;/td&gt;
          &lt;td&gt;Reactor thread&lt;/td&gt;
          &lt;td&gt;Reactor writes (Volatile), handler reads&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h2&gt;Cross-Thread Communication&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;cross-thread-communication&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#cross-thread-communication&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;All cross-thread data flow uses lock-free queues:&lt;/p&gt;
&lt;h3&gt;Acceptor → Reactor: New Connections&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;acceptor--reactor-new-connections&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#acceptor--reactor-new-connections&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;ConcurrentQueue&amp;lt;int&amp;gt; ReactorQueues[reactorId]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;The acceptor enqueues integer file descriptors. Each reactor drains its queue at the start of every loop iteration. &lt;code&gt;.NET ConcurrentQueue&lt;/code&gt; provides full thread-safety.&lt;/p&gt;
&lt;h3&gt;Handler → Reactor: Buffer Returns&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;handler--reactor-buffer-returns&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#handler--reactor-buffer-returns&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;MpscUshortQueue returnQ&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;When a handler calls &lt;code&gt;connection.ReturnRing(bufferId)&lt;/code&gt;, the &lt;code&gt;ushort&lt;/code&gt; buffer ID is enqueued to the reactor&amp;rsquo;s MPSC return queue. The reactor drains this queue and returns buffers to the kernel buffer ring.&lt;/p&gt;
&lt;h3&gt;Handler → Reactor: Flush Requests&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;handler--reactor-flush-requests&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#handler--reactor-flush-requests&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;MpscIntQueue flushQ&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;When a handler calls &lt;code&gt;FlushAsync()&lt;/code&gt;, the connection&amp;rsquo;s client fd is enqueued to the reactor&amp;rsquo;s flush queue. The reactor drains this and issues &lt;code&gt;send&lt;/code&gt; SQEs.&lt;/p&gt;
&lt;h3&gt;Reactor → Handler: Read Completion&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;reactor--handler-read-completion&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#reactor--handler-read-completion&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;SpscRecvRing _recv (per connection)
int _armed, _pending (atomics)
ManualResetValueTaskSourceCore&amp;lt;ReadResult&amp;gt; _readSignal&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;The reactor enqueues &lt;code&gt;RingItem&lt;/code&gt;s to the connection&amp;rsquo;s SPSC ring and wakes the handler via the ValueTask completion source.&lt;/p&gt;
&lt;h3&gt;Reactor → Handler: Flush Completion&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;reactor--handler-flush-completion&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#reactor--handler-flush-completion&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;ManualResetValueTaskSourceCore&amp;lt;bool&amp;gt; _flushSignal
int _flushArmed, _flushInProgress&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;When all staged bytes are sent, the reactor completes the flush signal, resuming the handler&amp;rsquo;s &lt;code&gt;await FlushAsync()&lt;/code&gt;.&lt;/p&gt;
&lt;h2&gt;Memory Ordering&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;memory-ordering&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#memory-ordering&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;zerg uses three levels of memory ordering:&lt;/p&gt;
&lt;h3&gt;Volatile Read/Write&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;volatile-readwrite&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#volatile-readwrite&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;Used for single-word flags where only visibility is needed:&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Volatile&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Write&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ref&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_closed&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;       &lt;span class=&#34;c1&#34;&gt;// publish close&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Volatile&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Read&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ref&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_pending&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;           &lt;span class=&#34;c1&#34;&gt;// check pending flag&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Volatile&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Write&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ref&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;SendInflight&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;   &lt;span class=&#34;c1&#34;&gt;// clear in-flight flag&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h3&gt;Interlocked (Full Fence)&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;interlocked-full-fence&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#interlocked-full-fence&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;Used in MPSC queues where multiple producers contend:&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Interlocked&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;CompareExchange&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ref&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_armed&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// atomically disarm&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Interlocked&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Increment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ref&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_tail&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;                &lt;span class=&#34;c1&#34;&gt;// reserve MPSC slot&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h3&gt;Plain Reads (Single-Consumer)&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;plain-reads-single-consumer&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#plain-reads-single-consumer&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;The consumer side of SPSC/MPSC queues uses plain reads for &lt;code&gt;_head&lt;/code&gt; since only one thread reads and writes it:&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;head&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_head&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;                      &lt;span class=&#34;c1&#34;&gt;// only consumer writes _head&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;_head&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;head&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;                      &lt;span class=&#34;c1&#34;&gt;// safe: single writer&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2&gt;CPU Affinity&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;cpu-affinity&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#cpu-affinity&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;zerg provides optional CPU pinning for reactor threads via the &lt;code&gt;Affinity&lt;/code&gt; class:&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Affinity&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PinCurrentThreadToCpu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cpuId&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;This uses the Linux &lt;code&gt;sched_setaffinity&lt;/code&gt; syscall to bind a thread to a specific core. Pinning prevents the OS scheduler from migrating threads, which improves cache locality and reduces jitter.&lt;/p&gt;
&lt;p&gt;CPU pinning is optional and best-effort &amp;ndash; if it fails (e.g., in containers with CPU limits), the thread continues on whatever core the scheduler assigns.&lt;/p&gt;
&lt;h2&gt;Handler Task Execution&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;handler-task-execution&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#handler-task-execution&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;Handler tasks (&lt;code&gt;_ = HandleConnectionAsync(connection)&lt;/code&gt;) run on the .NET thread pool. When a handler awaits &lt;code&gt;ReadAsync()&lt;/code&gt; or &lt;code&gt;FlushAsync()&lt;/code&gt;:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;The handler task yields back to the thread pool&lt;/li&gt;
&lt;li&gt;The reactor thread completes the ValueTask source when data/flush is ready&lt;/li&gt;
&lt;li&gt;The handler resumes on a thread pool thread (not the reactor thread)&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;This means:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Reactor threads never execute user handler code&lt;/li&gt;
&lt;li&gt;Handlers never block reactor threads&lt;/li&gt;
&lt;li&gt;Multiple handlers can be active simultaneously per reactor&lt;/li&gt;
&lt;li&gt;&lt;code&gt;DEFER_TASKRUN&lt;/code&gt; ensures completions arrive at predictable points in the reactor loop&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
  </channel>
</rss>
