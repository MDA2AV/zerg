<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>zerg â€“ Documentation</title>
    <link>http://localhost:1313/zerg/docs/</link>
    <description>Recent content in Documentation on zerg</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    
	  <atom:link href="http://localhost:1313/zerg/docs/index.xml" rel="self" type="application/rss+xml" />
    
    
      
        
      
    
    
    <item>
      <title>Engine</title>
      <link>http://localhost:1313/zerg/docs/api-reference/engine/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>http://localhost:1313/zerg/docs/api-reference/engine/</guid>
      <description>
        
        
        &lt;p&gt;The &lt;code&gt;Engine&lt;/code&gt; class is the entry point for zerg. It creates the acceptor and reactor threads, manages the listening socket, and provides the &lt;code&gt;AcceptAsync&lt;/code&gt; API for receiving new connections.&lt;/p&gt;
&lt;h2&gt;Class Definition&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;class-definition&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#class-definition&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;namespace&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;zerg.Engine&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;partial&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;Engine&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2&gt;Constructors&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;constructors&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#constructors&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;h3&gt;&lt;code&gt;Engine()&lt;/code&gt;&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;engine&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#engine&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;Creates an engine with default &lt;code&gt;EngineOptions&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;engine&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Engine&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Defaults: Port=8080, ReactorCount=1, Ip=&amp;#34;0.0.0.0&amp;#34;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h3&gt;&lt;code&gt;Engine(EngineOptions options)&lt;/code&gt;&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;engineengineoptions-options&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#engineengineoptions-options&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;Creates an engine with custom configuration.&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;engine&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Engine&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EngineOptions&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;Port&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;8080&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;ReactorCount&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Environment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ProcessorCount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;Backlog&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;65535&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;});&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;If &lt;code&gt;options.ReactorConfigs&lt;/code&gt; is null, it is auto-initialized with default &lt;code&gt;ReactorConfig&lt;/code&gt; for each reactor.&lt;/p&gt;
&lt;h2&gt;Properties&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;properties&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#properties&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;h3&gt;&lt;code&gt;ServerRunning&lt;/code&gt;&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;serverrunning&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#serverrunning&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ServerRunning&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;set&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Global flag checked by the acceptor and all reactor threads. When &lt;code&gt;Stop()&lt;/code&gt; is called, this becomes &lt;code&gt;false&lt;/code&gt; and all event loops exit gracefully.&lt;/p&gt;
&lt;h3&gt;&lt;code&gt;SingleAcceptor&lt;/code&gt;&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;singleacceptor&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#singleacceptor&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Acceptor&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;SingleAcceptor&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;set&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;The acceptor instance responsible for listening and distributing connections.&lt;/p&gt;
&lt;h3&gt;&lt;code&gt;Reactors&lt;/code&gt;&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;reactors&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#reactors&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Reactor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Reactors&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;set&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Array of reactor instances. Each reactor owns its own &lt;code&gt;io_uring&lt;/code&gt;, buffer ring, and connection map. Index corresponds to reactor ID.&lt;/p&gt;
&lt;h3&gt;&lt;code&gt;Connections&lt;/code&gt;&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;connections&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#connections&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Dictionary&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Connections&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;set&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Per-reactor connection dictionaries mapping file descriptors to &lt;code&gt;Connection&lt;/code&gt; objects.&lt;/p&gt;
&lt;h3&gt;&lt;code&gt;Options&lt;/code&gt;&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;options&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#options&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EngineOptions&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Options&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;The engine configuration. Read-only after construction.&lt;/p&gt;
&lt;h2&gt;Methods&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;methods&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#methods&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;h3&gt;&lt;code&gt;Listen()&lt;/code&gt;&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;listen&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#listen&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Listen&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Starts the engine:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Creates the acceptor with the configured &lt;code&gt;AcceptorConfig&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Creates N reactor instances (one per &lt;code&gt;ReactorCount&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;Initializes per-reactor &lt;code&gt;ConcurrentQueue&amp;lt;int&amp;gt;&lt;/code&gt; for fd distribution&lt;/li&gt;
&lt;li&gt;Initializes per-reactor connection dictionaries&lt;/li&gt;
&lt;li&gt;Starts reactor threads (each enters its event loop)&lt;/li&gt;
&lt;li&gt;Starts the acceptor thread (arms multishot accept)&lt;/li&gt;
&lt;li&gt;Prints diagnostics to console&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;After &lt;code&gt;Listen()&lt;/code&gt; returns, the server is accepting connections. Call &lt;code&gt;AcceptAsync()&lt;/code&gt; to receive them.&lt;/p&gt;
&lt;h3&gt;&lt;code&gt;AcceptAsync(CancellationToken)&lt;/code&gt;&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;acceptasynccancellationtoken&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#acceptasynccancellationtoken&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;async&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ValueTask&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;?&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AcceptAsync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;CancellationToken&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cancellationToken&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Waits for the next accepted connection and returns the fully registered &lt;code&gt;Connection&lt;/code&gt; object. The connection is already assigned to a reactor and has multishot recv armed by the time this method returns.&lt;/p&gt;
&lt;p&gt;Returns &lt;code&gt;null&lt;/code&gt; if the server is shutting down or the cancellation token is triggered.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Usage:&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;engine&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ServerRunning&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;await&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;engine&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;AcceptAsync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Token&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;is&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;_&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;HandleConnectionAsync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Important:&lt;/strong&gt; &lt;code&gt;AcceptAsync&lt;/code&gt; blocks until a connection is available. The returned connection is ready for immediate &lt;code&gt;ReadAsync()&lt;/code&gt;.&lt;/p&gt;
&lt;h3&gt;&lt;code&gt;Stop()&lt;/code&gt;&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;stop&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#stop&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Stop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Signals all event loops (acceptor + reactors) to exit. Sets &lt;code&gt;ServerRunning = false&lt;/code&gt;. This is a non-blocking signal &amp;ndash; threads will stop once they observe the flag change on their next loop iteration.&lt;/p&gt;
&lt;p&gt;After calling &lt;code&gt;Stop()&lt;/code&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The acceptor closes the listening socket and destroys its ring&lt;/li&gt;
&lt;li&gt;Each reactor closes all active connections, frees buffer rings, and destroys its ring&lt;/li&gt;
&lt;li&gt;Any pending &lt;code&gt;AcceptAsync()&lt;/code&gt; returns null&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Nested Types&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;nested-types&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#nested-types&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;h3&gt;&lt;code&gt;Acceptor&lt;/code&gt;&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;acceptor&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#acceptor&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;The acceptor manages the listening socket and multishot accept. Created internally by &lt;code&gt;Listen()&lt;/code&gt;.&lt;/p&gt;
&lt;h3&gt;&lt;code&gt;Reactor&lt;/code&gt;&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;reactor&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#reactor&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;Each reactor manages an &lt;code&gt;io_uring&lt;/code&gt; instance, buffer ring, and a set of connections. See &lt;a href=&#34;../../architecture/threading-model/&#34;&gt;Threading Model&lt;/a&gt; for how reactors interact with handlers.&lt;/p&gt;
&lt;p&gt;Key reactor methods (internal, called by Connection):&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;Method&lt;/th&gt;
          &lt;th&gt;Description&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;EnqueueReturnQ(ushort bufferId)&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Queue a buffer ID for return to the kernel buffer ring&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;EnqueueFlush(int clientFd)&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Queue a connection for send by the reactor&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h2&gt;Static Fields&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;static-fields&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#static-fields&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;h3&gt;&lt;code&gt;ReactorConnectionCounts&lt;/code&gt;&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;reactorconnectioncounts&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#reactorconnectioncounts&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;long&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ReactorConnectionCounts&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Per-reactor connection counters for metrics and diagnostics. Index corresponds to reactor ID.&lt;/p&gt;
&lt;h2&gt;Example: Full Server Lifecycle&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;example-full-server-lifecycle&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#example-full-server-lifecycle&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;engine&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Engine&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EngineOptions&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;Port&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;8080&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;ReactorCount&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;4&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;});&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;engine&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Listen&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Console&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;WriteLine&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Server started on :8080 with 4 reactors&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cts&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;CancellationTokenSource&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Shutdown hook&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Console&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;CancelKeyPress&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;+=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Cancel&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;engine&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Stop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;cts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Cancel&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;};&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;try&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;engine&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ServerRunning&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;kt&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;conn&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;await&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;engine&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;AcceptAsync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Token&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;conn&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;is&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;_&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;HandleConnectionAsync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;conn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;catch&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;OperationCanceledException&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Console&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;WriteLine&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Server stopped.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;

      </description>
    </item>
    
    <item>
      <title>Installation</title>
      <link>http://localhost:1313/zerg/docs/getting-started/installation/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>http://localhost:1313/zerg/docs/getting-started/installation/</guid>
      <description>
        
        
        &lt;h2&gt;NuGet Package&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;nuget-package&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#nuget-package&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;The recommended way to install zerg is via NuGet:&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;dotnet add package zerg&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Or add the package reference directly to your &lt;code&gt;.csproj&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-xml&#34; data-lang=&#34;xml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;&amp;lt;PackageReference&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;Include=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;zerg&amp;#34;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;Version=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;0.3.12&amp;#34;&lt;/span&gt; &lt;span class=&#34;nt&#34;&gt;/&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;zerg targets both &lt;strong&gt;.NET 9.0&lt;/strong&gt; and &lt;strong&gt;.NET 10.0&lt;/strong&gt;.&lt;/p&gt;
&lt;h2&gt;Native Dependencies&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;native-dependencies&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#native-dependencies&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;zerg ships with bundled native libraries for the &lt;code&gt;io_uring&lt;/code&gt; shim:&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;Runtime&lt;/th&gt;
          &lt;th&gt;Library&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;linux-x64&lt;/code&gt; (glibc)&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;liburingshim.so&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;linux-musl-x64&lt;/code&gt; (Alpine)&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;liburingshim.so&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;These are included in the NuGet package and copied to your output directory automatically. No manual installation of &lt;code&gt;liburing&lt;/code&gt; is required.&lt;/p&gt;
&lt;h3&gt;Kernel Requirements&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;kernel-requirements&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#kernel-requirements&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;zerg requires a Linux kernel with &lt;code&gt;io_uring&lt;/code&gt; support:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Minimum:&lt;/strong&gt; Linux 5.10+ (basic &lt;code&gt;io_uring&lt;/code&gt; operations)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Recommended:&lt;/strong&gt; Linux 6.0+ (multishot accept, buffer rings, &lt;code&gt;IORING_SETUP_SINGLE_ISSUER&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Optimal:&lt;/strong&gt; Linux 6.1+ (&lt;code&gt;IORING_SETUP_DEFER_TASKRUN&lt;/code&gt;)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;You can check your kernel version with:&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;uname -r&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2&gt;Build from Source&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;build-from-source&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#build-from-source&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;Clone the repository and build with the .NET SDK:&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;git clone https://github.com/MDA2AV/uRocket.git
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; uRocket
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;dotnet build&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;The solution file &lt;code&gt;zerg.sln&lt;/code&gt; includes the core library, examples, playground, and TechEmpower benchmark projects.&lt;/p&gt;
&lt;h2&gt;AOT Compilation&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;aot-compilation&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#aot-compilation&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;zerg is compatible with Native AOT compilation. The native &lt;code&gt;liburingshim.so&lt;/code&gt; P/Invoke bindings use static linking-friendly signatures. To publish with AOT:&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;dotnet publish -c Release -r linux-x64 /p:PublishAot&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;true&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2&gt;Managed Dependency&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;managed-dependency&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#managed-dependency&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;zerg has a single managed dependency:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Microsoft.Extensions.ObjectPool&lt;/code&gt; (v10.0.2) &amp;ndash; used for connection pooling&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Project Structure&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;project-structure&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#project-structure&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;When you reference zerg, the following projects are available in the solution:&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;Project&lt;/th&gt;
          &lt;th&gt;Description&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;zerg&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Core library (the NuGet package)&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;Examples&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Basic usage examples (ReadOnlySpan, ReadOnlySequence)&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;Playground&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Development sandbox&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;TechEmpower/BenchmarkApp&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;HTTP/1.1 benchmark server&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

      </description>
    </item>
    
    <item>
      <title>Reactor Pattern</title>
      <link>http://localhost:1313/zerg/docs/architecture/reactor-pattern/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>http://localhost:1313/zerg/docs/architecture/reactor-pattern/</guid>
      <description>
        
        
        &lt;p&gt;zerg implements a classic &lt;strong&gt;reactor pattern&lt;/strong&gt; with a split-architecture design: one dedicated acceptor thread and N independent reactor threads.&lt;/p&gt;
&lt;h2&gt;Overview&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;overview&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#overview&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;div id=&#34;reactor-diagram&#34; style=&#34;position:relative;width:100%;max-width:800px;margin:2rem auto;font-family:system-ui,sans-serif;user-select:none&#34;&gt;
&lt;style&gt;
  #reactor-diagram *{box-sizing:border-box}
  #reactor-diagram .zone{border-radius:12px;padding:20px;margin-bottom:16px;position:relative}
  #reactor-diagram .zone-kernel{background:linear-gradient(135deg,#1a1a2e,#16213e);border:1px solid #2a3a5c}
  #reactor-diagram .zone-user{background:linear-gradient(135deg,#0f1729,#131b2e);border:1px solid #1e2d4a}
  #reactor-diagram .zone-label{position:absolute;top:10px;right:14px;font-size:10px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:#4a5e7a}
  #reactor-diagram .node{border-radius:10px;padding:14px 18px;text-align:center;position:relative;transition:transform .2s,box-shadow .2s}
  #reactor-diagram .node:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(59,130,246,.2)}
  #reactor-diagram .node-client{background:linear-gradient(135deg,#1e3a5f,#1a2d4a);border:1px solid #2e5a8a;color:#7eb8f0}
  #reactor-diagram .node-acceptor{background:linear-gradient(135deg,#2d1b4e,#1f1338);border:1px solid #5b3a8a;color:#c4a5f0}
  #reactor-diagram .node-reactor{background:linear-gradient(135deg,#1b3a2e,#132a1f);border:1px solid #2e7a5a;color:#7ef0b8;flex:1;min-width:0}
  #reactor-diagram .node-app{background:linear-gradient(135deg,#3a2a1b,#2a1f13);border:1px solid #8a6a2e;color:#f0d07e}
  #reactor-diagram .node-title{font-weight:700;font-size:14px;margin-bottom:6px}
  #reactor-diagram .node-sub{font-size:11px;opacity:.7;line-height:1.5}
  #reactor-diagram .connector{display:flex;align-items:center;justify-content:center;padding:8px 0;position:relative}
  #reactor-diagram .connector-line{width:2px;height:32px;background:linear-gradient(to bottom,transparent,#3b82f6,transparent)}
  #reactor-diagram .connector-fan{display:flex;gap:12px;justify-content:center;align-items:flex-start;position:relative;padding-top:8px}
  #reactor-diagram .connector-arrow{color:#3b82f6;font-size:13px;font-weight:700;animation:pulse-arrow 2s infinite}
  #reactor-diagram .connector-arrow-rr{color:#8b5cf6;font-size:11px;font-weight:600}
  #reactor-diagram .badge{display:inline-block;font-size:10px;font-weight:600;padding:2px 8px;border-radius:20px;margin:2px}
  #reactor-diagram .badge-uring{background:rgba(139,92,246,.2);color:#a78bfa;border:1px solid rgba(139,92,246,.3)}
  #reactor-diagram .badge-buf{background:rgba(59,130,246,.15);color:#60a5fa;border:1px solid rgba(59,130,246,.3)}
  #reactor-diagram .badge-queue{background:rgba(16,185,129,.15);color:#34d399;border:1px solid rgba(16,185,129,.3)}
  #reactor-diagram .badge-lock{background:rgba(245,158,11,.15);color:#fbbf24;border:1px solid rgba(245,158,11,.3)}
  #reactor-diagram .flow-dot{width:6px;height:6px;border-radius:50%;background:#3b82f6;position:absolute;animation:flow-down 2s infinite}
  #reactor-diagram .reactor-internals{display:flex;flex-wrap:wrap;gap:4px;margin-top:8px;justify-content:center}
  #reactor-diagram .clients-grid{display:flex;gap:6px;justify-content:center;flex-wrap:wrap;margin-bottom:8px}
  #reactor-diagram .client-dot{width:36px;height:36px;border-radius:50%;background:linear-gradient(135deg,#2563eb,#1d4ed8);border:2px solid #3b82f6;display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:700;color:#bfdbfe;transition:transform .2s}
  #reactor-diagram .client-dot:hover{transform:scale(1.15)}
  @keyframes pulse-arrow{0%,100%{opacity:.4}50%{opacity:1}}
  @keyframes flow-down{0%{top:0;opacity:0}50%{opacity:1}100%{top:100%;opacity:0}}
  @media(max-width:640px){
    #reactor-diagram .connector-fan{flex-direction:column;align-items:center}
    #reactor-diagram .node-reactor{width:100%}
  }
&lt;/style&gt;
&lt;!-- Kernel Space --&gt;
&lt;div class=&#34;zone zone-kernel&#34;&gt;
  &lt;div class=&#34;zone-label&#34;&gt;Kernel Space&lt;/div&gt;
  &lt;div class=&#34;clients-grid&#34;&gt;
    &lt;div class=&#34;client-dot&#34;&gt;C1&lt;/div&gt;
    &lt;div class=&#34;client-dot&#34;&gt;C2&lt;/div&gt;
    &lt;div class=&#34;client-dot&#34;&gt;C3&lt;/div&gt;
    &lt;div class=&#34;client-dot&#34;&gt;C4&lt;/div&gt;
    &lt;div class=&#34;client-dot&#34;&gt;C5&lt;/div&gt;
    &lt;div class=&#34;client-dot&#34; style=&#34;opacity:.5&#34;&gt;...&lt;/div&gt;
  &lt;/div&gt;
  &lt;div style=&#34;text-align:center;margin-top:4px&#34;&gt;
    &lt;span class=&#34;connector-arrow&#34;&gt;TCP&lt;/span&gt;
    &lt;span style=&#34;color:#4a5e7a;font-size:12px&#34;&gt; &amp;darr; &lt;/span&gt;
  &lt;/div&gt;
  &lt;div class=&#34;node node-client&#34; style=&#34;max-width:320px;margin:8px auto 0&#34;&gt;
    &lt;div class=&#34;node-title&#34;&gt;Listening Socket&lt;/div&gt;
    &lt;div class=&#34;node-sub&#34;&gt;bind + listen &amp;bull; backlog queue&lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;
&lt;!-- Connector --&gt;
&lt;div class=&#34;connector&#34;&gt;&lt;div class=&#34;connector-line&#34; style=&#34;position:relative&#34;&gt;&lt;div class=&#34;flow-dot&#34;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;
&lt;!-- User Space --&gt;
&lt;div class=&#34;zone zone-user&#34;&gt;
  &lt;div class=&#34;zone-label&#34;&gt;User Space&lt;/div&gt;
  &lt;!-- Acceptor --&gt;
  &lt;div class=&#34;node node-acceptor&#34; style=&#34;max-width:480px;margin:0 auto 16px&#34;&gt;
    &lt;div class=&#34;node-title&#34;&gt;Acceptor Thread&lt;/div&gt;
    &lt;div class=&#34;node-sub&#34;&gt;Single SQE &amp;rarr; multishot accept &amp;rarr; one CQE per connection&lt;/div&gt;
    &lt;div style=&#34;margin-top:8px&#34;&gt;
      &lt;span class=&#34;badge badge-uring&#34;&gt;io_uring&lt;/span&gt;
      &lt;span class=&#34;badge badge-lock&#34;&gt;TCP_NODELAY&lt;/span&gt;
    &lt;/div&gt;
  &lt;/div&gt;
  &lt;!-- Round Robin label --&gt;
  &lt;div style=&#34;text-align:center;padding:4px 0&#34;&gt;
    &lt;span class=&#34;connector-arrow-rr&#34;&gt;round-robin fd distribution&lt;/span&gt;
    &lt;div style=&#34;display:flex;justify-content:center;gap:60px;margin-top:6px&#34;&gt;
      &lt;span class=&#34;connector-arrow&#34;&gt;&amp;darr;&lt;/span&gt;
      &lt;span class=&#34;connector-arrow&#34; style=&#34;animation-delay:.3s&#34;&gt;&amp;darr;&lt;/span&gt;
      &lt;span class=&#34;connector-arrow&#34; style=&#34;animation-delay:.6s&#34;&gt;&amp;darr;&lt;/span&gt;
    &lt;/div&gt;
    &lt;div style=&#34;display:flex;justify-content:center;gap:30px;margin-top:2px&#34;&gt;
      &lt;span class=&#34;badge badge-queue&#34;&gt;ConcurrentQueue&lt;/span&gt;
      &lt;span class=&#34;badge badge-queue&#34;&gt;ConcurrentQueue&lt;/span&gt;
      &lt;span class=&#34;badge badge-queue&#34;&gt;ConcurrentQueue&lt;/span&gt;
    &lt;/div&gt;
  &lt;/div&gt;
  &lt;!-- Reactors --&gt;
  &lt;div class=&#34;connector-fan&#34; style=&#34;margin-top:12px&#34;&gt;
    &lt;div class=&#34;node node-reactor&#34;&gt;
      &lt;div class=&#34;node-title&#34;&gt;Reactor 0&lt;/div&gt;
      &lt;div class=&#34;reactor-internals&#34;&gt;
        &lt;span class=&#34;badge badge-uring&#34;&gt;io_uring&lt;/span&gt;
        &lt;span class=&#34;badge badge-buf&#34;&gt;buf_ring&lt;/span&gt;
        &lt;span class=&#34;badge badge-queue&#34;&gt;SPSC ring&lt;/span&gt;
      &lt;/div&gt;
      &lt;div class=&#34;reactor-internals&#34;&gt;
        &lt;span class=&#34;badge badge-lock&#34;&gt;conn_map&lt;/span&gt;
        &lt;span class=&#34;badge badge-queue&#34;&gt;flush_Q&lt;/span&gt;
      &lt;/div&gt;
      &lt;div class=&#34;node-sub&#34; style=&#34;margin-top:6px&#34;&gt;multishot recv + send&lt;/div&gt;
    &lt;/div&gt;
    &lt;div class=&#34;node node-reactor&#34;&gt;
      &lt;div class=&#34;node-title&#34;&gt;Reactor 1&lt;/div&gt;
      &lt;div class=&#34;reactor-internals&#34;&gt;
        &lt;span class=&#34;badge badge-uring&#34;&gt;io_uring&lt;/span&gt;
        &lt;span class=&#34;badge badge-buf&#34;&gt;buf_ring&lt;/span&gt;
        &lt;span class=&#34;badge badge-queue&#34;&gt;SPSC ring&lt;/span&gt;
      &lt;/div&gt;
      &lt;div class=&#34;reactor-internals&#34;&gt;
        &lt;span class=&#34;badge badge-lock&#34;&gt;conn_map&lt;/span&gt;
        &lt;span class=&#34;badge badge-queue&#34;&gt;flush_Q&lt;/span&gt;
      &lt;/div&gt;
      &lt;div class=&#34;node-sub&#34; style=&#34;margin-top:6px&#34;&gt;multishot recv + send&lt;/div&gt;
    &lt;/div&gt;
    &lt;div class=&#34;node node-reactor&#34;&gt;
      &lt;div class=&#34;node-title&#34;&gt;Reactor N&lt;/div&gt;
      &lt;div class=&#34;reactor-internals&#34;&gt;
        &lt;span class=&#34;badge badge-uring&#34;&gt;io_uring&lt;/span&gt;
        &lt;span class=&#34;badge badge-buf&#34;&gt;buf_ring&lt;/span&gt;
        &lt;span class=&#34;badge badge-queue&#34;&gt;SPSC ring&lt;/span&gt;
      &lt;/div&gt;
      &lt;div class=&#34;reactor-internals&#34;&gt;
        &lt;span class=&#34;badge badge-lock&#34;&gt;conn_map&lt;/span&gt;
        &lt;span class=&#34;badge badge-queue&#34;&gt;flush_Q&lt;/span&gt;
      &lt;/div&gt;
      &lt;div class=&#34;node-sub&#34; style=&#34;margin-top:6px&#34;&gt;multishot recv + send&lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
  &lt;!-- Channel --&gt;
  &lt;div class=&#34;connector&#34;&gt;&lt;div class=&#34;connector-line&#34; style=&#34;position:relative&#34;&gt;&lt;div class=&#34;flow-dot&#34; style=&#34;animation-delay:.5s&#34;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;
  &lt;div style=&#34;text-align:center&#34;&gt;
    &lt;span class=&#34;badge badge-queue&#34; style=&#34;font-size:12px;padding:4px 14px&#34;&gt;Channel&amp;lt;ConnectionItem&amp;gt;&lt;/span&gt;
  &lt;/div&gt;
  &lt;div class=&#34;connector&#34;&gt;&lt;div class=&#34;connector-line&#34; style=&#34;position:relative&#34;&gt;&lt;div class=&#34;flow-dot&#34; style=&#34;animation-delay:1s&#34;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;
  &lt;!-- Application --&gt;
  &lt;div class=&#34;node node-app&#34; style=&#34;max-width:480px;margin:0 auto&#34;&gt;
    &lt;div class=&#34;node-title&#34;&gt;Application Handlers&lt;/div&gt;
    &lt;div class=&#34;node-sub&#34;&gt;Engine.AcceptAsync() &amp;rarr; ReadAsync &amp;harr; Write + FlushAsync&lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Every thread in the system owns its own &lt;code&gt;io_uring&lt;/code&gt; instance. There is no shared ring, and no lock contention on the I/O path.&lt;/p&gt;
&lt;h2&gt;Acceptor Thread&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;acceptor-thread&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#acceptor-thread&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;The acceptor is responsible for one job: accepting new TCP connections.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Creates a listening socket (IPv4 or IPv6 dual-stack, configurable via &lt;code&gt;IPVersion&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;Binds and listens with the configured &lt;code&gt;Backlog&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Sets up its own &lt;code&gt;io_uring&lt;/code&gt; and arms a &lt;strong&gt;multishot accept&lt;/strong&gt; SQE&lt;/li&gt;
&lt;li&gt;Enters an event loop that:
&lt;ul&gt;
&lt;li&gt;Peeks a batch of CQEs (accepted file descriptors)&lt;/li&gt;
&lt;li&gt;Sets &lt;code&gt;TCP_NODELAY&lt;/code&gt; on each accepted socket&lt;/li&gt;
&lt;li&gt;Distributes fds to reactors in round-robin order via lock-free &lt;code&gt;ConcurrentQueue&amp;lt;int&amp;gt;&lt;/code&gt; (one per reactor)&lt;/li&gt;
&lt;li&gt;Sleeps in &lt;code&gt;io_uring_wait_cqes()&lt;/code&gt; when idle&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Multishot accept means a single submission produces a CQE for every incoming connection without re-arming. The acceptor never allocates per-connection &amp;ndash; it just hands off integer file descriptors.&lt;/p&gt;
&lt;h3&gt;Acceptor Event Loop&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;acceptor-event-loop&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#acceptor-event-loop&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;loop:
    cqeCount = peek_batch_cqe(ring, cqes, batchSize)
    if cqeCount == 0:
        submit_and_wait_timeout(ring, timeout)
        continue

    for each cqe in cqes:
        if cqe.res &amp;lt; 0:
            log error, continue
        clientFd = cqe.res
        setsockopt(clientFd, TCP_NODELAY)
        reactorQueues[nextReactor&amp;#43;&amp;#43; % reactorCount].Enqueue(clientFd)

    cq_advance(ring, cqeCount)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2&gt;Reactor Threads&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;reactor-threads&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#reactor-threads&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;Each reactor thread owns:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Its own &lt;code&gt;io_uring&lt;/code&gt; instance (created with &lt;code&gt;SINGLE_ISSUER | DEFER_TASKRUN&lt;/code&gt; by default)&lt;/li&gt;
&lt;li&gt;A &lt;strong&gt;buffer ring&lt;/strong&gt; for zero-copy receive operations&lt;/li&gt;
&lt;li&gt;A &lt;code&gt;Dictionary&amp;lt;int, Connection&amp;gt;&lt;/code&gt; mapping file descriptors to connection objects&lt;/li&gt;
&lt;li&gt;Lock-free queues for receiving new fds from the acceptor and flush requests from handlers&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Reactor Event Loop&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;reactor-event-loop&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#reactor-event-loop&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;Each reactor runs a tight loop:&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;loop:
    // 1. Drain newly accepted connections
    while reactorQueue.TryDequeue(out clientFd):
        connection = pool.Get() or new Connection()
        connection.SetFd(clientFd).SetReactor(this)
        connections[clientFd] = connection
        arm multishot_recv_select(clientFd, bufferGroupId)
        notify application via Channel

    // 2. Drain buffer returns
    while returnQ.TryDequeue(out bufferId):
        buf_ring_add(bufferRing, slab &amp;#43; bufferId * bufSize, bufSize, bufferId, mask, idx&amp;#43;&amp;#43;)
    buf_ring_advance(bufferRing, returnCount)

    // 3. Drain flush requests
    while flushQ.TryDequeue(out flushFd):
        connection = connections[flushFd]
        prep_send(sqe, flushFd, connection.WriteBuffer, connection.WriteInFlight, 0)
        submit pending sends

    // 4. Process completions
    cqeCount = peek_batch_cqe(ring, cqes, batchSize)
    for each cqe:
        kind = UdKindOf(cqe.user_data)
        fd   = UdFdOf(cqe.user_data)

        if kind == Recv:
            if cqe.res &amp;lt;= 0: close connection, return buffer
            else: enqueue RingItem to connection, wake handler

        if kind == Send:
            advance WriteHead, resubmit if partial, signal flush complete

        if kind == Cancel:
            handle cancellation completion

    cq_advance(ring, cqeCount)
    submit_and_wait_timeout(ring, timeout)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2&gt;Connection Distribution&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;connection-distribution&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#connection-distribution&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;The acceptor distributes connections using a simple round-robin counter:&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;reactorIndex = acceptCount&amp;#43;&amp;#43; % reactorCount&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Each reactor gets approximately equal load. The distribution is via &lt;code&gt;ConcurrentQueue&amp;lt;int&amp;gt;&lt;/code&gt; &amp;ndash; one queue per reactor &amp;ndash; so the acceptor never blocks waiting for a reactor.&lt;/p&gt;
&lt;h2&gt;Application Integration&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;application-integration&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#application-integration&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;After a reactor registers a new connection, it pushes a &lt;code&gt;ConnectionItem&lt;/code&gt; (reactor ID + client fd) into an unbounded &lt;code&gt;Channel&amp;lt;ConnectionItem&amp;gt;&lt;/code&gt;. The &lt;code&gt;Engine.AcceptAsync()&lt;/code&gt; method reads from this channel, returning fully-registered &lt;code&gt;Connection&lt;/code&gt; objects to the application.&lt;/p&gt;
&lt;p&gt;This means by the time your handler receives a connection:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The connection is already assigned to a reactor&lt;/li&gt;
&lt;li&gt;Multishot recv is already armed&lt;/li&gt;
&lt;li&gt;The buffer ring is ready to receive data&lt;/li&gt;
&lt;li&gt;You can immediately call &lt;code&gt;ReadAsync()&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
    <item>
      <title>SPSC Recv Ring</title>
      <link>http://localhost:1313/zerg/docs/internals/spsc-ring/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>http://localhost:1313/zerg/docs/internals/spsc-ring/</guid>
      <description>
        
        
        &lt;p&gt;The &lt;code&gt;SpscRecvRing&lt;/code&gt; is the per-connection inbound data queue. It&amp;rsquo;s a lock-free, single-producer single-consumer ring buffer optimized for the reactor-to-handler data path.&lt;/p&gt;
&lt;h2&gt;Design&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;design&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#design&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;sealed&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;SpscRecvRing&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RingItem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_items&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;   &lt;span class=&#34;c1&#34;&gt;// power-of-2 capacity array&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_mask&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;           &lt;span class=&#34;c1&#34;&gt;// capacity - 1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;long&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_tail&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;          &lt;span class=&#34;c1&#34;&gt;// producer write position&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;long&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_head&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;          &lt;span class=&#34;c1&#34;&gt;// consumer read position&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Capacity:&lt;/strong&gt; 1024 items (hardcoded in connection construction)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Producer:&lt;/strong&gt; Reactor thread (enqueues &lt;code&gt;RingItem&lt;/code&gt; on recv CQE)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Consumer:&lt;/strong&gt; Handler task (drains items in snapshot batches)&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Why SPSC?&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;why-spsc&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#why-spsc&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;Each connection is owned by exactly one reactor. The reactor is the sole producer, and the handler awaiting &lt;code&gt;ReadAsync()&lt;/code&gt; is the sole consumer. This single-producer/single-consumer invariant means:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;No atomics needed&lt;/strong&gt; on &lt;code&gt;_tail&lt;/code&gt; or &lt;code&gt;_head&lt;/code&gt; for their respective owners&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Volatile reads/writes&lt;/strong&gt; are sufficient for cross-thread visibility&lt;/li&gt;
&lt;li&gt;No CAS loops, no contention, no backoff&lt;/li&gt;
&lt;li&gt;Maximum throughput with minimal overhead&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;API&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;api&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#api&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;h3&gt;Producer (Reactor Thread)&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;producer-reactor-thread&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#producer-reactor-thread&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;TryEnqueue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RingItem&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;item&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Enqueues one item. Returns &lt;code&gt;false&lt;/code&gt; if the ring is full.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Volatile-reads &lt;code&gt;_head&lt;/code&gt; to check capacity (&lt;code&gt;_tail - _head &amp;gt;= capacity&lt;/code&gt; â†’ full)&lt;/li&gt;
&lt;li&gt;Stores item at &lt;code&gt;_items[_tail &amp;amp; _mask]&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Volatile-writes &lt;code&gt;_tail = _tail + 1&lt;/code&gt; (release semantics: ensures item is visible before tail advances)&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;Consumer (Handler Thread)&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;consumer-handler-thread&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#consumer-handler-thread&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;long&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;SnapshotTail&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Volatile-reads &lt;code&gt;_tail&lt;/code&gt; to capture the current batch boundary. The handler can drain items up to this position without observing partially-written state.&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;TryDequeueUntil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;long&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;tailSnapshot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;out&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RingItem&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;item&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Dequeues one item, bounded by the snapshot. Returns &lt;code&gt;false&lt;/code&gt; when &lt;code&gt;_head &amp;gt;= tailSnapshot&lt;/code&gt;.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Compares &lt;code&gt;_head&lt;/code&gt; against &lt;code&gt;tailSnapshot&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Reads &lt;code&gt;_items[_head &amp;amp; _mask]&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Advances &lt;code&gt;_head&lt;/code&gt; (plain write &amp;ndash; only consumer writes &lt;code&gt;_head&lt;/code&gt;)&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RingItem&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;DequeueSingle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Unconditional dequeue. Assumes the ring is not empty. Direct read and advance.&lt;/p&gt;
&lt;h3&gt;Inspection&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;inspection&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#inspection&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;IsEmpty&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;           &lt;span class=&#34;c1&#34;&gt;// volatile reads head and tail&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;long&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;GetTailHeadDiff&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;   &lt;span class=&#34;c1&#34;&gt;// approximate count (tail - head)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Clear&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;             &lt;span class=&#34;c1&#34;&gt;// volatile reset both to 0&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2&gt;Memory Ordering&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;memory-ordering&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#memory-ordering&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;The SPSC ring relies on two key ordering guarantees:&lt;/p&gt;
&lt;h3&gt;Producer Side (Release)&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;producer-side-release&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#producer-side-release&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;_items&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_tail&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_mask&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;item&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;        &lt;span class=&#34;c1&#34;&gt;// store item&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Volatile&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Write&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ref&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_tail&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_tail&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// publish tail (release fence)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;The volatile write to &lt;code&gt;_tail&lt;/code&gt; ensures that the item store is visible to the consumer before the tail advance is visible. The consumer will never see an advanced tail with a stale item.&lt;/p&gt;
&lt;h3&gt;Consumer Side (Acquire)&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;consumer-side-acquire&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#consumer-side-acquire&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;long&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;tail&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Volatile&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Read&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ref&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_tail&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// acquire fence&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;item&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_items&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_head&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_mask&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt;      &lt;span class=&#34;c1&#34;&gt;// load item&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;The volatile read of &lt;code&gt;_tail&lt;/code&gt; ensures the consumer sees all stores made by the producer up to that tail position.&lt;/p&gt;
&lt;h3&gt;Single-Writer Optimization&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;single-writer-optimization&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#single-writer-optimization&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;Since only the consumer writes &lt;code&gt;_head&lt;/code&gt; and only the producer writes &lt;code&gt;_tail&lt;/code&gt;, these fields don&amp;rsquo;t need atomic operations. Plain reads from the owning thread and volatile reads from the other thread are sufficient.&lt;/p&gt;
&lt;h2&gt;Snapshot-Based Batching&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;snapshot-based-batching&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#snapshot-based-batching&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;The snapshot pattern prevents the consumer from chasing a moving tail:&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Handler side:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ReadResult&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;await&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ReadAsync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;long&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;snapshot&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TailSnapshot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// captured once&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Drain exactly what was available at ReadAsync time&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TryGetRing&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;snapshot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;out&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RingItem&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ring&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// process ring...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ReturnRing&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ring&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;BufferId&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Guaranteed to terminate: snapshot is fixed, head advances toward it&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;This is important because the reactor may enqueue more items while the handler is processing. Without a snapshot boundary, the handler could spin indefinitely.&lt;/p&gt;
&lt;h2&gt;Ring Full Behavior&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;ring-full-behavior&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#ring-full-behavior&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;When the SPSC ring is full (1024 items waiting to be consumed by the handler):&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;The reactor&amp;rsquo;s &lt;code&gt;EnqueueRingItem()&lt;/code&gt; detects the ring is full&lt;/li&gt;
&lt;li&gt;The connection is marked as closed (&lt;code&gt;_closed = 1&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;If the handler is armed, it&amp;rsquo;s woken with a close signal&lt;/li&gt;
&lt;li&gt;If no handler is armed, &lt;code&gt;_pending&lt;/code&gt; is set&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;This is a safety measure &amp;ndash; a handler that falls behind and doesn&amp;rsquo;t drain its ring will eventually have its connection closed rather than consuming unbounded kernel buffers.&lt;/p&gt;
&lt;h2&gt;Performance Characteristics&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;performance-characteristics&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#performance-characteristics&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;Operation&lt;/th&gt;
          &lt;th&gt;Cost&lt;/th&gt;
          &lt;th&gt;Allocation&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;TryEnqueue&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;~5 ns&lt;/td&gt;
          &lt;td&gt;None&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;TryDequeueUntil&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;~3 ns&lt;/td&gt;
          &lt;td&gt;None&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;SnapshotTail&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;~1 ns&lt;/td&gt;
          &lt;td&gt;None&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;IsEmpty&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;~2 ns&lt;/td&gt;
          &lt;td&gt;None&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;All operations are &lt;code&gt;[MethodImpl(MethodImplOptions.AggressiveInlining)]&lt;/code&gt; for JIT inlining.&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Zero-Allocation Patterns</title>
      <link>http://localhost:1313/zerg/docs/guides/zero-allocation/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>http://localhost:1313/zerg/docs/guides/zero-allocation/</guid>
      <description>
        
        
        &lt;p&gt;zerg is designed for allocation-free operation on the hot path. This guide explains the read/write patterns and their allocation characteristics.&lt;/p&gt;
&lt;h2&gt;Reading with ReadOnlySpan&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;reading-with-readonlyspan&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#reading-with-readonlyspan&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;The simplest approach: iterate ring items one at a time using &lt;code&gt;TryGetRing&lt;/code&gt; and process each as a &lt;code&gt;ReadOnlySpan&amp;lt;byte&amp;gt;&lt;/code&gt;. Zero allocation.&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;async&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Task&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;HandleConnectionAsync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Connection&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;kt&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;await&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ReadAsync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;IsClosed&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;break&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TryGetRing&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TailSnapshot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;out&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RingItem&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ring&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;ReadOnlySpan&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;data&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ring&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;AsSpan&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;c1&#34;&gt;// Parse and respond in-place -- no allocation&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;ProcessRequest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;c1&#34;&gt;// Return buffer immediately&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ReturnRing&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ring&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;BufferId&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;await&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;FlushAsync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ResetRead&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Key patterns:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Use &lt;code&gt;TryGetRing&lt;/code&gt; to iterate one buffer at a time&lt;/li&gt;
&lt;li&gt;Use &lt;code&gt;ring.AsSpan()&lt;/code&gt; for zero-copy access to the data&lt;/li&gt;
&lt;li&gt;Return each buffer immediately after processing&lt;/li&gt;
&lt;li&gt;No arrays, lists, or sequences allocated&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Reading with ReadOnlySequence&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;reading-with-readonlysequence&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#reading-with-readonlysequence&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;When data spans multiple kernel buffers, use &lt;code&gt;GetAllSnapshotRingsAsUnmanagedMemory&lt;/code&gt; to build a &lt;code&gt;ReadOnlySequence&amp;lt;byte&amp;gt;&lt;/code&gt; for &lt;code&gt;SequenceReader&amp;lt;byte&amp;gt;&lt;/code&gt; based parsing:&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;async&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Task&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;HandleConnectionAsync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Connection&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;kt&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;await&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ReadAsync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;IsClosed&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;break&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;// Get all received buffers as managed memory&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;kt&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;rings&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;GetAllSnapshotRingsAsUnmanagedMemory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;// Build a ReadOnlySequence for multi-segment parsing&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;ReadOnlySequence&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;sequence&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;rings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ToReadOnlySequence&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;kt&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;reader&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;SequenceReader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sequence&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;// Parse the request...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;ProcessSequence&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;ref&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;reader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;// Return all buffers&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;rings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ReturnRingBuffers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Reactor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;await&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;FlushAsync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ResetRead&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;This allocates one &lt;code&gt;UnmanagedMemoryManager[]&lt;/code&gt; array and one &lt;code&gt;RingSegment&lt;/code&gt; per buffer, but the data itself is never copied.&lt;/p&gt;
&lt;h2&gt;Writing Responses&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;writing-responses&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#writing-responses&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;h3&gt;Direct Span Write (Zero Allocation)&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;direct-span-write-zero-allocation&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#direct-span-write-zero-allocation&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Write&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;HTTP/1.1 200 OK\r\nContent-Length: 13\r\n\r\nHello, World!&amp;#34;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;u8&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;await&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;FlushAsync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Using &lt;code&gt;u8&lt;/code&gt; string literals produces compile-time constant UTF-8 data in the assembly&amp;rsquo;s read-only section. No allocation.&lt;/p&gt;
&lt;h3&gt;IBufferWriter (Zero Allocation)&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;ibufferwriter-zero-allocation&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#ibufferwriter-zero-allocation&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;Write directly into the connection&amp;rsquo;s slab without intermediate buffers:&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Span&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;span&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;GetSpan&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;256&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;written&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FormatResponse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;span&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Advance&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;written&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;await&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;FlushAsync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2&gt;Choosing a Read Pattern&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;choosing-a-read-pattern&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#choosing-a-read-pattern&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;Scenario&lt;/th&gt;
          &lt;th&gt;Pattern&lt;/th&gt;
          &lt;th&gt;Allocation&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;Single buffer, simple protocol&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;TryGetRing()&lt;/code&gt; + &lt;code&gt;AsSpan()&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;None&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Multi-buffer or complex parsing&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;GetAllSnapshotRingsAsUnmanagedMemory()&lt;/code&gt; + &lt;code&gt;ToReadOnlySequence()&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Array + segments&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Need individual ring control&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;TryGetRing()&lt;/code&gt; loop&lt;/td&gt;
          &lt;td&gt;None&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;BCL compatibility&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;ConnectionStream.ReadAsync()&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Copies to managed buffer&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h2&gt;Allocation-Free Patterns Summary&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;allocation-free-patterns-summary&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#allocation-free-patterns-summary&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;Pattern&lt;/th&gt;
          &lt;th&gt;Allocation?&lt;/th&gt;
          &lt;th&gt;When to Use&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;ring.AsSpan()&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;None&lt;/td&gt;
          &lt;td&gt;Reading a single buffer in-place&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;TryGetRing()&lt;/code&gt; loop&lt;/td&gt;
          &lt;td&gt;None&lt;/td&gt;
          &lt;td&gt;Iterating buffers one at a time&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;GetAllSnapshotRingsAsUnmanagedMemory()&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Array&lt;/td&gt;
          &lt;td&gt;When you need &lt;code&gt;ReadOnlySequence&lt;/code&gt; for multi-segment parsing&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;TryDynamicallyGetAllSnapshotRings()&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;List (if data)&lt;/td&gt;
          &lt;td&gt;When ring count varies and you want &lt;code&gt;out&lt;/code&gt; semantics&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;connection.Write(span)&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;None&lt;/td&gt;
          &lt;td&gt;Staging response bytes&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;connection.GetSpan()&lt;/code&gt; + &lt;code&gt;Advance()&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;None&lt;/td&gt;
          &lt;td&gt;Direct-write via IBufferWriter&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h2&gt;Real-World Example&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;real-world-example&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#real-world-example&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;The TechEmpower benchmark handler in the zerg repository demonstrates these patterns in a production HTTP server.&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Connection: Read</title>
      <link>http://localhost:1313/zerg/docs/api-reference/connection-read/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>http://localhost:1313/zerg/docs/api-reference/connection-read/</guid>
      <description>
        
        
        &lt;p&gt;The read API provides async waiting for inbound data, snapshot-based batch draining, and buffer management.&lt;/p&gt;
&lt;h2&gt;Core Read Cycle&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;core-read-cycle&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#core-read-cycle&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;Every read follows this pattern:&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// 1. Wait for data&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ReadResult&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;await&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ReadAsync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// 2. Check for close&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;IsClosed&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// 3. Drain and process buffers&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// 4. Return buffers to kernel&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// 5. Reset for next read&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ResetRead&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2&gt;ReadAsync&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;readasync&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#readasync&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ValueTask&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ReadResult&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ReadAsync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Waits for at least one received buffer to be available, or for the connection to close.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Returns:&lt;/strong&gt; A &lt;code&gt;ReadResult&lt;/code&gt; containing a tail snapshot and close status.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Fast paths (returns synchronously):&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Connection already closed â†’ &lt;code&gt;ReadResult.Closed()&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Data already pending in the receive ring â†’ immediate result with snapshot&lt;/li&gt;
&lt;li&gt;&lt;code&gt;_pending&lt;/code&gt; flag set from previous produce â†’ immediate result&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Slow path:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Parks the calling task until the reactor enqueues data or marks the connection closed&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Rules:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Only &lt;strong&gt;one&lt;/strong&gt; outstanding &lt;code&gt;ReadAsync&lt;/code&gt; per connection at a time (single waiter)&lt;/li&gt;
&lt;li&gt;After processing the batch, call &lt;code&gt;ResetRead()&lt;/code&gt; before the next &lt;code&gt;ReadAsync()&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;ReadResult&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;readresult&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#readresult&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;readonly&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;ReadResult&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;long&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;TailSnapshot&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;IsClosed&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;Property&lt;/th&gt;
          &lt;th&gt;Description&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;TailSnapshot&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Logical position in the receive ring at the time of read. Defines the batch boundary &amp;ndash; you can drain items up to this position.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;IsClosed&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;true&lt;/code&gt; if the connection was closed (EOF, error, or reuse).&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h2&gt;ResetRead&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;resetread&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#resetread&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ResetRead&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Prepares the connection for the next read cycle. Must be called after draining a batch and before the next &lt;code&gt;ReadAsync()&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Internally:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Resets the &lt;code&gt;ManualResetValueTaskSourceCore&lt;/code&gt; (it&amp;rsquo;s single-use)&lt;/li&gt;
&lt;li&gt;Checks if new data arrived during processing and sets &lt;code&gt;_pending = 1&lt;/code&gt; if so&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;High-Level Drain APIs&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;high-level-drain-apis&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#high-level-drain-apis&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;These methods dequeue all items in the current snapshot batch. Call one of these after &lt;code&gt;ReadAsync()&lt;/code&gt; returns successfully.&lt;/p&gt;
&lt;h3&gt;GetAllSnapshotRingsAsUnmanagedMemory&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;getallsnapshotringsasunmanagedmemory&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#getallsnapshotringsasunmanagedmemory&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;UnmanagedMemoryManager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;GetAllSnapshotRingsAsUnmanagedMemory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ReadResult&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;readResult&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Returns an array of &lt;code&gt;UnmanagedMemoryManager&lt;/code&gt; instances, one per received buffer in the snapshot. Each wraps a native pointer with a managed &lt;code&gt;Memory&amp;lt;byte&amp;gt;&lt;/code&gt; view.&lt;/p&gt;
&lt;p&gt;Use with &lt;code&gt;ToReadOnlySequence()&lt;/code&gt; for parsing:&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;rings&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;GetAllSnapshotRingsAsUnmanagedMemory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ReadOnlySequence&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;sequence&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;rings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ToReadOnlySequence&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// parse sequence...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;rings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ReturnRingBuffers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Reactor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h3&gt;GetAllSnapshotRings&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;getallsnapshotrings&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#getallsnapshotrings&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RingItem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;GetAllSnapshotRings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ReadResult&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;readResult&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Returns raw &lt;code&gt;RingItem&lt;/code&gt; values from the snapshot. Each item has &lt;code&gt;Ptr&lt;/code&gt;, &lt;code&gt;Length&lt;/code&gt;, and &lt;code&gt;BufferId&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;RingItem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;items&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;GetAllSnapshotRings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;foreach&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;item&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;items&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;ReadOnlySpan&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;data&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;item&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;AsSpan&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// process...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ReturnRing&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;item&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;BufferId&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h3&gt;TryDynamicallyGetAllSnapshotRingsAsReadOnlySequence&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;trydynamicallygetallsnapshotringsasreadonlysequence&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#trydynamicallygetallsnapshotringsasreadonlysequence&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;TryDynamicallyGetAllSnapshotRingsAsReadOnlySequence&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;ReadResult&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;readResult&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;out&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;List&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;UnmanagedMemoryManager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;rings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;out&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ReadOnlySequence&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;sequence&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Builds a zero-copy &lt;code&gt;ReadOnlySequence&amp;lt;byte&amp;gt;&lt;/code&gt; over all segments. Returns &lt;code&gt;false&lt;/code&gt; if no data is available.&lt;/p&gt;
&lt;h3&gt;TryDynamicallyGetAllSnapshotRingsAsUnmanagedMemory&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;trydynamicallygetallsnapshotringsasunmanagedmemory&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#trydynamicallygetallsnapshotringsasunmanagedmemory&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;TryDynamicallyGetAllSnapshotRingsAsUnmanagedMemory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;ReadResult&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;readResult&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;out&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;List&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;UnmanagedMemoryManager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;rings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Dequeues all segments as a list of &lt;code&gt;UnmanagedMemoryManager&lt;/code&gt;. Returns &lt;code&gt;false&lt;/code&gt; if no data.&lt;/p&gt;
&lt;h3&gt;TryDynamicallyGetAllSnapshotRings&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;trydynamicallygetallsnapshotrings&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#trydynamicallygetallsnapshotrings&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;TryDynamicallyGetAllSnapshotRings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;ReadResult&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;readResult&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;out&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;List&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;RingItem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;rings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Dequeues all segments as raw &lt;code&gt;RingItem&lt;/code&gt; values. Returns &lt;code&gt;false&lt;/code&gt; if no data.&lt;/p&gt;
&lt;h2&gt;Low-Level Drain APIs&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;low-level-drain-apis&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#low-level-drain-apis&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;For fine-grained control over individual ring items.&lt;/p&gt;
&lt;h3&gt;TryGetRing&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;trygetring&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#trygetring&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;TryGetRing&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;long&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;tailSnapshot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;out&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RingItem&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;item&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Dequeue one item from the receive ring, bounded by the snapshot. Returns &lt;code&gt;false&lt;/code&gt; when the batch is exhausted.&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TryGetRing&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TailSnapshot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;out&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RingItem&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ring&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;ReadOnlySpan&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;data&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ring&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;AsSpan&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// process one buffer...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ReturnRing&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ring&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;BufferId&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h3&gt;GetRing&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;getring&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#getring&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RingItem&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;GetRing&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Dequeue one item unconditionally. Assumes the ring is not empty. Use only when you know items are available.&lt;/p&gt;
&lt;h2&gt;Buffer Return&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;buffer-return&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#buffer-return&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;h3&gt;ReturnRing&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;returnring&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#returnring&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ReturnRing&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;ushort&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bufferId&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Returns a consumed buffer to the reactor&amp;rsquo;s buffer ring. The reactor will add it back to the kernel buffer ring on its next loop iteration.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Must be called&lt;/strong&gt; for every buffer obtained via &lt;code&gt;TryGetRing&lt;/code&gt;, &lt;code&gt;GetRing&lt;/code&gt;, &lt;code&gt;GetAllSnapshotRings&lt;/code&gt;, etc.&lt;/p&gt;
&lt;h3&gt;ReturnRingBuffers (Extension Method)&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;returnringbuffers-extension-method&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#returnringbuffers-extension-method&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ReturnRingBuffers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;this&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;UnmanagedMemoryManager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;managers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Engine&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Engine&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Reactor&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;reactor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Batch return of buffer IDs from an array of &lt;code&gt;UnmanagedMemoryManager&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;rings&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;GetAllSnapshotRingsAsUnmanagedMemory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// process...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;rings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ReturnRingBuffers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Reactor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2&gt;RingItem&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;ringitem&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#ringitem&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;readonly&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;unsafe&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;RingItem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;ushort&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bufferId&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Ptr&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Length&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;ushort&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;BufferId&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ReadOnlySpan&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AsSpan&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;UnmanagedMemoryManager&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AsUnmanagedMemoryManager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;A lightweight struct wrapping a received data buffer from the kernel. The pointer is valid until &lt;code&gt;ReturnRing(BufferId)&lt;/code&gt; is called.&lt;/p&gt;
&lt;h2&gt;Properties&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;properties&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#properties&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;h3&gt;TotalRingCount&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;totalringcount&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#totalringcount&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;long&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;TotalRingCount&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Current number of items in the receive ring (approximate, for diagnostics).&lt;/p&gt;
&lt;h3&gt;SnapshotRingCount&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;snapshotringcount&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#snapshotringcount&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;SnapshotRingCount&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Number of items in the current snapshot batch. Set when &lt;code&gt;ReadAsync()&lt;/code&gt; captures the tail.&lt;/p&gt;
&lt;h2&gt;Reactor-Side Producer API&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;reactor-side-producer-api&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#reactor-side-producer-api&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;These methods are called by the reactor thread, not by user code:&lt;/p&gt;
&lt;h3&gt;EnqueueRingItem (Internal)&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;enqueueringitem-internal&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#enqueueringitem-internal&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EnqueueRingItem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;ushort&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bufferId&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Called by the reactor when a recv CQE completes. Enqueues a &lt;code&gt;RingItem&lt;/code&gt; into the connection&amp;rsquo;s SPSC ring and wakes the handler if armed.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;If the ring is full (1024 items), the connection is closed&lt;/li&gt;
&lt;li&gt;If the handler is armed (&lt;code&gt;_armed == 1&lt;/code&gt;), it&amp;rsquo;s woken immediately&lt;/li&gt;
&lt;li&gt;If no handler is armed, &lt;code&gt;_pending&lt;/code&gt; is set for the next &lt;code&gt;ReadAsync()&lt;/code&gt; fast-path&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;MarkClosed (Internal)&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;markclosed-internal&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#markclosed-internal&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;Sets &lt;code&gt;_closed = 1&lt;/code&gt; and wakes any armed handler so it receives &lt;code&gt;ReadResult.Closed()&lt;/code&gt;.&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>io_uring</title>
      <link>http://localhost:1313/zerg/docs/architecture/io-uring/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>http://localhost:1313/zerg/docs/architecture/io-uring/</guid>
      <description>
        
        
        &lt;p&gt;&lt;code&gt;io_uring&lt;/code&gt; is a Linux kernel interface for asynchronous I/O. zerg uses it as its sole I/O mechanism &amp;ndash; there are no &lt;code&gt;epoll&lt;/code&gt;, &lt;code&gt;kqueue&lt;/code&gt;, or &lt;code&gt;libuv&lt;/code&gt; fallbacks.&lt;/p&gt;
&lt;style&gt;
  #iouring-guide { --bg: #0b0d11; --bg2: #12151c; --bg3: #181c25; --bg4: #1e2330; --border: #2a3040; --text: #e0e4ef; --text2: #8a90a8; --muted: #555c73; --blue: #4a90ff; --cyan: #3ee8d0; --green: #3ee88a; --orange: #ff8a3e; --red: #ff4a5e; --purple: #a06aff; --yellow: #ffd04a; }
  #iouring-guide * { box-sizing: border-box; }
  #iouring-guide .iu-section { margin: 3rem 0; }
  #iouring-guide .iu-stag { display:inline-block; padding:.2rem .65rem; border-radius:5px; font-size:.7rem; font-weight:700; text-transform:uppercase; letter-spacing:1.2px; margin-bottom:.75rem; }
  #iouring-guide .iu-stag-blue { background:rgba(74,144,255,.12); color:var(--blue); border:1px solid rgba(74,144,255,.2); }
  #iouring-guide .iu-stag-cyan { background:rgba(62,232,208,.1); color:var(--cyan); border:1px solid rgba(62,232,208,.2); }
  #iouring-guide .iu-stag-green { background:rgba(62,232,138,.1); color:var(--green); border:1px solid rgba(62,232,138,.2); }
  #iouring-guide .iu-stag-orange { background:rgba(255,138,62,.1); color:var(--orange); border:1px solid rgba(255,138,62,.2); }
  #iouring-guide .iu-stag-purple { background:rgba(160,106,255,.1); color:var(--purple); border:1px solid rgba(160,106,255,.2); }
  #iouring-guide .iu-lead { color:var(--text2); font-size:1.05rem; margin-bottom:2rem; max-width:650px; }
  #iouring-guide .ring-svg { width:100%; height:auto; display:block; }
  #iouring-guide .svg-text { font-family:&#39;Inter&#39;,system-ui,sans-serif; fill:var(--text); }
  #iouring-guide .svg-mono { font-family:&#39;JetBrains Mono&#39;,ui-monospace,monospace; fill:var(--text2); }
  #iouring-guide .iu-cards { display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:1rem; margin-top:1.5rem; }
  #iouring-guide .iu-card { background:var(--bg3); border:1px solid var(--border); border-radius:12px; padding:1.25rem; transition:border-color .3s; }
  #iouring-guide .iu-card:hover { border-color:rgba(62,232,208,.3); }
  #iouring-guide .iu-card h4 { font-size:.9rem; font-weight:700; margin-bottom:.35rem; }
  #iouring-guide .iu-card p { font-size:.82rem; color:var(--text2); line-height:1.55; }
  #iouring-guide .iu-card code { font-family:&#39;JetBrains Mono&#39;,ui-monospace,monospace; font-size:.78rem; background:var(--bg); padding:.1rem .35rem; border-radius:4px; color:var(--cyan); }
  #iouring-guide .iu-two-col { display:grid; grid-template-columns:1fr 1fr; gap:2rem; align-items:start; }
  @media (max-width:800px) { #iouring-guide .iu-two-col { grid-template-columns:1fr; } }
  #iouring-guide .iu-divider { width:100%; height:1px; background:linear-gradient(90deg,transparent,var(--border),transparent); margin:2.5rem 0; }
  /* Stepper */
  #iouring-guide .stepper { display:flex; align-items:center; gap:1rem; justify-content:center; margin:1.5rem 0 1rem; }
  #iouring-guide .step-btn { width:40px; height:40px; border-radius:50%; border:2px solid var(--border); background:var(--bg3); color:var(--text); font-size:1rem; cursor:pointer; display:flex; align-items:center; justify-content:center; transition:all .2s; }
  #iouring-guide .step-btn:hover { border-color:var(--cyan); color:var(--cyan); }
  #iouring-guide .step-btn:disabled { opacity:.3; cursor:default; }
  #iouring-guide .step-dots { display:flex; gap:.4rem; }
  #iouring-guide .step-dot { width:10px; height:10px; border-radius:50%; background:var(--bg4); border:2px solid var(--border); transition:all .3s; cursor:pointer; }
  #iouring-guide .step-dot.active { background:var(--cyan); border-color:var(--cyan); box-shadow:0 0 8px rgba(62,232,208,.4); }
  #iouring-guide .step-dot.done { background:var(--muted); border-color:var(--muted); }
  #iouring-guide .step-desc { background:var(--bg3); border:1px solid var(--border); border-radius:12px; padding:1.25rem 1.5rem; margin-bottom:1rem; min-height:70px; }
  #iouring-guide .step-desc h4 { font-size:.95rem; font-weight:700; margin-bottom:.35rem; }
  #iouring-guide .step-desc p { font-size:.88rem; color:var(--text2); line-height:1.6; }
  #iouring-guide .step-desc code { font-family:&#39;JetBrains Mono&#39;,ui-monospace,monospace; font-size:.78rem; background:var(--bg); padding:.1rem .35rem; border-radius:4px; color:var(--cyan); }
  /* Step elements */
  #iouring-guide .step-el { opacity:0; transition:opacity .5s,transform .5s; transform:translateY(8px); pointer-events:none; }
  #iouring-guide .step-el.show { opacity:1; transform:translateY(0); pointer-events:auto; }
  /* Full flow panels */
  #iouring-guide .ff-panel { animation:iuFadeIn .45s ease both; }
  @keyframes iuFadeIn { from{opacity:0;transform:translateY(16px)} to{opacity:1;transform:translateY(0)} }
  /* Phase bar */
  #iouring-guide .phase-bar { display:flex; gap:2px; margin-bottom:1.5rem; border-radius:8px; overflow:hidden; }
  #iouring-guide .phase-seg { flex:1; height:6px; background:var(--bg4); transition:background .4s; }
  /* Codeblock */
  #iouring-guide .iu-codeblock { background:var(--bg); border:1px solid var(--border); border-radius:10px; overflow:hidden; }
  #iouring-guide .iu-codeblock-head { padding:.5rem 1rem; background:rgba(255,255,255,.02); border-bottom:1px solid var(--border); font-size:.75rem; color:var(--muted); font-family:&#39;JetBrains Mono&#39;,ui-monospace,monospace; }
  #iouring-guide .iu-codeblock pre { padding:1rem 1.25rem; font-family:&#39;JetBrains Mono&#39;,ui-monospace,monospace; font-size:.8rem; line-height:1.7; overflow-x:auto; color:var(--text); margin:0; }
  #iouring-guide .kw { color:#c792ea; } #iouring-guide .ty { color:#82aaff; } #iouring-guide .fn { color:#ffd700; } #iouring-guide .cm { color:#546e7a; font-style:italic; } #iouring-guide .num { color:#f78c6c; } #iouring-guide .op { color:#89ddff; }
&lt;/style&gt;
&lt;div id=&#34;iouring-guide&#34;&gt;
&lt;!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SECTION 1: THE RING MODEL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• --&gt;
&lt;div class=&#34;iu-section&#34;&gt;
&lt;div class=&#34;iu-stag iu-stag-blue&#34;&gt;The Ring Model&lt;/div&gt;
&lt;h3&gt;How io_uring Works&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;how-io_uring-works&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#how-io_uring-works&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p class=&#34;iu-lead&#34;&gt;io_uring uses two lock-free ring buffers shared between userspace and the kernel. Your app writes SQEs (requests), the kernel writes CQEs (results). No syscall needed for submission.&lt;/p&gt;
&lt;svg viewBox=&#34;0 0 900 520&#34; class=&#34;ring-svg&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34;&gt;
  &lt;defs&gt;
    &lt;linearGradient id=&#34;gSQ&#34; x1=&#34;0&#34; y1=&#34;0&#34; x2=&#34;1&#34; y2=&#34;1&#34;&gt;&lt;stop offset=&#34;0%&#34; stop-color=&#34;#4a90ff&#34;/&gt;&lt;stop offset=&#34;100%&#34; stop-color=&#34;#3e6aff&#34;/&gt;&lt;/linearGradient&gt;
    &lt;linearGradient id=&#34;gCQ&#34; x1=&#34;0&#34; y1=&#34;0&#34; x2=&#34;1&#34; y2=&#34;1&#34;&gt;&lt;stop offset=&#34;0%&#34; stop-color=&#34;#3ee88a&#34;/&gt;&lt;stop offset=&#34;100%&#34; stop-color=&#34;#2ab870&#34;/&gt;&lt;/linearGradient&gt;
    &lt;linearGradient id=&#34;gK&#34; x1=&#34;0&#34; y1=&#34;0&#34; x2=&#34;1&#34; y2=&#34;1&#34;&gt;&lt;stop offset=&#34;0%&#34; stop-color=&#34;#ff8a3e&#34;/&gt;&lt;stop offset=&#34;100%&#34; stop-color=&#34;#e06020&#34;/&gt;&lt;/linearGradient&gt;
    &lt;marker id=&#34;arrowB&#34; markerWidth=&#34;8&#34; markerHeight=&#34;6&#34; refX=&#34;8&#34; refY=&#34;3&#34; orient=&#34;auto&#34;&gt;&lt;polygon points=&#34;0 0, 8 3, 0 6&#34; fill=&#34;#4a90ff&#34;/&gt;&lt;/marker&gt;
    &lt;marker id=&#34;arrowG&#34; markerWidth=&#34;8&#34; markerHeight=&#34;6&#34; refX=&#34;8&#34; refY=&#34;3&#34; orient=&#34;auto&#34;&gt;&lt;polygon points=&#34;0 0, 8 3, 0 6&#34; fill=&#34;#3ee88a&#34;/&gt;&lt;/marker&gt;
    &lt;marker id=&#34;arrowO&#34; markerWidth=&#34;8&#34; markerHeight=&#34;6&#34; refX=&#34;8&#34; refY=&#34;3&#34; orient=&#34;auto&#34;&gt;&lt;polygon points=&#34;0 0, 8 3, 0 6&#34; fill=&#34;#ff8a3e&#34;/&gt;&lt;/marker&gt;
    &lt;filter id=&#34;glowB&#34;&gt;&lt;feDropShadow dx=&#34;0&#34; dy=&#34;0&#34; stdDeviation=&#34;4&#34; flood-color=&#34;#4a90ff&#34; flood-opacity=&#34;.5&#34;/&gt;&lt;/filter&gt;
    &lt;filter id=&#34;glowG&#34;&gt;&lt;feDropShadow dx=&#34;0&#34; dy=&#34;0&#34; stdDeviation=&#34;4&#34; flood-color=&#34;#3ee88a&#34; flood-opacity=&#34;.5&#34;/&gt;&lt;/filter&gt;
  &lt;/defs&gt;
  &lt;!-- USERSPACE BOX --&gt;
  &lt;rect x=&#34;30&#34; y=&#34;20&#34; width=&#34;840&#34; height=&#34;180&#34; rx=&#34;14&#34; fill=&#34;none&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;1.5&#34; stroke-dasharray=&#34;6 4&#34; opacity=&#34;.3&#34;/&gt;
  &lt;text x=&#34;55&#34; y=&#34;48&#34; class=&#34;svg-text&#34; font-size=&#34;13&#34; font-weight=&#34;700&#34; fill=&#34;#4a90ff&#34; opacity=&#34;.6&#34;&gt;USERSPACE (your C# app)&lt;/text&gt;
  &lt;!-- KERNEL BOX --&gt;
  &lt;rect x=&#34;30&#34; y=&#34;310&#34; width=&#34;840&#34; height=&#34;190&#34; rx=&#34;14&#34; fill=&#34;none&#34; stroke=&#34;#ff8a3e&#34; stroke-width=&#34;1.5&#34; stroke-dasharray=&#34;6 4&#34; opacity=&#34;.3&#34;/&gt;
  &lt;text x=&#34;55&#34; y=&#34;340&#34; class=&#34;svg-text&#34; font-size=&#34;13&#34; font-weight=&#34;700&#34; fill=&#34;#ff8a3e&#34; opacity=&#34;.6&#34;&gt;KERNEL&lt;/text&gt;
  &lt;!-- SHARED MEMORY BAND --&gt;
  &lt;rect x=&#34;30&#34; y=&#34;210&#34; width=&#34;840&#34; height=&#34;90&#34; rx=&#34;10&#34; fill=&#34;rgba(255,255,255,.02)&#34; stroke=&#34;#2a3040&#34; stroke-width=&#34;1&#34;/&gt;
  &lt;text x=&#34;450&#34; y=&#34;262&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#555c73&#34; text-anchor=&#34;middle&#34;&gt;SHARED MEMORY (mmap&#39;d)&lt;/text&gt;
  &lt;!-- SQ RING --&gt;
  &lt;g transform=&#34;translate(150, 220)&#34;&gt;
    &lt;rect x=&#34;0&#34; y=&#34;0&#34; width=&#34;220&#34; height=&#34;70&#34; rx=&#34;10&#34; fill=&#34;rgba(74,144,255,.08)&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;2&#34; filter=&#34;url(#glowB)&#34;/&gt;
    &lt;text x=&#34;110&#34; y=&#34;25&#34; class=&#34;svg-text&#34; font-size=&#34;14&#34; font-weight=&#34;800&#34; fill=&#34;#4a90ff&#34; text-anchor=&#34;middle&#34;&gt;Submission Queue&lt;/text&gt;
    &lt;rect x=&#34;12&#34; y=&#34;36&#34; width=&#34;28&#34; height=&#34;24&#34; rx=&#34;4&#34; fill=&#34;#4a90ff&#34; opacity=&#34;.8&#34;/&gt;&lt;text x=&#34;26&#34; y=&#34;52&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#fff&#34; text-anchor=&#34;middle&#34;&gt;SQE&lt;/text&gt;
    &lt;rect x=&#34;44&#34; y=&#34;36&#34; width=&#34;28&#34; height=&#34;24&#34; rx=&#34;4&#34; fill=&#34;#4a90ff&#34; opacity=&#34;.6&#34;/&gt;&lt;text x=&#34;58&#34; y=&#34;52&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#fff&#34; text-anchor=&#34;middle&#34;&gt;SQE&lt;/text&gt;
    &lt;rect x=&#34;76&#34; y=&#34;36&#34; width=&#34;28&#34; height=&#34;24&#34; rx=&#34;4&#34; fill=&#34;#4a90ff&#34; opacity=&#34;.4&#34;/&gt;&lt;text x=&#34;90&#34; y=&#34;52&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#fff&#34; text-anchor=&#34;middle&#34;&gt;SQE&lt;/text&gt;
    &lt;rect x=&#34;108&#34; y=&#34;36&#34; width=&#34;28&#34; height=&#34;24&#34; rx=&#34;4&#34; fill=&#34;rgba(74,144,255,.15)&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;1&#34; stroke-dasharray=&#34;3 2&#34;/&gt;
    &lt;rect x=&#34;140&#34; y=&#34;36&#34; width=&#34;28&#34; height=&#34;24&#34; rx=&#34;4&#34; fill=&#34;rgba(74,144,255,.15)&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;1&#34; stroke-dasharray=&#34;3 2&#34;/&gt;
    &lt;rect x=&#34;172&#34; y=&#34;36&#34; width=&#34;28&#34; height=&#34;24&#34; rx=&#34;4&#34; fill=&#34;rgba(74,144,255,.15)&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;1&#34; stroke-dasharray=&#34;3 2&#34;/&gt;
  &lt;/g&gt;
  &lt;!-- CQ RING --&gt;
  &lt;g transform=&#34;translate(530, 220)&#34;&gt;
    &lt;rect x=&#34;0&#34; y=&#34;0&#34; width=&#34;220&#34; height=&#34;70&#34; rx=&#34;10&#34; fill=&#34;rgba(62,232,138,.08)&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;2&#34; filter=&#34;url(#glowG)&#34;/&gt;
    &lt;text x=&#34;110&#34; y=&#34;25&#34; class=&#34;svg-text&#34; font-size=&#34;14&#34; font-weight=&#34;800&#34; fill=&#34;#3ee88a&#34; text-anchor=&#34;middle&#34;&gt;Completion Queue&lt;/text&gt;
    &lt;rect x=&#34;12&#34; y=&#34;36&#34; width=&#34;28&#34; height=&#34;24&#34; rx=&#34;4&#34; fill=&#34;#3ee88a&#34; opacity=&#34;.8&#34;/&gt;&lt;text x=&#34;26&#34; y=&#34;52&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#0a0a0f&#34; text-anchor=&#34;middle&#34;&gt;CQE&lt;/text&gt;
    &lt;rect x=&#34;44&#34; y=&#34;36&#34; width=&#34;28&#34; height=&#34;24&#34; rx=&#34;4&#34; fill=&#34;#3ee88a&#34; opacity=&#34;.6&#34;/&gt;&lt;text x=&#34;58&#34; y=&#34;52&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#0a0a0f&#34; text-anchor=&#34;middle&#34;&gt;CQE&lt;/text&gt;
    &lt;rect x=&#34;76&#34; y=&#34;36&#34; width=&#34;28&#34; height=&#34;24&#34; rx=&#34;4&#34; fill=&#34;rgba(62,232,138,.15)&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;1&#34; stroke-dasharray=&#34;3 2&#34;/&gt;
    &lt;rect x=&#34;108&#34; y=&#34;36&#34; width=&#34;28&#34; height=&#34;24&#34; rx=&#34;4&#34; fill=&#34;rgba(62,232,138,.15)&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;1&#34; stroke-dasharray=&#34;3 2&#34;/&gt;
    &lt;rect x=&#34;140&#34; y=&#34;36&#34; width=&#34;28&#34; height=&#34;24&#34; rx=&#34;4&#34; fill=&#34;rgba(62,232,138,.15)&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;1&#34; stroke-dasharray=&#34;3 2&#34;/&gt;
    &lt;rect x=&#34;172&#34; y=&#34;36&#34; width=&#34;28&#34; height=&#34;24&#34; rx=&#34;4&#34; fill=&#34;rgba(62,232,138,.15)&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;1&#34; stroke-dasharray=&#34;3 2&#34;/&gt;
  &lt;/g&gt;
  &lt;!-- ARROWS --&gt;
  &lt;line x1=&#34;260&#34; y1=&#34;150&#34; x2=&#34;260&#34; y2=&#34;215&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;2&#34; marker-end=&#34;url(#arrowB)&#34; opacity=&#34;.7&#34;/&gt;
  &lt;text x=&#34;278&#34; y=&#34;185&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#4a90ff&#34;&gt;write SQEs&lt;/text&gt;
  &lt;line x1=&#34;260&#34; y1=&#34;295&#34; x2=&#34;260&#34; y2=&#34;360&#34; stroke=&#34;#ff8a3e&#34; stroke-width=&#34;2&#34; marker-end=&#34;url(#arrowO)&#34; opacity=&#34;.7&#34;/&gt;
  &lt;text x=&#34;178&#34; y=&#34;335&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#ff8a3e&#34;&gt;kernel reads SQ&lt;/text&gt;
  &lt;line x1=&#34;640&#34; y1=&#34;360&#34; x2=&#34;640&#34; y2=&#34;295&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;2&#34; marker-end=&#34;url(#arrowG)&#34; opacity=&#34;.7&#34;/&gt;
  &lt;text x=&#34;655&#34; y=&#34;335&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#3ee88a&#34;&gt;kernel writes CQ&lt;/text&gt;
  &lt;line x1=&#34;640&#34; y1=&#34;215&#34; x2=&#34;640&#34; y2=&#34;150&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;2&#34; marker-end=&#34;url(#arrowG)&#34; opacity=&#34;.7&#34;/&gt;
  &lt;text x=&#34;655&#34; y=&#34;185&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#3ee88a&#34;&gt;read CQEs&lt;/text&gt;
  &lt;!-- Kernel processing --&gt;
  &lt;rect x=&#34;350&#34; y=&#34;370&#34; width=&#34;200&#34; height=&#34;60&#34; rx=&#34;10&#34; fill=&#34;rgba(255,138,62,.08)&#34; stroke=&#34;#ff8a3e&#34; stroke-width=&#34;1.5&#34;/&gt;
  &lt;text x=&#34;450&#34; y=&#34;395&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#ff8a3e&#34; text-anchor=&#34;middle&#34;&gt;I/O Processing&lt;/text&gt;
  &lt;text x=&#34;450&#34; y=&#34;415&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;accept / recv / send&lt;/text&gt;
  &lt;!-- App boxes --&gt;
  &lt;rect x=&#34;120&#34; y=&#34;70&#34; width=&#34;180&#34; height=&#34;65&#34; rx=&#34;10&#34; fill=&#34;#181c25&#34; stroke=&#34;#2a3040&#34; stroke-width=&#34;1&#34;/&gt;
  &lt;text x=&#34;210&#34; y=&#34;95&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; text-anchor=&#34;middle&#34;&gt;Your Code&lt;/text&gt;
  &lt;text x=&#34;210&#34; y=&#34;115&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;prep_recv, prep_send...&lt;/text&gt;
  &lt;rect x=&#34;570&#34; y=&#34;70&#34; width=&#34;200&#34; height=&#34;65&#34; rx=&#34;10&#34; fill=&#34;#181c25&#34; stroke=&#34;#2a3040&#34; stroke-width=&#34;1&#34;/&gt;
  &lt;text x=&#34;670&#34; y=&#34;95&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; text-anchor=&#34;middle&#34;&gt;Your Handler&lt;/text&gt;
  &lt;text x=&#34;670&#34; y=&#34;115&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;process results, route...&lt;/text&gt;
  &lt;!-- SQE STRUCTURE --&gt;
  &lt;g transform=&#34;translate(60,445)&#34;&gt;
    &lt;text x=&#34;0&#34; y=&#34;0&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; font-weight=&#34;700&#34; fill=&#34;#4a90ff&#34;&gt;SQE Structure (Submission)&lt;/text&gt;
    &lt;g transform=&#34;translate(0,12)&#34;&gt;
      &lt;rect x=&#34;0&#34; y=&#34;0&#34; width=&#34;80&#34; height=&#34;22&#34; rx=&#34;3&#34; fill=&#34;rgba(74,144,255,.12)&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;1&#34;/&gt;
      &lt;text x=&#34;40&#34; y=&#34;15&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#4a90ff&#34; text-anchor=&#34;middle&#34;&gt;opcode&lt;/text&gt;
      &lt;rect x=&#34;84&#34; y=&#34;0&#34; width=&#34;60&#34; height=&#34;22&#34; rx=&#34;3&#34; fill=&#34;rgba(74,144,255,.12)&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;1&#34;/&gt;
      &lt;text x=&#34;114&#34; y=&#34;15&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#4a90ff&#34; text-anchor=&#34;middle&#34;&gt;fd&lt;/text&gt;
      &lt;rect x=&#34;148&#34; y=&#34;0&#34; width=&#34;70&#34; height=&#34;22&#34; rx=&#34;3&#34; fill=&#34;rgba(74,144,255,.12)&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;1&#34;/&gt;
      &lt;text x=&#34;183&#34; y=&#34;15&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#4a90ff&#34; text-anchor=&#34;middle&#34;&gt;buf/len&lt;/text&gt;
      &lt;rect x=&#34;222&#34; y=&#34;0&#34; width=&#34;100&#34; height=&#34;22&#34; rx=&#34;3&#34; fill=&#34;rgba(74,144,255,.12)&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;1&#34;/&gt;
      &lt;text x=&#34;272&#34; y=&#34;15&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#4a90ff&#34; text-anchor=&#34;middle&#34;&gt;user_data&lt;/text&gt;
      &lt;rect x=&#34;326&#34; y=&#34;0&#34; width=&#34;60&#34; height=&#34;22&#34; rx=&#34;3&#34; fill=&#34;rgba(74,144,255,.12)&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;1&#34;/&gt;
      &lt;text x=&#34;356&#34; y=&#34;15&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#4a90ff&#34; text-anchor=&#34;middle&#34;&gt;flags&lt;/text&gt;
    &lt;/g&gt;
  &lt;/g&gt;
  &lt;!-- CQE STRUCTURE --&gt;
  &lt;g transform=&#34;translate(510,445)&#34;&gt;
    &lt;text x=&#34;0&#34; y=&#34;0&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; font-weight=&#34;700&#34; fill=&#34;#3ee88a&#34;&gt;CQE Structure (Completion)&lt;/text&gt;
    &lt;g transform=&#34;translate(0,12)&#34;&gt;
      &lt;rect x=&#34;0&#34; y=&#34;0&#34; width=&#34;100&#34; height=&#34;22&#34; rx=&#34;3&#34; fill=&#34;rgba(62,232,138,.12)&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;1&#34;/&gt;
      &lt;text x=&#34;50&#34; y=&#34;15&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#3ee88a&#34; text-anchor=&#34;middle&#34;&gt;user_data&lt;/text&gt;
      &lt;rect x=&#34;104&#34; y=&#34;0&#34; width=&#34;70&#34; height=&#34;22&#34; rx=&#34;3&#34; fill=&#34;rgba(62,232,138,.12)&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;1&#34;/&gt;
      &lt;text x=&#34;139&#34; y=&#34;15&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#3ee88a&#34; text-anchor=&#34;middle&#34;&gt;res&lt;/text&gt;
      &lt;rect x=&#34;178&#34; y=&#34;0&#34; width=&#34;100&#34; height=&#34;22&#34; rx=&#34;3&#34; fill=&#34;rgba(62,232,138,.12)&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;1&#34;/&gt;
      &lt;text x=&#34;228&#34; y=&#34;15&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#3ee88a&#34; text-anchor=&#34;middle&#34;&gt;flags&lt;/text&gt;
    &lt;/g&gt;
  &lt;/g&gt;
&lt;/svg&gt;
&lt;div class=&#34;iu-cards&#34;&gt;
  &lt;div class=&#34;iu-card&#34;&gt;
    &lt;h4 style=&#34;color:#4a90ff;&#34;&gt;SQE â€” Submission Queue Entry&lt;/h4&gt;
    &lt;p&gt;&lt;code&gt;opcode&lt;/code&gt; = what to do (recv, send, accept)&lt;br&gt;
       &lt;code&gt;fd&lt;/code&gt; = which socket&lt;br&gt;
       &lt;code&gt;user_data&lt;/code&gt; = your 64-bit tag (returned in CQE)&lt;br&gt;
       &lt;code&gt;flags&lt;/code&gt; = BUFFER_SELECT, etc.&lt;/p&gt;
  &lt;/div&gt;
  &lt;div class=&#34;iu-card&#34;&gt;
    &lt;h4 style=&#34;color:#3ee88a;&#34;&gt;CQE â€” Completion Queue Entry&lt;/h4&gt;
    &lt;p&gt;&lt;code&gt;user_data&lt;/code&gt; = your original tag (identifies the op)&lt;br&gt;
       &lt;code&gt;res&lt;/code&gt; = result (bytes transferred, new fd, or -errno)&lt;br&gt;
       &lt;code&gt;flags&lt;/code&gt; = MORE, BUFFER (contains buffer_id)&lt;/p&gt;
  &lt;/div&gt;
  &lt;div class=&#34;iu-card&#34;&gt;
    &lt;h4 style=&#34;color:#ff8a3e;&#34;&gt;Shared Memory&lt;/h4&gt;
    &lt;p&gt;Both rings are mmap&#39;d. The kernel and your app write to them directly. No copy,
       no syscall for enqueue. Only &lt;code&gt;io_uring_enter()&lt;/code&gt; needed to wake the kernel.&lt;/p&gt;
  &lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SECTION 2: I/O LIFECYCLE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• --&gt;
&lt;div class=&#34;iu-section&#34;&gt;
&lt;div class=&#34;iu-stag iu-stag-cyan&#34;&gt;Interactive&lt;/div&gt;
&lt;h3&gt;The I/O Lifecycle&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;the-io-lifecycle&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#the-io-lifecycle&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p class=&#34;iu-lead&#34;&gt;Step through the exact sequence: your app queues an SQE, the kernel processes it, and you read the CQE result. All in shared memory.&lt;/p&gt;
&lt;div id=&#34;lifecycleScene&#34;&gt;
  &lt;svg viewBox=&#34;0 0 900 400&#34; class=&#34;ring-svg&#34;&gt;
    &lt;rect x=&#34;20&#34; y=&#34;10&#34; width=&#34;860&#34; height=&#34;140&#34; rx=&#34;12&#34; fill=&#34;none&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;1&#34; stroke-dasharray=&#34;4 3&#34; opacity=&#34;.2&#34;/&gt;
    &lt;text x=&#34;40&#34; y=&#34;34&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; font-weight=&#34;700&#34; fill=&#34;#4a90ff&#34; opacity=&#34;.5&#34;&gt;USERSPACE&lt;/text&gt;
    &lt;line x1=&#34;20&#34; y1=&#34;195&#34; x2=&#34;880&#34; y2=&#34;195&#34; stroke=&#34;#2a3040&#34; stroke-width=&#34;1&#34; stroke-dasharray=&#34;6 4&#34;/&gt;
    &lt;text x=&#34;435&#34; y=&#34;190&#34; class=&#34;svg-text&#34; font-size=&#34;10&#34; font-weight=&#34;700&#34; fill=&#34;#555c73&#34; text-anchor=&#34;middle&#34;&gt;â”â” kernel boundary â”â”&lt;/text&gt;
    &lt;rect x=&#34;20&#34; y=&#34;210&#34; width=&#34;860&#34; height=&#34;180&#34; rx=&#34;12&#34; fill=&#34;none&#34; stroke=&#34;#ff8a3e&#34; stroke-width=&#34;1&#34; stroke-dasharray=&#34;4 3&#34; opacity=&#34;.2&#34;/&gt;
    &lt;text x=&#34;40&#34; y=&#34;234&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; font-weight=&#34;700&#34; fill=&#34;#ff8a3e&#34; opacity=&#34;.5&#34;&gt;KERNEL&lt;/text&gt;
    &lt;!-- STEP 1 --&gt;
    &lt;g id=&#34;lc-s1&#34; class=&#34;step-el&#34;&gt;
      &lt;rect x=&#34;80&#34; y=&#34;55&#34; width=&#34;160&#34; height=&#34;55&#34; rx=&#34;10&#34; fill=&#34;#181c25&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;160&#34; y=&#34;80&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#4a90ff&#34; text-anchor=&#34;middle&#34;&gt;get_sqe()&lt;/text&gt;
      &lt;text x=&#34;160&#34; y=&#34;96&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; text-anchor=&#34;middle&#34;&gt;grab empty SQE slot&lt;/text&gt;
    &lt;/g&gt;
    &lt;!-- STEP 2 --&gt;
    &lt;g id=&#34;lc-s2&#34; class=&#34;step-el&#34;&gt;
      &lt;rect x=&#34;280&#34; y=&#34;55&#34; width=&#34;180&#34; height=&#34;55&#34; rx=&#34;10&#34; fill=&#34;#181c25&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;370&#34; y=&#34;80&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#4a90ff&#34; text-anchor=&#34;middle&#34;&gt;prep_recv(sqe, fd)&lt;/text&gt;
      &lt;text x=&#34;370&#34; y=&#34;96&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; text-anchor=&#34;middle&#34;&gt;fill opcode + fd + flags&lt;/text&gt;
      &lt;line x1=&#34;242&#34; y1=&#34;82&#34; x2=&#34;276&#34; y2=&#34;82&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;1.5&#34; marker-end=&#34;url(#arrowB)&#34; opacity=&#34;.6&#34;/&gt;
    &lt;/g&gt;
    &lt;!-- STEP 3 --&gt;
    &lt;g id=&#34;lc-s3&#34; class=&#34;step-el&#34;&gt;
      &lt;rect x=&#34;500&#34; y=&#34;55&#34; width=&#34;190&#34; height=&#34;55&#34; rx=&#34;10&#34; fill=&#34;#181c25&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;595&#34; y=&#34;80&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#4a90ff&#34; text-anchor=&#34;middle&#34;&gt;set_data64(sqe, tag)&lt;/text&gt;
      &lt;text x=&#34;595&#34; y=&#34;96&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; text-anchor=&#34;middle&#34;&gt;attach your 64-bit token&lt;/text&gt;
      &lt;line x1=&#34;462&#34; y1=&#34;82&#34; x2=&#34;496&#34; y2=&#34;82&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;1.5&#34; marker-end=&#34;url(#arrowB)&#34; opacity=&#34;.6&#34;/&gt;
    &lt;/g&gt;
    &lt;!-- STEP 4 --&gt;
    &lt;g id=&#34;lc-s4&#34; class=&#34;step-el&#34;&gt;
      &lt;rect x=&#34;730&#34; y=&#34;55&#34; width=&#34;120&#34; height=&#34;55&#34; rx=&#34;10&#34; fill=&#34;#181c25&#34; stroke=&#34;#3ee8d0&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;790&#34; y=&#34;80&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#3ee8d0&#34; text-anchor=&#34;middle&#34;&gt;submit()&lt;/text&gt;
      &lt;text x=&#34;790&#34; y=&#34;96&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; text-anchor=&#34;middle&#34;&gt;io_uring_enter&lt;/text&gt;
      &lt;line x1=&#34;692&#34; y1=&#34;82&#34; x2=&#34;726&#34; y2=&#34;82&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;1.5&#34; marker-end=&#34;url(#arrowB)&#34; opacity=&#34;.6&#34;/&gt;
      &lt;line x1=&#34;790&#34; y1=&#34;115&#34; x2=&#34;790&#34; y2=&#34;230&#34; stroke=&#34;#ff8a3e&#34; stroke-width=&#34;2&#34; marker-end=&#34;url(#arrowO)&#34; opacity=&#34;.6&#34; stroke-dasharray=&#34;6 4&#34;/&gt;
    &lt;/g&gt;
    &lt;!-- STEP 5 --&gt;
    &lt;g id=&#34;lc-s5&#34; class=&#34;step-el&#34;&gt;
      &lt;rect x=&#34;620&#34; y=&#34;250&#34; width=&#34;220&#34; height=&#34;55&#34; rx=&#34;10&#34; fill=&#34;rgba(255,138,62,.08)&#34; stroke=&#34;#ff8a3e&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;730&#34; y=&#34;275&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#ff8a3e&#34; text-anchor=&#34;middle&#34;&gt;Kernel processes I/O&lt;/text&gt;
      &lt;text x=&#34;730&#34; y=&#34;291&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; text-anchor=&#34;middle&#34;&gt;recv(fd) â†’ data into buffer&lt;/text&gt;
    &lt;/g&gt;
    &lt;!-- STEP 6 --&gt;
    &lt;g id=&#34;lc-s6&#34; class=&#34;step-el&#34;&gt;
      &lt;rect x=&#34;320&#34; y=&#34;250&#34; width=&#34;220&#34; height=&#34;55&#34; rx=&#34;10&#34; fill=&#34;rgba(62,232,138,.08)&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;430&#34; y=&#34;275&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#3ee88a&#34; text-anchor=&#34;middle&#34;&gt;CQE written to CQ&lt;/text&gt;
      &lt;text x=&#34;430&#34; y=&#34;291&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; text-anchor=&#34;middle&#34;&gt;user_data + res + flags&lt;/text&gt;
      &lt;line x1=&#34;616&#34; y1=&#34;277&#34; x2=&#34;544&#34; y2=&#34;277&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;1.5&#34; marker-end=&#34;url(#arrowG)&#34; opacity=&#34;.6&#34;/&gt;
      &lt;line x1=&#34;430&#34; y1=&#34;245&#34; x2=&#34;430&#34; y2=&#34;140&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;2&#34; marker-end=&#34;url(#arrowG)&#34; opacity=&#34;.6&#34; stroke-dasharray=&#34;6 4&#34;/&gt;
    &lt;/g&gt;
    &lt;!-- STEP 7 --&gt;
    &lt;g id=&#34;lc-s7&#34; class=&#34;step-el&#34;&gt;
      &lt;rect x=&#34;80&#34; y=&#34;250&#34; width=&#34;180&#34; height=&#34;55&#34; rx=&#34;10&#34; fill=&#34;rgba(62,232,138,.08)&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;170&#34; y=&#34;275&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#3ee88a&#34; text-anchor=&#34;middle&#34;&gt;App reads CQE&lt;/text&gt;
      &lt;text x=&#34;170&#34; y=&#34;291&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; text-anchor=&#34;middle&#34;&gt;dispatch by user_data&lt;/text&gt;
      &lt;line x1=&#34;316&#34; y1=&#34;277&#34; x2=&#34;264&#34; y2=&#34;277&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;1.5&#34; marker-end=&#34;url(#arrowG)&#34; opacity=&#34;.6&#34;/&gt;
    &lt;/g&gt;
    &lt;!-- STEP 8 --&gt;
    &lt;g id=&#34;lc-s8&#34; class=&#34;step-el&#34;&gt;
      &lt;rect x=&#34;80&#34; y=&#34;330&#34; width=&#34;180&#34; height=&#34;50&#34; rx=&#34;10&#34; fill=&#34;#181c25&#34; stroke=&#34;#555c73&#34; stroke-width=&#34;1.5&#34;/&gt;
      &lt;text x=&#34;170&#34; y=&#34;354&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;cq_advance(count)&lt;/text&gt;
      &lt;text x=&#34;170&#34; y=&#34;370&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#555c73&#34; text-anchor=&#34;middle&#34;&gt;mark CQEs consumed&lt;/text&gt;
    &lt;/g&gt;
  &lt;/svg&gt;
&lt;/div&gt;
&lt;div class=&#34;stepper&#34;&gt;
  &lt;button class=&#34;step-btn&#34; id=&#34;lcPrev&#34; onclick=&#34;lcStep(-1)&#34;&gt;&amp;#9664;&lt;/button&gt;
  &lt;div class=&#34;step-dots&#34; id=&#34;lcDots&#34;&gt;&lt;/div&gt;
  &lt;button class=&#34;step-btn&#34; id=&#34;lcNext&#34; onclick=&#34;lcStep(1)&#34;&gt;&amp;#9654;&lt;/button&gt;
&lt;/div&gt;
&lt;div class=&#34;step-desc&#34; id=&#34;lcDesc&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;iu-codeblock&#34; style=&#34;max-width:700px;margin:0 auto;&#34;&gt;
  &lt;div class=&#34;iu-codeblock-head&#34;&gt;zerg â€” single syscall pattern&lt;/div&gt;
  &lt;pre&gt;&lt;span class=&#34;cm&#34;&gt;// 1. Queue work (no syscall)&lt;/span&gt;
&lt;span class=&#34;ty&#34;&gt;io_uring_sqe&lt;/span&gt;* sqe = &lt;span class=&#34;fn&#34;&gt;shim_get_sqe&lt;/span&gt;(ring);
&lt;span class=&#34;fn&#34;&gt;shim_prep_recv_multishot_select&lt;/span&gt;(sqe, fd, bgid, &lt;span class=&#34;num&#34;&gt;0&lt;/span&gt;);
&lt;span class=&#34;fn&#34;&gt;shim_sqe_set_data64&lt;/span&gt;(sqe, &lt;span class=&#34;fn&#34;&gt;PackUd&lt;/span&gt;(&lt;span class=&#34;ty&#34;&gt;UdKind&lt;/span&gt;.Recv, fd));
&lt;p&gt;&lt;span class=&#34;cm&#34;&gt;// 2. Submit + wait in ONE syscall&lt;/span&gt;
&lt;span class=&#34;fn&#34;&gt;shim_submit_and_wait_timeout&lt;/span&gt;(ring, &amp;amp;cqes, &lt;span class=&#34;num&#34;&gt;1&lt;/span&gt;, &amp;amp;ts);&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;cm&#34;&gt;// 3. Batch-read completions (no syscall)&lt;/span&gt;
&lt;span class=&#34;kw&#34;&gt;int&lt;/span&gt; got = &lt;span class=&#34;fn&#34;&gt;shim_peek_batch_cqe&lt;/span&gt;(ring, cqes, batchSize);&lt;/p&gt;
&lt;p&gt;&lt;span class=&#34;cm&#34;&gt;// 4. Process results&lt;/span&gt;
&lt;span class=&#34;kw&#34;&gt;for&lt;/span&gt; (&lt;span class=&#34;kw&#34;&gt;int&lt;/span&gt; i = &lt;span class=&#34;num&#34;&gt;0&lt;/span&gt;; i &amp;lt; got; i++) {
&lt;span class=&#34;ty&#34;&gt;UdKind&lt;/span&gt; kind = &lt;span class=&#34;fn&#34;&gt;UdKindOf&lt;/span&gt;(&lt;span class=&#34;fn&#34;&gt;shim_cqe_get_data64&lt;/span&gt;(cqes[i]));
&lt;span class=&#34;kw&#34;&gt;int&lt;/span&gt; res = cqes[i]-&amp;gt;res;
&lt;span class=&#34;cm&#34;&gt;// dispatch&amp;hellip;&lt;/span&gt;
}
&lt;span class=&#34;fn&#34;&gt;shim_cq_advance&lt;/span&gt;(ring, (&lt;span class=&#34;ty&#34;&gt;uint&lt;/span&gt;)got); &lt;span class=&#34;cm&#34;&gt;// 5. Mark consumed&lt;/span&gt;&lt;/pre&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SECTION 3: MULTISHOT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• --&gt;
&lt;div class=&#34;iu-section&#34;&gt;
&lt;div class=&#34;iu-stag iu-stag-green&#34;&gt;Key Feature&lt;/div&gt;
&lt;h3&gt;Multishot Operations&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;multishot-operations&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#multishot-operations&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p class=&#34;iu-lead&#34;&gt;Traditional I/O: 1 SQE â†’ 1 CQE. Multishot: 1 SQE â†’ many CQEs. The kernel keeps producing completions until an error or you cancel.&lt;/p&gt;
&lt;div class=&#34;iu-two-col&#34;&gt;
  &lt;div&gt;
    &lt;h4 style=&#34;font-weight:700;margin-bottom:1rem;&#34;&gt;Traditional (one-shot)&lt;/h4&gt;
    &lt;svg viewBox=&#34;0 0 420 280&#34; class=&#34;ring-svg&#34;&gt;
      &lt;text x=&#34;10&#34; y=&#34;20&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; font-weight=&#34;600&#34; fill=&#34;#555c73&#34;&gt;Submit recv for each read&lt;/text&gt;
      &lt;g transform=&#34;translate(20,35)&#34;&gt;
        &lt;rect x=&#34;0&#34; y=&#34;0&#34; width=&#34;80&#34; height=&#34;28&#34; rx=&#34;6&#34; fill=&#34;rgba(74,144,255,.15)&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;1.5&#34;/&gt;
        &lt;text x=&#34;40&#34; y=&#34;18&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#4a90ff&#34; text-anchor=&#34;middle&#34;&gt;SQE recv&lt;/text&gt;
        &lt;line x1=&#34;84&#34; y1=&#34;14&#34; x2=&#34;140&#34; y2=&#34;14&#34; stroke=&#34;#555c73&#34; stroke-width=&#34;1&#34; marker-end=&#34;url(#arrowB)&#34;/&gt;
        &lt;rect x=&#34;144&#34; y=&#34;0&#34; width=&#34;80&#34; height=&#34;28&#34; rx=&#34;6&#34; fill=&#34;rgba(62,232,138,.15)&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;1.5&#34;/&gt;
        &lt;text x=&#34;184&#34; y=&#34;18&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#3ee88a&#34; text-anchor=&#34;middle&#34;&gt;CQE data&lt;/text&gt;
      &lt;/g&gt;
      &lt;g transform=&#34;translate(20,75)&#34;&gt;
        &lt;rect x=&#34;0&#34; y=&#34;0&#34; width=&#34;80&#34; height=&#34;28&#34; rx=&#34;6&#34; fill=&#34;rgba(74,144,255,.15)&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;1.5&#34;/&gt;
        &lt;text x=&#34;40&#34; y=&#34;18&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#4a90ff&#34; text-anchor=&#34;middle&#34;&gt;SQE recv&lt;/text&gt;
        &lt;line x1=&#34;84&#34; y1=&#34;14&#34; x2=&#34;140&#34; y2=&#34;14&#34; stroke=&#34;#555c73&#34; stroke-width=&#34;1&#34; marker-end=&#34;url(#arrowB)&#34;/&gt;
        &lt;rect x=&#34;144&#34; y=&#34;0&#34; width=&#34;80&#34; height=&#34;28&#34; rx=&#34;6&#34; fill=&#34;rgba(62,232,138,.15)&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;1.5&#34;/&gt;
        &lt;text x=&#34;184&#34; y=&#34;18&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#3ee88a&#34; text-anchor=&#34;middle&#34;&gt;CQE data&lt;/text&gt;
      &lt;/g&gt;
      &lt;g transform=&#34;translate(20,115)&#34;&gt;
        &lt;rect x=&#34;0&#34; y=&#34;0&#34; width=&#34;80&#34; height=&#34;28&#34; rx=&#34;6&#34; fill=&#34;rgba(74,144,255,.15)&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;1.5&#34;/&gt;
        &lt;text x=&#34;40&#34; y=&#34;18&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#4a90ff&#34; text-anchor=&#34;middle&#34;&gt;SQE recv&lt;/text&gt;
        &lt;line x1=&#34;84&#34; y1=&#34;14&#34; x2=&#34;140&#34; y2=&#34;14&#34; stroke=&#34;#555c73&#34; stroke-width=&#34;1&#34; marker-end=&#34;url(#arrowB)&#34;/&gt;
        &lt;rect x=&#34;144&#34; y=&#34;0&#34; width=&#34;80&#34; height=&#34;28&#34; rx=&#34;6&#34; fill=&#34;rgba(62,232,138,.15)&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;1.5&#34;/&gt;
        &lt;text x=&#34;184&#34; y=&#34;18&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#3ee88a&#34; text-anchor=&#34;middle&#34;&gt;CQE data&lt;/text&gt;
      &lt;/g&gt;
      &lt;g transform=&#34;translate(20,155)&#34;&gt;
        &lt;rect x=&#34;0&#34; y=&#34;0&#34; width=&#34;80&#34; height=&#34;28&#34; rx=&#34;6&#34; fill=&#34;rgba(74,144,255,.15)&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;1.5&#34;/&gt;
        &lt;text x=&#34;40&#34; y=&#34;18&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#4a90ff&#34; text-anchor=&#34;middle&#34;&gt;SQE recv&lt;/text&gt;
        &lt;line x1=&#34;84&#34; y1=&#34;14&#34; x2=&#34;140&#34; y2=&#34;14&#34; stroke=&#34;#555c73&#34; stroke-width=&#34;1&#34; marker-end=&#34;url(#arrowB)&#34;/&gt;
        &lt;rect x=&#34;144&#34; y=&#34;0&#34; width=&#34;80&#34; height=&#34;28&#34; rx=&#34;6&#34; fill=&#34;rgba(62,232,138,.15)&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;1.5&#34;/&gt;
        &lt;text x=&#34;184&#34; y=&#34;18&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#3ee88a&#34; text-anchor=&#34;middle&#34;&gt;CQE data&lt;/text&gt;
      &lt;/g&gt;
      &lt;text x=&#34;280&#34; y=&#34;115&#34; class=&#34;svg-text&#34; font-size=&#34;32&#34; font-weight=&#34;800&#34; fill=&#34;#ff4a5e&#34; opacity=&#34;.6&#34;&gt;4 SQEs&lt;/text&gt;
      &lt;text x=&#34;280&#34; y=&#34;140&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; fill=&#34;#8a90a8&#34;&gt;4 submissions&lt;/text&gt;
      &lt;text x=&#34;280&#34; y=&#34;155&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; fill=&#34;#8a90a8&#34;&gt;4 completions&lt;/text&gt;
      &lt;text x=&#34;20&#34; y=&#34;220&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; font-weight=&#34;600&#34; fill=&#34;#ff4a5e&#34;&gt;Cost: re-arm after every read&lt;/text&gt;
      &lt;text x=&#34;20&#34; y=&#34;238&#34; class=&#34;svg-text&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34;&gt;More SQE slots consumed&lt;/text&gt;
      &lt;text x=&#34;20&#34; y=&#34;254&#34; class=&#34;svg-text&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34;&gt;More CPU cycles on submission&lt;/text&gt;
    &lt;/svg&gt;
  &lt;/div&gt;
  &lt;div&gt;
    &lt;h4 style=&#34;font-weight:700;margin-bottom:1rem;&#34;&gt;Multishot (zerg)&lt;/h4&gt;
    &lt;svg viewBox=&#34;0 0 420 280&#34; class=&#34;ring-svg&#34;&gt;
      &lt;text x=&#34;10&#34; y=&#34;20&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; font-weight=&#34;600&#34; fill=&#34;#555c73&#34;&gt;Submit once, get many completions&lt;/text&gt;
      &lt;g transform=&#34;translate(20,35)&#34;&gt;
        &lt;rect x=&#34;0&#34; y=&#34;0&#34; width=&#34;120&#34; height=&#34;150&#34; rx=&#34;10&#34; fill=&#34;rgba(74,144,255,.08)&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;2&#34;/&gt;
        &lt;text x=&#34;60&#34; y=&#34;25&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#4a90ff&#34; text-anchor=&#34;middle&#34;&gt;1 SQE&lt;/text&gt;
        &lt;text x=&#34;60&#34; y=&#34;42&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;recv_multishot&lt;/text&gt;
        &lt;line x1=&#34;124&#34; y1=&#34;45&#34; x2=&#34;175&#34; y2=&#34;30&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;1.5&#34; marker-end=&#34;url(#arrowG)&#34;/&gt;
        &lt;line x1=&#34;124&#34; y1=&#34;70&#34; x2=&#34;175&#34; y2=&#34;70&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;1.5&#34; marker-end=&#34;url(#arrowG)&#34;/&gt;
        &lt;line x1=&#34;124&#34; y1=&#34;95&#34; x2=&#34;175&#34; y2=&#34;110&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;1.5&#34; marker-end=&#34;url(#arrowG)&#34;/&gt;
        &lt;line x1=&#34;124&#34; y1=&#34;120&#34; x2=&#34;175&#34; y2=&#34;150&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;1.5&#34; marker-end=&#34;url(#arrowG)&#34;/&gt;
        &lt;rect x=&#34;180&#34; y=&#34;16&#34; width=&#34;90&#34; height=&#34;28&#34; rx=&#34;6&#34; fill=&#34;rgba(62,232,138,.15)&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;1.5&#34;/&gt;
        &lt;text x=&#34;225&#34; y=&#34;34&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#3ee88a&#34; text-anchor=&#34;middle&#34;&gt;CQE + MORE&lt;/text&gt;
        &lt;rect x=&#34;180&#34; y=&#34;56&#34; width=&#34;90&#34; height=&#34;28&#34; rx=&#34;6&#34; fill=&#34;rgba(62,232,138,.15)&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;1.5&#34;/&gt;
        &lt;text x=&#34;225&#34; y=&#34;74&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#3ee88a&#34; text-anchor=&#34;middle&#34;&gt;CQE + MORE&lt;/text&gt;
        &lt;rect x=&#34;180&#34; y=&#34;96&#34; width=&#34;90&#34; height=&#34;28&#34; rx=&#34;6&#34; fill=&#34;rgba(62,232,138,.15)&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;1.5&#34;/&gt;
        &lt;text x=&#34;225&#34; y=&#34;114&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#3ee88a&#34; text-anchor=&#34;middle&#34;&gt;CQE + MORE&lt;/text&gt;
        &lt;rect x=&#34;180&#34; y=&#34;136&#34; width=&#34;90&#34; height=&#34;28&#34; rx=&#34;6&#34; fill=&#34;rgba(62,232,138,.15)&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;1.5&#34;/&gt;
        &lt;text x=&#34;225&#34; y=&#34;154&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#3ee88a&#34; text-anchor=&#34;middle&#34;&gt;CQE final&lt;/text&gt;
        &lt;rect x=&#34;285&#34; y=&#34;16&#34; width=&#34;100&#34; height=&#34;28&#34; rx=&#34;6&#34; fill=&#34;rgba(255,208,74,.08)&#34; stroke=&#34;#ffd04a&#34; stroke-width=&#34;1&#34;/&gt;
        &lt;text x=&#34;335&#34; y=&#34;34&#34; class=&#34;svg-mono&#34; font-size=&#34;8&#34; fill=&#34;#ffd04a&#34; text-anchor=&#34;middle&#34;&gt;F_MORE = 1&lt;/text&gt;
        &lt;rect x=&#34;285&#34; y=&#34;56&#34; width=&#34;100&#34; height=&#34;28&#34; rx=&#34;6&#34; fill=&#34;rgba(255,208,74,.08)&#34; stroke=&#34;#ffd04a&#34; stroke-width=&#34;1&#34;/&gt;
        &lt;text x=&#34;335&#34; y=&#34;74&#34; class=&#34;svg-mono&#34; font-size=&#34;8&#34; fill=&#34;#ffd04a&#34; text-anchor=&#34;middle&#34;&gt;F_MORE = 1&lt;/text&gt;
        &lt;rect x=&#34;285&#34; y=&#34;96&#34; width=&#34;100&#34; height=&#34;28&#34; rx=&#34;6&#34; fill=&#34;rgba(255,208,74,.08)&#34; stroke=&#34;#ffd04a&#34; stroke-width=&#34;1&#34;/&gt;
        &lt;text x=&#34;335&#34; y=&#34;114&#34; class=&#34;svg-mono&#34; font-size=&#34;8&#34; fill=&#34;#ffd04a&#34; text-anchor=&#34;middle&#34;&gt;F_MORE = 1&lt;/text&gt;
        &lt;rect x=&#34;285&#34; y=&#34;136&#34; width=&#34;100&#34; height=&#34;28&#34; rx=&#34;6&#34; fill=&#34;rgba(255,74,94,.08)&#34; stroke=&#34;#ff4a5e&#34; stroke-width=&#34;1&#34;/&gt;
        &lt;text x=&#34;335&#34; y=&#34;154&#34; class=&#34;svg-mono&#34; font-size=&#34;8&#34; fill=&#34;#ff4a5e&#34; text-anchor=&#34;middle&#34;&gt;F_MORE = 0&lt;/text&gt;
      &lt;/g&gt;
      &lt;text x=&#34;20&#34; y=&#34;220&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; font-weight=&#34;600&#34; fill=&#34;#3ee88a&#34;&gt;Win: 1 submission, N completions&lt;/text&gt;
      &lt;text x=&#34;20&#34; y=&#34;238&#34; class=&#34;svg-text&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34;&gt;Kernel sets IORING_CQE_F_MORE on each CQE&lt;/text&gt;
      &lt;text x=&#34;20&#34; y=&#34;254&#34; class=&#34;svg-text&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34;&gt;When MORE=0 â†’ multishot ended, re-arm&lt;/text&gt;
      &lt;text x=&#34;20&#34; y=&#34;272&#34; class=&#34;svg-text&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34;&gt;Used for both accept and recv in zerg&lt;/text&gt;
    &lt;/svg&gt;
  &lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;iu-divider&#34;&gt;&lt;/div&gt;
&lt;h4&gt;user_data Packing&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;user_data-packing&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#user_data-packing&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h4&gt;&lt;p&gt;Each SQE carries a 64-bit token so the completion handler knows what operation completed and on which socket.&lt;/p&gt;
&lt;svg viewBox=&#34;0 0 800 110&#34; class=&#34;ring-svg&#34; style=&#34;max-width:800px;margin:1rem auto;display:block;&#34;&gt;
  &lt;text x=&#34;400&#34; y=&#34;18&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; text-anchor=&#34;middle&#34;&gt;64-bit user_data&lt;/text&gt;
  &lt;rect x=&#34;50&#34; y=&#34;30&#34; width=&#34;340&#34; height=&#34;45&#34; rx=&#34;8&#34; fill=&#34;rgba(160,106,255,.1)&#34; stroke=&#34;#a06aff&#34; stroke-width=&#34;2&#34;/&gt;
  &lt;text x=&#34;220&#34; y=&#34;50&#34; class=&#34;svg-text&#34; font-size=&#34;13&#34; font-weight=&#34;700&#34; fill=&#34;#a06aff&#34; text-anchor=&#34;middle&#34;&gt;UdKind (bits 63-32)&lt;/text&gt;
  &lt;text x=&#34;220&#34; y=&#34;66&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; text-anchor=&#34;middle&#34;&gt;1=Accept  2=Recv  3=Send  4=Cancel&lt;/text&gt;
  &lt;rect x=&#34;410&#34; y=&#34;30&#34; width=&#34;340&#34; height=&#34;45&#34; rx=&#34;8&#34; fill=&#34;rgba(74,144,255,.1)&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;2&#34;/&gt;
  &lt;text x=&#34;580&#34; y=&#34;50&#34; class=&#34;svg-text&#34; font-size=&#34;13&#34; font-weight=&#34;700&#34; fill=&#34;#4a90ff&#34; text-anchor=&#34;middle&#34;&gt;File Descriptor (bits 31-0)&lt;/text&gt;
  &lt;text x=&#34;580&#34; y=&#34;66&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; text-anchor=&#34;middle&#34;&gt;socket fd cast to uint&lt;/text&gt;
  &lt;text x=&#34;400&#34; y=&#34;100&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#3ee8d0&#34; text-anchor=&#34;middle&#34;&gt;PackUd(kind, fd) = ((ulong)kind &amp;lt;&amp;lt; 32) | (uint)fd&lt;/text&gt;
&lt;/svg&gt;
&lt;/div&gt;
&lt;!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SECTION 4: BUFFER RING â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• --&gt;
&lt;div class=&#34;iu-section&#34;&gt;
&lt;div class=&#34;iu-stag iu-stag-purple&#34;&gt;Zero Copy&lt;/div&gt;
&lt;h3&gt;Provided Buffer Ring&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;provided-buffer-ring&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#provided-buffer-ring&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p class=&#34;iu-lead&#34;&gt;Instead of passing a buffer with each recv, you pre-register a pool. The kernel picks one, fills it, and tells you which ID it used. You return it when done.&lt;/p&gt;
&lt;svg viewBox=&#34;0 0 900 500&#34; class=&#34;ring-svg&#34;&gt;
  &lt;defs&gt;
    &lt;marker id=&#34;arrowP&#34; markerWidth=&#34;8&#34; markerHeight=&#34;6&#34; refX=&#34;8&#34; refY=&#34;3&#34; orient=&#34;auto&#34;&gt;&lt;polygon points=&#34;0 0, 8 3, 0 6&#34; fill=&#34;#a06aff&#34;/&gt;&lt;/marker&gt;
  &lt;/defs&gt;
  &lt;text x=&#34;30&#34; y=&#34;25&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; font-weight=&#34;700&#34; fill=&#34;#4a90ff&#34; opacity=&#34;.5&#34;&gt;USERSPACE&lt;/text&gt;
  &lt;text x=&#34;30&#34; y=&#34;335&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; font-weight=&#34;700&#34; fill=&#34;#ff8a3e&#34; opacity=&#34;.5&#34;&gt;KERNEL&lt;/text&gt;
  &lt;line x1=&#34;20&#34; y1=&#34;305&#34; x2=&#34;880&#34; y2=&#34;305&#34; stroke=&#34;#2a3040&#34; stroke-width=&#34;1&#34; stroke-dasharray=&#34;6 4&#34;/&gt;
  &lt;!-- BUFFER SLAB --&gt;
  &lt;text x=&#34;60&#34; y=&#34;55&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#a06aff&#34;&gt;Buffer Slab (NativeMemory)&lt;/text&gt;
  &lt;g transform=&#34;translate(60, 65)&#34;&gt;
    &lt;rect x=&#34;0&#34; y=&#34;0&#34; width=&#34;60&#34; height=&#34;35&#34; rx=&#34;5&#34; fill=&#34;rgba(160,106,255,.2)&#34; stroke=&#34;#a06aff&#34; stroke-width=&#34;1.5&#34;/&gt;
    &lt;text x=&#34;30&#34; y=&#34;15&#34; class=&#34;svg-mono&#34; font-size=&#34;8&#34; fill=&#34;#a06aff&#34; text-anchor=&#34;middle&#34;&gt;buf 0&lt;/text&gt;
    &lt;text x=&#34;30&#34; y=&#34;28&#34; class=&#34;svg-mono&#34; font-size=&#34;7&#34; fill=&#34;#555c73&#34; text-anchor=&#34;middle&#34;&gt;32KB&lt;/text&gt;
    &lt;rect x=&#34;66&#34; y=&#34;0&#34; width=&#34;60&#34; height=&#34;35&#34; rx=&#34;5&#34; fill=&#34;rgba(160,106,255,.2)&#34; stroke=&#34;#a06aff&#34; stroke-width=&#34;1.5&#34;/&gt;
    &lt;text x=&#34;96&#34; y=&#34;15&#34; class=&#34;svg-mono&#34; font-size=&#34;8&#34; fill=&#34;#a06aff&#34; text-anchor=&#34;middle&#34;&gt;buf 1&lt;/text&gt;
    &lt;text x=&#34;96&#34; y=&#34;28&#34; class=&#34;svg-mono&#34; font-size=&#34;7&#34; fill=&#34;#555c73&#34; text-anchor=&#34;middle&#34;&gt;32KB&lt;/text&gt;
    &lt;rect x=&#34;132&#34; y=&#34;0&#34; width=&#34;60&#34; height=&#34;35&#34; rx=&#34;5&#34; fill=&#34;rgba(160,106,255,.5)&#34; stroke=&#34;#a06aff&#34; stroke-width=&#34;2&#34;/&gt;
    &lt;text x=&#34;162&#34; y=&#34;15&#34; class=&#34;svg-mono&#34; font-size=&#34;8&#34; fill=&#34;#fff&#34; text-anchor=&#34;middle&#34;&gt;buf 2&lt;/text&gt;
    &lt;text x=&#34;162&#34; y=&#34;28&#34; class=&#34;svg-mono&#34; font-size=&#34;7&#34; fill=&#34;rgba(255,255,255,.6)&#34; text-anchor=&#34;middle&#34;&gt;32KB&lt;/text&gt;
    &lt;rect x=&#34;198&#34; y=&#34;0&#34; width=&#34;60&#34; height=&#34;35&#34; rx=&#34;5&#34; fill=&#34;rgba(160,106,255,.2)&#34; stroke=&#34;#a06aff&#34; stroke-width=&#34;1.5&#34;/&gt;
    &lt;text x=&#34;228&#34; y=&#34;15&#34; class=&#34;svg-mono&#34; font-size=&#34;8&#34; fill=&#34;#a06aff&#34; text-anchor=&#34;middle&#34;&gt;buf 3&lt;/text&gt;
    &lt;text x=&#34;228&#34; y=&#34;28&#34; class=&#34;svg-mono&#34; font-size=&#34;7&#34; fill=&#34;#555c73&#34; text-anchor=&#34;middle&#34;&gt;32KB&lt;/text&gt;
    &lt;rect x=&#34;264&#34; y=&#34;0&#34; width=&#34;60&#34; height=&#34;35&#34; rx=&#34;5&#34; fill=&#34;rgba(160,106,255,.15)&#34; stroke=&#34;#a06aff&#34; stroke-width=&#34;1&#34; stroke-dasharray=&#34;3 2&#34;/&gt;
    &lt;text x=&#34;294&#34; y=&#34;22&#34; class=&#34;svg-mono&#34; font-size=&#34;8&#34; fill=&#34;#555c73&#34; text-anchor=&#34;middle&#34;&gt;...&lt;/text&gt;
    &lt;rect x=&#34;330&#34; y=&#34;0&#34; width=&#34;60&#34; height=&#34;35&#34; rx=&#34;5&#34; fill=&#34;rgba(160,106,255,.2)&#34; stroke=&#34;#a06aff&#34; stroke-width=&#34;1.5&#34;/&gt;
    &lt;text x=&#34;360&#34; y=&#34;15&#34; class=&#34;svg-mono&#34; font-size=&#34;8&#34; fill=&#34;#a06aff&#34; text-anchor=&#34;middle&#34;&gt;buf N&lt;/text&gt;
    &lt;text x=&#34;360&#34; y=&#34;28&#34; class=&#34;svg-mono&#34; font-size=&#34;7&#34; fill=&#34;#555c73&#34; text-anchor=&#34;middle&#34;&gt;32KB&lt;/text&gt;
  &lt;/g&gt;
  &lt;!-- BUFFER RING --&gt;
  &lt;text x=&#34;60&#34; y=&#34;135&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#a06aff&#34;&gt;Buffer Ring (shared with kernel)&lt;/text&gt;
  &lt;g transform=&#34;translate(60, 145)&#34;&gt;
    &lt;rect x=&#34;0&#34; y=&#34;0&#34; width=&#34;450&#34; height=&#34;50&#34; rx=&#34;10&#34; fill=&#34;rgba(160,106,255,.06)&#34; stroke=&#34;#a06aff&#34; stroke-width=&#34;2&#34;/&gt;
    &lt;rect x=&#34;10&#34; y=&#34;10&#34; width=&#34;50&#34; height=&#34;30&#34; rx=&#34;4&#34; fill=&#34;#a06aff&#34; opacity=&#34;.7&#34;/&gt;&lt;text x=&#34;35&#34; y=&#34;29&#34; class=&#34;svg-mono&#34; font-size=&#34;8&#34; fill=&#34;#fff&#34; text-anchor=&#34;middle&#34;&gt;id:0&lt;/text&gt;
    &lt;rect x=&#34;65&#34; y=&#34;10&#34; width=&#34;50&#34; height=&#34;30&#34; rx=&#34;4&#34; fill=&#34;#a06aff&#34; opacity=&#34;.7&#34;/&gt;&lt;text x=&#34;90&#34; y=&#34;29&#34; class=&#34;svg-mono&#34; font-size=&#34;8&#34; fill=&#34;#fff&#34; text-anchor=&#34;middle&#34;&gt;id:1&lt;/text&gt;
    &lt;rect x=&#34;120&#34; y=&#34;10&#34; width=&#34;50&#34; height=&#34;30&#34; rx=&#34;4&#34; fill=&#34;#a06aff&#34; opacity=&#34;.3&#34;/&gt;&lt;text x=&#34;145&#34; y=&#34;29&#34; class=&#34;svg-mono&#34; font-size=&#34;8&#34; fill=&#34;#a06aff&#34; text-anchor=&#34;middle&#34;&gt;id:2&lt;/text&gt;
    &lt;text x=&#34;145&#34; y=&#34;16&#34; class=&#34;svg-mono&#34; font-size=&#34;7&#34; fill=&#34;#ff8a3e&#34; text-anchor=&#34;middle&#34;&gt;used&lt;/text&gt;
    &lt;rect x=&#34;175&#34; y=&#34;10&#34; width=&#34;50&#34; height=&#34;30&#34; rx=&#34;4&#34; fill=&#34;#a06aff&#34; opacity=&#34;.7&#34;/&gt;&lt;text x=&#34;200&#34; y=&#34;29&#34; class=&#34;svg-mono&#34; font-size=&#34;8&#34; fill=&#34;#fff&#34; text-anchor=&#34;middle&#34;&gt;id:3&lt;/text&gt;
    &lt;rect x=&#34;230&#34; y=&#34;10&#34; width=&#34;50&#34; height=&#34;30&#34; rx=&#34;4&#34; fill=&#34;#a06aff&#34; opacity=&#34;.7&#34;/&gt;&lt;text x=&#34;255&#34; y=&#34;29&#34; class=&#34;svg-mono&#34; font-size=&#34;8&#34; fill=&#34;#fff&#34; text-anchor=&#34;middle&#34;&gt;id:4&lt;/text&gt;
    &lt;rect x=&#34;285&#34; y=&#34;10&#34; width=&#34;50&#34; height=&#34;30&#34; rx=&#34;4&#34; fill=&#34;#a06aff&#34; opacity=&#34;.7&#34;/&gt;&lt;text x=&#34;310&#34; y=&#34;29&#34; class=&#34;svg-mono&#34; font-size=&#34;8&#34; fill=&#34;#fff&#34; text-anchor=&#34;middle&#34;&gt;id:5&lt;/text&gt;
    &lt;rect x=&#34;340&#34; y=&#34;10&#34; width=&#34;50&#34; height=&#34;30&#34; rx=&#34;4&#34; fill=&#34;#a06aff&#34; opacity=&#34;.5&#34;/&gt;&lt;text x=&#34;365&#34; y=&#34;29&#34; class=&#34;svg-mono&#34; font-size=&#34;8&#34; fill=&#34;#a06aff&#34; text-anchor=&#34;middle&#34;&gt;...&lt;/text&gt;
    &lt;rect x=&#34;395&#34; y=&#34;10&#34; width=&#34;45&#34; height=&#34;30&#34; rx=&#34;4&#34; fill=&#34;#a06aff&#34; opacity=&#34;.7&#34;/&gt;&lt;text x=&#34;417&#34; y=&#34;29&#34; class=&#34;svg-mono&#34; font-size=&#34;8&#34; fill=&#34;#fff&#34; text-anchor=&#34;middle&#34;&gt;id:N&lt;/text&gt;
  &lt;/g&gt;
  &lt;!-- RECV FLOW --&gt;
  &lt;text x=&#34;550&#34; y=&#34;135&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; font-weight=&#34;700&#34; fill=&#34;#ff8a3e&#34;&gt;Recv Flow&lt;/text&gt;
  &lt;rect x=&#34;540&#34; y=&#34;145&#34; width=&#34;320&#34; height=&#34;145&#34; rx=&#34;12&#34; fill=&#34;#181c25&#34; stroke=&#34;#2a3040&#34; stroke-width=&#34;1&#34;/&gt;
  &lt;text x=&#34;560&#34; y=&#34;170&#34; class=&#34;svg-text&#34; font-size=&#34;10&#34; font-weight=&#34;700&#34; fill=&#34;#ffd04a&#34;&gt;1&lt;/text&gt;
  &lt;text x=&#34;578&#34; y=&#34;170&#34; class=&#34;svg-text&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34;&gt;Kernel picks buf from ring&lt;/text&gt;
  &lt;text x=&#34;560&#34; y=&#34;195&#34; class=&#34;svg-text&#34; font-size=&#34;10&#34; font-weight=&#34;700&#34; fill=&#34;#ffd04a&#34;&gt;2&lt;/text&gt;
  &lt;text x=&#34;578&#34; y=&#34;195&#34; class=&#34;svg-text&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34;&gt;recv() fills it with data&lt;/text&gt;
  &lt;text x=&#34;560&#34; y=&#34;220&#34; class=&#34;svg-text&#34; font-size=&#34;10&#34; font-weight=&#34;700&#34; fill=&#34;#ffd04a&#34;&gt;3&lt;/text&gt;
  &lt;text x=&#34;578&#34; y=&#34;220&#34; class=&#34;svg-text&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34;&gt;CQE.flags contains buf id&lt;/text&gt;
  &lt;text x=&#34;578&#34; y=&#34;235&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#3ee8d0&#34;&gt;bid = flags &gt;&gt; 16&lt;/text&gt;
  &lt;text x=&#34;560&#34; y=&#34;260&#34; class=&#34;svg-text&#34; font-size=&#34;10&#34; font-weight=&#34;700&#34; fill=&#34;#ffd04a&#34;&gt;4&lt;/text&gt;
  &lt;text x=&#34;578&#34; y=&#34;260&#34; class=&#34;svg-text&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34;&gt;CQE.res = bytes received&lt;/text&gt;
  &lt;text x=&#34;560&#34; y=&#34;280&#34; class=&#34;svg-text&#34; font-size=&#34;10&#34; font-weight=&#34;700&#34; fill=&#34;#ffd04a&#34;&gt;5&lt;/text&gt;
  &lt;text x=&#34;578&#34; y=&#34;280&#34; class=&#34;svg-text&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34;&gt;App returns buf via buf_ring_add&lt;/text&gt;
  &lt;!-- KERNEL --&gt;
  &lt;rect x=&#34;200&#34; y=&#34;340&#34; width=&#34;500&#34; height=&#34;55&#34; rx=&#34;10&#34; fill=&#34;rgba(255,138,62,.06)&#34; stroke=&#34;#ff8a3e&#34; stroke-width=&#34;1.5&#34;/&gt;
  &lt;text x=&#34;450&#34; y=&#34;365&#34; class=&#34;svg-text&#34; font-size=&#34;13&#34; font-weight=&#34;700&#34; fill=&#34;#ff8a3e&#34; text-anchor=&#34;middle&#34;&gt;Kernel: recv(fd) â†’ picks buf 2 â†’ fills 1,420 bytes&lt;/text&gt;
  &lt;text x=&#34;450&#34; y=&#34;382&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;CQE { user_data: [Recv|fd], res: 1420, flags: (2 &amp;lt;&amp;lt; 16) | F_BUFFER | F_MORE }&lt;/text&gt;
  &lt;!-- RETURN FLOW --&gt;
  &lt;g transform=&#34;translate(60, 415)&#34;&gt;
    &lt;text x=&#34;0&#34; y=&#34;15&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#3ee88a&#34;&gt;Buffer Return (app â†’ ring)&lt;/text&gt;
    &lt;rect x=&#34;0&#34; y=&#34;25&#34; width=&#34;700&#34; height=&#34;50&#34; rx=&#34;10&#34; fill=&#34;#181c25&#34; stroke=&#34;#2a3040&#34; stroke-width=&#34;1&#34;/&gt;
    &lt;text x=&#34;20&#34; y=&#34;50&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34;&gt;connection.ReturnRing(bid)&lt;/text&gt;
    &lt;text x=&#34;25&#34; y=&#34;65&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#555c73&#34;&gt;â†’ MPSC queue â†’ reactor drains â†’ shim_buf_ring_add(ring, addr, len, bid, mask, idx) â†’ shim_buf_ring_advance(1)&lt;/text&gt;
  &lt;/g&gt;
&lt;/svg&gt;
&lt;/div&gt;
&lt;!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SECTION 5: FULL FLOW â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• --&gt;
&lt;div class=&#34;iu-section&#34;&gt;
&lt;div class=&#34;iu-stag iu-stag-orange&#34;&gt;End to End&lt;/div&gt;
&lt;h3&gt;Full zerg Flow&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;full-zerg-flow&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#full-zerg-flow&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p class=&#34;iu-lead&#34;&gt;Walk through the complete lifecycle: client connects, data flows in, your app responds, buffers recycle. Step through each phase one at a time.&lt;/p&gt;
&lt;div class=&#34;phase-bar&#34; id=&#34;ffBar&#34;&gt;
  &lt;div class=&#34;phase-seg&#34; id=&#34;ffSeg0&#34;&gt;&lt;/div&gt;
  &lt;div class=&#34;phase-seg&#34; id=&#34;ffSeg1&#34;&gt;&lt;/div&gt;
  &lt;div class=&#34;phase-seg&#34; id=&#34;ffSeg2&#34;&gt;&lt;/div&gt;
  &lt;div class=&#34;phase-seg&#34; id=&#34;ffSeg3&#34;&gt;&lt;/div&gt;
  &lt;div class=&#34;phase-seg&#34; id=&#34;ffSeg4&#34;&gt;&lt;/div&gt;
  &lt;div class=&#34;phase-seg&#34; id=&#34;ffSeg5&#34;&gt;&lt;/div&gt;
  &lt;div class=&#34;phase-seg&#34; id=&#34;ffSeg6&#34;&gt;&lt;/div&gt;
  &lt;div class=&#34;phase-seg&#34; id=&#34;ffSeg7&#34;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&#34;ffSvgWrap&#34; style=&#34;min-height:300px;position:relative;&#34;&gt;
  &lt;!-- STEP 0 --&gt;
  &lt;div class=&#34;ff-panel&#34; id=&#34;ffP0&#34;&gt;
    &lt;svg viewBox=&#34;0 0 860 280&#34; class=&#34;ring-svg&#34;&gt;
      &lt;rect x=&#34;10&#34; y=&#34;10&#34; width=&#34;840&#34; height=&#34;260&#34; rx=&#34;14&#34; fill=&#34;rgba(74,144,255,.03)&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;1&#34; stroke-dasharray=&#34;5 3&#34; opacity=&#34;.35&#34;/&gt;
      &lt;text x=&#34;30&#34; y=&#34;34&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; font-weight=&#34;700&#34; fill=&#34;#4a90ff&#34; opacity=&#34;.5&#34;&gt;ACCEPTOR THREAD&lt;/text&gt;
      &lt;rect x=&#34;40&#34; y=&#34;90&#34; width=&#34;110&#34; height=&#34;70&#34; rx=&#34;10&#34; fill=&#34;#181c25&#34; stroke=&#34;#8a90a8&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;95&#34; y=&#34;120&#34; class=&#34;svg-text&#34; font-size=&#34;14&#34; font-weight=&#34;800&#34; text-anchor=&#34;middle&#34;&gt;Client&lt;/text&gt;
      &lt;text x=&#34;95&#34; y=&#34;140&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#555c73&#34; text-anchor=&#34;middle&#34;&gt;TCP SYN&lt;/text&gt;
      &lt;line x1=&#34;155&#34; y1=&#34;125&#34; x2=&#34;230&#34; y2=&#34;125&#34; stroke=&#34;#8a90a8&#34; stroke-width=&#34;2.5&#34; marker-end=&#34;url(#arrowB)&#34;/&gt;
      &lt;text x=&#34;192&#34; y=&#34;115&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#555c73&#34; text-anchor=&#34;middle&#34;&gt;connect&lt;/text&gt;
      &lt;rect x=&#34;235&#34; y=&#34;75&#34; width=&#34;190&#34; height=&#34;100&#34; rx=&#34;12&#34; fill=&#34;rgba(255,138,62,.06)&#34; stroke=&#34;#ff8a3e&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;330&#34; y=&#34;104&#34; class=&#34;svg-text&#34; font-size=&#34;13&#34; font-weight=&#34;800&#34; fill=&#34;#ff8a3e&#34; text-anchor=&#34;middle&#34;&gt;Kernel&lt;/text&gt;
      &lt;text x=&#34;330&#34; y=&#34;124&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;multishot accept&lt;/text&gt;
      &lt;text x=&#34;330&#34; y=&#34;142&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;completes â†’ CQE&lt;/text&gt;
      &lt;text x=&#34;330&#34; y=&#34;160&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#ff8a3e&#34; text-anchor=&#34;middle&#34;&gt;res = new client fd&lt;/text&gt;
      &lt;line x1=&#34;428&#34; y1=&#34;125&#34; x2=&#34;510&#34; y2=&#34;125&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;2.5&#34; marker-end=&#34;url(#arrowG)&#34;/&gt;
      &lt;rect x=&#34;515&#34; y=&#34;85&#34; width=&#34;150&#34; height=&#34;80&#34; rx=&#34;12&#34; fill=&#34;rgba(62,232,138,.06)&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;590&#34; y=&#34;115&#34; class=&#34;svg-text&#34; font-size=&#34;13&#34; font-weight=&#34;800&#34; fill=&#34;#3ee88a&#34; text-anchor=&#34;middle&#34;&gt;Accept CQE&lt;/text&gt;
      &lt;text x=&#34;590&#34; y=&#34;135&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;fd = 42&lt;/text&gt;
      &lt;text x=&#34;590&#34; y=&#34;152&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#3ee88a&#34; text-anchor=&#34;middle&#34;&gt;F_MORE = 1 (stay armed)&lt;/text&gt;
      &lt;line x1=&#34;668&#34; y1=&#34;125&#34; x2=&#34;720&#34; y2=&#34;125&#34; stroke=&#34;#3ee8d0&#34; stroke-width=&#34;2.5&#34; marker-end=&#34;url(#arrowB)&#34;/&gt;
      &lt;rect x=&#34;725&#34; y=&#34;85&#34; width=&#34;110&#34; height=&#34;80&#34; rx=&#34;12&#34; fill=&#34;#181c25&#34; stroke=&#34;#3ee8d0&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;780&#34; y=&#34;113&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#3ee8d0&#34; text-anchor=&#34;middle&#34;&gt;Round&lt;/text&gt;
      &lt;text x=&#34;780&#34; y=&#34;130&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#3ee8d0&#34; text-anchor=&#34;middle&#34;&gt;Robin&lt;/text&gt;
      &lt;text x=&#34;780&#34; y=&#34;152&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;next % N&lt;/text&gt;
      &lt;text x=&#34;430&#34; y=&#34;230&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;Multishot accept is armed once at startup. Each new connection produces a CQE automatically.&lt;/text&gt;
      &lt;text x=&#34;430&#34; y=&#34;250&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;The acceptor never re-submits. F_MORE flag tells us the kernel will keep producing CQEs.&lt;/text&gt;
    &lt;/svg&gt;
  &lt;/div&gt;
  &lt;!-- STEP 1 --&gt;
  &lt;div class=&#34;ff-panel&#34; id=&#34;ffP1&#34; style=&#34;display:none;&#34;&gt;
    &lt;svg viewBox=&#34;0 0 860 280&#34; class=&#34;ring-svg&#34;&gt;
      &lt;rect x=&#34;10&#34; y=&#34;10&#34; width=&#34;380&#34; height=&#34;130&#34; rx=&#34;14&#34; fill=&#34;rgba(74,144,255,.03)&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;1&#34; stroke-dasharray=&#34;5 3&#34; opacity=&#34;.35&#34;/&gt;
      &lt;text x=&#34;30&#34; y=&#34;34&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; font-weight=&#34;700&#34; fill=&#34;#4a90ff&#34; opacity=&#34;.5&#34;&gt;ACCEPTOR&lt;/text&gt;
      &lt;rect x=&#34;470&#34; y=&#34;10&#34; width=&#34;380&#34; height=&#34;260&#34; rx=&#34;14&#34; fill=&#34;rgba(62,232,208,.03)&#34; stroke=&#34;#3ee8d0&#34; stroke-width=&#34;1&#34; stroke-dasharray=&#34;5 3&#34; opacity=&#34;.35&#34;/&gt;
      &lt;text x=&#34;490&#34; y=&#34;34&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; font-weight=&#34;700&#34; fill=&#34;#3ee8d0&#34; opacity=&#34;.5&#34;&gt;REACTOR 0&lt;/text&gt;
      &lt;rect x=&#34;40&#34; y=&#34;55&#34; width=&#34;140&#34; height=&#34;65&#34; rx=&#34;10&#34; fill=&#34;#181c25&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;1.5&#34;/&gt;
      &lt;text x=&#34;110&#34; y=&#34;80&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#4a90ff&#34; text-anchor=&#34;middle&#34;&gt;Acceptor&lt;/text&gt;
      &lt;text x=&#34;110&#34; y=&#34;98&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;fd = 42&lt;/text&gt;
      &lt;line x1=&#34;184&#34; y1=&#34;87&#34; x2=&#34;470&#34; y2=&#34;87&#34; stroke=&#34;#3ee8d0&#34; stroke-width=&#34;3&#34; marker-end=&#34;url(#arrowB)&#34;/&gt;
      &lt;rect x=&#34;260&#34; y=&#34;68&#34; width=&#34;140&#34; height=&#34;38&#34; rx=&#34;8&#34; fill=&#34;#0b0d11&#34; stroke=&#34;#3ee8d0&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;330&#34; y=&#34;84&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; font-weight=&#34;700&#34; fill=&#34;#3ee8d0&#34; text-anchor=&#34;middle&#34;&gt;MPSC Queue&lt;/text&gt;
      &lt;text x=&#34;330&#34; y=&#34;99&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#555c73&#34; text-anchor=&#34;middle&#34;&gt;lock-free enqueue&lt;/text&gt;
      &lt;rect x=&#34;505&#34; y=&#34;55&#34; width=&#34;200&#34; height=&#34;65&#34; rx=&#34;10&#34; fill=&#34;#181c25&#34; stroke=&#34;#3ee8d0&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;605&#34; y=&#34;78&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#3ee8d0&#34; text-anchor=&#34;middle&#34;&gt;Reactor dequeues fd&lt;/text&gt;
      &lt;text x=&#34;605&#34; y=&#34;98&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;creates Connection object&lt;/text&gt;
      &lt;line x1=&#34;605&#34; y1=&#34;124&#34; x2=&#34;605&#34; y2=&#34;162&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;2.5&#34; marker-end=&#34;url(#arrowB)&#34;/&gt;
      &lt;rect x=&#34;490&#34; y=&#34;166&#34; width=&#34;230&#34; height=&#34;65&#34; rx=&#34;10&#34; fill=&#34;rgba(74,144,255,.08)&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;605&#34; y=&#34;190&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#4a90ff&#34; text-anchor=&#34;middle&#34;&gt;Arm recv_multishot&lt;/text&gt;
      &lt;text x=&#34;605&#34; y=&#34;210&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;prep_recv(sqe, fd=42, bgid=1)&lt;/text&gt;
      &lt;text x=&#34;605&#34; y=&#34;224&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#555c73&#34; text-anchor=&#34;middle&#34;&gt;+ set_data64([Recv | 42])&lt;/text&gt;
      &lt;text x=&#34;430&#34; y=&#34;265&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;The reactor now owns this fd. No other thread touches it. Zero contention by design.&lt;/text&gt;
    &lt;/svg&gt;
  &lt;/div&gt;
  &lt;!-- STEP 2 --&gt;
  &lt;div class=&#34;ff-panel&#34; id=&#34;ffP2&#34; style=&#34;display:none;&#34;&gt;
    &lt;svg viewBox=&#34;0 0 860 300&#34; class=&#34;ring-svg&#34;&gt;
      &lt;rect x=&#34;10&#34; y=&#34;10&#34; width=&#34;840&#34; height=&#34;280&#34; rx=&#34;14&#34; fill=&#34;rgba(255,138,62,.03)&#34; stroke=&#34;#ff8a3e&#34; stroke-width=&#34;1&#34; stroke-dasharray=&#34;5 3&#34; opacity=&#34;.35&#34;/&gt;
      &lt;text x=&#34;30&#34; y=&#34;34&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; font-weight=&#34;700&#34; fill=&#34;#ff8a3e&#34; opacity=&#34;.5&#34;&gt;KERNEL I/O&lt;/text&gt;
      &lt;rect x=&#34;40&#34; y=&#34;70&#34; width=&#34;120&#34; height=&#34;60&#34; rx=&#34;10&#34; fill=&#34;#181c25&#34; stroke=&#34;#8a90a8&#34; stroke-width=&#34;1.5&#34;/&gt;
      &lt;text x=&#34;100&#34; y=&#34;96&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; text-anchor=&#34;middle&#34;&gt;Client&lt;/text&gt;
      &lt;text x=&#34;100&#34; y=&#34;114&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#555c73&#34; text-anchor=&#34;middle&#34;&gt;sends data&lt;/text&gt;
      &lt;line x1=&#34;164&#34; y1=&#34;100&#34; x2=&#34;230&#34; y2=&#34;100&#34; stroke=&#34;#8a90a8&#34; stroke-width=&#34;2&#34; marker-end=&#34;url(#arrowO)&#34;/&gt;
      &lt;rect x=&#34;235&#34; y=&#34;55&#34; width=&#34;200&#34; height=&#34;90&#34; rx=&#34;12&#34; fill=&#34;rgba(255,138,62,.08)&#34; stroke=&#34;#ff8a3e&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;335&#34; y=&#34;82&#34; class=&#34;svg-text&#34; font-size=&#34;13&#34; font-weight=&#34;800&#34; fill=&#34;#ff8a3e&#34; text-anchor=&#34;middle&#34;&gt;Kernel recv()&lt;/text&gt;
      &lt;text x=&#34;335&#34; y=&#34;102&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;multishot â†’ picks buf&lt;/text&gt;
      &lt;text x=&#34;335&#34; y=&#34;120&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;from buf_ring (bgid=1)&lt;/text&gt;
      &lt;line x1=&#34;438&#34; y1=&#34;100&#34; x2=&#34;510&#34; y2=&#34;100&#34; stroke=&#34;#a06aff&#34; stroke-width=&#34;2.5&#34; marker-end=&#34;url(#arrowP)&#34;/&gt;
      &lt;rect x=&#34;515&#34; y=&#34;60&#34; width=&#34;160&#34; height=&#34;80&#34; rx=&#34;12&#34; fill=&#34;rgba(160,106,255,.1)&#34; stroke=&#34;#a06aff&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;595&#34; y=&#34;88&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#a06aff&#34; text-anchor=&#34;middle&#34;&gt;Buffer #7&lt;/text&gt;
      &lt;text x=&#34;595&#34; y=&#34;108&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;32KB pre-allocated&lt;/text&gt;
      &lt;text x=&#34;595&#34; y=&#34;126&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#a06aff&#34; text-anchor=&#34;middle&#34;&gt;filled: 1,420 bytes&lt;/text&gt;
      &lt;line x1=&#34;430&#34; y1=&#34;150&#34; x2=&#34;430&#34; y2=&#34;188&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;2.5&#34; marker-end=&#34;url(#arrowG)&#34;/&gt;
      &lt;rect x=&#34;240&#34; y=&#34;192&#34; width=&#34;380&#34; height=&#34;70&#34; rx=&#34;12&#34; fill=&#34;rgba(62,232,138,.06)&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;430&#34; y=&#34;215&#34; class=&#34;svg-text&#34; font-size=&#34;13&#34; font-weight=&#34;800&#34; fill=&#34;#3ee88a&#34; text-anchor=&#34;middle&#34;&gt;CQE produced&lt;/text&gt;
      &lt;text x=&#34;430&#34; y=&#34;237&#34; class=&#34;svg-mono&#34; font-size=&#34;11&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;user_data: [Recv | 42]   res: 1420   flags: (7 &amp;lt;&amp;lt; 16) | F_BUFFER | F_MORE&lt;/text&gt;
      &lt;text x=&#34;430&#34; y=&#34;255&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#555c73&#34; text-anchor=&#34;middle&#34;&gt;buffer_id=7 encoded in flags upper 16 bits â€¢ F_MORE means multishot continues&lt;/text&gt;
      &lt;rect x=&#34;690&#34; y=&#34;75&#34; width=&#34;140&#34; height=&#34;50&#34; rx=&#34;8&#34; fill=&#34;#181c25&#34; stroke=&#34;#ffd04a&#34; stroke-width=&#34;1.5&#34;/&gt;
      &lt;text x=&#34;760&#34; y=&#34;97&#34; class=&#34;svg-text&#34; font-size=&#34;10&#34; font-weight=&#34;700&#34; fill=&#34;#ffd04a&#34; text-anchor=&#34;middle&#34;&gt;Zero Copy&lt;/text&gt;
      &lt;text x=&#34;760&#34; y=&#34;112&#34; class=&#34;svg-mono&#34; font-size=&#34;8&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;NIC â†’ your buffer&lt;/text&gt;
    &lt;/svg&gt;
  &lt;/div&gt;
  &lt;!-- STEP 3 --&gt;
  &lt;div class=&#34;ff-panel&#34; id=&#34;ffP3&#34; style=&#34;display:none;&#34;&gt;
    &lt;svg viewBox=&#34;0 0 860 300&#34; class=&#34;ring-svg&#34;&gt;
      &lt;rect x=&#34;10&#34; y=&#34;10&#34; width=&#34;840&#34; height=&#34;280&#34; rx=&#34;14&#34; fill=&#34;rgba(62,232,208,.03)&#34; stroke=&#34;#3ee8d0&#34; stroke-width=&#34;1&#34; stroke-dasharray=&#34;5 3&#34; opacity=&#34;.35&#34;/&gt;
      &lt;text x=&#34;30&#34; y=&#34;34&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; font-weight=&#34;700&#34; fill=&#34;#3ee8d0&#34; opacity=&#34;.5&#34;&gt;REACTOR EVENT LOOP&lt;/text&gt;
      &lt;rect x=&#34;40&#34; y=&#34;60&#34; width=&#34;200&#34; height=&#34;70&#34; rx=&#34;10&#34; fill=&#34;#181c25&#34; stroke=&#34;#3ee8d0&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;140&#34; y=&#34;86&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#3ee8d0&#34; text-anchor=&#34;middle&#34;&gt;peek_batch_cqe&lt;/text&gt;
      &lt;text x=&#34;140&#34; y=&#34;108&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;got 3 CQEs&lt;/text&gt;
      &lt;line x1=&#34;244&#34; y1=&#34;95&#34; x2=&#34;300&#34; y2=&#34;95&#34; stroke=&#34;#3ee8d0&#34; stroke-width=&#34;2&#34; marker-end=&#34;url(#arrowB)&#34;/&gt;
      &lt;rect x=&#34;305&#34; y=&#34;60&#34; width=&#34;200&#34; height=&#34;70&#34; rx=&#34;10&#34; fill=&#34;#181c25&#34; stroke=&#34;#8a90a8&#34; stroke-width=&#34;1.5&#34;/&gt;
      &lt;text x=&#34;405&#34; y=&#34;84&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; text-anchor=&#34;middle&#34;&gt;Unpack user_data&lt;/text&gt;
      &lt;text x=&#34;405&#34; y=&#34;106&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;kind = UdKindOf(ud)&lt;/text&gt;
      &lt;text x=&#34;405&#34; y=&#34;120&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;fd   = UdFdOf(ud)&lt;/text&gt;
      &lt;line x1=&#34;405&#34; y1=&#34;134&#34; x2=&#34;140&#34; y2=&#34;190&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;2&#34; marker-end=&#34;url(#arrowG)&#34;/&gt;
      &lt;line x1=&#34;405&#34; y1=&#34;134&#34; x2=&#34;405&#34; y2=&#34;190&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;2&#34; marker-end=&#34;url(#arrowB)&#34;/&gt;
      &lt;line x1=&#34;405&#34; y1=&#34;134&#34; x2=&#34;670&#34; y2=&#34;190&#34; stroke=&#34;#ff4a5e&#34; stroke-width=&#34;2&#34; marker-end=&#34;url(#arrowB)&#34;/&gt;
      &lt;rect x=&#34;50&#34; y=&#34;195&#34; width=&#34;180&#34; height=&#34;75&#34; rx=&#34;10&#34; fill=&#34;rgba(62,232,138,.06)&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;140&#34; y=&#34;220&#34; class=&#34;svg-text&#34; font-size=&#34;13&#34; font-weight=&#34;800&#34; fill=&#34;#3ee88a&#34; text-anchor=&#34;middle&#34;&gt;Recv&lt;/text&gt;
      &lt;text x=&#34;140&#34; y=&#34;240&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;extract buffer_id&lt;/text&gt;
      &lt;text x=&#34;140&#34; y=&#34;256&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;enqueue to connection&lt;/text&gt;
      &lt;rect x=&#34;315&#34; y=&#34;195&#34; width=&#34;180&#34; height=&#34;75&#34; rx=&#34;10&#34; fill=&#34;rgba(74,144,255,.06)&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;405&#34; y=&#34;220&#34; class=&#34;svg-text&#34; font-size=&#34;13&#34; font-weight=&#34;800&#34; fill=&#34;#4a90ff&#34; text-anchor=&#34;middle&#34;&gt;Send&lt;/text&gt;
      &lt;text x=&#34;405&#34; y=&#34;240&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;update WriteHead += res&lt;/text&gt;
      &lt;text x=&#34;405&#34; y=&#34;256&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;complete flush if done&lt;/text&gt;
      &lt;rect x=&#34;580&#34; y=&#34;195&#34; width=&#34;180&#34; height=&#34;75&#34; rx=&#34;10&#34; fill=&#34;rgba(255,74,94,.06)&#34; stroke=&#34;#ff4a5e&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;670&#34; y=&#34;220&#34; class=&#34;svg-text&#34; font-size=&#34;13&#34; font-weight=&#34;800&#34; fill=&#34;#ff4a5e&#34; text-anchor=&#34;middle&#34;&gt;Cancel&lt;/text&gt;
      &lt;text x=&#34;670&#34; y=&#34;240&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;cleanup acknowledged&lt;/text&gt;
      &lt;text x=&#34;670&#34; y=&#34;256&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;nothing to do&lt;/text&gt;
    &lt;/svg&gt;
  &lt;/div&gt;
  &lt;!-- STEP 4 --&gt;
  &lt;div class=&#34;ff-panel&#34; id=&#34;ffP4&#34; style=&#34;display:none;&#34;&gt;
    &lt;svg viewBox=&#34;0 0 860 280&#34; class=&#34;ring-svg&#34;&gt;
      &lt;rect x=&#34;10&#34; y=&#34;10&#34; width=&#34;840&#34; height=&#34;260&#34; rx=&#34;14&#34; fill=&#34;rgba(62,232,208,.03)&#34; stroke=&#34;#3ee8d0&#34; stroke-width=&#34;1&#34; stroke-dasharray=&#34;5 3&#34; opacity=&#34;.35&#34;/&gt;
      &lt;text x=&#34;30&#34; y=&#34;34&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; font-weight=&#34;700&#34; fill=&#34;#3ee8d0&#34; opacity=&#34;.5&#34;&gt;CONNECTION READ PATH&lt;/text&gt;
      &lt;rect x=&#34;40&#34; y=&#34;70&#34; width=&#34;170&#34; height=&#34;80&#34; rx=&#34;10&#34; fill=&#34;rgba(62,232,138,.06)&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;125&#34; y=&#34;96&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#3ee88a&#34; text-anchor=&#34;middle&#34;&gt;Recv CQE&lt;/text&gt;
      &lt;text x=&#34;125&#34; y=&#34;116&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;buf_id=7, 1420B&lt;/text&gt;
      &lt;text x=&#34;125&#34; y=&#34;134&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#555c73&#34; text-anchor=&#34;middle&#34;&gt;ptr = slab + 7*32KB&lt;/text&gt;
      &lt;line x1=&#34;214&#34; y1=&#34;110&#34; x2=&#34;280&#34; y2=&#34;110&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;2&#34; marker-end=&#34;url(#arrowG)&#34;/&gt;
      &lt;rect x=&#34;285&#34; y=&#34;70&#34; width=&#34;180&#34; height=&#34;80&#34; rx=&#34;10&#34; fill=&#34;#181c25&#34; stroke=&#34;#a06aff&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;375&#34; y=&#34;96&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#a06aff&#34; text-anchor=&#34;middle&#34;&gt;MPSC Recv Ring&lt;/text&gt;
      &lt;text x=&#34;375&#34; y=&#34;116&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;EnqueueRingItem&lt;/text&gt;
      &lt;text x=&#34;375&#34; y=&#34;134&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#555c73&#34; text-anchor=&#34;middle&#34;&gt;(ptr, len, buf_id)&lt;/text&gt;
      &lt;line x1=&#34;469&#34; y1=&#34;110&#34; x2=&#34;535&#34; y2=&#34;110&#34; stroke=&#34;#3ee8d0&#34; stroke-width=&#34;2&#34; marker-end=&#34;url(#arrowB)&#34;/&gt;
      &lt;rect x=&#34;540&#34; y=&#34;60&#34; width=&#34;270&#34; height=&#34;100&#34; rx=&#34;12&#34; fill=&#34;rgba(62,232,208,.06)&#34; stroke=&#34;#3ee8d0&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;675&#34; y=&#34;90&#34; class=&#34;svg-text&#34; font-size=&#34;14&#34; font-weight=&#34;800&#34; fill=&#34;#3ee8d0&#34; text-anchor=&#34;middle&#34;&gt;ReadAsync() completes&lt;/text&gt;
      &lt;text x=&#34;675&#34; y=&#34;114&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;ValueTask signals your handler&lt;/text&gt;
      &lt;text x=&#34;675&#34; y=&#34;134&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;result.IsClosed = false&lt;/text&gt;
      &lt;text x=&#34;675&#34; y=&#34;150&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#3ee8d0&#34; text-anchor=&#34;middle&#34;&gt;zero allocation (ManualResetValueTaskSourceCore)&lt;/text&gt;
      &lt;text x=&#34;430&#34; y=&#34;210&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;The reactor enqueues the raw pointer + length + buffer_id into the connection&#39;s lock-free recv ring.&lt;/text&gt;
      &lt;text x=&#34;430&#34; y=&#34;230&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;Your await ReadAsync() resumes with zero allocations via ValueTask.&lt;/text&gt;
      &lt;text x=&#34;430&#34; y=&#34;252&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;You now have direct pointer access to the kernel-filled buffer. No copy happened.&lt;/text&gt;
    &lt;/svg&gt;
  &lt;/div&gt;
  &lt;!-- STEP 5 --&gt;
  &lt;div class=&#34;ff-panel&#34; id=&#34;ffP5&#34; style=&#34;display:none;&#34;&gt;
    &lt;svg viewBox=&#34;0 0 860 300&#34; class=&#34;ring-svg&#34;&gt;
      &lt;rect x=&#34;10&#34; y=&#34;10&#34; width=&#34;840&#34; height=&#34;280&#34; rx=&#34;14&#34; fill=&#34;rgba(62,232,208,.03)&#34; stroke=&#34;#3ee8d0&#34; stroke-width=&#34;1&#34; stroke-dasharray=&#34;5 3&#34; opacity=&#34;.35&#34;/&gt;
      &lt;text x=&#34;30&#34; y=&#34;34&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; font-weight=&#34;700&#34; fill=&#34;#3ee8d0&#34; opacity=&#34;.5&#34;&gt;YOUR APPLICATION HANDLER&lt;/text&gt;
      &lt;rect x=&#34;40&#34; y=&#34;60&#34; width=&#34;200&#34; height=&#34;100&#34; rx=&#34;10&#34; fill=&#34;#181c25&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;140&#34; y=&#34;86&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#3ee88a&#34; text-anchor=&#34;middle&#34;&gt;Read Buffers&lt;/text&gt;
      &lt;text x=&#34;140&#34; y=&#34;106&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#3ee8d0&#34; text-anchor=&#34;middle&#34;&gt;GetAllSnapshot&lt;/text&gt;
      &lt;text x=&#34;140&#34; y=&#34;122&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#3ee8d0&#34; text-anchor=&#34;middle&#34;&gt;RingsAsUnmanagedMemory&lt;/text&gt;
      &lt;text x=&#34;140&#34; y=&#34;142&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#555c73&#34; text-anchor=&#34;middle&#34;&gt;or ToReadOnlySequence()&lt;/text&gt;
      &lt;line x1=&#34;244&#34; y1=&#34;110&#34; x2=&#34;295&#34; y2=&#34;110&#34; stroke=&#34;#8a90a8&#34; stroke-width=&#34;2&#34; marker-end=&#34;url(#arrowB)&#34;/&gt;
      &lt;rect x=&#34;300&#34; y=&#34;70&#34; width=&#34;170&#34; height=&#34;80&#34; rx=&#34;10&#34; fill=&#34;#181c25&#34; stroke=&#34;#8a90a8&#34; stroke-width=&#34;1.5&#34;/&gt;
      &lt;text x=&#34;385&#34; y=&#34;100&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; text-anchor=&#34;middle&#34;&gt;Parse Request&lt;/text&gt;
      &lt;text x=&#34;385&#34; y=&#34;120&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;your business logic&lt;/text&gt;
      &lt;text x=&#34;385&#34; y=&#34;137&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#555c73&#34; text-anchor=&#34;middle&#34;&gt;HTTP parse, JSON, etc.&lt;/text&gt;
      &lt;line x1=&#34;474&#34; y1=&#34;110&#34; x2=&#34;525&#34; y2=&#34;110&#34; stroke=&#34;#8a90a8&#34; stroke-width=&#34;2&#34; marker-end=&#34;url(#arrowB)&#34;/&gt;
      &lt;rect x=&#34;530&#34; y=&#34;60&#34; width=&#34;280&#34; height=&#34;100&#34; rx=&#34;10&#34; fill=&#34;rgba(74,144,255,.06)&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;670&#34; y=&#34;86&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#4a90ff&#34; text-anchor=&#34;middle&#34;&gt;Write Response&lt;/text&gt;
      &lt;text x=&#34;670&#34; y=&#34;108&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#3ee8d0&#34; text-anchor=&#34;middle&#34;&gt;connection.Write(data)&lt;/text&gt;
      &lt;text x=&#34;670&#34; y=&#34;126&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;copies into 16KB staging slab&lt;/text&gt;
      &lt;text x=&#34;670&#34; y=&#34;146&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#555c73&#34; text-anchor=&#34;middle&#34;&gt;NativeMemory, no GC pressure&lt;/text&gt;
      &lt;line x1=&#34;670&#34; y1=&#34;164&#34; x2=&#34;670&#34; y2=&#34;200&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;2&#34; marker-end=&#34;url(#arrowB)&#34;/&gt;
      &lt;rect x=&#34;530&#34; y=&#34;205&#34; width=&#34;280&#34; height=&#34;60&#34; rx=&#34;10&#34; fill=&#34;rgba(74,144,255,.1)&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;670&#34; y=&#34;230&#34; class=&#34;svg-text&#34; font-size=&#34;13&#34; font-weight=&#34;800&#34; fill=&#34;#4a90ff&#34; text-anchor=&#34;middle&#34;&gt;await FlushAsync()&lt;/text&gt;
      &lt;text x=&#34;670&#34; y=&#34;250&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;queues send SQE for reactor&lt;/text&gt;
      &lt;text x=&#34;250&#34; y=&#34;230&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;Write() copies into the unmanaged staging buffer.&lt;/text&gt;
      &lt;text x=&#34;250&#34; y=&#34;250&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;FlushAsync() signals the reactor to submit a&lt;/text&gt;
      &lt;text x=&#34;250&#34; y=&#34;270&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;send SQE on the next loop iteration.&lt;/text&gt;
    &lt;/svg&gt;
  &lt;/div&gt;
  &lt;!-- STEP 6 --&gt;
  &lt;div class=&#34;ff-panel&#34; id=&#34;ffP6&#34; style=&#34;display:none;&#34;&gt;
    &lt;svg viewBox=&#34;0 0 860 280&#34; class=&#34;ring-svg&#34;&gt;
      &lt;rect x=&#34;10&#34; y=&#34;10&#34; width=&#34;420&#34; height=&#34;260&#34; rx=&#34;14&#34; fill=&#34;rgba(62,232,208,.03)&#34; stroke=&#34;#3ee8d0&#34; stroke-width=&#34;1&#34; stroke-dasharray=&#34;5 3&#34; opacity=&#34;.35&#34;/&gt;
      &lt;text x=&#34;30&#34; y=&#34;34&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; font-weight=&#34;700&#34; fill=&#34;#3ee8d0&#34; opacity=&#34;.5&#34;&gt;REACTOR&lt;/text&gt;
      &lt;rect x=&#34;440&#34; y=&#34;10&#34; width=&#34;410&#34; height=&#34;260&#34; rx=&#34;14&#34; fill=&#34;rgba(255,138,62,.03)&#34; stroke=&#34;#ff8a3e&#34; stroke-width=&#34;1&#34; stroke-dasharray=&#34;5 3&#34; opacity=&#34;.35&#34;/&gt;
      &lt;text x=&#34;460&#34; y=&#34;34&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; font-weight=&#34;700&#34; fill=&#34;#ff8a3e&#34; opacity=&#34;.5&#34;&gt;KERNEL&lt;/text&gt;
      &lt;rect x=&#34;40&#34; y=&#34;60&#34; width=&#34;180&#34; height=&#34;65&#34; rx=&#34;10&#34; fill=&#34;#181c25&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;130&#34; y=&#34;84&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; font-weight=&#34;700&#34; fill=&#34;#4a90ff&#34; text-anchor=&#34;middle&#34;&gt;Drain Flush Q&lt;/text&gt;
      &lt;text x=&#34;130&#34; y=&#34;104&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;prep_send(fd, buf, len)&lt;/text&gt;
      &lt;line x1=&#34;224&#34; y1=&#34;92&#34; x2=&#34;265&#34; y2=&#34;92&#34; stroke=&#34;#4a90ff&#34; stroke-width=&#34;2&#34; marker-end=&#34;url(#arrowB)&#34;/&gt;
      &lt;rect x=&#34;270&#34; y=&#34;60&#34; width=&#34;145&#34; height=&#34;65&#34; rx=&#34;10&#34; fill=&#34;rgba(62,232,208,.08)&#34; stroke=&#34;#3ee8d0&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;342&#34; y=&#34;82&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; font-weight=&#34;700&#34; fill=&#34;#3ee8d0&#34; text-anchor=&#34;middle&#34;&gt;submit_and&lt;/text&gt;
      &lt;text x=&#34;342&#34; y=&#34;98&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; font-weight=&#34;700&#34; fill=&#34;#3ee8d0&#34; text-anchor=&#34;middle&#34;&gt;_wait_timeout&lt;/text&gt;
      &lt;text x=&#34;342&#34; y=&#34;115&#34; class=&#34;svg-mono&#34; font-size=&#34;8&#34; fill=&#34;#555c73&#34; text-anchor=&#34;middle&#34;&gt;1 syscall&lt;/text&gt;
      &lt;line x1=&#34;418&#34; y1=&#34;92&#34; x2=&#34;475&#34; y2=&#34;92&#34; stroke=&#34;#ff8a3e&#34; stroke-width=&#34;2.5&#34; marker-end=&#34;url(#arrowO)&#34;/&gt;
      &lt;rect x=&#34;480&#34; y=&#34;55&#34; width=&#34;200&#34; height=&#34;80&#34; rx=&#34;12&#34; fill=&#34;rgba(255,138,62,.08)&#34; stroke=&#34;#ff8a3e&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;580&#34; y=&#34;82&#34; class=&#34;svg-text&#34; font-size=&#34;13&#34; font-weight=&#34;800&#34; fill=&#34;#ff8a3e&#34; text-anchor=&#34;middle&#34;&gt;Kernel send()&lt;/text&gt;
      &lt;text x=&#34;580&#34; y=&#34;102&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;staging buf â†’ TCP socket&lt;/text&gt;
      &lt;text x=&#34;580&#34; y=&#34;120&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;â†’ client receives data&lt;/text&gt;
      &lt;line x1=&#34;580&#34; y1=&#34;140&#34; x2=&#34;580&#34; y2=&#34;178&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;2&#34; marker-end=&#34;url(#arrowG)&#34;/&gt;
      &lt;rect x=&#34;475&#34; y=&#34;182&#34; width=&#34;210&#34; height=&#34;65&#34; rx=&#34;10&#34; fill=&#34;rgba(62,232,138,.06)&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;580&#34; y=&#34;208&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#3ee88a&#34; text-anchor=&#34;middle&#34;&gt;Send CQE&lt;/text&gt;
      &lt;text x=&#34;580&#34; y=&#34;228&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;res = bytes_sent&lt;/text&gt;
      &lt;text x=&#34;580&#34; y=&#34;240&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#3ee88a&#34; text-anchor=&#34;middle&#34;&gt;reactor: CompleteFlush()&lt;/text&gt;
      &lt;line x1=&#34;472&#34; y1=&#34;214&#34; x2=&#34;240&#34; y2=&#34;214&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;2&#34; marker-end=&#34;url(#arrowG)&#34;/&gt;
      &lt;rect x=&#34;40&#34; y=&#34;185&#34; width=&#34;196&#34; height=&#34;60&#34; rx=&#34;10&#34; fill=&#34;#181c25&#34; stroke=&#34;#3ee88a&#34; stroke-width=&#34;1.5&#34;/&gt;
      &lt;text x=&#34;138&#34; y=&#34;208&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; font-weight=&#34;700&#34; fill=&#34;#3ee88a&#34; text-anchor=&#34;middle&#34;&gt;FlushAsync returns&lt;/text&gt;
      &lt;text x=&#34;138&#34; y=&#34;228&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;your handler continues&lt;/text&gt;
    &lt;/svg&gt;
  &lt;/div&gt;
  &lt;!-- STEP 7 --&gt;
  &lt;div class=&#34;ff-panel&#34; id=&#34;ffP7&#34; style=&#34;display:none;&#34;&gt;
    &lt;svg viewBox=&#34;0 0 860 300&#34; class=&#34;ring-svg&#34;&gt;
      &lt;rect x=&#34;10&#34; y=&#34;10&#34; width=&#34;840&#34; height=&#34;280&#34; rx=&#34;14&#34; fill=&#34;rgba(160,106,255,.03)&#34; stroke=&#34;#a06aff&#34; stroke-width=&#34;1&#34; stroke-dasharray=&#34;5 3&#34; opacity=&#34;.35&#34;/&gt;
      &lt;text x=&#34;30&#34; y=&#34;34&#34; class=&#34;svg-text&#34; font-size=&#34;11&#34; font-weight=&#34;700&#34; fill=&#34;#a06aff&#34; opacity=&#34;.5&#34;&gt;BUFFER RECYCLING&lt;/text&gt;
      &lt;rect x=&#34;40&#34; y=&#34;65&#34; width=&#34;190&#34; height=&#34;80&#34; rx=&#34;10&#34; fill=&#34;#181c25&#34; stroke=&#34;#3ee8d0&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;135&#34; y=&#34;92&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#3ee8d0&#34; text-anchor=&#34;middle&#34;&gt;Your Handler&lt;/text&gt;
      &lt;text x=&#34;135&#34; y=&#34;112&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#3ee8d0&#34; text-anchor=&#34;middle&#34;&gt;ReturnRing(bid=7)&lt;/text&gt;
      &lt;text x=&#34;135&#34; y=&#34;130&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#3ee8d0&#34; text-anchor=&#34;middle&#34;&gt;ResetRead()&lt;/text&gt;
      &lt;line x1=&#34;234&#34; y1=&#34;105&#34; x2=&#34;290&#34; y2=&#34;105&#34; stroke=&#34;#a06aff&#34; stroke-width=&#34;2.5&#34; marker-end=&#34;url(#arrowP)&#34;/&gt;
      &lt;rect x=&#34;295&#34; y=&#34;70&#34; width=&#34;170&#34; height=&#34;70&#34; rx=&#34;10&#34; fill=&#34;#181c25&#34; stroke=&#34;#a06aff&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;380&#34; y=&#34;96&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#a06aff&#34; text-anchor=&#34;middle&#34;&gt;Return Queue&lt;/text&gt;
      &lt;text x=&#34;380&#34; y=&#34;118&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;MPSC enqueue(7)&lt;/text&gt;
      &lt;line x1=&#34;469&#34; y1=&#34;105&#34; x2=&#34;525&#34; y2=&#34;105&#34; stroke=&#34;#3ee8d0&#34; stroke-width=&#34;2.5&#34; marker-end=&#34;url(#arrowB)&#34;/&gt;
      &lt;rect x=&#34;530&#34; y=&#34;65&#34; width=&#34;175&#34; height=&#34;80&#34; rx=&#34;10&#34; fill=&#34;#181c25&#34; stroke=&#34;#3ee8d0&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;617&#34; y=&#34;92&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#3ee8d0&#34; text-anchor=&#34;middle&#34;&gt;Reactor drains&lt;/text&gt;
      &lt;text x=&#34;617&#34; y=&#34;112&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;DrainReturnQ()&lt;/text&gt;
      &lt;text x=&#34;617&#34; y=&#34;130&#34; class=&#34;svg-mono&#34; font-size=&#34;9&#34; fill=&#34;#555c73&#34; text-anchor=&#34;middle&#34;&gt;on next loop iter&lt;/text&gt;
      &lt;line x1=&#34;617&#34; y1=&#34;149&#34; x2=&#34;617&#34; y2=&#34;185&#34; stroke=&#34;#a06aff&#34; stroke-width=&#34;2.5&#34; marker-end=&#34;url(#arrowP)&#34;/&gt;
      &lt;rect x=&#34;440&#34; y=&#34;190&#34; width=&#34;360&#34; height=&#34;80&#34; rx=&#34;12&#34; fill=&#34;rgba(160,106,255,.06)&#34; stroke=&#34;#a06aff&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;620&#34; y=&#34;218&#34; class=&#34;svg-text&#34; font-size=&#34;13&#34; font-weight=&#34;800&#34; fill=&#34;#a06aff&#34; text-anchor=&#34;middle&#34;&gt;buf_ring_add + buf_ring_advance&lt;/text&gt;
      &lt;text x=&#34;620&#34; y=&#34;240&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;buffer #7 is back in the pool&lt;/text&gt;
      &lt;text x=&#34;620&#34; y=&#34;258&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;kernel can use it for the next recv&lt;/text&gt;
      &lt;rect x=&#34;40&#34; y=&#34;200&#34; width=&#34;230&#34; height=&#34;60&#34; rx=&#34;10&#34; fill=&#34;rgba(62,232,208,.06)&#34; stroke=&#34;#3ee8d0&#34; stroke-width=&#34;2&#34;/&gt;
      &lt;text x=&#34;155&#34; y=&#34;224&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#3ee8d0&#34; text-anchor=&#34;middle&#34;&gt;await ReadAsync()&lt;/text&gt;
      &lt;text x=&#34;155&#34; y=&#34;244&#34; class=&#34;svg-mono&#34; font-size=&#34;10&#34; fill=&#34;#8a90a8&#34; text-anchor=&#34;middle&#34;&gt;ready for next request&lt;/text&gt;
      &lt;text x=&#34;430&#34; y=&#34;290&#34; class=&#34;svg-text&#34; font-size=&#34;12&#34; font-weight=&#34;700&#34; fill=&#34;#3ee8d0&#34; text-anchor=&#34;middle&#34;&gt;â† Loop repeats. Zero allocations. 1 syscall per iteration. â†’&lt;/text&gt;
    &lt;/svg&gt;
  &lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;stepper&#34;&gt;
  &lt;button class=&#34;step-btn&#34; id=&#34;ffPrev&#34; onclick=&#34;ffStep(-1)&#34;&gt;&amp;#9664;&lt;/button&gt;
  &lt;div class=&#34;step-dots&#34; id=&#34;ffDots&#34;&gt;&lt;/div&gt;
  &lt;button class=&#34;step-btn&#34; id=&#34;ffNext&#34; onclick=&#34;ffStep(1)&#34;&gt;&amp;#9654;&lt;/button&gt;
&lt;/div&gt;
&lt;div class=&#34;step-desc&#34; id=&#34;ffDesc&#34;&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• FEATURES USED BY ZERG â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• --&gt;
&lt;div class=&#34;iu-section&#34;&gt;
&lt;h3&gt;Features Used by zerg&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;features-used-by-zerg&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#features-used-by-zerg&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;iu-cards&#34; style=&#34;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));&#34;&gt;
  &lt;div class=&#34;iu-card&#34;&gt;
    &lt;h4 style=&#34;color:#4a90ff;&#34;&gt;Multishot Accept&lt;/h4&gt;
    &lt;p&gt;A single SQE arms the kernel to produce one CQE per accepted connection indefinitely. The acceptor thread never re-arms. Each CQE contains the new client fd in &lt;code&gt;cqe-&gt;res&lt;/code&gt; and &lt;code&gt;IORING_CQE_F_MORE&lt;/code&gt; to indicate more will follow.&lt;/p&gt;
  &lt;/div&gt;
  &lt;div class=&#34;iu-card&#34;&gt;
    &lt;h4 style=&#34;color:#3ee88a;&#34;&gt;Multishot Recv + Buffer Selection&lt;/h4&gt;
    &lt;p&gt;A single SQE arms recv for a connection. Each time data arrives, the kernel picks a buffer from the buf_ring, fills it, and produces a CQE with the buffer ID in the flags. Eliminates per-recv buffer allocation.&lt;/p&gt;
  &lt;/div&gt;
  &lt;div class=&#34;iu-card&#34;&gt;
    &lt;h4 style=&#34;color:#a06aff;&#34;&gt;Buffer Rings (Provided Buffers)&lt;/h4&gt;
    &lt;p&gt;Pre-allocated buffer pool registered with the kernel via &lt;code&gt;shim_setup_buf_ring()&lt;/code&gt;. Buffers are added with &lt;code&gt;buf_ring_add()&lt;/code&gt; and recycled after use. See &lt;a href=&#34;../buffer-rings/&#34; style=&#34;color:#a06aff;&#34;&gt;Buffer Rings&lt;/a&gt; for the full lifecycle.&lt;/p&gt;
  &lt;/div&gt;
  &lt;div class=&#34;iu-card&#34;&gt;
    &lt;h4 style=&#34;color:#3ee8d0;&#34;&gt;SINGLE_ISSUER&lt;/h4&gt;
    &lt;p&gt;Tells the kernel only one thread submits to this ring. Skips SQ locking for better throughput. Matches zerg&#39;s model where each reactor is the sole submitter to its ring.&lt;/p&gt;
  &lt;/div&gt;
  &lt;div class=&#34;iu-card&#34;&gt;
    &lt;h4 style=&#34;color:#ff8a3e;&#34;&gt;DEFER_TASKRUN&lt;/h4&gt;
    &lt;p&gt;Defers kernel task_work until the next ring entry. Reduces latency spikes from interrupt-context work and makes completions arrive at predictable points for better async/await integration.&lt;/p&gt;
  &lt;/div&gt;
  &lt;div class=&#34;iu-card&#34;&gt;
    &lt;h4 style=&#34;color:#ffd04a;&#34;&gt;SQPOLL (Optional)&lt;/h4&gt;
    &lt;p&gt;Creates a kernel thread polling the SQ continuously, eliminating the &lt;code&gt;io_uring_enter()&lt;/code&gt; syscall. Trades a dedicated CPU core for the lowest possible submission latency.&lt;/p&gt;
  &lt;/div&gt;
  &lt;div class=&#34;iu-card&#34;&gt;
    &lt;h4 style=&#34;color:#ff6ab0;&#34;&gt;Submit-and-Wait&lt;/h4&gt;
    &lt;p&gt;zerg&#39;s reactor uses &lt;code&gt;shim_submit_and_wait_timeout()&lt;/code&gt; â€” a single syscall that submits all pending SQEs AND waits for at least one CQE. One syscall instead of two.&lt;/p&gt;
  &lt;/div&gt;
  &lt;div class=&#34;iu-card&#34;&gt;
    &lt;h4 style=&#34;color:#82aaff;&#34;&gt;CQE Batching&lt;/h4&gt;
    &lt;p&gt;Instead of one CQE at a time, the reactor peeks a batch with &lt;code&gt;shim_peek_batch_cqe()&lt;/code&gt; and processes all before advancing the CQ head. Amortizes the head update across completions.&lt;/p&gt;
  &lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;!-- /iouring-guide --&gt;
&lt;script&gt;
// Lifecycle stepper
const lcSteps = [
  { el: &#39;lc-s1&#39;, title: &#39;1. Get a free SQE slot&#39;, desc: &#39;Call &lt;code&gt;shim_get_sqe(ring)&lt;/code&gt; to grab an empty Submission Queue Entry from the ring. This is a userspace-only operation â€” no syscall. If the SQ is full, submit first to flush pending entries.&#39; },
  { el: &#39;lc-s2&#39;, title: &#39;2. Prepare the operation&#39;, desc: &#39;Fill the SQE with what you want: &lt;code&gt;shim_prep_recv_multishot_select(sqe, fd, bgid, 0)&lt;/code&gt;. This sets the opcode (RECV), the file descriptor, and enables buffer selection from the buf_ring.&#39; },
  { el: &#39;lc-s3&#39;, title: &#39;3. Attach your user_data&#39;, desc: &#39;Call &lt;code&gt;shim_sqe_set_data64(sqe, PackUd(Recv, fd))&lt;/code&gt;. This 64-bit tag will be returned verbatim in the CQE, so you can identify which operation completed and on which socket.&#39; },
  { el: &#39;lc-s4&#39;, title: &#39;4. Submit to kernel&#39;, desc: &#39;&lt;code&gt;shim_submit_and_wait_timeout(ring, &amp;amp;cqes, 1, &amp;amp;ts)&lt;/code&gt; â€” this single syscall flushes all queued SQEs AND waits for at least 1 completion. One syscall instead of two.&#39; },
  { el: &#39;lc-s5&#39;, title: &#39;5. Kernel processes the I/O&#39;, desc: &#39;The kernel sees your recv SQE, picks a buffer from the buf_ring, and when data arrives on the socket, fills that buffer. Zero-copy from NIC to your pre-allocated memory.&#39; },
  { el: &#39;lc-s6&#39;, title: &#39;6. CQE written to Completion Queue&#39;, desc: &#39;The kernel writes a CQE containing your &lt;code&gt;user_data&lt;/code&gt;, &lt;code&gt;res&lt;/code&gt; (bytes received), and &lt;code&gt;flags&lt;/code&gt; (including the buffer_id in the upper 16 bits and the F_MORE flag).&#39; },
  { el: &#39;lc-s7&#39;, title: &#39;7. App reads and dispatches CQE&#39;, desc: &#39;Your app calls &lt;code&gt;shim_peek_batch_cqe()&lt;/code&gt; to grab all available CQEs. Unpack &lt;code&gt;user_data&lt;/code&gt; to determine UdKind (Recv/Send/Cancel) and the fd. Process the result.&#39; },
  { el: &#39;lc-s8&#39;, title: &#39;8. Advance the CQ head&#39;, desc: &#39;Call &lt;code&gt;shim_cq_advance(ring, count)&lt;/code&gt; to mark all processed CQEs as consumed. This is a single userspace write to the ring head pointer â€” no syscall needed.&#39; },
];
let lcCur = -1;
function lcBuildDots() {
  const c = document.getElementById(&#39;lcDots&#39;);
  lcSteps.forEach((_, i) =&gt; { const d = document.createElement(&#39;div&#39;); d.className = &#39;step-dot&#39;; d.onclick = () =&gt; lcGoTo(i); c.appendChild(d); });
}
lcBuildDots();
function lcGoTo(idx) {
  lcCur = idx;
  lcSteps.forEach((s, i) =&gt; { const el = document.getElementById(s.el); if (i &lt;= idx) el.classList.add(&#39;show&#39;); else el.classList.remove(&#39;show&#39;); });
  document.querySelectorAll(&#39;#lcDots .step-dot&#39;).forEach((d, i) =&gt; { d.classList.remove(&#39;active&#39;,&#39;done&#39;); if (i &lt; idx) d.classList.add(&#39;done&#39;); if (i === idx) d.classList.add(&#39;active&#39;); });
  document.getElementById(&#39;lcDesc&#39;).innerHTML = &#39;&lt;h4&gt;&lt;span style=&#34;color:#3ee8d0;&#34;&gt;&#39;+lcSteps[idx].title+&#39;&lt;/span&gt;&lt;/h4&gt;&lt;p&gt;&#39;+lcSteps[idx].desc+&#39;&lt;/p&gt;&#39;;
  document.getElementById(&#39;lcPrev&#39;).disabled = idx &lt;= 0;
  document.getElementById(&#39;lcNext&#39;).disabled = idx &gt;= lcSteps.length - 1;
}
function lcStep(dir) { const n = lcCur + dir; if (n &gt;= 0 &amp;&amp; n &lt; lcSteps.length) lcGoTo(n); }
lcGoTo(0);

// Full flow stepper
const ffSteps = [
  { panel:&#39;ffP0&#39;, title:&#39;Phase 1 â€” Client Connects&#39;, desc:&#39;A client sends a TCP SYN. The kernel\&#39;s multishot accept (armed once at startup) produces a CQE with the new file descriptor. The acceptor never re-submits â€” F_MORE keeps it armed. The fd is round-robin\&#39;d to a reactor.&#39;, color:&#39;#4a90ff&#39; },
  { panel:&#39;ffP1&#39;, title:&#39;Phase 2 â€” FD Handed to Reactor&#39;, desc:&#39;The acceptor pushes the fd into the reactor\&#39;s lock-free MPSC queue. The reactor dequeues it, creates a pooled Connection object, and arms &lt;code&gt;recv_multishot&lt;/code&gt; with buffer selection. From now on, only this reactor touches this fd â€” zero contention.&#39;, color:&#39;#3ee8d0&#39; },
  { panel:&#39;ffP2&#39;, title:&#39;Phase 3 â€” Data Arrives&#39;, desc:&#39;The client sends data. The kernel\&#39;s multishot recv automatically picks a buffer from the buf_ring, fills it, and writes a CQE. The buffer_id is encoded in the upper 16 bits of &lt;code&gt;cqe.flags&lt;/code&gt;. Your pre-allocated memory was filled directly â€” zero copy.&#39;, color:&#39;#ff8a3e&#39; },
  { panel:&#39;ffP3&#39;, title:&#39;Phase 4 â€” CQE Dispatch&#39;, desc:&#39;The reactor calls &lt;code&gt;peek_batch_cqe()&lt;/code&gt; to grab all available completions. For each CQE, it unpacks &lt;code&gt;user_data&lt;/code&gt; into UdKind + fd and dispatches: &lt;b style=&#34;color:#3ee88a&#34;&gt;Recv&lt;/b&gt; = enqueue to connection, &lt;b style=&#34;color:#4a90ff&#34;&gt;Send&lt;/b&gt; = complete flush, &lt;b style=&#34;color:#ff4a5e&#34;&gt;Cancel&lt;/b&gt; = cleanup.&#39;, color:&#39;#3ee88a&#39; },
  { panel:&#39;ffP4&#39;, title:&#39;Phase 5 â€” ReadAsync Completes&#39;, desc:&#39;The recv data (raw pointer + length + buffer_id) is enqueued into the connection\&#39;s MPSC recv ring. This signals the &lt;code&gt;ManualResetValueTaskSourceCore&lt;/code&gt;, completing your &lt;code&gt;await ReadAsync()&lt;/code&gt; with zero allocation. You now have direct pointer access to the kernel-filled buffer.&#39;, color:&#39;#3ee8d0&#39; },
  { panel:&#39;ffP5&#39;, title:&#39;Phase 6 â€” Process + Write Response&#39;, desc:&#39;Your handler reads the buffers via &lt;code&gt;GetAllSnapshotRingsAsUnmanagedMemory()&lt;/code&gt; or &lt;code&gt;ToReadOnlySequence()&lt;/code&gt;. After processing, call &lt;code&gt;connection.Write(data)&lt;/code&gt; to copy into the unmanaged staging slab, then &lt;code&gt;FlushAsync()&lt;/code&gt; to signal the reactor to send.&#39;, color:&#39;#4a90ff&#39; },
  { panel:&#39;ffP6&#39;, title:&#39;Phase 7 â€” Reactor Sends Response&#39;, desc:&#39;On the next loop iteration, the reactor drains the flush queue, builds a send SQE, and fires &lt;code&gt;submit_and_wait_timeout&lt;/code&gt; â€” one syscall for all pending work. The kernel delivers the response to the client. The send CQE completes your &lt;code&gt;FlushAsync()&lt;/code&gt;.&#39;, color:&#39;#ff8a3e&#39; },
  { panel:&#39;ffP7&#39;, title:&#39;Phase 8 â€” Buffer Recycle + Loop&#39;, desc:&#39;Your handler calls &lt;code&gt;ReturnRing(bid)&lt;/code&gt; to recycle the buffer, then &lt;code&gt;ResetRead()&lt;/code&gt;. The reactor drains the return queue and calls &lt;code&gt;buf_ring_add + buf_ring_advance&lt;/code&gt; to give the buffer back to the kernel. Then &lt;code&gt;await ReadAsync()&lt;/code&gt; again. The loop repeats with zero allocations.&#39;, color:&#39;#a06aff&#39; },
];
let ffCur = -1;
function ffBuildDots() {
  const c = document.getElementById(&#39;ffDots&#39;);
  ffSteps.forEach((_, i) =&gt; { const d = document.createElement(&#39;div&#39;); d.className = &#39;step-dot&#39;; d.onclick = () =&gt; ffGoTo(i); c.appendChild(d); });
}
ffBuildDots();
function ffGoTo(idx) {
  ffCur = idx;
  ffSteps.forEach((s, i) =&gt; { const el = document.getElementById(s.panel); if (i === idx) { el.style.display=&#39;&#39;; el.style.animation=&#39;none&#39;; el.offsetHeight; el.style.animation=&#39;&#39;; } else el.style.display=&#39;none&#39;; });
  document.querySelectorAll(&#39;#ffDots .step-dot&#39;).forEach((d, i) =&gt; { d.classList.remove(&#39;active&#39;,&#39;done&#39;); if (i &lt; idx) d.classList.add(&#39;done&#39;); if (i === idx) d.classList.add(&#39;active&#39;); });
  ffSteps.forEach((s, i) =&gt; { const seg = document.getElementById(&#39;ffSeg&#39;+i); if (i &lt; idx) seg.style.background=&#39;#555c73&#39;; else if (i === idx) seg.style.background=s.color; else seg.style.background=&#39;&#39;; });
  document.getElementById(&#39;ffDesc&#39;).innerHTML = &#39;&lt;h4&gt;&lt;span style=&#34;color:&#39;+ffSteps[idx].color+&#39;;&#34;&gt;&#39;+ffSteps[idx].title+&#39;&lt;/span&gt;&lt;/h4&gt;&lt;p&gt;&#39;+ffSteps[idx].desc+&#39;&lt;/p&gt;&#39;;
  document.getElementById(&#39;ffPrev&#39;).disabled = idx &lt;= 0;
  document.getElementById(&#39;ffNext&#39;).disabled = idx &gt;= ffSteps.length - 1;
}
function ffStep(dir) { const n = ffCur + dir; if (n &gt;= 0 &amp;&amp; n &lt; ffSteps.length) ffGoTo(n); }
ffGoTo(0);
&lt;/script&gt;

      </description>
    </item>
    
    <item>
      <title>MPSC Queues</title>
      <link>http://localhost:1313/zerg/docs/internals/mpsc-queues/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>http://localhost:1313/zerg/docs/internals/mpsc-queues/</guid>
      <description>
        
        
        &lt;p&gt;zerg uses three MPSC (multi-producer, single-consumer) queue implementations for cross-thread communication where multiple handler threads need to send messages to a single reactor thread.&lt;/p&gt;
&lt;h2&gt;Overview&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;overview&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#overview&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;Queue&lt;/th&gt;
          &lt;th&gt;Item Type&lt;/th&gt;
          &lt;th&gt;Used For&lt;/th&gt;
          &lt;th&gt;Algorithm&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;MpscUshortQueue&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;ushort&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Buffer ID returns&lt;/td&gt;
          &lt;td&gt;Sequence-per-slot (Vyukov variant)&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;MpscIntQueue&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;int&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Flush requests (client fds)&lt;/td&gt;
          &lt;td&gt;Sequence-per-slot (Vyukov)&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;MpscRecvRing&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;RingItem&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Multi-producer recv enqueue&lt;/td&gt;
          &lt;td&gt;Interlocked tail increment&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;MpscWriteItem&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;WriteItem&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Write item queue&lt;/td&gt;
          &lt;td&gt;Interlocked tail increment&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h2&gt;MpscUshortQueue&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;mpscushortqueue&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#mpscushortqueue&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;Used by handlers to return buffer IDs to the reactor after processing received data.&lt;/p&gt;
&lt;h3&gt;Design&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;design&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#design&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;sealed&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;MpscUshortQueue&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_capacity&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;         &lt;span class=&#34;c1&#34;&gt;// power of 2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_mask&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;             &lt;span class=&#34;c1&#34;&gt;// capacity - 1&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;long&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_seq&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;           &lt;span class=&#34;c1&#34;&gt;// per-slot sequence numbers&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;ushort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;        &lt;span class=&#34;c1&#34;&gt;// actual values&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;long&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_tail&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;            &lt;span class=&#34;c1&#34;&gt;// producer position (contended)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;long&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_head&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;            &lt;span class=&#34;c1&#34;&gt;// consumer position (single reader)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h3&gt;Algorithm: Sequence-Per-Slot&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;algorithm-sequence-per-slot&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#algorithm-sequence-per-slot&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;This implements a variant of Dmitry Vyukov&amp;rsquo;s bounded MPSC queue. Each slot has a sequence number that coordinates ownership between producers and the consumer.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Producer (&lt;code&gt;TryEnqueue&lt;/code&gt;):&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;1. ticket = Interlocked.Increment(ref _tail) - 1    // reserve unique slot
2. idx = ticket &amp;amp; _mask                               // compute array index
3. if _seq[idx] != ticket: return false               // slot not ready (full)
4. _data[idx] = value                                 // store value
5. Volatile.Write(ref _seq[idx], ticket &amp;#43; 1)          // publish (release)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;The key insight: each producer gets a unique ticket via &lt;code&gt;Interlocked.Increment&lt;/code&gt;. If the slot&amp;rsquo;s sequence matches the ticket, the slot is free. After storing the value, the producer advances the sequence by 1 to signal &amp;ldquo;ready for consumption.&amp;rdquo;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Consumer (&lt;code&gt;TryDequeue&lt;/code&gt;):&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;1. head = _head                                       // plain read (single consumer)
2. idx = head &amp;amp; _mask
3. if _seq[idx] != head &amp;#43; 1: return false             // not ready yet
4. value = _data[idx]                                 // extract value
5. Volatile.Write(ref _seq[idx], head &amp;#43; _capacity)    // mark free for next wrap
6. _head = head &amp;#43; 1                                   // advance (plain write)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;The consumer checks if the sequence is &lt;code&gt;head + 1&lt;/code&gt; (one ahead of its position, meaning a producer has filled it). After reading, it resets the sequence to &lt;code&gt;head + capacity&lt;/code&gt; so the slot is ready for the next cycle.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Blocking variant (&lt;code&gt;EnqueueSpin&lt;/code&gt;):&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EnqueueSpin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;ushort&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Spins with &lt;code&gt;SpinWait&lt;/code&gt; backoff until &lt;code&gt;TryEnqueue&lt;/code&gt; succeeds. Used when buffer returns must not be dropped.&lt;/p&gt;
&lt;h3&gt;Drain&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;drain&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#drain&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Drain&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Action&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;ushort&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;consume&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;max&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;MaxValue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Dequeues up to &lt;code&gt;max&lt;/code&gt; items, calling the action for each. Returns count drained.&lt;/p&gt;
&lt;h2&gt;MpscIntQueue&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;mpscintqueue&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#mpscintqueue&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;Same algorithm as &lt;code&gt;MpscUshortQueue&lt;/code&gt;, but stores &lt;code&gt;int&lt;/code&gt; values. Used for flush requests (handler enqueues &lt;code&gt;clientFd&lt;/code&gt; to the reactor&amp;rsquo;s flush queue).&lt;/p&gt;
&lt;h3&gt;Structure&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;structure&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#structure&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;sealed&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;MpscIntQueue&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;    [StructLayout(LayoutKind.Explicit, Size = 64)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;PaddedLong&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;FieldOffset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)]&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;long&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;Cell&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;long&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Sequence&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Cell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PaddedLong&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_enqueuePos&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;   &lt;span class=&#34;c1&#34;&gt;// 64-byte padded to prevent false sharing&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PaddedLong&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_dequeuePos&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;   &lt;span class=&#34;c1&#34;&gt;// 64-byte padded to prevent false sharing&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;The &lt;code&gt;PaddedLong&lt;/code&gt; struct ensures the enqueue and dequeue positions are on separate cache lines (64 bytes), preventing false sharing between producer and consumer threads.&lt;/p&gt;
&lt;h3&gt;API&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;api&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#api&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;TryEnqueue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;item&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;     &lt;span class=&#34;c1&#34;&gt;// CAS-based multi-producer enqueue&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;TryDequeue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;out&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;item&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// single-consumer dequeue&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;CountApprox&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;      &lt;span class=&#34;c1&#34;&gt;// approximate queue depth&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;The &lt;code&gt;TryEnqueue&lt;/code&gt; implementation uses &lt;code&gt;Interlocked.CompareExchange&lt;/code&gt; in a loop to claim a slot, making it lock-free but not wait-free under contention.&lt;/p&gt;
&lt;h2&gt;MpscRecvRing&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;mpscrecvring&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#mpscrecvring&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;A simpler MPSC ring buffer using &lt;code&gt;Interlocked.Increment&lt;/code&gt; for slot reservation. Used when multiple producers need to enqueue &lt;code&gt;RingItem&lt;/code&gt; structs.&lt;/p&gt;
&lt;h3&gt;Design&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;design-1&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#design-1&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;sealed&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;unsafe&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;MpscRecvRing&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RingItem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_items&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_mask&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;long&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_tail&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// producers: Interlocked.Increment&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;long&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_head&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// consumer: plain read/write&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h3&gt;Algorithm: Interlocked Tail&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;algorithm-interlocked-tail&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#algorithm-interlocked-tail&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;Producer:
1. Volatile read head and tail for fast full-check
2. slot = Interlocked.Increment(ref _tail) - 1   // full fence, reserve slot
3. _items[slot &amp;amp; _mask] = item                     // store
4. return true

Consumer:
1. snapshot = Volatile.Read(ref _tail)
2. while _head &amp;lt; snapshot:
     item = _items[_head &amp;amp; _mask]
     _head&amp;#43;&amp;#43;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;This is simpler than the sequence-per-slot algorithm: producers just increment the tail atomically, and the consumer trusts the tail as an upper bound.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Trade-off:&lt;/strong&gt; There&amp;rsquo;s a small window where &lt;code&gt;_tail&lt;/code&gt; has been incremented but the item isn&amp;rsquo;t stored yet. The consumer relies on the &lt;code&gt;SnapshotTail()&lt;/code&gt; / &lt;code&gt;TryDequeueUntil()&lt;/code&gt; pattern to avoid reading partially-written slots.&lt;/p&gt;
&lt;h3&gt;API&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;api-1&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#api-1&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;TryEnqueue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RingItem&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;item&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;long&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;SnapshotTail&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;TryDequeueUntil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;long&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;tailSnapshot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;out&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RingItem&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;item&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RingItem&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;DequeueSingle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;IsEmpty&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Clear&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2&gt;MpscWriteItem&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;mpscwriteitem&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#mpscwriteitem&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;Same structure as &lt;code&gt;MpscRecvRing&lt;/code&gt; but stores &lt;code&gt;WriteItem&lt;/code&gt; structs (buffer + client fd pairs).&lt;/p&gt;
&lt;h2&gt;Choosing Between Algorithms&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;choosing-between-algorithms&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#choosing-between-algorithms&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;Algorithm&lt;/th&gt;
          &lt;th&gt;Pros&lt;/th&gt;
          &lt;th&gt;Cons&lt;/th&gt;
          &lt;th&gt;Used When&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;Sequence-per-slot (Vyukov)&lt;/td&gt;
          &lt;td&gt;No torn reads, exact capacity&lt;/td&gt;
          &lt;td&gt;CAS contention under high producer count&lt;/td&gt;
          &lt;td&gt;Small value types (&lt;code&gt;ushort&lt;/code&gt;, &lt;code&gt;int&lt;/code&gt;)&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Interlocked tail&lt;/td&gt;
          &lt;td&gt;Simpler, faster under low contention&lt;/td&gt;
          &lt;td&gt;Small visibility window&lt;/td&gt;
          &lt;td&gt;Struct items (&lt;code&gt;RingItem&lt;/code&gt;, &lt;code&gt;WriteItem&lt;/code&gt;)&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h2&gt;Cache Line Considerations&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;cache-line-considerations&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#cache-line-considerations&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;The &lt;code&gt;MpscIntQueue&lt;/code&gt; pads both &lt;code&gt;_enqueuePos&lt;/code&gt; and &lt;code&gt;_dequeuePos&lt;/code&gt; to 64 bytes to prevent false sharing. When a producer writes to &lt;code&gt;_enqueuePos&lt;/code&gt; and the consumer reads &lt;code&gt;_dequeuePos&lt;/code&gt;, they should be on different cache lines to avoid invalidation traffic.&lt;/p&gt;
&lt;p&gt;The ring-based MPSC queues (&lt;code&gt;MpscRecvRing&lt;/code&gt;, &lt;code&gt;MpscWriteItem&lt;/code&gt;) don&amp;rsquo;t pad their head/tail fields separately, relying on the item array itself to provide spatial separation.&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Quick Start</title>
      <link>http://localhost:1313/zerg/docs/getting-started/quick-start/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>http://localhost:1313/zerg/docs/getting-started/quick-start/</guid>
      <description>
        
        
        &lt;p&gt;This guide shows you how to create a minimal TCP server with zerg, accept connections, read data, and send a response.&lt;/p&gt;
&lt;h2&gt;Minimal Server&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;minimal-server&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#minimal-server&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;using&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;zerg.Engine&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;using&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;zerg.Engine.Configs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// 1. Create the engine with configuration&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;engine&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Engine&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EngineOptions&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;Port&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;8080&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;ReactorCount&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Environment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ProcessorCount&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;});&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// 2. Start listening -- spawns acceptor + reactor threads&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;engine&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Listen&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// 3. Graceful shutdown on Enter key&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cts&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;CancellationTokenSource&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;_&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Task&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Run&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;Console&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ReadLine&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;engine&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Stop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;cts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Cancel&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;});&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// 4. Accept loop&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;try&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;engine&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ServerRunning&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;kt&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;await&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;engine&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;AcceptAsync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cts&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Token&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;is&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;// Fire-and-forget handler per connection&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;_&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;HandleConnectionAsync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;catch&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;OperationCanceledException&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;Console&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;WriteLine&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Server stopped.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2&gt;Connection Handler&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;connection-handler&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#connection-handler&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;Each accepted connection gives you a &lt;code&gt;Connection&lt;/code&gt; object. The read/write cycle follows this pattern:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ReadAsync&lt;/strong&gt; &amp;ndash; wait for inbound data&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Process&lt;/strong&gt; &amp;ndash; inspect received buffers&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ReturnRing&lt;/strong&gt; &amp;ndash; return kernel buffers after processing&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Write&lt;/strong&gt; &amp;ndash; stage response bytes&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;FlushAsync&lt;/strong&gt; &amp;ndash; send staged bytes to the kernel&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ResetRead&lt;/strong&gt; &amp;ndash; prepare for the next read cycle&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;async&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Task&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;HandleConnectionAsync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Connection&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;// Wait for data from the client&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;kt&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;await&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ReadAsync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;IsClosed&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;k&#34;&gt;break&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;// Get all received buffers as managed memory&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;kt&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;rings&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;GetAllSnapshotRingsAsUnmanagedMemory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;// Build a ReadOnlySequence for parsing&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;ReadOnlySequence&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;sequence&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;rings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ToReadOnlySequence&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;// ... parse the request from sequence ...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;// Return buffers to the kernel buffer ring&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;rings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ReturnRingBuffers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Reactor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;// Write a response&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Write&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;HTTP/1.1 200 OK\r\nContent-Length: 13\r\nContent-Type: text/plain\r\n\r\nHello, World!&amp;#34;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;u8&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;// Flush to kernel and wait for send completion&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;await&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;FlushAsync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;// Ready for the next read&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ResetRead&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2&gt;What Happens Under the Hood&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;what-happens-under-the-hood&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#what-happens-under-the-hood&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;When you call &lt;code&gt;engine.Listen()&lt;/code&gt;:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;An &lt;strong&gt;acceptor thread&lt;/strong&gt; starts with its own &lt;code&gt;io_uring&lt;/code&gt; instance and arms multishot accept on the listening socket&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;N reactor threads&lt;/strong&gt; start, each with their own &lt;code&gt;io_uring&lt;/code&gt; instance and pre-allocated buffer ring&lt;/li&gt;
&lt;li&gt;As clients connect, the acceptor distributes file descriptors to reactors in round-robin order&lt;/li&gt;
&lt;li&gt;Each reactor arms multishot recv with buffer selection for its connections&lt;/li&gt;
&lt;li&gt;&lt;code&gt;AcceptAsync&lt;/code&gt; returns connections as they are fully registered in a reactor&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;When you call &lt;code&gt;connection.ReadAsync()&lt;/code&gt;:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;If data is already queued in the connection&amp;rsquo;s SPSC ring, it returns immediately&lt;/li&gt;
&lt;li&gt;Otherwise, the calling task parks until the reactor delivers data via a CQE completion&lt;/li&gt;
&lt;li&gt;The returned &lt;code&gt;ReadResult&lt;/code&gt; contains a snapshot boundary so you drain exactly the data that was available at that point&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;When you call &lt;code&gt;connection.FlushAsync()&lt;/code&gt;:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;The write tail is captured as the flush target&lt;/li&gt;
&lt;li&gt;The connection is enqueued to the reactor&amp;rsquo;s flush queue&lt;/li&gt;
&lt;li&gt;The reactor issues a &lt;code&gt;send&lt;/code&gt; SQE and handles partial sends automatically&lt;/li&gt;
&lt;li&gt;The &lt;code&gt;ValueTask&lt;/code&gt; completes when all staged bytes have been sent&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;Next Steps&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;next-steps&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#next-steps&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;../configuration/&#34;&gt;Configuration&lt;/a&gt; &amp;ndash; tune buffer sizes, reactor count, and ring flags&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;../../architecture/reactor-pattern/&#34;&gt;Architecture&lt;/a&gt; &amp;ndash; understand the acceptor + reactor model&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;../../guides/zero-allocation/&#34;&gt;Zero-Allocation Guide&lt;/a&gt; &amp;ndash; allocation-free read and write patterns&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
    <item>
      <title>Buffer Management</title>
      <link>http://localhost:1313/zerg/docs/guides/buffer-management/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>http://localhost:1313/zerg/docs/guides/buffer-management/</guid>
      <description>
        
        
        &lt;p&gt;Correct buffer management is critical in zerg. Kernel-provided buffers are a finite pool &amp;ndash; leaking them will stall your server. This guide covers the buffer lifecycle, ownership rules, and common pitfalls.&lt;/p&gt;
&lt;h2&gt;Buffer Ownership Model&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;buffer-ownership-model&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#buffer-ownership-model&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;Every buffer in zerg has exactly one owner at any time:&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;Kernel (buffer ring) â†’ Reactor (CQE) â†’ Connection (SPSC ring) â†’ Handler â†’ Return â†’ Kernel&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;State&lt;/th&gt;
          &lt;th&gt;Owner&lt;/th&gt;
          &lt;th&gt;What You Can Do&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;In buffer ring&lt;/td&gt;
          &lt;td&gt;Kernel&lt;/td&gt;
          &lt;td&gt;Nothing &amp;ndash; kernel picks buffers for recv&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;CQE delivered&lt;/td&gt;
          &lt;td&gt;Reactor&lt;/td&gt;
          &lt;td&gt;Reactor creates &lt;code&gt;RingItem&lt;/code&gt;, enqueues to connection&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;In SPSC ring&lt;/td&gt;
          &lt;td&gt;Connection&lt;/td&gt;
          &lt;td&gt;Waiting to be drained by handler&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Dequeued&lt;/td&gt;
          &lt;td&gt;Handler&lt;/td&gt;
          &lt;td&gt;Read &lt;code&gt;Ptr&lt;/code&gt;/&lt;code&gt;AsSpan()&lt;/code&gt;. Must return when done.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Returned&lt;/td&gt;
          &lt;td&gt;Kernel&lt;/td&gt;
          &lt;td&gt;Buffer back in pool. All pointers are invalid.&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h2&gt;The Golden Rule&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;the-golden-rule&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#the-golden-rule&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;Every buffer obtained from the connection must be returned exactly once.&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Correct: obtain and return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TryGetRing&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TailSnapshot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;out&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RingItem&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ring&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;ProcessData&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ring&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;AsSpan&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;());&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ReturnRing&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ring&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;BufferId&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// MUST call this&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Also correct: batch obtain and return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;rings&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;GetAllSnapshotRingsAsUnmanagedMemory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// ... process ...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;rings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ReturnRingBuffers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Reactor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// returns all at once&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2&gt;Common Mistakes&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;common-mistakes&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#common-mistakes&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;h3&gt;Forgetting to Return on Error&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;forgetting-to-return-on-error&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#forgetting-to-return-on-error&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// BAD: buffer leaked on exception&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TryGetRing&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TailSnapshot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;out&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RingItem&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ring&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;ProcessData&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ring&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;AsSpan&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;());&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// throws!&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ReturnRing&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ring&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;BufferId&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// never reached&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// GOOD: return in finally&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TryGetRing&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TailSnapshot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;out&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RingItem&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ring&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;try&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;ProcessData&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ring&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;AsSpan&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;());&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;finally&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ReturnRing&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ring&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;BufferId&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h3&gt;Using a Buffer After Return&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;using-a-buffer-after-return&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#using-a-buffer-after-return&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// BAD: use-after-return&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TryGetRing&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TailSnapshot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;out&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RingItem&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ring&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ReturnRing&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ring&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;BufferId&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;data&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ring&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;AsSpan&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// UNSAFE: kernel may have reused the buffer&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// GOOD: copy first if needed&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TryGetRing&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TailSnapshot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;out&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RingItem&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ring&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;copy&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ring&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;AsSpan&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ToArray&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// copy to managed memory&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ReturnRing&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ring&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;BufferId&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ProcessLater&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;copy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// safe: data is in managed memory&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h3&gt;Holding Buffers Too Long&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;holding-buffers-too-long&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#holding-buffers-too-long&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// BAD: holding buffer during async operation&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TryGetRing&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TailSnapshot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;out&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RingItem&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ring&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;await&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;SomeDatabaseCallAsync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ring&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;AsSpan&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;());&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// buffer held during I/O&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ReturnRing&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ring&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;BufferId&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// GOOD: copy what you need, return immediately&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TryGetRing&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TailSnapshot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;out&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RingItem&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ring&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;requestData&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ring&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;AsSpan&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ToArray&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// or parse inline&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ReturnRing&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ring&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;BufferId&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// return immediately&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;await&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;SomeDatabaseCallAsync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;requestData&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2&gt;Return Path Internals&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;return-path-internals&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#return-path-internals&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;When you call &lt;code&gt;connection.ReturnRing(bufferId)&lt;/code&gt;:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;The &lt;code&gt;ushort&lt;/code&gt; buffer ID is enqueued to the reactor&amp;rsquo;s MPSC return queue&lt;/li&gt;
&lt;li&gt;On the reactor&amp;rsquo;s next loop iteration, it drains the return queue&lt;/li&gt;
&lt;li&gt;For each returned buffer ID:
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nf&#34;&gt;shim_buf_ring_add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;br&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;slab&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bufferId&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bufSize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bufSize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bufferId&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;mask&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;idx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;After processing all returns: &lt;code&gt;shim_buf_ring_advance(br, count)&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;The kernel can now use these buffers for future recv operations&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;The return is &lt;strong&gt;not immediate&lt;/strong&gt; &amp;ndash; there&amp;rsquo;s a small delay (one reactor loop iteration) before the kernel can reuse the buffer. This is safe because the buffer ring has thousands of buffers.&lt;/p&gt;
&lt;h2&gt;Buffer Pool Exhaustion&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;buffer-pool-exhaustion&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#buffer-pool-exhaustion&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;If all buffers are in-flight (held by the kernel or handlers):&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;New recv operations have no buffers to use&lt;/li&gt;
&lt;li&gt;Multishot recv CQEs may stop arriving for affected connections&lt;/li&gt;
&lt;li&gt;If the connection&amp;rsquo;s SPSC ring fills (1024 items), the connection is &lt;strong&gt;force-closed&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Monitoring&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;monitoring&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#monitoring&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Per-connection ring fill level&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;long&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pending&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TotalRingCount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// After ReadAsync&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;batchSize&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;SnapshotRingCount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h3&gt;Prevention&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;prevention&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#prevention&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Return buffers promptly&lt;/strong&gt; &amp;ndash; don&amp;rsquo;t hold them across awaits&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Size &lt;code&gt;BufferRingEntries&lt;/code&gt; appropriately&lt;/strong&gt; &amp;ndash; more buffers = more headroom&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Process data inline&lt;/strong&gt; &amp;ndash; parse and respond in the same sync block when possible&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Copy if you need to hold data&lt;/strong&gt; &amp;ndash; copy to managed/unmanaged memory, return the buffer&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;Write Buffer Management&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;write-buffer-management&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#write-buffer-management&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;The write path uses a separate unmanaged slab per connection (default 16 KB):&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;Write(data) â†’ copies into slab â†’ FlushAsync() â†’ reactor sends â†’ slab reset&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;The write slab is automatically reset after &lt;code&gt;FlushAsync()&lt;/code&gt; completes. You don&amp;rsquo;t need to manage it manually.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Size limit:&lt;/strong&gt; The total staged data (all &lt;code&gt;Write()&lt;/code&gt; calls between flushes) must fit in the slab. If your responses are larger than 16 KB, increase the slab size in the &lt;code&gt;Connection&lt;/code&gt; constructor.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Flush barrier:&lt;/strong&gt; While a flush is in progress (&lt;code&gt;_flushInProgress == 1&lt;/code&gt;), all &lt;code&gt;Write()&lt;/code&gt; calls throw &lt;code&gt;InvalidOperationException&lt;/code&gt;. Wait for the flush to complete before writing again.&lt;/p&gt;
&lt;h2&gt;Memory Layout Summary&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;memory-layout-summary&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#memory-layout-summary&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;Per-Reactor:
  Buffer Ring Slab: BufferRingEntries * RecvBufferSize bytes (unmanaged, aligned)
  Buffer Ring:      BufferRingEntries * sizeof(entry)        (kernel-managed)

Per-Connection:
  Write Slab:       16 KB default (unmanaged, 64-byte aligned)
  SPSC Recv Ring:   1024 * sizeof(RingItem)                  (managed array)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;

      </description>
    </item>
    
    <item>
      <title>Buffer Rings</title>
      <link>http://localhost:1313/zerg/docs/architecture/buffer-rings/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>http://localhost:1313/zerg/docs/architecture/buffer-rings/</guid>
      <description>
        
        
        &lt;p&gt;Buffer rings (also called &amp;ldquo;provided buffers&amp;rdquo;) are a core &lt;code&gt;io_uring&lt;/code&gt; feature that zerg uses for zero-copy receive operations. Instead of userspace providing a buffer with each recv call, the kernel picks from a pre-registered pool.&lt;/p&gt;
&lt;h2&gt;How Buffer Rings Work&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;how-buffer-rings-work&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#how-buffer-rings-work&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;h3&gt;Setup&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;setup&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#setup&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;When a reactor starts, it creates a buffer ring and populates it with pre-allocated buffers:&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;1. Allocate a contiguous slab of unmanaged memory (64-byte aligned)
2. Register the buffer ring with io_uring:
     br = shim_setup_buf_ring(ring, entries, bgid, 0, &amp;amp;ret)
3. Divide the slab into fixed-size chunks and add each to the ring:
     for i in 0..entries:
         shim_buf_ring_add(br, slab &amp;#43; i * bufSize, bufSize, i, mask, i)
4. Publish all buffers to the kernel:
     shim_buf_ring_advance(br, entries)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Each buffer is identified by a 16-bit &lt;code&gt;bufferId&lt;/code&gt; (0 to &lt;code&gt;BufferRingEntries - 1&lt;/code&gt;). The slab is a single contiguous allocation so the address of any buffer is &lt;code&gt;slab + bufferId * RecvBufferSize&lt;/code&gt;.&lt;/p&gt;
&lt;h3&gt;Receive&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;receive&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#receive&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;When multishot recv completes for a connection:&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;CQE arrives:
    cqe-&amp;gt;res    = bytes received (or negative errno)
    cqe-&amp;gt;flags  = IORING_CQE_F_BUFFER | (bufferId &amp;lt;&amp;lt; 16)

Reactor extracts:
    bufferId = shim_cqe_buffer_id(cqe)
    ptr      = slab &amp;#43; bufferId * bufSize
    length   = cqe-&amp;gt;res&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;The kernel has already written the received data into the selected buffer. The reactor creates a &lt;code&gt;RingItem(ptr, length, bufferId)&lt;/code&gt; and enqueues it to the connection&amp;rsquo;s receive ring.&lt;/p&gt;
&lt;h3&gt;Consumption&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;consumption&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#consumption&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;The application handler drains &lt;code&gt;RingItem&lt;/code&gt;s from the connection:&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TryGetRing&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TailSnapshot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;out&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RingItem&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ring&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;ReadOnlySpan&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;data&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ring&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;AsSpan&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// zero-copy view&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// process data...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ReturnRing&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ring&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;BufferId&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;      &lt;span class=&#34;c1&#34;&gt;// return to kernel&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h3&gt;Return&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;return&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#return&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;When the handler calls &lt;code&gt;ReturnRing(bufferId)&lt;/code&gt;, the buffer ID is enqueued to the reactor&amp;rsquo;s return queue (an MPSC queue). On the next loop iteration, the reactor returns all queued buffers to the kernel:&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;while returnQ.TryDequeue(out bufferId):
    shim_buf_ring_add(br, slab &amp;#43; bufferId * bufSize, bufSize, bufferId, mask, idx&amp;#43;&amp;#43;)
shim_buf_ring_advance(br, count)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2&gt;Buffer Lifecycle&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;buffer-lifecycle&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#buffer-lifecycle&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚              Buffer Ring                   â”‚
                â”‚  â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”         â”‚
                â”‚  â”‚ B0  â”‚ B1  â”‚ B2  â”‚ ... â”‚ Bn  â”‚         â”‚
                â”‚  â””â”€â”€â”¬â”€â”€â”´â”€â”€â”¬â”€â”€â”´â”€â”€â”¬â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”¬â”€â”€â”˜         â”‚
                â””â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚     â”‚     â”‚           â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚     â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â–¼                     â–¼     â–¼                          â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Kernel â”‚          â”‚ Kernel â”‚ â”‚  User  â”‚           â”‚  User  â”‚
  â”‚ (free) â”‚          â”‚ (recv) â”‚ â”‚ (proc) â”‚           â”‚ (done) â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                          â”‚          â”‚                    â”‚
                          â”‚ CQE      â”‚ TryGetRing()       â”‚ ReturnRing()
                          â–¼          â–¼                    â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ RingItem â”‚ â”‚ Handler  â”‚      â”‚ Return Q â”‚
                    â”‚ enqueued â”‚ â”‚ draining â”‚      â”‚ â†’ kernel â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;A buffer transitions through these states:&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;State&lt;/th&gt;
          &lt;th&gt;Owner&lt;/th&gt;
          &lt;th&gt;Description&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;Free&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;Kernel&lt;/td&gt;
          &lt;td&gt;Available in the buffer ring for the next recv&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;In-flight&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;Kernel&lt;/td&gt;
          &lt;td&gt;Selected by kernel for an active recv operation&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;Enqueued&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;Reactor&lt;/td&gt;
          &lt;td&gt;Data received, &lt;code&gt;RingItem&lt;/code&gt; pushed to connection&amp;rsquo;s SPSC ring&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;Processing&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;Handler&lt;/td&gt;
          &lt;td&gt;Handler has dequeued the &lt;code&gt;RingItem&lt;/code&gt; and is reading the data&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;Returning&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;Return queue&lt;/td&gt;
          &lt;td&gt;Handler called &lt;code&gt;ReturnRing()&lt;/code&gt;, buffer ID queued for return&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;Returned&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;Kernel&lt;/td&gt;
          &lt;td&gt;Reactor added buffer back to the ring via &lt;code&gt;buf_ring_add&lt;/code&gt; + &lt;code&gt;advance&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h2&gt;Configuration&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;configuration&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#configuration&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;Config Property&lt;/th&gt;
          &lt;th&gt;Default&lt;/th&gt;
          &lt;th&gt;Impact&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;BufferRingEntries&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;16384&lt;/td&gt;
          &lt;td&gt;Total buffers per reactor. Must be power of two. More buffers = more concurrent in-flight receives.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;RecvBufferSize&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;32 KB&lt;/td&gt;
          &lt;td&gt;Size of each buffer. Larger = fewer buffers needed for big payloads, but more memory per buffer.&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;Memory formula:&lt;/strong&gt; &lt;code&gt;BufferRingEntries * RecvBufferSize&lt;/code&gt; per reactor.&lt;/p&gt;
&lt;p&gt;With defaults: 16384 * 32 KB = &lt;strong&gt;512 MB per reactor&lt;/strong&gt;.&lt;/p&gt;
&lt;h2&gt;Important Rules&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;important-rules&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#important-rules&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Always return buffers.&lt;/strong&gt; Every buffer obtained via &lt;code&gt;TryGetRing()&lt;/code&gt; or &lt;code&gt;GetAllSnapshotRings()&lt;/code&gt; must eventually be returned via &lt;code&gt;ReturnRing()&lt;/code&gt; or &lt;code&gt;ReturnRingBuffers()&lt;/code&gt;. Leaked buffers deplete the pool and eventually stall receives.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Don&amp;rsquo;t access buffer data after returning.&lt;/strong&gt; Once &lt;code&gt;ReturnRing(bufferId)&lt;/code&gt; is called, the kernel may reuse that buffer immediately. Any pointer or span referencing the buffer becomes invalid.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Return from the handler thread.&lt;/strong&gt; &lt;code&gt;ReturnRing()&lt;/code&gt; enqueues to an MPSC queue that the reactor drains. It&amp;rsquo;s safe to call from any thread, but typically called from the handler after processing.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Buffer ring exhaustion.&lt;/strong&gt; If all buffers are in-flight or held by handlers, new recv operations will fail. The reactor handles this gracefully &amp;ndash; multishot recv CQEs may stop arriving until buffers are returned. If the connection&amp;rsquo;s SPSC ring is full (1024 items), the connection is closed as a safety measure.&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;

      </description>
    </item>
    
    <item>
      <title>Configuration</title>
      <link>http://localhost:1313/zerg/docs/getting-started/configuration/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>http://localhost:1313/zerg/docs/getting-started/configuration/</guid>
      <description>
        
        
        &lt;p&gt;zerg is configured through three types: &lt;code&gt;EngineOptions&lt;/code&gt; (top-level), &lt;code&gt;ReactorConfig&lt;/code&gt; (per-reactor), and &lt;code&gt;AcceptorConfig&lt;/code&gt; (acceptor thread). All have sensible defaults so you can start with just a port number.&lt;/p&gt;
&lt;h2&gt;EngineOptions&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;engineoptions&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#engineoptions&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;The top-level configuration passed to &lt;code&gt;new Engine(options)&lt;/code&gt;.&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;Property&lt;/th&gt;
          &lt;th&gt;Type&lt;/th&gt;
          &lt;th&gt;Default&lt;/th&gt;
          &lt;th&gt;Description&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;ReactorCount&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;int&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;1&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Number of reactor threads to spawn. Each gets its own &lt;code&gt;io_uring&lt;/code&gt; instance.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;Ip&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;string&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;&amp;quot;0.0.0.0&amp;quot;&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;IP address to bind the listening socket to. Use &lt;code&gt;&amp;quot;::&amp;quot;&lt;/code&gt; for IPv6.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;Port&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;ushort&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;8080&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;TCP port to listen on.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;Backlog&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;int&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;65535&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Kernel listen backlog for pending connections.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;AcceptorConfig&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;AcceptorConfig&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;new()&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Configuration for the acceptor ring and event loop.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;ReactorConfigs&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;ReactorConfig[]&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;null&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Per-reactor configuration array. Auto-initialized with defaults if null. Must have at least &lt;code&gt;ReactorCount&lt;/code&gt; entries if provided.&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h3&gt;Example&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;example&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#example&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;engine&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Engine&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EngineOptions&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;Ip&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;0.0.0.0&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;Port&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;8080&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;ReactorCount&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;Backlog&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;65535&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;});&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2&gt;ReactorConfig&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;reactorconfig&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#reactorconfig&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;Configuration for a single reactor&amp;rsquo;s &lt;code&gt;io_uring&lt;/code&gt; instance and event loop. This is a &lt;code&gt;sealed record&lt;/code&gt; &amp;ndash; all properties have defaults.&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;Property&lt;/th&gt;
          &lt;th&gt;Type&lt;/th&gt;
          &lt;th&gt;Default&lt;/th&gt;
          &lt;th&gt;Description&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;RingFlags&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;uint&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;SINGLE_ISSUER | DEFER_TASKRUN&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;io_uring&lt;/code&gt; setup flags. See &lt;a href=&#34;#ring-flags&#34;&gt;Ring Flags&lt;/a&gt; below.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;SqCpuThread&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;int&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;-1&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;CPU core to pin the SQPOLL kernel thread to. Only used with &lt;code&gt;IORING_SETUP_SQPOLL&lt;/code&gt;. &lt;code&gt;-1&lt;/code&gt; = kernel decides.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;SqThreadIdleMs&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;uint&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;100&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;How long (ms) the SQPOLL kernel thread stays alive without submissions before sleeping.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;RingEntries&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;uint&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;8192&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;SQ/CQ size. Upper bound on in-flight operations (recv, send, cancel) the reactor can have at once.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;RecvBufferSize&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;int&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;32768&lt;/code&gt; (32 KB)&lt;/td&gt;
          &lt;td&gt;Size of each receive buffer in the buffer ring. Larger values reduce syscalls for large payloads.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;BufferRingEntries&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;int&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;16384&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Number of pre-allocated recv buffers. Must be a power of two.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;BatchCqes&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;int&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;4096&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Maximum CQEs processed per loop iteration. Larger improves throughput under load.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;MaxConnectionsPerReactor&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;int&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;8192&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Upper bound on concurrent connections. Should be &amp;lt;= &lt;code&gt;RingEntries&lt;/code&gt;.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;CqTimeout&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;long&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;1_000_000&lt;/code&gt; (1 ms)&lt;/td&gt;
          &lt;td&gt;Timeout in nanoseconds passed to &lt;code&gt;io_uring_wait_cqes()&lt;/code&gt;. Lower = lower tail latency, higher CPU.&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h3&gt;Example: Per-Reactor Configuration&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;example-per-reactor-configuration&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#example-per-reactor-configuration&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;engine&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Engine&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EngineOptions&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;Port&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;8080&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;ReactorCount&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;ReactorConfigs&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Enumerable&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Range&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Select&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ReactorConfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;RecvBufferSize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;64&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1024&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;       &lt;span class=&#34;c1&#34;&gt;// 64 KB recv buffers&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;BufferRingEntries&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;32&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1024&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;     &lt;span class=&#34;c1&#34;&gt;// 32K buffers per reactor&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;CqTimeout&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;500_000&lt;/span&gt;                &lt;span class=&#34;c1&#34;&gt;// 0.5 ms timeout&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;)).&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ToArray&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;});&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2&gt;AcceptorConfig&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;acceptorconfig&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#acceptorconfig&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;Configuration for the acceptor thread&amp;rsquo;s &lt;code&gt;io_uring&lt;/code&gt; instance. This is a &lt;code&gt;sealed record&lt;/code&gt;.&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;Property&lt;/th&gt;
          &lt;th&gt;Type&lt;/th&gt;
          &lt;th&gt;Default&lt;/th&gt;
          &lt;th&gt;Description&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;RingFlags&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;uint&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;0&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;io_uring&lt;/code&gt; setup flags for the acceptor ring. SQPOLL is usually unnecessary here.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;SqCpuThread&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;int&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;-1&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;CPU core for SQPOLL thread.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;SqThreadIdleMs&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;uint&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;100&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;SQPOLL idle timeout in milliseconds.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;RingEntries&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;uint&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;8192&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;SQ/CQ size. Bounds in-flight accept completions.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;BatchSqes&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;uint&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;4096&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Max accepts processed per loop iteration.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;CqTimeout&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;long&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;100_000_000&lt;/code&gt; (100 ms)&lt;/td&gt;
          &lt;td&gt;Wait timeout in nanoseconds. Higher than reactor default since accepts are burst-driven.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;IPVersion&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;IPVersion&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;IPv6DualStack&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;IP stack for the listening socket.&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h3&gt;IPVersion Enum&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;ipversion-enum&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#ipversion-enum&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;Value&lt;/th&gt;
          &lt;th&gt;Description&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;IPv4Only&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Creates &lt;code&gt;AF_INET&lt;/code&gt; socket. Only IPv4 clients can connect.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;IPv6DualStack&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Creates &lt;code&gt;AF_INET6&lt;/code&gt; socket with &lt;code&gt;IPV6_V6ONLY=0&lt;/code&gt;. Accepts both IPv4 and IPv6 clients. IPv4 clients appear as &lt;code&gt;::ffff:a.b.c.d&lt;/code&gt;.&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h3&gt;Example: Custom Acceptor&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;example-custom-acceptor&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#example-custom-acceptor&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;engine&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Engine&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EngineOptions&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;Port&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;443&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;ReactorCount&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;8&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;AcceptorConfig&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AcceptorConfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;RingEntries&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;16384&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;CqTimeout&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;50_000_000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;           &lt;span class=&#34;c1&#34;&gt;// 50 ms&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;IPVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;IPVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;IPv4Only&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;});&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2&gt;Ring Flags&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;ring-flags&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#ring-flags&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;&lt;code&gt;io_uring&lt;/code&gt; setup flags control how the kernel processes submissions and completions. You can combine flags with bitwise OR.&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;Flag&lt;/th&gt;
          &lt;th&gt;Value&lt;/th&gt;
          &lt;th&gt;Description&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;IORING_SETUP_SQPOLL&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;1 &amp;lt;&amp;lt; 1&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Kernel thread polls the SQ, eliminating submit syscalls. Trades a CPU core for lower latency.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;IORING_SETUP_SQ_AFF&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;1 &amp;lt;&amp;lt; 2&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Pin the SQPOLL kernel thread to the CPU specified by &lt;code&gt;SqCpuThread&lt;/code&gt;.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;IORING_SETUP_SINGLE_ISSUER&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;1 &amp;lt;&amp;lt; 12&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Optimize for a single submitting thread. &lt;strong&gt;Default for reactors.&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;IORING_SETUP_DEFER_TASKRUN&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;1 &amp;lt;&amp;lt; 13&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Defer kernel task_work execution, reducing latency spikes. &lt;strong&gt;Default for reactors.&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;IORING_SETUP_CQSIZE&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;1 &amp;lt;&amp;lt; 3&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Allow CQ size different from SQ size.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;IORING_SETUP_CLAMP&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;1 &amp;lt;&amp;lt; 4&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Clamp queue sizes to kernel-supported limits.&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h3&gt;SQPOLL Example&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;sqpoll-example&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#sqpoll-example&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Enable SQPOLL on reactor 0, pinned to CPU 2&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;config&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ReactorConfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;RingFlags&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ABI&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;IORING_SETUP_SQPOLL&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ABI&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;IORING_SETUP_SQ_AFF&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ABI&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;IORING_SETUP_SINGLE_ISSUER&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;SqCpuThread&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;SqThreadIdleMs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2&gt;Memory Budget&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;memory-budget&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#memory-budget&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;A rough estimate of per-reactor memory usage:&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;Component&lt;/th&gt;
          &lt;th&gt;Formula&lt;/th&gt;
          &lt;th&gt;Default&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;Buffer ring&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;BufferRingEntries * RecvBufferSize&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;16384 * 32 KB = &lt;strong&gt;512 MB&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Write slabs&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;MaxConnectionsPerReactor * 16 KB&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;8192 * 16 KB = &lt;strong&gt;128 MB&lt;/strong&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Ring entries&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;RingEntries * sizeof(SQE/CQE)&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;~1 MB&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;For a 4-reactor server with defaults, the buffer ring alone accounts for ~2 GB. Adjust &lt;code&gt;BufferRingEntries&lt;/code&gt; and &lt;code&gt;RecvBufferSize&lt;/code&gt; based on your workload and available memory.&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Connection: Write</title>
      <link>http://localhost:1313/zerg/docs/api-reference/connection-write/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>http://localhost:1313/zerg/docs/api-reference/connection-write/</guid>
      <description>
        
        
        &lt;p&gt;The write API provides a staged write buffer and async flush to the kernel. Data is written into an unmanaged slab, then flushed via &lt;code&gt;io_uring&lt;/code&gt; send operations.&lt;/p&gt;
&lt;h2&gt;Write/Flush Cycle&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;writeflush-cycle&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#writeflush-cycle&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// 1. Stage data into the write buffer&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Write&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;HTTP/1.1 200 OK\r\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;u8&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Write&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Content-Length: 13\r\n\r\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;u8&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Write&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Hello, World!&amp;#34;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;u8&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// 2. Flush staged data to kernel&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;await&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;FlushAsync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Write buffer is automatically reset after flush completes&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2&gt;Write Methods&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;write-methods&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#write-methods&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;h3&gt;Write(ReadOnlySpan&amp;lt;byte&amp;gt;)&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;writereadonlyspanbyte&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#writereadonlyspanbyte&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Write&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ReadOnlySpan&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Copies the span into the unmanaged write slab at the current tail position.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Throws:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;InvalidOperationException&lt;/code&gt; if a flush is in progress&lt;/li&gt;
&lt;li&gt;&lt;code&gt;InvalidOperationException&lt;/code&gt; if the slab doesn&amp;rsquo;t have enough space&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Write(ReadOnlyMemory&amp;lt;byte&amp;gt;)&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;writereadonlymemorybyte&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#writereadonlymemorybyte&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Write&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ReadOnlyMemory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Same behavior as the span overload, using &lt;code&gt;source.Span&lt;/code&gt;.&lt;/p&gt;
&lt;h3&gt;Write(byte*, int) (Unsafe)&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;writebyte-int-unsafe&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#writebyte-int-unsafe&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Write&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Copies from unmanaged memory into the write slab. Uses &lt;code&gt;Buffer.MemoryCopy&lt;/code&gt; for native-to-native copy.&lt;/p&gt;
&lt;h2&gt;IBufferWriter&amp;lt;byte&amp;gt;&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;ibufferwriterbyte&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#ibufferwriterbyte&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;The &lt;code&gt;Connection&lt;/code&gt; class implements &lt;code&gt;IBufferWriter&amp;lt;byte&amp;gt;&lt;/code&gt;, allowing direct writes into the slab without copying:&lt;/p&gt;
&lt;h3&gt;GetSpan&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;getspan&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#getspan&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Span&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;GetSpan&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;sizeHint&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Returns a writable &lt;code&gt;Span&amp;lt;byte&amp;gt;&lt;/code&gt; over the remaining slab space. Write directly into this span, then call &lt;code&gt;Advance()&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Span&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;span&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;GetSpan&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;256&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;written&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Encoding&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;UTF8&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;GetBytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Hello&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;span&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Advance&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;written&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h3&gt;GetMemory&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;getmemory&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#getmemory&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Memory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;GetMemory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;sizeHint&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Returns a writable &lt;code&gt;Memory&amp;lt;byte&amp;gt;&lt;/code&gt; over the remaining slab space. Useful for APIs that require &lt;code&gt;Memory&amp;lt;byte&amp;gt;&lt;/code&gt;.&lt;/p&gt;
&lt;h3&gt;Advance&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;advance&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#advance&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Advance&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;count&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Advances the write tail by &lt;code&gt;count&lt;/code&gt; bytes. Call after writing into the span/memory returned by &lt;code&gt;GetSpan&lt;/code&gt;/&lt;code&gt;GetMemory&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Throws:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;InvalidOperationException&lt;/code&gt; if a flush is in progress&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;FlushAsync&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;flushasync&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#flushasync&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ValueTask&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FlushAsync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Arms a flush and returns a &lt;code&gt;ValueTask&lt;/code&gt; that completes when the reactor has sent all staged bytes.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Behavior:&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Captures &lt;code&gt;WriteTail&lt;/code&gt; as the flush target (&lt;code&gt;WriteInFlight&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;Sets &lt;code&gt;_flushInProgress = 1&lt;/code&gt; (blocks further writes)&lt;/li&gt;
&lt;li&gt;Enqueues the connection&amp;rsquo;s fd to the reactor&amp;rsquo;s flush queue&lt;/li&gt;
&lt;li&gt;The reactor issues a &lt;code&gt;send&lt;/code&gt; SQE with the staged bytes&lt;/li&gt;
&lt;li&gt;If partial send, the reactor resubmits for the remaining bytes&lt;/li&gt;
&lt;li&gt;When fully sent, the reactor calls &lt;code&gt;CompleteFlush()&lt;/code&gt; which:
&lt;ul&gt;
&lt;li&gt;Clears &lt;code&gt;_flushInProgress&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Resets &lt;code&gt;WriteHead&lt;/code&gt; and &lt;code&gt;WriteTail&lt;/code&gt; to 0&lt;/li&gt;
&lt;li&gt;Completes the &lt;code&gt;ValueTask&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;Fast path:&lt;/strong&gt; Returns &lt;code&gt;default(ValueTask)&lt;/code&gt; (completed) if nothing was written (&lt;code&gt;WriteTail == 0&lt;/code&gt;).&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Throws:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;InvalidOperationException&lt;/code&gt; if a flush is already in progress&lt;/li&gt;
&lt;li&gt;&lt;code&gt;InvalidOperationException&lt;/code&gt; if a flush is already armed&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Write Buffer Internals&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;write-buffer-internals&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#write-buffer-internals&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;h3&gt;Slab Layout&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;slab-layout&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#slab-layout&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Unmanaged Write Slab            â”‚
â”‚  (64-byte aligned, default 16 KB)        â”‚
â”‚                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Sent   â”‚  Staged data â”‚   Free   â”‚   â”‚
â”‚  â”‚ (Head)  â”‚              â”‚  space   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  ^WriteHead  ^WriteTail                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;Field&lt;/th&gt;
          &lt;th&gt;Description&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;WriteBuffer&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Pointer to the start of the 64-byte aligned slab&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;WriteHead&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Start of valid staged data (currently always 0)&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;WriteTail&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;End of written data &amp;ndash; advanced by &lt;code&gt;Write()&lt;/code&gt; and &lt;code&gt;Advance()&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;WriteInFlight&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Snapshot of &lt;code&gt;WriteTail&lt;/code&gt; captured by &lt;code&gt;FlushAsync()&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;SendInflight&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Reactor-owned flag: 1 if a send SQE is outstanding&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h3&gt;Write Slab Size&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;write-slab-size&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#write-slab-size&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;The default write slab is &lt;strong&gt;16 KB&lt;/strong&gt; per connection, allocated as 64-byte aligned unmanaged memory:&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;writeSlabSize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1024&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;16&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;If your responses are larger than 16 KB, increase this value. The entire response must fit in the slab before flushing.&lt;/p&gt;
&lt;h2&gt;Flush Completion&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;flush-completion&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#flush-completion&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;The reactor handles the flush-to-kernel process:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Drain flush queue:&lt;/strong&gt; &lt;code&gt;flushQ.TryDequeue(out clientFd)&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Prepare send:&lt;/strong&gt; &lt;code&gt;shim_prep_send(sqe, fd, writeBuffer + writeHead, writeInFlight - writeHead, 0)&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Submit and process CQE:&lt;/strong&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;cqe-&amp;gt;res&lt;/code&gt; = bytes sent&lt;/li&gt;
&lt;li&gt;Advance &lt;code&gt;WriteHead&lt;/code&gt; by bytes sent&lt;/li&gt;
&lt;li&gt;If &lt;code&gt;WriteHead &amp;lt; WriteInFlight&lt;/code&gt;: resubmit for remaining bytes&lt;/li&gt;
&lt;li&gt;If complete: call &lt;code&gt;CompleteFlush()&lt;/code&gt; on the connection&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;Handler                Reactor
   â”‚                      â”‚
   â”‚â”€â”€ Write(data) â”€â”€â”€â”€â”€â”€â–¶â”‚
   â”‚â”€â”€ Write(data) â”€â”€â”€â”€â”€â”€â–¶â”‚
   â”‚â”€â”€ FlushAsync() â”€â”€â”€â”€â”€â–¶â”‚ enqueue fd to flushQ
   â”‚   (awaiting)         â”‚
   â”‚                      â”‚â”€â”€ drain flushQ
   â”‚                      â”‚â”€â”€ prep_send(fd, buf, len)
   â”‚                      â”‚â”€â”€ submit
   â”‚                      â”‚   ...
   â”‚                      â”‚â”€â”€ CQE: send complete
   â”‚â—€â”€â”€ CompleteFlush() â”€â”€â”‚ resume ValueTask
   â”‚                      â”‚
   â”‚â”€â”€ Write(next) â”€â”€â”€â”€â”€â”€â–¶â”‚ slab reset, ready for next cycle&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2&gt;Thread Safety&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;thread-safety&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#thread-safety&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Write()&lt;/code&gt;, &lt;code&gt;GetSpan()&lt;/code&gt;, &lt;code&gt;Advance()&lt;/code&gt; must be called from a single thread (the handler)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;FlushAsync()&lt;/code&gt; enqueues to an MPSC queue (safe from any thread)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;CompleteFlush()&lt;/code&gt; is called by the reactor thread, which may resume the handler inline&lt;/li&gt;
&lt;li&gt;The &lt;code&gt;_flushInProgress&lt;/code&gt; flag prevents writes during an active flush&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
    <item>
      <title>Native Interop</title>
      <link>http://localhost:1313/zerg/docs/internals/native-interop/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>http://localhost:1313/zerg/docs/internals/native-interop/</guid>
      <description>
        
        
        &lt;p&gt;zerg communicates with the Linux kernel&amp;rsquo;s &lt;code&gt;io_uring&lt;/code&gt; subsystem through a C shim library (&lt;code&gt;liburingshim.so&lt;/code&gt;) that wraps &lt;code&gt;liburing&lt;/code&gt;. All native calls are made via P/Invoke from the &lt;code&gt;ABI.URing&lt;/code&gt; class.&lt;/p&gt;
&lt;h2&gt;Architecture&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;architecture&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#architecture&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;C# (zerg)  â”€â”€P/Invokeâ”€â”€â–¶  liburingshim.so  â”€â”€callsâ”€â”€â–¶  liburing  â”€â”€syscallâ”€â”€â–¶  Linux kernel&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;The shim library serves two purposes:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Provides a flat C ABI that P/Invoke can call (liburing uses inline functions and macros)&lt;/li&gt;
&lt;li&gt;Bundles liburing statically so users don&amp;rsquo;t need to install it&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;Bundled Native Libraries&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;bundled-native-libraries&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#bundled-native-libraries&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;The NuGet package includes pre-built shim libraries:&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;Runtime&lt;/th&gt;
          &lt;th&gt;Path&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;linux-x64&lt;/code&gt; (glibc)&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;native/linux-x64/liburingshim.so&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;linux-musl-x64&lt;/code&gt; (Alpine)&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;native/linux-musl-x64/liburingshim.so&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;These are automatically copied to the output directory by MSBuild.&lt;/p&gt;
&lt;h2&gt;Opaque Types&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;opaque-types&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#opaque-types&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;The C# side uses fixed-size structs as opaque handles for kernel types:&lt;/p&gt;
&lt;h3&gt;io_uring&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;io_uring&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#io_uring&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;[StructLayout(LayoutKind.Sequential)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;internal&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;unsafe&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;io_uring&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;fixed&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;ulong&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_opaque&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;128&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// 1024 bytes&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Managed equivalent of &lt;code&gt;struct io_uring&lt;/code&gt; from liburing. Never directly manipulated &amp;ndash; passed to/from shim functions by pointer.&lt;/p&gt;
&lt;h3&gt;io_uring_sqe&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;io_uring_sqe&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#io_uring_sqe&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;[StructLayout(LayoutKind.Sequential)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;internal&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;unsafe&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;io_uring_sqe&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;fixed&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;ulong&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_opaque&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;8&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// 64 bytes&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Submission Queue Entry. Populated via &lt;code&gt;shim_prep_*&lt;/code&gt; helpers. Never directly filled from C#.&lt;/p&gt;
&lt;h3&gt;io_uring_cqe&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;io_uring_cqe&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#io_uring_cqe&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;[StructLayout(LayoutKind.Sequential)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;internal&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;unsafe&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;io_uring_cqe&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;ulong&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;user_data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;   &lt;span class=&#34;c1&#34;&gt;// 64-bit token from SQE&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;res&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;           &lt;span class=&#34;c1&#34;&gt;// result (bytes transferred or -errno)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;flags&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;        &lt;span class=&#34;c1&#34;&gt;// CQE flags (buffer selection, multishot)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Completion Queue Entry. Read directly from C# after peek/wait.&lt;/p&gt;
&lt;h3&gt;io_uring_buf_ring&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;io_uring_buf_ring&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#io_uring_buf_ring&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;[StructLayout(LayoutKind.Sequential)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;internal&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;io_uring_buf_ring&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Opaque token for the buffer ring. All manipulation via shim functions.&lt;/p&gt;
&lt;h3&gt;__kernel_timespec&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;__kernel_timespec&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#__kernel_timespec&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;na&#34;&gt;[StructLayout(LayoutKind.Sequential)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;internal&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;__kernel_timespec&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;long&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;tv_sec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;     &lt;span class=&#34;c1&#34;&gt;// seconds&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;long&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;tv_nsec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// nanoseconds&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Matches the Linux kernel&amp;rsquo;s &lt;code&gt;struct __kernel_timespec&lt;/code&gt; (16 bytes). Used for timeout operations.&lt;/p&gt;
&lt;h2&gt;P/Invoke Surface&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;pinvoke-surface&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#pinvoke-surface&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;h3&gt;Ring Lifecycle&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;ring-lifecycle&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#ring-lifecycle&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;Function&lt;/th&gt;
          &lt;th&gt;Description&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;shim_create_ring(entries, out err)&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Create ring with SQ/CQ size&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;shim_create_ring_ex(entries, flags, cpu, idle_ms, out err)&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Create ring with flags (SQPOLL, etc.)&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;shim_destroy_ring(ring)&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Release all native resources&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;shim_get_ring_flags(ring)&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Get ring setup flags&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h3&gt;Submission&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;submission&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#submission&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;Function&lt;/th&gt;
          &lt;th&gt;Description&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;shim_get_sqe(ring)&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Acquire fresh SQE slot (null if full)&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;shim_submit(ring)&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Submit pending SQEs to kernel&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;shim_submit_and_wait(ring, waitNr)&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Submit + wait for CQEs (single syscall)&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;shim_submit_and_wait_timeout(ring, cqes, waitNr, ts)&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Submit + wait with timeout&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;shim_enter(ring, toSubmit, minComplete, flags, ts)&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Direct &lt;code&gt;io_uring_enter(2)&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h3&gt;Completion&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;completion&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#completion&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;Function&lt;/th&gt;
          &lt;th&gt;Description&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;shim_wait_cqe(ring, cqe)&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Blocking wait for one CQE&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;shim_wait_cqe_timeout(ring, cqe, ts)&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Wait with timeout&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;shim_wait_cqes(ring, cqe, waitNr, ts)&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Wait for N CQEs&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;shim_peek_batch_cqe(ring, cqes, count)&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Non-blocking batch peek&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;shim_cqe_seen(ring, cqe)&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Mark one CQE consumed&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;shim_cq_advance(ring, count)&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Mark N CQEs consumed (batch)&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;shim_cq_ready(ring)&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Check CQE count (no syscall)&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;shim_sq_ready(ring)&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Check available SQE slots&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h3&gt;SQE Preparation&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;sqe-preparation&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#sqe-preparation&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;Function&lt;/th&gt;
          &lt;th&gt;Description&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;shim_prep_multishot_accept(sqe, lfd, flags)&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Multishot accept on listening fd&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;shim_prep_recv_multishot_select(sqe, fd, buf_group, flags)&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Multishot recv with buffer selection&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;shim_prep_send(sqe, fd, buf, nbytes, flags)&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Send data from buffer&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;shim_prep_cancel64(sqe, user_data, flags)&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Cancel operation by user_data&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h3&gt;User Data&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;user-data&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#user-data&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;Function&lt;/th&gt;
          &lt;th&gt;Description&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;shim_sqe_set_data64(sqe, data)&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Set 64-bit token on SQE&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;shim_cqe_get_data64(cqe)&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Get token from CQE&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h3&gt;Buffer Ring&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;buffer-ring&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#buffer-ring&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;Function&lt;/th&gt;
          &lt;th&gt;Description&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;shim_setup_buf_ring(ring, entries, bgid, flags, out ret)&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Create and register buffer ring&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;shim_free_buf_ring(ring, br, entries, bgid)&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Unregister and free&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;shim_buf_ring_add(br, addr, len, bid, mask, idx)&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Add buffer to ring&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;shim_buf_ring_advance(br, count)&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Publish N buffers to kernel&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;shim_cqe_has_buffer(cqe)&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Check if CQE used a provided buffer&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;shim_cqe_buffer_id(cqe)&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Extract buffer ID from CQE flags&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h2&gt;User Data Token Packing&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;user-data-token-packing&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#user-data-token-packing&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;zerg encodes the operation kind and file descriptor into the 64-bit &lt;code&gt;user_data&lt;/code&gt; field:&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;internal&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;enum&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;UdKind&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;Accept&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;Recv&lt;/span&gt;   &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;Send&lt;/span&gt;   &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;Cancel&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;4&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;ulong&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PackUd&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;UdKind&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;k&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;fd&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;ulong&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;k&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;fd&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;UdKind&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;UdKindOf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;ulong&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ud&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;UdKind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ud&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;UdFdOf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;ulong&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ud&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ud&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;0xFFFFFFFF&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;This allows the reactor to dispatch CQEs to the correct handler (recv, send, cancel) in a single branch on the extracted kind.&lt;/p&gt;
&lt;h2&gt;Socket Operations&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;socket-operations&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#socket-operations&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;The &lt;code&gt;ABI.LinuxSocket&lt;/code&gt; class provides raw socket syscall wrappers:&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;Function&lt;/th&gt;
          &lt;th&gt;Description&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;socket(domain, type, proto)&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Create socket&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;bind(fd, addr, len)&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Bind to address (IPv4 and IPv6 overloads)&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;listen(fd, backlog)&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Mark as listening&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;setsockopt(fd, level, optname, optval, optlen)&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Set socket option&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;close(fd)&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Close file descriptor&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;fcntl(fd, cmd, arg)&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;File control (flags)&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;inet_pton(af, src, dst)&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Text to binary IP address&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h2&gt;CPU Affinity&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;cpu-affinity&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#cpu-affinity&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;The &lt;code&gt;ABI.Affinity&lt;/code&gt; class provides thread-to-core pinning:&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Affinity&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PinCurrentThreadToCpu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cpu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Uses &lt;code&gt;sched_setaffinity(2)&lt;/code&gt; with a CPU bitmask. Best-effort &amp;ndash; failures are logged but not fatal.&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Connection Lifecycle</title>
      <link>http://localhost:1313/zerg/docs/architecture/connection-lifecycle/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>http://localhost:1313/zerg/docs/architecture/connection-lifecycle/</guid>
      <description>
        
        
        &lt;p&gt;A connection in zerg goes through a well-defined lifecycle: accept, register, use, close, and optionally return to pool.&lt;/p&gt;
&lt;h2&gt;Lifecycle Stages&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;lifecycle-stages&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#lifecycle-stages&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;                    Accept (Acceptor)
                         â”‚
                         â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚  Distribute  â”‚  round-robin to reactor
                  â”‚  via queue   â”‚
                  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚   Register   â”‚  arm multishot recv
                  â”‚  in reactor  â”‚  add to connections dict
                  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚   Notify     â”‚  push to Channel
                  â”‚  application â”‚  AcceptAsync() returns
                  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”Œâ”€â”€â–¶â”‚  ReadAsync   â”‚â—€â”€â”
              â”‚   â”‚  &amp;#43; process   â”‚  â”‚  read/write loop
              â”‚   â”‚  &amp;#43; Write     â”‚  â”‚
              â”‚   â”‚  &amp;#43; FlushAsyncâ”‚â”€â”€â”˜
              â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚          â”‚
              â”‚          â–¼ (IsClosed or error)
              â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   â”‚    Close     â”‚  connection removed
              â”‚   â”‚   &amp;#43; cleanup  â”‚  from reactor dict
              â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚          â”‚
              â”‚          â–¼
              â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â””â”€â”€â”€â”‚  Pool/Reuse  â”‚  Clear(), return to pool
                  â”‚  (optional)  â”‚  generation incremented
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2&gt;Accept Phase&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;accept-phase&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#accept-phase&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;The acceptor&amp;rsquo;s &lt;code&gt;io_uring&lt;/code&gt; delivers a CQE with the new client fd&lt;/li&gt;
&lt;li&gt;&lt;code&gt;TCP_NODELAY&lt;/code&gt; is set on the socket&lt;/li&gt;
&lt;li&gt;The fd is enqueued to the target reactor&amp;rsquo;s &lt;code&gt;ConcurrentQueue&amp;lt;int&amp;gt;&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;Registration Phase&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;registration-phase&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#registration-phase&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;On its next loop iteration, the reactor:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Dequeues the fd from its queue&lt;/li&gt;
&lt;li&gt;Creates or retrieves a &lt;code&gt;Connection&lt;/code&gt; from the pool&lt;/li&gt;
&lt;li&gt;Calls &lt;code&gt;connection.SetFd(clientFd).SetReactor(this)&lt;/code&gt; which:
&lt;ul&gt;
&lt;li&gt;Assigns the file descriptor&lt;/li&gt;
&lt;li&gt;Clears the &lt;code&gt;_closed&lt;/code&gt; flag&lt;/li&gt;
&lt;li&gt;Resets &lt;code&gt;_pending&lt;/code&gt; and &lt;code&gt;_armed&lt;/code&gt; flags&lt;/li&gt;
&lt;li&gt;Resets the &lt;code&gt;_readSignal&lt;/code&gt; completion source&lt;/li&gt;
&lt;li&gt;Clears the SPSC receive ring&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Stores the connection in &lt;code&gt;connections[clientFd]&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Arms multishot recv with buffer selection for the fd&lt;/li&gt;
&lt;li&gt;Pushes a &lt;code&gt;ConnectionItem&lt;/code&gt; to the &lt;code&gt;Channel&amp;lt;ConnectionItem&amp;gt;&lt;/code&gt; for &lt;code&gt;AcceptAsync()&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;Active Phase&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;active-phase&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#active-phase&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;The connection is now active. The handler can:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ReadAsync()&lt;/strong&gt; &amp;ndash; park until data arrives, then drain ring items&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Write()&lt;/strong&gt; &amp;ndash; stage bytes into the unmanaged write slab&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;FlushAsync()&lt;/strong&gt; &amp;ndash; tell the reactor to send staged bytes&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ResetRead()&lt;/strong&gt; &amp;ndash; prepare for the next read cycle&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;See &lt;a href=&#34;../../api-reference/connection-read/&#34;&gt;Connection Read&lt;/a&gt; and &lt;a href=&#34;../../api-reference/connection-write/&#34;&gt;Connection Write&lt;/a&gt; for API details.&lt;/p&gt;
&lt;h2&gt;Close Phase&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;close-phase&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#close-phase&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;A connection closes when:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Client disconnects&lt;/strong&gt;: recv CQE arrives with &lt;code&gt;res == 0&lt;/code&gt; (EOF) or &lt;code&gt;res &amp;lt; 0&lt;/code&gt; (error)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Ring overflow&lt;/strong&gt;: the SPSC recv ring is full (1024 items) &amp;ndash; the connection is force-closed as a safety measure&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Application closes&lt;/strong&gt;: the handler exits the read loop&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;When the reactor detects a close (recv CQE with &lt;code&gt;res &amp;lt;= 0&lt;/code&gt;):&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Returns any buffer used by the final CQE to the buffer ring&lt;/li&gt;
&lt;li&gt;Removes the connection from the reactor&amp;rsquo;s &lt;code&gt;connections&lt;/code&gt; dictionary&lt;/li&gt;
&lt;li&gt;Marks the connection as closed (&lt;code&gt;_closed = 1&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;Wakes any waiting &lt;code&gt;ReadAsync()&lt;/code&gt; so the handler sees &lt;code&gt;IsClosed == true&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;Pooling and Reuse&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;pooling-and-reuse&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#pooling-and-reuse&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;Connections can be pooled to avoid repeated allocation. The &lt;code&gt;Connection&lt;/code&gt; class supports two reset methods:&lt;/p&gt;
&lt;h3&gt;&lt;code&gt;Clear()&lt;/code&gt; &amp;ndash; Safe Reset&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;clear--safe-reset&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#clear--safe-reset&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;Increments &lt;code&gt;_generation&lt;/code&gt; to invalidate in-flight &lt;code&gt;ValueTask&lt;/code&gt; tokens&lt;/li&gt;
&lt;li&gt;Publishes &lt;code&gt;_closed = 1&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Cancels any waiting read or flush waiter with &lt;code&gt;OperationCanceledException&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Resets all write buffer state (WriteHead, WriteTail = 0)&lt;/li&gt;
&lt;li&gt;Resets both &lt;code&gt;_readSignal&lt;/code&gt; and &lt;code&gt;_flushSignal&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Clears the SPSC receive ring&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;&lt;code&gt;Clear2()&lt;/code&gt; &amp;ndash; Fast Reset&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;clear2--fast-reset&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#clear2--fast-reset&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;Increments &lt;code&gt;_generation&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Publishes &lt;code&gt;_closed = 1&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Clears the receive ring and resets completion state&lt;/li&gt;
&lt;li&gt;Does &lt;strong&gt;not&lt;/strong&gt; cancel waiters (assumes they&amp;rsquo;ve already exited)&lt;/li&gt;
&lt;li&gt;Faster than &lt;code&gt;Clear()&lt;/code&gt; for hot-path pooling&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Generation Counter&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;generation-counter&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#generation-counter&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;The &lt;code&gt;_generation&lt;/code&gt; counter (incremented on every reuse) serves as the &lt;code&gt;ValueTask&lt;/code&gt; token. If a stale &lt;code&gt;ReadAsync()&lt;/code&gt; completes after the connection has been reused, &lt;code&gt;GetResult()&lt;/code&gt; detects the mismatched token and returns &lt;code&gt;ReadResult.Closed()&lt;/code&gt; instead of delivering stale data. This prevents use-after-free bugs in the async machinery.&lt;/p&gt;
&lt;h2&gt;Connection Object Layout&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;connection-object-layout&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#connection-object-layout&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;partial&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;Connection&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;IBufferWriter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;IValueTaskSource&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ReadResult&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;IValueTaskSource&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;IDisposable&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// Identity&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ClientFd&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;Engine&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Reactor&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Reactor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_generation&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// Read state&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;SpscRecvRing&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_recv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;           &lt;span class=&#34;c1&#34;&gt;// capacity: 1024&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;ManualResetValueTaskSourceCore&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ReadResult&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_readSignal&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_armed&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_pending&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_closed&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;// Write state&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;WriteBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;            &lt;span class=&#34;c1&#34;&gt;// 64-byte aligned unmanaged slab&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;WriteHead&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;WriteTail&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;WriteInFlight&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;SendInflight&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;             &lt;span class=&#34;c1&#34;&gt;// reactor-owned flag&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;ManualResetValueTaskSourceCore&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_flushSignal&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_flushArmed&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_flushInProgress&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;

      </description>
    </item>
    
    <item>
      <title>ConnectionStream</title>
      <link>http://localhost:1313/zerg/docs/api-reference/connection-stream/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>http://localhost:1313/zerg/docs/api-reference/connection-stream/</guid>
      <description>
        
        
        &lt;p&gt;&lt;code&gt;ConnectionStream&lt;/code&gt; is a thin &lt;code&gt;Stream&lt;/code&gt; adapter that bridges zerg&amp;rsquo;s native connection API to BCL pipeline APIs. It provides zero-copy writes and single-copy reads for compatibility with code that expects a &lt;code&gt;System.IO.Stream&lt;/code&gt;.&lt;/p&gt;
&lt;h2&gt;Class Definition&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;class-definition&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#class-definition&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;sealed&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;ConnectionStream&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Stream&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2&gt;Constructor&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;constructor&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#constructor&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ConnectionStream&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Connection&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;inner&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Wraps an existing &lt;code&gt;Connection&lt;/code&gt; in a &lt;code&gt;Stream&lt;/code&gt; interface. The underlying connection must already be registered with a reactor.&lt;/p&gt;
&lt;h2&gt;Supported Operations&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;supported-operations&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#supported-operations&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;Property&lt;/th&gt;
          &lt;th&gt;Value&lt;/th&gt;
          &lt;th&gt;Description&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;CanRead&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;true&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Reading is supported via reactor receive rings&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;CanWrite&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;true&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Writing appends to the connection&amp;rsquo;s unmanaged slab&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;CanSeek&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;false&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Network streams are not seekable&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h2&gt;Write Operations&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;write-operations&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#write-operations&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;h3&gt;Write(byte[], int, int)&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;writebyte-int-int&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#writebyte-int-int&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;override&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Write&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;offset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;count&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Synchronous write. Validates parameters and copies the buffer slice into the connection&amp;rsquo;s unmanaged write slab.&lt;/p&gt;
&lt;h3&gt;WriteAsync(ReadOnlyMemory&amp;lt;byte&amp;gt;, CancellationToken)&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;writeasyncreadonlymemorybyte-cancellationtoken&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#writeasyncreadonlymemorybyte-cancellationtoken&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;override&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ValueTask&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;WriteAsync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ReadOnlyMemory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;CancellationToken&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cancellationToken&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Fast async write with no allocation and no implicit flush. Returns a completed &lt;code&gt;ValueTask&lt;/code&gt; if the buffer is empty. Otherwise copies the data into the write slab synchronously and returns completed.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; This does not flush. Call &lt;code&gt;FlushAsync()&lt;/code&gt; to send data.&lt;/p&gt;
&lt;h2&gt;Flush&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;flush&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#flush&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;h3&gt;FlushAsync(CancellationToken)&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;flushasynccancellationtoken&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#flushasynccancellationtoken&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;override&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Task&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FlushAsync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;CancellationToken&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;token&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Flushes all previously written data. Delegates to &lt;code&gt;connection.FlushAsync().AsTask()&lt;/code&gt;. The reactor controls the actual send &amp;ndash; the returned &lt;code&gt;Task&lt;/code&gt; completes when all staged bytes have been transmitted.&lt;/p&gt;
&lt;h3&gt;Flush()&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;flush-1&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#flush-1&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;override&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Flush&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Throws &lt;code&gt;NotSupportedException&lt;/code&gt;.&lt;/strong&gt; Synchronous flush is not supported. Use &lt;code&gt;FlushAsync()&lt;/code&gt;.&lt;/p&gt;
&lt;h2&gt;Read Operations&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;read-operations&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#read-operations&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;h3&gt;ReadAsync(Memory&amp;lt;byte&amp;gt;, CancellationToken)&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;readasyncmemorybyte-cancellationtoken&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#readasyncmemorybyte-cancellationtoken&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;override&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ValueTask&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ReadAsync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Memory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;CancellationToken&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cancellationToken&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Reads from the reactor receive rings and copies into &lt;code&gt;destination&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Steps:&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Awaits the next receive snapshot from the reactor (&lt;code&gt;connection.ReadAsync()&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;Returns 0 (EOF) if the connection is closed&lt;/li&gt;
&lt;li&gt;Gathers all segments belonging to the snapshot&lt;/li&gt;
&lt;li&gt;Copies once into the caller&amp;rsquo;s buffer via &lt;code&gt;CopyFromRings()&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Returns each ring buffer to the reactor pool&lt;/li&gt;
&lt;li&gt;Calls &lt;code&gt;ResetRead()&lt;/code&gt; to prepare for the next cycle&lt;/li&gt;
&lt;li&gt;Returns the number of bytes copied&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;ReadAsync(byte[], int, int, CancellationToken)&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;readasyncbyte-int-int-cancellationtoken&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#readasyncbyte-int-int-cancellationtoken&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;override&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Task&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ReadAsync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;offset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;count&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;CancellationToken&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cancellationToken&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Legacy array-based read. Delegates to the &lt;code&gt;Memory&amp;lt;byte&amp;gt;&lt;/code&gt; overload.&lt;/p&gt;
&lt;h3&gt;Read(byte[], int, int)&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;readbyte-int-int&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#readbyte-int-int&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;override&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Read&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;offset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;count&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Throws &lt;code&gt;NotSupportedException&lt;/code&gt;.&lt;/strong&gt; Synchronous reads are not supported on an async reactor-driven connection.&lt;/p&gt;
&lt;h2&gt;Unsupported Operations&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;unsupported-operations&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#unsupported-operations&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;Method&lt;/th&gt;
          &lt;th&gt;Behavior&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;Read(byte[], int, int)&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Throws &lt;code&gt;NotSupportedException&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;Flush()&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Throws &lt;code&gt;NotSupportedException&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;Seek(long, SeekOrigin)&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Throws &lt;code&gt;NotSupportedException&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;SetLength(long)&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Throws &lt;code&gt;NotSupportedException&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;Length&lt;/code&gt; (property)&lt;/td&gt;
          &lt;td&gt;Throws &lt;code&gt;NotSupportedException&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;Position&lt;/code&gt; (property)&lt;/td&gt;
          &lt;td&gt;Throws &lt;code&gt;NotSupportedException&lt;/code&gt;&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h2&gt;Disposal&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;disposal&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#disposal&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;protected&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;override&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Dispose&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;disposing&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Idempotent disposal using an interlocked guard. Disposes the underlying connection. Safe to call multiple times.&lt;/p&gt;
&lt;h2&gt;Usage Example&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;usage-example&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#usage-example&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;async&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Task&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;HandleWithStreamAsync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Connection&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;await&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;using&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;stream&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ConnectionStream&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;4096&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bytesRead&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bytesRead&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;await&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;stream&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ReadAsync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;// Process data in buffer[..bytesRead]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;c1&#34;&gt;// Echo back&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;await&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;stream&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;WriteAsync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;AsMemory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bytesRead&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;await&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;stream&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;FlushAsync&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2&gt;When to Use ConnectionStream&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;when-to-use-connectionstream&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#when-to-use-connectionstream&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;Use &lt;code&gt;ConnectionStream&lt;/code&gt; when you need to integrate with APIs that require &lt;code&gt;Stream&lt;/code&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;System.Text.Json&lt;/code&gt; serialization/deserialization&lt;/li&gt;
&lt;li&gt;&lt;code&gt;StreamReader&lt;/code&gt;/&lt;code&gt;StreamWriter&lt;/code&gt; for text protocols&lt;/li&gt;
&lt;li&gt;Third-party libraries that accept &lt;code&gt;Stream&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;PipeReader&lt;/code&gt;/&lt;code&gt;PipeWriter&lt;/code&gt; adapters&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;For maximum performance, prefer the native &lt;code&gt;Connection&lt;/code&gt; API directly (&lt;code&gt;ReadAsync&lt;/code&gt;/&lt;code&gt;Write&lt;/code&gt;/&lt;code&gt;FlushAsync&lt;/code&gt;). &lt;code&gt;ConnectionStream&lt;/code&gt; adds one copy on reads (from kernel buffers into your destination buffer) and wraps &lt;code&gt;ValueTask&lt;/code&gt; as &lt;code&gt;Task&lt;/code&gt; for &lt;code&gt;FlushAsync&lt;/code&gt;.&lt;/p&gt;
&lt;h2&gt;Design Notes&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;design-notes&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#design-notes&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;No internal buffering:&lt;/strong&gt; Reads pull directly from reactor rings; writes go directly to the slab&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;No synchronization:&lt;/strong&gt; The reactor provides exclusivity guarantees&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Single copy on read:&lt;/strong&gt; Data is copied from kernel-provided buffers into the caller&amp;rsquo;s buffer&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Zero-copy on write:&lt;/strong&gt; Data is copied into the slab (same as native &lt;code&gt;Write()&lt;/code&gt;)&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
    <item>
      <title>Memory Management</title>
      <link>http://localhost:1313/zerg/docs/internals/memory-management/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>http://localhost:1313/zerg/docs/internals/memory-management/</guid>
      <description>
        
        
        &lt;p&gt;zerg minimizes GC pressure by using unmanaged memory for all hot-path data: receive buffers, write slabs, and inflight buffers. This page describes the memory management strategy.&lt;/p&gt;
&lt;h2&gt;Unmanaged Allocations&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;unmanaged-allocations&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#unmanaged-allocations&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;All performance-critical buffers are allocated outside the managed heap:&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;Component&lt;/th&gt;
          &lt;th&gt;Size&lt;/th&gt;
          &lt;th&gt;Alignment&lt;/th&gt;
          &lt;th&gt;Lifetime&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;Buffer ring slab&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;BufferRingEntries * RecvBufferSize&lt;/code&gt; per reactor&lt;/td&gt;
          &lt;td&gt;64 bytes&lt;/td&gt;
          &lt;td&gt;Reactor lifetime&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Write slab&lt;/td&gt;
          &lt;td&gt;16 KB per connection (configurable)&lt;/td&gt;
          &lt;td&gt;64 bytes&lt;/td&gt;
          &lt;td&gt;Connection lifetime&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Inflight buffer&lt;/td&gt;
          &lt;td&gt;User-defined (typically 16 KB) per handler&lt;/td&gt;
          &lt;td&gt;64 bytes&lt;/td&gt;
          &lt;td&gt;Handler lifetime&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h3&gt;Why 64-Byte Alignment?&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;why-64-byte-alignment&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#why-64-byte-alignment&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;64 bytes is a common L1 cache line size on x86_64. Aligned allocations prevent false sharing and ensure optimal memory access patterns for DMA operations used by the kernel.&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ptr&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;*)&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NativeMemory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;AlignedAlloc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;nuint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// ...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;NativeMemory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;AlignedFree&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2&gt;UnmanagedMemoryManager&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;unmanagedmemorymanager&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#unmanagedmemorymanager&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;The &lt;code&gt;UnmanagedMemoryManager&lt;/code&gt; class bridges unmanaged pointers and .NET&amp;rsquo;s managed memory model:&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;sealed&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;unsafe&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;UnmanagedMemoryManager&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;MemoryManager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_ptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;ushort&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;BufferId&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_freeable&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Span&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;GetSpan&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Span&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_ptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;MemoryHandle&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Pin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;elementIndex&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;MemoryHandle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_ptr&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;elementIndex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Unpin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// no-op: already unmanaged&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Free&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_freeable&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NativeMemory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;AlignedFree&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_ptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;This enables zero-copy interop between kernel buffers and .NET APIs that accept &lt;code&gt;Memory&amp;lt;byte&amp;gt;&lt;/code&gt;, &lt;code&gt;ReadOnlyMemory&amp;lt;byte&amp;gt;&lt;/code&gt;, or &lt;code&gt;ReadOnlySequence&amp;lt;byte&amp;gt;&lt;/code&gt;.&lt;/p&gt;
&lt;h3&gt;Constructors&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;constructors&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#constructors&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;Constructor&lt;/th&gt;
          &lt;th&gt;Freeable&lt;/th&gt;
          &lt;th&gt;Use Case&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;(byte* ptr, int length)&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Yes&lt;/td&gt;
          &lt;td&gt;Owned unmanaged allocations&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;(byte* ptr, int length, bool freeable)&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Configurable&lt;/td&gt;
          &lt;td&gt;Borrowed pointers (e.g., buffer ring)&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;(byte* ptr, int length, ushort bufferId)&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Yes&lt;/td&gt;
          &lt;td&gt;Recv buffers with buffer ring ID&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;(byte* ptr, int length, ushort bufferId, bool freeable)&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Configurable&lt;/td&gt;
          &lt;td&gt;Full control&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;For buffer ring receive data, &lt;code&gt;freeable&lt;/code&gt; is typically &lt;code&gt;false&lt;/code&gt; because the buffer belongs to the reactor&amp;rsquo;s slab and is returned, not freed.&lt;/p&gt;
&lt;h3&gt;Usage Pattern&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;usage-pattern&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#usage-pattern&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Wrap kernel buffer in managed view&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;manager&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;UnmanagedMemoryManager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ring&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Ptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ring&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ring&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;BufferId&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;freeable&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ReadOnlyMemory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;memory&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;manager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Memory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// zero allocation&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2&gt;Buffer Ring Slab&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;buffer-ring-slab&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#buffer-ring-slab&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;Each reactor pre-allocates a contiguous slab for receive buffers:&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Buffer Ring Slab                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Buffer 0 â”‚ Buffer 1 â”‚ Buffer 2 â”‚ ... â”‚ Buffer N â”‚       â”‚
â”‚  â”‚ 32 KB    â”‚ 32 KB    â”‚ 32 KB    â”‚     â”‚ 32 KB    â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚  ^ slab                                                     â”‚
â”‚  ^ slab &amp;#43; 0 * bufSize                                       â”‚
â”‚  ^ slab &amp;#43; 1 * bufSize                                       â”‚
â”‚  ^ slab &amp;#43; 2 * bufSize                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Address formula:&lt;/strong&gt; &lt;code&gt;bufferPtr = slab + bufferId * RecvBufferSize&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;The kernel writes directly into these buffers via the buffer ring. When the handler is done, the buffer ID is returned and the same slot is reused for future receives.&lt;/p&gt;
&lt;h2&gt;Write Slab&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;write-slab&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#write-slab&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;Each connection owns a write slab (default 16 KB):&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;writeSlabSize&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1024&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;16&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;_writeSlabSize&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;writeSlabSize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;_manager&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;UnmanagedMemoryManager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;*)&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NativeMemory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;AlignedAlloc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;nuint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;writeSlabSize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;writeSlabSize&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;The slab lifecycle:&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;  Write(data)  â†’  Advance WriteTail  â†’  FlushAsync()  â†’  Reactor sends  â†’  Reset(Head=0, Tail=0)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;The slab is never freed and reallocated during the connection&amp;rsquo;s lifetime &amp;ndash; it&amp;rsquo;s allocated once and reused.&lt;/p&gt;
&lt;h3&gt;Disposal&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;disposal&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#disposal&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Dispose&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;_manager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Free&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// NativeMemory.AlignedFree&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;_manager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Dispose&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2&gt;Connection Pooling&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;connection-pooling&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#connection-pooling&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;Connections can be pooled to avoid repeated unmanaged allocation. The reset methods prepare a connection for reuse:&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;Method&lt;/th&gt;
          &lt;th&gt;Speed&lt;/th&gt;
          &lt;th&gt;Safety&lt;/th&gt;
          &lt;th&gt;Use When&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;Clear()&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Slower&lt;/td&gt;
          &lt;td&gt;Cancels pending waiters&lt;/td&gt;
          &lt;td&gt;Connection may have outstanding async operations&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;Clear2()&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Faster&lt;/td&gt;
          &lt;td&gt;No waiter cancellation&lt;/td&gt;
          &lt;td&gt;Handler has definitely exited&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Both methods:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Increment &lt;code&gt;_generation&lt;/code&gt; (invalidates stale ValueTask tokens)&lt;/li&gt;
&lt;li&gt;Set &lt;code&gt;_closed = 1&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Clear the SPSC receive ring&lt;/li&gt;
&lt;li&gt;Reset write buffer state&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The generation counter is the key safety mechanism: any ValueTask created before the reset will observe a mismatched token and return &lt;code&gt;Closed&lt;/code&gt; instead of accessing stale data.&lt;/p&gt;
&lt;h2&gt;ReadOnlySequence Construction&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;readonlysequence-construction&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#readonlysequence-construction&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;When received data spans multiple kernel buffers, &lt;code&gt;UnmanagedMemoryManager&lt;/code&gt; instances are linked into a &lt;code&gt;ReadOnlySequence&amp;lt;byte&amp;gt;&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ReadOnlySequence&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ToReadOnlySequence&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;this&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;UnmanagedMemoryManager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;managers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;This creates a chain of &lt;code&gt;RingSegment&lt;/code&gt; objects (custom &lt;code&gt;ReadOnlySequenceSegment&amp;lt;byte&amp;gt;&lt;/code&gt; subclass) that link the managed views:&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;[Manager0.Memory] â†’ [Manager1.Memory] â†’ [Manager2.Memory]
      â†“                    â†“                    â†“
   Segment0 â”€â”€nextâ”€â”€â–¶ Segment1 â”€â”€nextâ”€â”€â–¶ Segment2&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;The resulting &lt;code&gt;ReadOnlySequence&amp;lt;byte&amp;gt;&lt;/code&gt; can be parsed with &lt;code&gt;SequenceReader&amp;lt;byte&amp;gt;&lt;/code&gt; for efficient multi-segment processing.&lt;/p&gt;
&lt;h2&gt;Memory Copy Helpers&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;memory-copy-helpers&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#memory-copy-helpers&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;The &lt;code&gt;MemoryExtensions&lt;/code&gt; class provides optimized copy operations:&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Copy from native pointer to managed Memory&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;CopyFrom&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;this&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Memory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;dst&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;src&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Copy from RingItem to managed Memory&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;CopyFromRing&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;this&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Memory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;dst&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;ref&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RingItem&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ring&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Copy from array of RingItems to managed Memory&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;CopyFromRings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;this&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Memory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;dst&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RingItem&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ring&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;All use &lt;code&gt;Buffer.MemoryCopy&lt;/code&gt; for efficient native-to-managed copying with bounds checking.&lt;/p&gt;
&lt;h2&gt;GC Pressure Analysis&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;gc-pressure-analysis&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#gc-pressure-analysis&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;Operation&lt;/th&gt;
          &lt;th&gt;Allocations&lt;/th&gt;
          &lt;th&gt;Notes&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;ReadAsync()&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;0&lt;/td&gt;
          &lt;td&gt;ValueTask-based, no state machine allocation&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;FlushAsync()&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;0&lt;/td&gt;
          &lt;td&gt;ValueTask-based&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;Write(span)&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;0&lt;/td&gt;
          &lt;td&gt;Direct memcpy to unmanaged slab&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;GetSpan() + Advance()&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;0&lt;/td&gt;
          &lt;td&gt;Direct pointer arithmetic&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;TryGetRing()&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;0&lt;/td&gt;
          &lt;td&gt;Returns struct by value&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;ReturnRing()&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;0&lt;/td&gt;
          &lt;td&gt;Enqueues ushort to MPSC queue&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;ring.AsSpan()&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;0&lt;/td&gt;
          &lt;td&gt;Creates Span over existing pointer&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;GetAllSnapshotRingsAsUnmanagedMemory()&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;1 array&lt;/td&gt;
          &lt;td&gt;Allocates UnmanagedMemoryManager[]&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;ToReadOnlySequence()&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;N segments&lt;/td&gt;
          &lt;td&gt;Allocates RingSegment per buffer&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;ConnectionStream.ReadAsync()&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;1 array + segments&lt;/td&gt;
          &lt;td&gt;Copies data to managed buffer&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;For the lowest allocation rate, use &lt;code&gt;TryGetRing()&lt;/code&gt; in a loop and process data via &lt;code&gt;ring.AsSpan()&lt;/code&gt;.&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Performance Tuning</title>
      <link>http://localhost:1313/zerg/docs/guides/performance-tuning/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>http://localhost:1313/zerg/docs/guides/performance-tuning/</guid>
      <description>
        
        
        &lt;p&gt;This guide covers the key tunables in zerg and how to adjust them for your workload.&lt;/p&gt;
&lt;h2&gt;Reactor Count&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;reactor-count&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#reactor-count&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;ReactorCount&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Environment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ProcessorCount&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Rule of thumb:&lt;/strong&gt; Start with one reactor per CPU core. Each reactor runs a tight event loop on a dedicated thread, so more reactors than cores leads to context switching overhead.&lt;/p&gt;
&lt;p&gt;For mixed workloads (some connections do async I/O like database calls), you may benefit from slightly more reactors than cores since handler tasks yield to the thread pool during awaits.&lt;/p&gt;
&lt;h2&gt;CQ Timeout&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;cq-timeout&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#cq-timeout&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;CqTimeout&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1_000_000&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// nanoseconds (1 ms)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;The CQ timeout controls how long the reactor sleeps when no completions are available.&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;Value&lt;/th&gt;
          &lt;th&gt;Tail Latency&lt;/th&gt;
          &lt;th&gt;CPU Usage&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;100_000&lt;/code&gt; (0.1 ms)&lt;/td&gt;
          &lt;td&gt;Very low&lt;/td&gt;
          &lt;td&gt;High (more frequent wakeups)&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;1_000_000&lt;/code&gt; (1 ms)&lt;/td&gt;
          &lt;td&gt;Low&lt;/td&gt;
          &lt;td&gt;Moderate (default)&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;10_000_000&lt;/code&gt; (10 ms)&lt;/td&gt;
          &lt;td&gt;Moderate&lt;/td&gt;
          &lt;td&gt;Low&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;100_000_000&lt;/code&gt; (100 ms)&lt;/td&gt;
          &lt;td&gt;High&lt;/td&gt;
          &lt;td&gt;Very low&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;For latency-sensitive servers, use 0.1-1 ms. For background or batch-oriented servers, 10-100 ms is fine.&lt;/p&gt;
&lt;p&gt;The acceptor uses 100 ms by default since accept bursts are infrequent.&lt;/p&gt;
&lt;h2&gt;Buffer Ring Sizing&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;buffer-ring-sizing&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#buffer-ring-sizing&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;h3&gt;RecvBufferSize&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;recvbuffersize&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#recvbuffersize&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;RecvBufferSize&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;32&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1024&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// 32 KB per buffer&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Each kernel recv writes into one of these buffers. If a recv delivers more data than the buffer size, the kernel fills the buffer and the remainder arrives in the next CQE.&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;Workload&lt;/th&gt;
          &lt;th&gt;Recommended Size&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;Small messages (HTTP/1.1 requests)&lt;/td&gt;
          &lt;td&gt;4-8 KB&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Mixed traffic&lt;/td&gt;
          &lt;td&gt;16-32 KB (default)&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Large uploads/downloads&lt;/td&gt;
          &lt;td&gt;64-128 KB&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Websockets with large frames&lt;/td&gt;
          &lt;td&gt;64+ KB&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h3&gt;BufferRingEntries&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;bufferringentries&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#bufferringentries&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;BufferRingEntries&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;16&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1024&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// 16384 buffers&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Total receive buffers available to the kernel per reactor. Must be a power of two.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Size it based on:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;MaxConnectionsPerReactor&lt;/code&gt; &amp;ndash; at minimum, one buffer per active connection&lt;/li&gt;
&lt;li&gt;Data holding time &amp;ndash; if handlers hold buffers during async work, you need more&lt;/li&gt;
&lt;li&gt;Burst capacity &amp;ndash; buffers to absorb data bursts without stalling&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Memory impact:&lt;/strong&gt; &lt;code&gt;BufferRingEntries * RecvBufferSize&lt;/code&gt; per reactor.&lt;/p&gt;
&lt;h2&gt;Ring Entries&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;ring-entries&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#ring-entries&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;RingEntries&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;8192&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;The SQ/CQ size. This is the maximum number of in-flight I/O operations:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;One multishot recv per active connection&lt;/li&gt;
&lt;li&gt;One send per flushing connection&lt;/li&gt;
&lt;li&gt;Cancel operations&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Should be &amp;gt;= &lt;code&gt;MaxConnectionsPerReactor&lt;/code&gt; to avoid running out of SQE slots.&lt;/p&gt;
&lt;h2&gt;Batch CQEs&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;batch-cqes&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#batch-cqes&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;BatchCqes&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;4096&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Maximum CQEs processed per loop iteration. Larger values improve throughput under load by amortizing loop overhead, but increase per-loop latency (time to service all CQEs before sleeping again).&lt;/p&gt;
&lt;p&gt;For latency-sensitive applications, consider reducing this to 256-1024.&lt;/p&gt;
&lt;h2&gt;SQPOLL&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;sqpoll&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#sqpoll&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;SQPOLL mode creates a kernel thread that continuously polls the submission queue:&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ReactorConfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;RingFlags&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ABI&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;IORING_SETUP_SQPOLL&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ABI&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;IORING_SETUP_SQ_AFF&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ABI&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;IORING_SETUP_SINGLE_ISSUER&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;SqCpuThread&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;        &lt;span class=&#34;c1&#34;&gt;// pin to CPU 4&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;SqThreadIdleMs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;     &lt;span class=&#34;c1&#34;&gt;// sleep after 200ms idle&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Benefits:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Eliminates the &lt;code&gt;io_uring_enter()&lt;/code&gt; syscall for submissions&lt;/li&gt;
&lt;li&gt;Reduced per-submission latency&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Costs:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Dedicates one CPU core per reactor&lt;/li&gt;
&lt;li&gt;Increased power consumption&lt;/li&gt;
&lt;li&gt;Requires &lt;code&gt;CAP_SYS_NICE&lt;/code&gt; or appropriate permissions in containers&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;When to enable:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;You have spare cores (total cores &amp;gt; 2 * reactor count)&lt;/li&gt;
&lt;li&gt;Submission latency is your bottleneck&lt;/li&gt;
&lt;li&gt;You&amp;rsquo;re already saturating network bandwidth&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;When to avoid:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Core-constrained environments (containers, small VMs)&lt;/li&gt;
&lt;li&gt;Acceptor ring (multishot accept generates CQEs from interrupts, not submissions)&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;DEFER_TASKRUN&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;defer_taskrun&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#defer_taskrun&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;RingFlags&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ABI&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;IORING_SETUP_SINGLE_ISSUER&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ABI&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;IORING_SETUP_DEFER_TASKRUN&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;This is the &lt;strong&gt;default&lt;/strong&gt; for reactors. It tells the kernel to defer task_work (completion callbacks) until the next &lt;code&gt;io_uring_enter()&lt;/code&gt; call, rather than running them in interrupt context.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Benefits:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Completions arrive at predictable points in the reactor loop&lt;/li&gt;
&lt;li&gt;Reduces latency spikes from interrupt-context work&lt;/li&gt;
&lt;li&gt;Better cache behavior&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;When to disable:&lt;/strong&gt; Rarely. Only if you&amp;rsquo;re seeing issues with specific kernel versions.&lt;/p&gt;
&lt;h2&gt;Connection Limits&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;connection-limits&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#connection-limits&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;MaxConnectionsPerReactor&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;8192&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Upper bound on concurrent connections per reactor. This is a logical limit, not a hard allocation.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Scaling formula:&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Total concurrent connections = &lt;code&gt;ReactorCount * MaxConnectionsPerReactor&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;With defaults: 1 * 8192 = 8,192 connections&lt;/li&gt;
&lt;li&gt;With 12 reactors: 12 * 8192 = 98,304 connections&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Ensure &lt;code&gt;MaxConnectionsPerReactor &amp;lt;= RingEntries&lt;/code&gt; to avoid SQE exhaustion.&lt;/p&gt;
&lt;h2&gt;Listen Backlog&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;listen-backlog&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#listen-backlog&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Backlog&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;65535&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Kernel queue for pending connections (accepted by kernel but not yet accepted by userspace). 65535 is the Linux maximum. Reduce only if you want to reject connections under load.&lt;/p&gt;
&lt;h2&gt;Benchmarking Tips&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;benchmarking-tips&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#benchmarking-tips&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;Warm up&lt;/strong&gt; &amp;ndash; run at least 10 seconds of load before measuring&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Pin cores&lt;/strong&gt; &amp;ndash; use CPU affinity to prevent migration&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Disable turbo boost&lt;/strong&gt; &amp;ndash; for consistent results, disable CPU frequency scaling&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Use wrk or h2load&lt;/strong&gt; &amp;ndash; standard HTTP benchmarking tools&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Watch for kernel limits&lt;/strong&gt; &amp;ndash; check &lt;code&gt;ulimit -n&lt;/code&gt; (file descriptor limit) and &lt;code&gt;net.core.somaxconn&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Profile with perf&lt;/strong&gt; &amp;ndash; &lt;code&gt;perf top&lt;/code&gt; shows where CPU time is spent&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;System Tuning&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;system-tuning&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#system-tuning&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Increase file descriptor limit&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;ulimit&lt;/span&gt; -n &lt;span class=&#34;m&#34;&gt;1000000&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Increase somaxconn (listen backlog limit)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sysctl -w net.core.somaxconn&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;65535&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Increase local port range (for clients)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sysctl -w net.ipv4.ip_local_port_range&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;1024 65535&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Disable TCP timestamps (minor latency improvement)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;sysctl -w net.ipv4.tcp_timestamps&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2&gt;Configuration Matrix&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;configuration-matrix&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#configuration-matrix&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;Scenario&lt;/th&gt;
          &lt;th&gt;ReactorCount&lt;/th&gt;
          &lt;th&gt;RecvBufferSize&lt;/th&gt;
          &lt;th&gt;BufferRingEntries&lt;/th&gt;
          &lt;th&gt;CqTimeout&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;Low-latency API&lt;/td&gt;
          &lt;td&gt;CPU count&lt;/td&gt;
          &lt;td&gt;4 KB&lt;/td&gt;
          &lt;td&gt;8192&lt;/td&gt;
          &lt;td&gt;100,000 ns&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;HTTP server&lt;/td&gt;
          &lt;td&gt;CPU count&lt;/td&gt;
          &lt;td&gt;32 KB&lt;/td&gt;
          &lt;td&gt;16384&lt;/td&gt;
          &lt;td&gt;1,000,000 ns&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Proxy/gateway&lt;/td&gt;
          &lt;td&gt;CPU count&lt;/td&gt;
          &lt;td&gt;64 KB&lt;/td&gt;
          &lt;td&gt;32768&lt;/td&gt;
          &lt;td&gt;500,000 ns&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;File transfer&lt;/td&gt;
          &lt;td&gt;CPU count / 2&lt;/td&gt;
          &lt;td&gt;128 KB&lt;/td&gt;
          &lt;td&gt;4096&lt;/td&gt;
          &lt;td&gt;10,000,000 ns&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;IoT/many connections&lt;/td&gt;
          &lt;td&gt;CPU count&lt;/td&gt;
          &lt;td&gt;2 KB&lt;/td&gt;
          &lt;td&gt;65536&lt;/td&gt;
          &lt;td&gt;1,000,000 ns&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

      </description>
    </item>
    
    <item>
      <title>Configuration Reference</title>
      <link>http://localhost:1313/zerg/docs/api-reference/configuration/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>http://localhost:1313/zerg/docs/api-reference/configuration/</guid>
      <description>
        
        
        &lt;p&gt;Complete reference for all configuration types in zerg.&lt;/p&gt;
&lt;h2&gt;EngineOptions&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;engineoptions&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#engineoptions&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;Top-level configuration passed to &lt;code&gt;new Engine(options)&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;EngineOptions&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ReactorCount&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;init&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Ip&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;init&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;0.0.0.0&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;ushort&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Port&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;init&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;8080&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Backlog&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;init&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;65535&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AcceptorConfig&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AcceptorConfig&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;init&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ReactorConfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ReactorConfigs&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;set&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;!;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;Property&lt;/th&gt;
          &lt;th&gt;Type&lt;/th&gt;
          &lt;th&gt;Default&lt;/th&gt;
          &lt;th&gt;Description&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;ReactorCount&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;int&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;1&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Number of reactor event-loop threads. Each gets its own &lt;code&gt;io_uring&lt;/code&gt;.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;Ip&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;string&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;&amp;quot;0.0.0.0&amp;quot;&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Bind address. &lt;code&gt;&amp;quot;0.0.0.0&amp;quot;&lt;/code&gt; for all IPv4, &lt;code&gt;&amp;quot;::&amp;quot;&lt;/code&gt; for all IPv6.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;Port&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;ushort&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;8080&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;TCP listen port.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;Backlog&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;int&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;65535&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Kernel listen backlog (pending connection queue size).&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;AcceptorConfig&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;AcceptorConfig&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;new()&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Acceptor ring configuration.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;ReactorConfigs&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;ReactorConfig[]&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;null&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Per-reactor configs. Auto-filled with defaults if null.&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h2&gt;ReactorConfig&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;reactorconfig&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#reactorconfig&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;Per-reactor configuration. Sealed record with default values.&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;sealed&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;record&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;ReactorConfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;uint&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RingFlags&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;IORING_SETUP_SINGLE_ISSUER&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;IORING_SETUP_DEFER_TASKRUN&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;SqCpuThread&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;uint&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;SqThreadIdleMs&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;uint&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RingEntries&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;8&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1024&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RecvBufferSize&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;32&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1024&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;BufferRingEntries&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;16&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1024&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;BatchCqes&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;4096&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;MaxConnectionsPerReactor&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;8&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1024&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;long&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;CqTimeout&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1_000_000&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;Property&lt;/th&gt;
          &lt;th&gt;Type&lt;/th&gt;
          &lt;th&gt;Default&lt;/th&gt;
          &lt;th&gt;Description&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;RingFlags&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;uint&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;SINGLE_ISSUER | DEFER_TASKRUN&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;io_uring&lt;/code&gt; setup flags. Controls kernel behavior.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;SqCpuThread&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;int&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;-1&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;CPU core for SQPOLL thread. &lt;code&gt;-1&lt;/code&gt; = kernel decides. Only with &lt;code&gt;SQPOLL&lt;/code&gt;.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;SqThreadIdleMs&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;uint&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;100&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;SQPOLL idle timeout (ms) before kernel thread sleeps.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;RingEntries&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;uint&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;8192&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;SQ/CQ ring size. Max in-flight I/O operations.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;RecvBufferSize&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;int&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;32768&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Bytes per receive buffer. Larger = fewer buffers for big payloads.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;BufferRingEntries&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;int&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;16384&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Number of recv buffers in buffer ring. Must be power of 2.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;BatchCqes&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;int&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;4096&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Max CQEs processed per event loop iteration.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;MaxConnectionsPerReactor&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;int&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;8192&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Connection limit per reactor. Should be &amp;lt;= &lt;code&gt;RingEntries&lt;/code&gt;.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;CqTimeout&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;long&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;1000000&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Wait timeout in nanoseconds (1 ms). Lower = lower latency, more CPU.&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h2&gt;AcceptorConfig&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;acceptorconfig&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#acceptorconfig&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;Acceptor thread configuration. Sealed record with default values.&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;sealed&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;record&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;AcceptorConfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;uint&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RingFlags&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;SqCpuThread&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;uint&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;SqThreadIdleMs&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;uint&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RingEntries&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;8&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1024&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;uint&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;BatchSqes&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;4096&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;kt&#34;&gt;long&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;CqTimeout&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;100_000_000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;IPVersion&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;IPVersion&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;IPVersion&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;IPv6DualStack&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;Property&lt;/th&gt;
          &lt;th&gt;Type&lt;/th&gt;
          &lt;th&gt;Default&lt;/th&gt;
          &lt;th&gt;Description&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;RingFlags&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;uint&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;0&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;io_uring&lt;/code&gt; setup flags for the acceptor ring.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;SqCpuThread&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;int&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;-1&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;CPU core for SQPOLL thread.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;SqThreadIdleMs&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;uint&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;100&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;SQPOLL idle timeout (ms).&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;RingEntries&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;uint&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;8192&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;SQ/CQ size. Bounds accept CQE burst capacity.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;BatchSqes&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;uint&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;4096&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Max accept completions per loop iteration.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;CqTimeout&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;long&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;100000000&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Wait timeout in ns (100 ms). Higher than reactor since accepts are bursty.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;IPVersion&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;IPVersion&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;IPv6DualStack&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;IP stack for the listening socket.&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h2&gt;IPVersion&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;ipversion&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#ipversion&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;enum&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;IPVersion&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;IPv4Only&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;IPv6DualStack&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;Value&lt;/th&gt;
          &lt;th&gt;Socket&lt;/th&gt;
          &lt;th&gt;Description&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;IPv4Only&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;AF_INET&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;IPv4 only.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;IPv6DualStack&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;AF_INET6&lt;/code&gt; (&lt;code&gt;V6ONLY=0&lt;/code&gt;)&lt;/td&gt;
          &lt;td&gt;Accepts both IPv4 and IPv6. IPv4 clients appear as &lt;code&gt;::ffff:a.b.c.d&lt;/code&gt;.&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h2&gt;io_uring Setup Flags&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;io_uring-setup-flags&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#io_uring-setup-flags&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;Available constants from the &lt;code&gt;ABI&lt;/code&gt; class for use in &lt;code&gt;RingFlags&lt;/code&gt;:&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;Flag&lt;/th&gt;
          &lt;th&gt;Value&lt;/th&gt;
          &lt;th&gt;Description&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;IORING_SETUP_IOPOLL&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;1 &amp;lt;&amp;lt; 0&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Polling-based I/O (not recommended for sockets).&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;IORING_SETUP_SQPOLL&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;1 &amp;lt;&amp;lt; 1&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Kernel thread polls SQ. Eliminates submit syscall.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;IORING_SETUP_SQ_AFF&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;1 &amp;lt;&amp;lt; 2&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Pin SQPOLL thread to &lt;code&gt;SqCpuThread&lt;/code&gt;.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;IORING_SETUP_CQSIZE&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;1 &amp;lt;&amp;lt; 3&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Custom CQ size (separate from SQ).&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;IORING_SETUP_CLAMP&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;1 &amp;lt;&amp;lt; 4&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Clamp queue sizes to kernel limits.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;IORING_SETUP_SINGLE_ISSUER&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;1 &amp;lt;&amp;lt; 12&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Single thread submits. Reduces kernel locking.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;IORING_SETUP_DEFER_TASKRUN&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;1 &amp;lt;&amp;lt; 13&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Defer task_work. Reduces latency spikes.&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;IORING_SETUP_NO_MMAP&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;1 &amp;lt;&amp;lt; 14&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Don&amp;rsquo;t mmap rings (use registered buffers).&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;IORING_SETUP_REGISTERED_FD_ONLY&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;&lt;code&gt;1 &amp;lt;&amp;lt; 15&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Only allow registered file descriptors.&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h2&gt;Configuration Examples&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;configuration-examples&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#configuration-examples&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;h3&gt;High-Throughput Server&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;high-throughput-server&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#high-throughput-server&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;engine&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Engine&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EngineOptions&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;Port&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;8080&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;ReactorCount&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Environment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ProcessorCount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;ReactorConfigs&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Enumerable&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Range&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Environment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ProcessorCount&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Select&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ReactorConfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;RingEntries&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;16384&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;RecvBufferSize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;64&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1024&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;BufferRingEntries&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;32&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1024&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;BatchCqes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;8192&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;MaxConnectionsPerReactor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;16384&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;CqTimeout&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;500_000&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// 0.5 ms&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;)).&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ToArray&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;});&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h3&gt;Low-Latency Server with SQPOLL&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;low-latency-server-with-sqpoll&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#low-latency-server-with-sqpoll&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;engine&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Engine&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EngineOptions&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;Port&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;8080&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;ReactorCount&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;ReactorConfigs&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Enumerable&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Range&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Select&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ReactorConfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;RingFlags&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ABI&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;IORING_SETUP_SQPOLL&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                     &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ABI&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;IORING_SETUP_SQ_AFF&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                     &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ABI&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;IORING_SETUP_SINGLE_ISSUER&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;SqCpuThread&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;      &lt;span class=&#34;c1&#34;&gt;// pin SQPOLL threads to CPUs 4-7&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;SqThreadIdleMs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;200&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;CqTimeout&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;100_000&lt;/span&gt;        &lt;span class=&#34;c1&#34;&gt;// 0.1 ms&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;)).&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ToArray&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;});&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h3&gt;Minimal Memory Footprint&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;minimal-memory-footprint&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#minimal-memory-footprint&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;engine&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Engine&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EngineOptions&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;Port&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;8080&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;ReactorCount&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;ReactorConfigs&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ReactorConfig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;RecvBufferSize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;4096&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;BufferRingEntries&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1024&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;MaxConnectionsPerReactor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;256&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;RingEntries&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;512&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;});&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;

      </description>
    </item>
    
    <item>
      <title>Threading Model</title>
      <link>http://localhost:1313/zerg/docs/architecture/threading-model/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>http://localhost:1313/zerg/docs/architecture/threading-model/</guid>
      <description>
        
        
        &lt;p&gt;zerg uses a fixed set of dedicated threads with strict ownership rules. Every piece of mutable state is owned by exactly one thread, and all cross-thread communication happens through lock-free queues with well-defined memory ordering.&lt;/p&gt;
&lt;h2&gt;Thread Layout&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;thread-layout&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#thread-layout&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Acceptor Thread â”‚  1 thread
â”‚  (io_uring)      â”‚  Accepts connections, distributes fds
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ ConcurrentQueue&amp;lt;int&amp;gt; per reactor
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Reactor 0    â”‚  â”‚  Reactor 1    â”‚  â”‚  Reactor N    â”‚  N threads
â”‚  (io_uring)   â”‚  â”‚  (io_uring)   â”‚  â”‚  (io_uring)   â”‚  Event loops
â”‚  (buf_ring)   â”‚  â”‚  (buf_ring)   â”‚  â”‚  (buf_ring)   â”‚
â”‚  (conn dict)  â”‚  â”‚  (conn dict)  â”‚  â”‚  (conn dict)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                  â”‚                  â”‚
        â–¼                  â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Handler Tasksâ”‚  â”‚  Handler Tasksâ”‚  â”‚  Handler Tasksâ”‚  Task pool
â”‚  (async/await)â”‚  â”‚  (async/await)â”‚  â”‚  (async/await)â”‚  User code
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h3&gt;Thread Count&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;thread-count&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#thread-count&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;Total threads = 1 (acceptor) + N (reactors), where N = &lt;code&gt;EngineOptions.ReactorCount&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Handler tasks run on the .NET thread pool and are not dedicated threads. Multiple handler tasks may be active per reactor, but each connection&amp;rsquo;s &lt;code&gt;ReadAsync&lt;/code&gt;/&lt;code&gt;FlushAsync&lt;/code&gt; enforces single-waiter semantics.&lt;/p&gt;
&lt;h2&gt;Ownership Rules&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;ownership-rules&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#ownership-rules&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;State&lt;/th&gt;
          &lt;th&gt;Owner&lt;/th&gt;
          &lt;th&gt;Accessed By&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;Acceptor &lt;code&gt;io_uring&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Acceptor thread&lt;/td&gt;
          &lt;td&gt;Acceptor only&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Reactor &lt;code&gt;io_uring&lt;/code&gt;&lt;/td&gt;
          &lt;td&gt;Reactor thread&lt;/td&gt;
          &lt;td&gt;Reactor only&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Buffer ring&lt;/td&gt;
          &lt;td&gt;Reactor thread&lt;/td&gt;
          &lt;td&gt;Reactor (add/advance), handler (ReturnRing via MPSC queue)&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;connections&lt;/code&gt; dict&lt;/td&gt;
          &lt;td&gt;Reactor thread&lt;/td&gt;
          &lt;td&gt;Reactor only&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Connection read state (&lt;code&gt;_recv&lt;/code&gt;, &lt;code&gt;_armed&lt;/code&gt;, etc.)&lt;/td&gt;
          &lt;td&gt;Split&lt;/td&gt;
          &lt;td&gt;Reactor produces, handler consumes&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;Connection write slab&lt;/td&gt;
          &lt;td&gt;Handler&lt;/td&gt;
          &lt;td&gt;Handler writes, reactor reads during flush&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;code&gt;SendInflight&lt;/code&gt; flag&lt;/td&gt;
          &lt;td&gt;Reactor thread&lt;/td&gt;
          &lt;td&gt;Reactor writes (Volatile), handler reads&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;h2&gt;Cross-Thread Communication&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;cross-thread-communication&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#cross-thread-communication&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;All cross-thread data flow uses lock-free queues:&lt;/p&gt;
&lt;h3&gt;Acceptor â†’ Reactor: New Connections&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;acceptor--reactor-new-connections&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#acceptor--reactor-new-connections&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;ConcurrentQueue&amp;lt;int&amp;gt; ReactorQueues[reactorId]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;The acceptor enqueues integer file descriptors. Each reactor drains its queue at the start of every loop iteration. &lt;code&gt;.NET ConcurrentQueue&lt;/code&gt; provides full thread-safety.&lt;/p&gt;
&lt;h3&gt;Handler â†’ Reactor: Buffer Returns&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;handler--reactor-buffer-returns&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#handler--reactor-buffer-returns&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;MpscUshortQueue returnQ&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;When a handler calls &lt;code&gt;connection.ReturnRing(bufferId)&lt;/code&gt;, the &lt;code&gt;ushort&lt;/code&gt; buffer ID is enqueued to the reactor&amp;rsquo;s MPSC return queue. The reactor drains this queue and returns buffers to the kernel buffer ring.&lt;/p&gt;
&lt;h3&gt;Handler â†’ Reactor: Flush Requests&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;handler--reactor-flush-requests&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#handler--reactor-flush-requests&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;MpscIntQueue flushQ&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;When a handler calls &lt;code&gt;FlushAsync()&lt;/code&gt;, the connection&amp;rsquo;s client fd is enqueued to the reactor&amp;rsquo;s flush queue. The reactor drains this and issues &lt;code&gt;send&lt;/code&gt; SQEs.&lt;/p&gt;
&lt;h3&gt;Reactor â†’ Handler: Read Completion&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;reactor--handler-read-completion&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#reactor--handler-read-completion&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;SpscRecvRing _recv (per connection)
int _armed, _pending (atomics)
ManualResetValueTaskSourceCore&amp;lt;ReadResult&amp;gt; _readSignal&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;The reactor enqueues &lt;code&gt;RingItem&lt;/code&gt;s to the connection&amp;rsquo;s SPSC ring and wakes the handler via the ValueTask completion source.&lt;/p&gt;
&lt;h3&gt;Reactor â†’ Handler: Flush Completion&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;reactor--handler-flush-completion&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#reactor--handler-flush-completion&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;pre&gt;&lt;code&gt;ManualResetValueTaskSourceCore&amp;lt;bool&amp;gt; _flushSignal
int _flushArmed, _flushInProgress&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;When all staged bytes are sent, the reactor completes the flush signal, resuming the handler&amp;rsquo;s &lt;code&gt;await FlushAsync()&lt;/code&gt;.&lt;/p&gt;
&lt;h2&gt;Memory Ordering&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;memory-ordering&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#memory-ordering&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;zerg uses three levels of memory ordering:&lt;/p&gt;
&lt;h3&gt;Volatile Read/Write&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;volatile-readwrite&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#volatile-readwrite&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;Used for single-word flags where only visibility is needed:&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Volatile&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Write&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ref&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_closed&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;       &lt;span class=&#34;c1&#34;&gt;// publish close&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Volatile&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Read&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ref&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_pending&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;           &lt;span class=&#34;c1&#34;&gt;// check pending flag&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Volatile&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Write&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ref&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;SendInflight&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;   &lt;span class=&#34;c1&#34;&gt;// clear in-flight flag&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h3&gt;Interlocked (Full Fence)&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;interlocked-full-fence&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#interlocked-full-fence&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;Used in MPSC queues where multiple producers contend:&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Interlocked&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;CompareExchange&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ref&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_armed&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// atomically disarm&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Interlocked&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Increment&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ref&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_tail&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;                &lt;span class=&#34;c1&#34;&gt;// reserve MPSC slot&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h3&gt;Plain Reads (Single-Consumer)&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;plain-reads-single-consumer&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#plain-reads-single-consumer&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;The consumer side of SPSC/MPSC queues uses plain reads for &lt;code&gt;_head&lt;/code&gt; since only one thread reads and writes it:&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kt&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;head&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_head&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;                      &lt;span class=&#34;c1&#34;&gt;// only consumer writes _head&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;_head&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;head&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;                      &lt;span class=&#34;c1&#34;&gt;// safe: single writer&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2&gt;CPU Affinity&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;cpu-affinity&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#cpu-affinity&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;zerg provides optional CPU pinning for reactor threads via the &lt;code&gt;Affinity&lt;/code&gt; class:&lt;/p&gt;
&lt;div class=&#34;hextra-code-block hx:relative hx:mt-6 hx:first:mt-0 hx:group/code&#34;&gt;

&lt;div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-csharp&#34; data-lang=&#34;csharp&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;Affinity&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PinCurrentThreadToCpu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cpuId&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&#34;hextra-code-copy-btn-container hx:opacity-0 hx:transition hx:group-hover/code:opacity-100 hx:flex hx:gap-1 hx:absolute hx:m-[11px] hx:right-0 hx:top-0&#34;&gt;
  &lt;button
    class=&#34;hextra-code-copy-btn hx:group/copybtn hx:cursor-pointer hx:transition-all hx:active:opacity-50 hx:bg-primary-700/5 hx:border hx:border-black/5 hx:text-gray-600 hx:hover:text-gray-900 hx:rounded-md hx:p-1.5 hx:dark:bg-primary-300/10 hx:dark:border-white/10 hx:dark:text-gray-400 hx:dark:hover:text-gray-50&#34;
    title=&#34;Copy code&#34;
  &gt;
    &lt;div class=&#34;hextra-copy-icon hx:group-[.copied]/copybtn:hidden hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
&lt;div class=&#34;hextra-success-icon hx:hidden hx:group-[.copied]/copybtn:block hx:pointer-events-none hx:h-4 hx:w-4&#34;&gt;&lt;/div&gt;
  &lt;/button&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;This uses the Linux &lt;code&gt;sched_setaffinity&lt;/code&gt; syscall to bind a thread to a specific core. Pinning prevents the OS scheduler from migrating threads, which improves cache locality and reduces jitter.&lt;/p&gt;
&lt;p&gt;CPU pinning is optional and best-effort &amp;ndash; if it fails (e.g., in containers with CPU limits), the thread continues on whatever core the scheduler assigns.&lt;/p&gt;
&lt;h2&gt;Handler Task Execution&lt;span class=&#34;hx:absolute hx:-mt-20&#34; id=&#34;handler-task-execution&#34;&gt;&lt;/span&gt;
    &lt;a href=&#34;#handler-task-execution&#34; class=&#34;subheading-anchor&#34; aria-label=&#34;Permalink for this section&#34;&gt;&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;Handler tasks (&lt;code&gt;_ = HandleConnectionAsync(connection)&lt;/code&gt;) run on the .NET thread pool. When a handler awaits &lt;code&gt;ReadAsync()&lt;/code&gt; or &lt;code&gt;FlushAsync()&lt;/code&gt;:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;The handler task yields back to the thread pool&lt;/li&gt;
&lt;li&gt;The reactor thread completes the ValueTask source when data/flush is ready&lt;/li&gt;
&lt;li&gt;The handler resumes on a thread pool thread (not the reactor thread)&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;This means:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Reactor threads never execute user handler code&lt;/li&gt;
&lt;li&gt;Handlers never block reactor threads&lt;/li&gt;
&lt;li&gt;Multiple handlers can be active simultaneously per reactor&lt;/li&gt;
&lt;li&gt;&lt;code&gt;DEFER_TASKRUN&lt;/code&gt; ensures completions arrive at predictable points in the reactor loop&lt;/li&gt;
&lt;/ul&gt;

      </description>
    </item>
    
  </channel>
</rss>
